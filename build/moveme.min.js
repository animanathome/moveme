'use strict';MM={App:function(a,b){function c(a,b){var c,d,e,m,n;c=0;for(d=b.length;c<d;c++){n=m=0;for(e in b[c])a[e]===b[c][e]&&(m+=1),n+=1;if(m===n)return!0}return!1}console.log("MM.App",a,b);if(void 0===a)console.log("No parent dom element defined. Unable to continue.");else{void 0===b&&(b={});var d=this;this.dom=a;this.editor=new MM.Editor;this.editor.setupDefaultScene();this.editor.setupDefaultKeyScene();b.hasOwnProperty("isRenderer")?this.layout=new MM.NoLayout(a,this.editor):this.layout=new MM.Layout(a,
this.editor,b);var e=function(){requestAnimationFrame(e);d.editor.animate();d.layout.viewportLayout&&d.layout.viewportLayout.render()};e();d.editor.signals.objectSelected.dispatch();this.hotkeys={select:[{keyCode:81}],translate:[{keyCode:87}],rotate:[{keyCode:69}],scale:[{keyCode:82}],bigger:[{keyCode:178},{keyCode:107}],smaller:[{keyCode:189},{keyCode:109}],deleteSelected:[{keyCode:8},{keyCode:46}],frame:[{keyCode:70}],undo:[{shiftKey:!0,altKey:!1,ctrlKey:!1,keyCode:90}],redo:[{shiftKey:!1,altKey:!0,
ctrlKey:!1,keyCode:90}],play:[{shiftKey:!1,altKey:!0,ctrlKey:!1,keyCode:86}],previousFrame:[{shiftKey:!1,altKey:!0,ctrlKey:!1,keyCode:188}],startFrame:[{shiftKey:!0,altKey:!0,ctrlKey:!1,keyCode:188}],nextFrame:[{shiftKey:!1,altKey:!0,ctrlKey:!1,keyCode:190}],endFrame:[{shiftKey:!0,altKey:!0,ctrlKey:!1,keyCode:190}],keyAll:[{keyCode:83}],keyTranslation:[{shiftKey:!0,altKey:!1,ctrlKey:!1,keyCode:87}],keyRotation:[{shiftKey:!0,altKey:!1,ctrlKey:!1,keyCode:69}],keyScale:[{shiftKey:!0,altKey:!1,ctrlKey:!1,
keyCode:82}],fileNew:[{shiftKey:!1,altKey:!1,ctrlKey:!0,keyCode:78}],fileOpen:[{shiftKey:!1,altKey:!1,ctrlKey:!0,keyCode:79}],fileSave:[{shiftKey:!1,altKey:!1,ctrlKey:!0,keyCode:83}]};this.shortcutEvents=function(a){!0!==d.editor.useHotKeys?console.log("Hotkeys are disabled"):(console.log("\tkeycode",a.keyCode),c(a,d.hotkeys.select)&&d.editor.signals.manipModeChange.dispatch("select"),c(a,d.hotkeys.undo)&&(console.log("\tundo"),d.editor.undo()),c(a,d.hotkeys.redo)&&(console.log("\tredo"),d.editor.redo()),
c(a,d.hotkeys.deleteSelected)&&(console.log("\tdeleteSelected"),d.editor.deleteSelected()),c(a,d.hotkeys.play)&&(console.log("\tplay"),d.editor.play()),c(a,d.hotkeys.nextFrame)&&(console.log("\tnextFrame"),d.editor.nextFrame()),c(a,d.hotkeys.previousFrame)&&(console.log("\tpreviousFrame"),d.editor.previousFrame()),c(a,d.hotkeys.startFrame)&&(console.log("\tstartFrame"),d.editor.startFrame()),c(a,d.hotkeys.endFrame)&&(console.log("\tendFrame"),d.editor.endFrame()),c(a,d.hotkeys.keyAll)&&(console.log("\tkeyAll"),
d.editor.keySelectedObjects()),c(a,d.hotkeys.translate)&&d.editor.signals.manipModeChange.dispatch("translate"),c(a,d.hotkeys.rotate)&&d.editor.signals.manipModeChange.dispatch("rotate"),c(a,d.hotkeys.scale)&&d.editor.signals.manipModeChange.dispatch("scale"),c(a,d.hotkeys.bigger)&&(console.log("\tbigger"),d.editor.signals.manipScaleChange.dispatch(.1)),c(a,d.hotkeys.smaller)&&(console.log("\tsmaller"),d.editor.signals.manipScaleChange.dispatch(-.1)),c(a,d.hotkeys.keyTranslation)&&d.editor.keySelectedObjects(["rotation",
"scale"]),c(a,d.hotkeys.keyRotation)&&d.editor.keySelectedObjects(["position","scale"]),c(a,d.hotkeys.keyScale)&&d.editor.keySelectedObjects(["position","rotation"]),c(a,d.hotkeys.fileNew)&&d.editor.newScene(),c(a,d.hotkeys.fileOpen)&&console.log("pass"),c(a,d.hotkeys.fileSave)&&d.editor.saveSceneLocal(),c(a,d.hotkeys.frame)&&void 0!==d.layout.viewportLayout.activePanel&&d.layout.viewportLayout.focus())};this.dom.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.editor.signals.sceneSave.add(function(a){console.log("\tMM.App.message:",
a);d.onSaveScene(a)});return this}}};
MM.App.prototype={loadScene:function(a){console.log("MM.loadScene",a);this.editor.loadScene(a);return this},saveScene:function(){return this},importAsset:function(a){console.log("Importing asset",a);try{eval("MM.insert"+a+"(this.editor)")}catch(b){console.log("Unable to import asset",a)}return this},exportAsset:function(){return this},importAnimation:function(a){console.log("Import animation",a);this.editor.importAnimation(a)},setCurrentTime:function(){return this},setStartTime:function(){return this},
setEndTime:function(){return this},hideAllWindows:function(){this.layout.maximizeWorkspace();return this},showAllWindows:function(){return this},onSaveScene:function(a){console.log("MM.App.onSaveScene",a)}};MM.elementWorldPosition=function(a){for(var b=0,c=0;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;return{x:b,y:c}};MM.toScreenXY=function(a,b,c){a=a.clone();b=(new THREE.Matrix4).multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);a.applyMatrix4(b);return{x:(a.x+1)*c.offsetWidth/2,y:(a.y+1)*c.offsetHeight/2}};MM.extendArrayWithArray=function(a,b){var c,d;c=0;for(d=b.length;c<d;c++)a.push(b[c]);return a};
MM.getDictionaryAsArray=function(a,b){var c=[];if(void 0===b||"value"===b)for(var d in a)c.push(a[d]);else for(d in a)c.push(d);return c};MM.getArrayAsDictionary=function(a){var b,c,d={};b=0;for(c=a.length;b<c;b++)d[b]=a[b];return d};MM.arraysEqual=function(a,b){if(a===b)return!0;if(null==a||null==b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0};
MM.arrayContainsAElementFromArray=function(a,b){if(void 0===a||void 0===b)return!1;var c,d;c=0;for(d=a.length;c<d;c++)if(-1!==b.indexOf(a[c]))return!0;return!1};MM.arrayContainsAllElementsInArray=function(a,b){var c,d,e=a.length,f=0;c=0;for(d=a.length;c<d;c++)if(-1!==b.indexOf(a[c])&&(f+=1),f===e)return!0;return!1};MM.containsElementFromArray=function(a,b){for(var c=0;c<b.length;c++)if(-1!==a.indexOf(b[c]))return!0;return!1};
MM.containsInstanceWithinArray=function(a,b){var c,d;c=0;for(d=b.length;c<d;c++)if(b[c]instanceof a)return!0;return!1};MM.containsObjectWithinArray=function(a,b){var c,d;c=0;for(d=b.length;c<d;c++)if(a.name===b[c].name)return!0;return!1};MM.contentMatches=function(a,b){var c,d,e,f;e=a.length;f=b.length;if(e!==f)return!1;var g=!1;for(c=0;c<e;c++){g=!1;for(d=0;d<f;d++)a[c]===b[d]&&(g=!0);if(!1===g)return!1}return!0};MM.roundToFive=function(a){return+(Math.floor(a+"e+5")+"e-5")};
MM.freezeTransformations=function(a){console.log("MM.freezeTransformations",a);a.updateMatrixWorld();var b=(new THREE.Matrix4).copy(a.matrixWorld),c=(new THREE.Matrix4).getInverse(b);a.applyMatrix(c);console.log("\tworldMatrix",b);a.geometry.verticesNeedUpdate=!0;for(c=0;c<a.geometry.vertices.length;c++)a.geometry.vertices[c].applyMatrix4(b)};MM.Loader=function(a){this.loadLocalStorage=function(){if(void 0!==localStorage.threejsEditor){var b=new THREE.ObjectLoader,c=JSON.parse(localStorage.threejsEditor);!0===c.hasOwnProperty("project")&&a.importPTASettings(c.project);!0===c.hasOwnProperty("scene")&&(b=b.parse(c.scene),a.setScene(b));!0===c.hasOwnProperty("selectable")&&a.importSelectables(c.selectable);!0===c.hasOwnProperty("setups")&&a.importSetups(c.setups);!0===c.hasOwnProperty("groups")&&a.importGroups(c.groups);!0===c.hasOwnProperty("settings")&&
a.importSceneSettings(c.settings);!0===c.hasOwnProperty("assets")&&a.importAssetObjects(c.assets);a.initDrivenChannels()}else console.log("\tNo local storage defined.")};var b=new THREE.ObjectExporter;this.saveLocalStorage=function(){console.log("SLoader.saveLocalStorage");var c={};c.project=a.exportPTASettings();c.scene=b.parse(a.scene);c.selectable=a.exportSelectables();c.groups=a.exportGroups();c.setups=a.exportSetups();c.settings=a.exportSceneSettings();c.assets=a.exportAssetObjects();localStorage.threejsEditor=
JSON.stringify(c);console.log("Saved state to LocalStorage.")};this.saveLayout=function(){var b={};b.settings=a.exportSceneSettings();localStorage.threejsEditor=JSON.stringify(b)};this.resetLayout=function(){console.log("Loader.resetLayout");var b={};b.settings=a.resetSceneSettings();localStorage.threejsEditor=JSON.stringify(b)};this.saveAsJSON=function(){var c={};c.scene=b.parse(a.scene);c.selectable=a.exportSelectables();c.groups=a.exportGroups();c.setups=a.exportSetups();c.settings=a.exportSceneSettings();
c.assets=a.exportAssetObjects();return JSON.stringify(c)};this.loadAsJSON=function(b){var c=(new THREE.ObjectLoader).parse(b.scene);a.setScene(c);a.importSelectables(b.selectable);a.importSetups(b.setups);a.importGroups(b.groups);a.importSceneSettings(b.settings);a.importAssetObjects(b.assets)};this.loadJSONFile=function(a){var b=new FileReader,c=this;b.addEventListener("load",function(a){a=JSON.parse(a.target.result);c.loadAsJSON(a)},!1);b.readAsText(a)};this.loadFile=function(b){var e=b.name;switch(e.split(".").pop().toLowerCase()){case "js":case "json":case "3geo":case "3mat":case "3obj":case "3scn":var f=
new FileReader;f.addEventListener("load",function(a){a=a.target.result;if(-1!==a.indexOf("postMessage")){var f=new Blob([a],{type:"text/javascript"}),f=URL.createObjectURL(f),f=new Worker(f);f.onmessage=function(a){a.data.metadata={version:2};c(a.data,b,e)};f.postMessage(Date.now())}else{try{f=JSON.parse(a)}catch(k){alert(k);return}c(f,b,e)}},!1);f.readAsText(b);break;case "obj":f=new FileReader;f.addEventListener("load",function(b){b=b.target.result;b=(new THREE.OBJLoader).parse(b);b.name=e;a.addObject(b)},
!1);f.readAsText(b);break;default:alert("Unsupported file format.")}};var c=function(b,c,f){void 0===b.metadata&&(b.metadata={type:"Geometry"});void 0===b.metadata.type&&(b.metadata.type="Geometry");void 0===b.metadata.version&&(b.metadata.version=b.metadata.formatVersion);if("geometry"===b.metadata.type.toLowerCase()){var g=new THREE.JSONLoader,g=g.parse(b);b=g.geometry;g=void 0!==g.materials?new THREE.MeshFaceMaterial(g.materials):new THREE.MeshPhongMaterial;b.sourceType="ascii";b.sourceFile=c.name;
c=new THREE.Mesh(b,g);c.name=f;a.addObject(c)}else"object"===b.metadata.type.toLowerCase()?(g=new THREE.ObjectLoader,g=g.parse(b),g instanceof THREE.Scene?a.setScene(g):a.addObject(g)):"scene"===b.metadata.type.toLowerCase()&&(g=new THREE.SceneLoader,g.parse(b,function(b){a.setScene(b.scene)},""))}};MM.NoLayout=function(a,b,c){console.log("NoLayout");console.log("\tdom",a);var d=this;this.editor=b;this.dom=a;this.canvas=document.createElement("canvas");this.canvas.style.position="absolute";this.canvas.style.left="0px";this.canvas.style.top="0px";this.canvas.style.top="0px";this.canvas.style.bottom="0px";this.dom.appendChild(this.canvas);this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,devicePixelRatio:1,antialias:!0});this.renderer.setSize(window.innerWidth,window.innerHeight);a=function(a){a=
window.innerHeight;var b=window.innerWidth;d.editor.activeCamera.aspect=b/a;d.editor.activeCamera.updateProjectionMatrix();d.renderer.setSize(b,a);d.editor.signals.windowResize.dispatch()};window.addEventListener("resize",a,!1);this.viewportLayout={};this.viewportLayout.render=function(){d.renderer.render(d.editor.scene,d.editor.activeCamera)};this.update=function(){console.log("NoLayout.update")};a();return this};
MM.Layout=function(a,b,c){console.log("MM.Layout init",a,b,c);if(void 0===a)console.log("A parent dom element is required.");else if(void 0===b)console.log("A parent editor is required.");else{void 0===c&&(c={});c.hasOwnProperty("hasNavigation")||(c.hasNavigation=!0);c.hasOwnProperty("hasProjectBar")||(c.hasProjectBar=!0);c.hasOwnProperty("hasMenuBar")||(c.hasMenuBar=!0);c.hasOwnProperty("hasToolBar")||(c.hasToolBar=!0);console.log("\toptions",c);var d=this;this.editor=b;this.dom=a;this.sidebar=this.infoline=
this.rangeslider=this.timeline=this.viewportLayout=this.toolbar=this.menubar=this.projectbar=this.navigation=void 0;a=signals.Signal;this.signals={sidebarVisibility:new a,timeLineVisibility:new a,rangeSliderVisibility:new a,infoLineVisibility:new a};!0===c.hasNavigation&&(this.navigation=$.find("#movemenav")[0]);a=(new MMUI.A).setImage("/ui/brand.gif").setClass("btn-anim-home");a.dom.href="/";this.dom.appendChild(a.dom);!0===c.hasProjectBar&&(this.projectbar=new MM.Projectbar(this.editor,this.dom));
!0===c.hasMenuBar&&(a={},c.hasOwnProperty("menu")&&(a=c.menu),console.log("\tmenu bar options:",a),this.menubar=new MM.Menubar(this,this.editor,this.dom,a));a=(new MMUI.Button).addGlyphicon("cog").addClass("btn-anim-settings");this.dom.appendChild(a.dom);if(!0===c.hasToolBar){var e={};c.hasOwnProperty("toolbar")&&(e=c.toolbar);this.toolbar=new MM.Toolbar(this.editor,this.dom,e)}var f=new MMUI.Panel;f.dom.className="panellayout";f.dom.style.position="relative";this.dom.appendChild(f.dom);e={panels:{infoLine:{h:[0,
5],w:[0,80],td:["rangeSlider"],bd:[],rd:["sidebar"],ld:[],dh:5,dw:80,v:!0},rangeSlider:{h:[5,10],w:[0,80],td:["timeLine"],bd:[],rd:["sidebar"],ld:[],dh:10,dw:80,v:!0},timeLine:{h:[10,20],w:[0,80],td:["workspace"],bd:["rangeSlider"],rd:["sidebar"],ld:[],dh:10,dw:80,v:!0},workspace:{h:[20,100],w:[0,80],td:[],bd:["timeLine"],rd:["sidebar"],ld:[],dh:75,dw:80,v:!0},sidebar:{h:[0,100],w:[80,100],td:[],bd:[],rd:[],ld:["infoLine","rangeSlider","timeLine","workspace"],v:!0,dw:20}},hsliders:{rangeSlider:{h:[0,
10],w:[0,80],td:["timeLine"],bd:["rangeSlider"]},timeLine:{h:[10,20],w:[0,80],td:["workspace"],bd:["timeLine"]}},vsliders:{sidebar:{h:[0,100],w:[80,100],ld:["workspace","timeLine","rangeSlider"],rd:["sidebar"]}}};c.hasOwnProperty("baseLayout")&&(console.log("\toverwriting default baseLayout."),e=c.baseLayout);this.layout=new MMUI.PanelLayout(this.editor,this.dom);this.layout.applyRandomColor=!1;this.layout.setPanelClass="layout-panel";this.layout.setLayout(e);f.dom.appendChild(this.layout.dom);this.layout.init();
if(e=this.layout.getPanel("timeLine"))this.timeline=new MMUI.Timeline,e.dom.appendChild(this.timeline.dom),this.timeline.onTimechange(function(){d.editor.setTime(d.timeline.time)}).onPlay(function(){d.editor.play()}).onNextframe(function(){d.editor.nextFrame()}).onPreviousframe(function(){d.editor.previousFrame()}).onStartframe(function(){d.editor.startFrame()}).onEndframe(function(){d.editor.endFrame()}).onTimeshift(function(){console.log("time shift",d.timeline.time);d.editor.shiftTime(d.timeline.time)}).onTimerelease(function(){console.log("time release");
d.editor.signals.objectRefresh.dispatch()});if(e=this.layout.getPanel("rangeSlider"))this.rangeslider=new MMUI.RangeSlider,e.dom.appendChild(this.rangeslider.dom),this.rangeslider.init(),this.rangeslider.onTimerangechange(function(){console.log("MM.TimeRangeChange");d.editor.startTime=d.rangeslider.startTime;d.editor.endTime=d.rangeslider.endTime;d.editor.startRange=d.rangeslider.startRange;d.editor.endRange=d.rangeslider.endRange;d.editor.time<d.editor.startRange&&d.editor.setTime(d.editor.startRange);
d.editor.time>d.editor.endRange&&d.editor.setTime(d.editor.endRange);d.timeline&&(d.timeline.setTime(d.editor.time),d.timeline.setRange(d.editor.startRange,d.editor.endRange),d.timeline.setActiveKeys(d.editor.activeTimeValue))}),this.rangeslider.onAutokeychange(function(){console.log("MM.onAutokeychange",d.rangeslider.autoKey);d.editor.setAutoKey(d.rangeslider.autoKey)});if(e=this.layout.getPanel("infoLine"))this.infoLine=document.createElement("a"),this.infoLine.className="infoLine",this.infoLine.textContent=
"finished startup",e.dom.appendChild(this.infoLine);e={panels:{view0:{h:[0,100],w:[0,50],td:[],bd:[],rd:["view1"],ld:[],dh:100,dw:50,v:!0},view1:{h:[0,100],w:[50,100],td:[],bd:[],rd:[],ld:["view0"],dh:100,dw:50,v:!0}},vsliders:{view1:{h:[0,100],w:[50,100],ld:["view0"],rd:["view1"],td:[],bd:[]}}};c.hasOwnProperty("viewLayout")&&(console.log("\toverwriting default viewLayout."),e=c.viewLayout);if(c=this.layout.getPanel("workspace"))this.viewportLayout=new MM.PanelViewLayout(this.editor,this.dom),this.viewportLayout.setPrefix("workspace"),
this.viewportLayout.setLayout(e),c.dom.appendChild(this.viewportLayout.dom),this.viewportLayout.init();if(c=this.layout.getPanel("sidebar"))this.sidebar=new MM.Sidebar(this.editor,this.dom),c.dom.appendChild(this.sidebar.dom);var g=new MM.SettingsWindow(this.editor);this.dom.appendChild(g.dom);a.onClick(function(){g.show()});this.signals.sidebarVisibility.add(function(a){void 0!==d.layout&&(console.log("sidebarVisbility",a),0===a?d.layout.hidePanel("sidebar"):d.layout.showPanel("sidebar"))});this.signals.timeLineVisibility.add(function(a){void 0!==
d.layout&&(console.log("timeLineVisibility",a),0===a?d.layout.hidePanel("timeLine"):d.layout.showPanel("timeLine"))});this.signals.rangeSliderVisibility.add(function(a){void 0!==d.layout&&(console.log("rangeSliderVisibility",a),0===a?d.layout.hidePanel("rangeSlider"):d.layout.showPanel("rangeSlider"))});this.signals.infoLineVisibility.add(function(a){void 0!==d.layout&&(console.log("infoLineVisibility",a),0===a?d.layout.hidePanel("infoLine"):d.layout.showPanel("infoLine"))});this.editor.signals.manipModeChange.add(function(a){d.editor.signals.showInfo.dispatch("Activating "+
a+" tool")});this.editor.signals.manipSpaceChange.dispatch(function(a){d.editor.signals.showInfo.dispatch("Setting tool in "+a+" mode")});c=function(a){a=window.innerHeight-5;var c=0;d.navigation&&(c+=d.navigation.offsetHeight);d.projectbar&&(c+=d.projectbar.dom.offsetHeight);d.menubar&&(c+=d.menubar.dom.offsetHeight);d.toolbar&&(c+=d.toolbar.dom.offsetHeight);f.dom.style.height=a-c+"px";d.layout&&d.layout.resize();d.viewportLayout&&d.viewportLayout.resize();d.timeline&&d.timeline.rebuild();b.signals.windowResize.dispatch()};
window.addEventListener("resize",c,!1);var h=function(){d.timeline?(d.timeline.setTime(d.editor.time),d.timeline.setRange(d.editor.startRange,d.editor.endRange),d.timeline.setActiveKeys(d.editor.activeTimeValue)):console.log("No timeline to update");d.rangeslider?(d.rangeslider.setRange(d.editor.startRange,d.editor.endRange),d.rangeslider.setTime(d.editor.startTime,d.editor.endTime)):console.log("No rangeSlider to update")};this.editor.signals.keyframeEditorKeysUpdated.add(function(){d.timeline?d.timeline.setActiveKeys(d.editor.activeTimeValue):
console.log("No timeline to update")});this.editor.signals.keyframeEditorChanged.add(function(){d.timeline?d.timeline.setActiveKeys(d.editor.activeTimeValue):console.log("No timeline to update")});this.editor.signals.keyAuto.add(function(){d.rangeslider?d.rangeslider.setAutoKey(d.editor.autoKey):console.log("No rangeslider to update")});this.editor.signals.layoutResized.add(function(a){console.log("layoutResized",a);"main"===a&&d.viewportLayout.resize();d.timeline&&d.timeline.rebuild()});this.editor.signals.timeChanged.add(function(){d.timeline&&
d.timeline.setTime(d.editor.time)});this.editor.signals.timeRangeChanged.add(function(){h()});this.editor.signals.showInfo.add(function(a){console.log("showInfo",a);d.infoLine&&(d.infoLine.textContent=a)});this.update=function(){console.log("Layout.update");h()};c();return this}};MM.PanelView=function(a,b){void 0===b&&(b="base");MMUI.Element.call(this);this.editor=a;this.childPanel=this.parentLayout=void 0;this.prefix=b;this.zIndex=10;this.contentType=void 0;var c=this,d=a.signals,e=document.createElement("div");e.id="panelview-"+b;e.style.top="0px";e.style.bottom="0px";e.style.left="0px";e.style.right="0px";e.style.position="absolute";this.dom=e;this.children=[];this.show_camera=this.show_fps=this.show_frame=!1;this.usedCamera=this.textCamera=this.menuCamera=void 0;this.showSettingsMenu=
!0;this.showRatio=!1;this.aspectRatio=[16,10];this.lockCamera=!1;this.layoutDD=(new MMUI.Dropdown("layout")).addClass("dropdown-panelview");this.layoutDD.dom.style.zIndex=this.zIndex;e.appendChild(this.layoutDD.dom);this.buildLayoutDD();this.children.push(this.layoutDD.dom);this.panelDD=(new MMUI.Dropdown("panel")).addClass("dropdown-panelview");this.panelDD.dom.style.zIndex=this.zIndex;e.appendChild(this.panelDD.dom);this.panelDD.onClick(function(){c.buildPanelDD()});this.children.push(this.panelDD.dom);
this.cameraDD=(new MMUI.Dropdown("camera")).addClass("dropdown-panelview");this.cameraDD.dom.style.zIndex=this.zIndex;e.appendChild(this.cameraDD.dom);this.buildCameraDD();this.children.push(this.cameraDD.dom);var f=new MMUI.Text("0 fps");f.setPosition("absolute").setRight("25%").setBottom("10px");f.dom.style.zIndex=this.zIndex;f.setFontSize("24px");this.fpsText=f;e.appendChild(f.dom);this.children.push(this.fpsText.dom);f=new MMUI.Text("frame 0");f.setPosition("absolute").setRight("10px").setBottom("10px");
f.dom.style.zIndex=this.zIndex;f.setFontSize("24px");this.frameText=f;e.appendChild(f.dom);this.children.push(this.frameText.dom);f=(new MMUI.Panel).setPosition("absolute");f.setWidth("120px");f.setHeight("200px");f.dom.id="panelview-"+this.prefix;f.setDisplay("none");this.aspectFrame=f;e.appendChild(f.dom);this.children.push(this.aspectFrame.dom);f=new MMUI.Text(this.prefix);f.setPosition("absolute").setLeft("50%").setBottom("10px");f.dom.style.zIndex=this.zIndex;this.lockText=f;e.appendChild(f.dom);
this.children.push(this.lockText.dom);d.timeChanged.add(function(){c.setTime(c.editor.time);c.setFPS(c.editor._fps)});d.timeShifted.add(function(){c.setTime(c.editor.time);c.setFPS(c.editor._fps)});d.cameraAdded.add(function(){c.buildCameraDD()});d.cameraRemoved.add(function(){c.buildCameraDD()});this.hideCamera();this.hideFPS();this.hideTime()};MM.PanelView.prototype=Object.create(MMUI.Element.prototype);MM.PanelView.prototype.setParentLayout=function(a){this.parentLayout=a};
MM.PanelView.prototype.setParentPanel=function(a){this.parentPanel=a};MM.PanelView.prototype.setChildPanel=function(a){this.childPanel=a};
MM.PanelView.prototype.setContent=function(a){console.log("MM.PanelView.setContent",a);if(this.contentType!==a){this.childPanel.clear();delete this.childPanel;var b;switch(a){case "SceneView":b=new MM.SceneView(this.editor,this.prefix,this);this.showCameraDD();this.setCamera(this.editor.cameras[0])();break;case "KeyView":b=new MM.KeyView(this.editor,this.prefix,this);this.hideCameraDD();break;default:console.log("Unsupported content type.")}this.contentType=a;this.setChildPanel(b);this.resize()}};
MM.PanelView.prototype.toggleCamera=function(){this.show_camera?this.hideCamera():this.showCamera()};MM.PanelView.prototype.showCamera=function(){this.lockText.dom.style.display="block";this.show_camera=!0;this.lockText.setValue(this.childPanel.camera.name)};MM.PanelView.prototype.hideCamera=function(){this.lockText.dom.style.display="none";this.show_camera=!1};MM.PanelView.prototype.toggleFPS=function(){this.show_fps?this.hideFPS():this.showFPS()};
MM.PanelView.prototype.hideFPS=function(){this.fpsText.dom.style.display="none";this.show_fps=!1};MM.PanelView.prototype.showFPS=function(){this.fpsText.dom.style.display="block";this.show_fps=!0};MM.PanelView.prototype.setFPS=function(a){this.show_fps&&this.fpsText.setValue(a+" fps")};MM.PanelView.prototype.toggleTime=function(){this.show_frame?this.hideTime():this.showTime()};MM.PanelView.prototype.hideTime=function(){this.frameText.dom.style.display="none";this.show_frame=!1};
MM.PanelView.prototype.showTime=function(){this.frameText.dom.style.display="block";this.show_frame=!0};MM.PanelView.prototype.setTime=function(a){this.show_frame&&this.frameText.setValue("frame "+a)};MM.PanelView.prototype.hidePanelDD=function(){this.panelDD.dom.style.display="none"};MM.PanelView.prototype.showPanelDD=function(){this.panelDD.dom.style.display=""};
MM.PanelView.prototype.buildPanelDD=function(){for(var a=this;this.panelDD.dropgrp.firstChild;)this.panelDD.dropgrp.removeChild(this.panelDD.dropgrp.firstChild);var b=new MMUI.DropdownItem("SceneView");b.onClick(function(){a.setContent("SceneView")});this.panelDD.add(b);b=new MMUI.DropdownItem("KeyView");b.onClick(function(){a.setContent("KeyView")});this.panelDD.add(b);this.panelDD.add(new MMUI.DropdownDivider);b=new MMUI.DropdownItem("Split Horizontal");b.onClick(function(){a.parentLayout.createPanel(a.prefix,
"h")});this.panelDD.add(b);b=new MMUI.DropdownItem("Split Vertical");b.onClick(function(){a.parentLayout.createPanel(a.prefix,"v")});this.panelDD.add(b);var c,d=a.parentLayout.getNeighourDirections(a.prefix);if(0!==d.length)for(b=0;b<d.length;b++){switch(d[b]){case "ld":c="Collapse Right";break;case "rd":c="Collapse Left";break;case "td":c="Collapse Downwards";break;case "bd":c="Collapse Upwards"}var e=new MMUI.DropdownItem(c);e.onClick(a.deletePanel(a.prefix,d[b]));a.panelDD.add(e)}this.panelDD.add(new MMUI.DropdownDivider);
c=(new MMUI.DropdownItem(this.show_frame?"Hide Time":"Show Time")).onClick(function(){a.toggleTime()});this.panelDD.add(c);c=(new MMUI.DropdownItem(this.show_camera?"Hide Camera":"Show Camera")).onClick(function(){a.toggleCamera()});this.panelDD.add(c);c=(new MMUI.DropdownItem(this.show_fps?"Hide FPS":"Show FPS")).onClick(function(){a.toggleFPS()});this.panelDD.add(c)};MM.PanelView.prototype.deletePanel=function(a,b){var c=this;return function(){c.parentLayout.deletePanel(a,b)}};
MM.PanelView.prototype.hideCameraDD=function(){this.cameraDD.dom.style.display="none";this.lockText.dom.style.display="none"};MM.PanelView.prototype.showCameraDD=function(){this.cameraDD.dom.style.display="block";this.lockText.dom.style.display="block"};
MM.PanelView.prototype.buildCameraDD=function(){this.cameraDD.removeAll();var a,b;a=0;for(b=this.editor.cameras.length;a<b;a++)this.editor.cameras[a]instanceof THREE.PerspectiveCamera&&this.cameraDD.add((new MMUI.DropdownItem(this.editor.cameras[a].name)).onClick(this.setCamera(this.editor.cameras[a])));this.cameraDD.add(new MMUI.DropdownDivider);a=0;for(b=this.editor.cameras.length;a<b;a++)this.editor.cameras[a]instanceof THREE.OrthographicCamera&&this.cameraDD.add((new MMUI.DropdownItem(this.editor.cameras[a].name)).onClick(this.setCamera(this.editor.cameras[a])))};
MM.PanelView.prototype.buildLayoutDD=function(){var a=this,b=new MMUI.DropdownItem("Single");b.onClick(function(){for(var b in a.parentLayout.layoutElements.view){var d=a.parentLayout.layoutElements.view[b];d.childPanel.clear();delete d.childPanel;d.deletePanel()}a.parentLayout.rebuild({panels:{view0:{h:[0,100],w:[0,100],td:[],bd:[],rd:[],ld:[],dh:100,dw:100,v:!0}}})});this.layoutDD.add(b);b=new MMUI.DropdownItem("Vertical");b.onClick(function(){for(var b in a.parentLayout.layoutElements.view){var d=
a.parentLayout.layoutElements.view[b];d.childPanel.clear();delete d.childPanel;d.deletePanel()}a.parentLayout.rebuild({panels:{view0:{h:[0,100],w:[0,50],td:[],bd:[],rd:["view1"],ld:[],dh:100,dw:50,v:!0},view1:{h:[0,100],w:[50,100],td:[],bd:[],rd:[],ld:["view0"],dh:100,dw:50,v:!0}},vsliders:{view1:{h:[0,100],w:[50,100],ld:["view0"],rd:["view1"],td:[],bd:[]}}})});this.layoutDD.add(b);b=new MMUI.DropdownItem("Horizontal");b.onClick(function(){for(var b in a.parentLayout.layoutElements.view){var d=a.parentLayout.layoutElements.view[b];
d.childPanel.clear();delete d.childPanel;d.deletePanel()}a.parentLayout.rebuild({panels:{view0:{h:[50,100],w:[0,100],td:[],bd:["view1"],rd:[],ld:[],dh:50,dw:100,v:!0},view1:{h:[0,50],w:[0,100],td:[],bd:["view0"],rd:[],ld:[],dh:50,dw:100,v:!0}},hsliders:{view0:{h:[0,50],w:[0,100],ld:[],rd:[],td:["view0"],bd:["view1"]}}})});this.layoutDD.add(b)};MM.PanelView.prototype.activate=function(){this.isActive=!0;this.childPanel&&this.childPanel.activate()};
MM.PanelView.prototype.deactivate=function(){this.dom.style.outline="";this.isActive=!1;this.childPanel&&this.childPanel.deactivate()};MM.PanelView.prototype.setCamera=function(a){var b=this;return function(){b.cameraDD.setTitle(a.name);b.childPanel&&b.childPanel instanceof MM.SceneView&&b.childPanel.setCamera(a)}};MM.PanelView.prototype.focus=function(){console.log("PanelView.focus");this.childPanel&&this.childPanel.focus()};MM.PanelView.prototype.render=function(){this.childPanel&&this.childPanel.render()};
MM.PanelView.prototype.resize=function(){this.childPanel&&this.childPanel.resize()};MM.PanelViewLayout=function(a,b){var c=this;MMUI.PanelLayout.call(this,a,b);this.renderer=this.canvas=void 0;this.applyRandomColor=!0;this.activeLayout=!1;this.activePanel=void 0;this.hasKeyView=!1;this.editor=a;this.mdom.addEventListener("mousedown",function(a){document.activeElement.blur()},!1);this.mdom.addEventListener("mousemove",function(a){c.activeLayout=!1;for(var b in c.layoutObject.panels)null!==a.target.id&&-1!==a.target.id.indexOf(b)&&(c.setActivePanel("panelview-"+b),c.activeLayout=!0);
c.activeLayout||c.resetActivePanel()},!1)};MM.PanelViewLayout.prototype=Object.create(MMUI.PanelLayout.prototype);
MM.PanelViewLayout.prototype.createPanel=function(a,b){MMUI.PanelLayout.prototype.createPanel.call(this,a,b);console.log("PanelViewLayout.createPanel");var c=this.layoutElements.container[this.newPanelName],d=new MM.PanelView(this.editor,this.newPanelName);d.setParentPanel(c);d.setParentLayout(this);c.add(d);c=new MM.SceneView(this.editor,this.newPanelName,d,this.canvas,this.renderer);d.setChildPanel(c);d.contentType="SceneView";this.layoutElements.view[this.newPanelName]=d;d.setCamera(this.editor.cameras[0])();
this.update(!0)};MM.PanelViewLayout.prototype.deletePanel=function(a,b){delete this.layoutElements.view[a];MMUI.PanelLayout.prototype.deletePanel.call(this,a,b)};MM.PanelViewLayout.prototype.resetActivePanel=function(){this.activePanel=void 0;this.deactivatePanels()};
MM.PanelViewLayout.prototype.setActivePanel=function(a){a=String(a).split("-");2===a.length?(a=a[1],this.activePanel!==a&&(this.deactivatePanels(),this.activePanel=a,this.activatePanel(a))):void 0!==this.activePanel?(this.deactivatePanels(),this.activePanel=void 0):console.log("Look into this if one of the is still moving...")};
MM.PanelViewLayout.prototype.init=function(){console.log("MM.PanelViewLayout.init");void 0===this.canvas&&(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0px",this.canvas.style.top="0px",this.applyRandomColor=!1,this.dom.appendChild(this.canvas),this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,devicePixelRatio:1,antialias:!0}),this.renderer.autoClear=!1,this.renderer.autoUpdateScene=!1);console.log("\tCreating layout elements");
this.buildContainers();this.buildHSliders();this.buildVSliders();console.log("\tNumber of panels",this.panelCount());var a,b,c;this.layoutElements.view={};for(c in this.layoutObject.panels)console.log("\tcreating panel view for",c),b=this.layoutElements.container[c],a=new MM.PanelView(this.editor,c),a.setParentPanel(b),a.setParentLayout(this),b.add(a),"view0"===c&&(b=new MM.SceneView(this.editor,c,a,this.canvas,this.renderer),a.setChildPanel(b),a.contentType="SceneView",a.setCamera(this.editor.cameras[0])()),
"view1"===c&&(b=new MM.KeyView(this.editor,c,a,this.canvas,this.renderer),a.dom.appendChild(b.dom),a.setChildPanel(b),a.hideCameraDD(),this.hasKeyView=!0,a.contentType="KeyView"),this.layoutElements.view[c]=a};MM.PanelViewLayout.prototype.rebuild=function(a){console.log("PanelViewLayout.rebuild");this.resetLayout();this.setLayout(a);this.init();this.resize();this.editor.signals.objectChanged.dispatch()};MM.PanelViewLayout.prototype.deactivatePanels=function(){for(var a in this.layoutElements.view)this.layoutElements.view[a].deactivate()};
MM.PanelViewLayout.prototype.activatePanel=function(a){this.layoutElements.view.hasOwnProperty(a)&&this.layoutElements.view[a].activate()};MM.PanelViewLayout.prototype.getViewPanels=function(){return this.layoutElements.view};MM.PanelViewLayout.prototype.getViewPanel=function(a){return this.layoutElements.view[a]};MM.PanelViewLayout.prototype.focus=function(){console.log("PanelViewLayout.focus");console.log("\tactive",this.activePanel);this.layoutElements.view[this.activePanel].focus()};
MM.PanelViewLayout.prototype.update=function(){MMUI.PanelLayout.prototype.update.call(this);this.canvas.width=this.dom.offsetWidth;this.canvas.height=this.dom.offsetHeight;this.renderer.setSize(this.dom.offsetWidth,this.dom.offsetHeight);for(var a in this.layoutElements.view)this.layoutElements.view[a].resize()};
MM.PanelViewLayout.prototype.resize=function(){MMUI.PanelLayout.prototype.resize.call(this);this.canvas.width=this.dom.offsetWidth;this.canvas.height=this.dom.offsetHeight;this.renderer.setSize(this.dom.offsetWidth,this.dom.offsetHeight);for(var a in this.layoutElements.view)this.layoutElements.view[a].resize();return this};MM.PanelViewLayout.prototype.render=function(){for(var a in this.layoutElements.view)this.layoutElements.view[a].render()};MM.Projectbar=function(a,b){this.data={};var c=new MMUI.Panel;this.dom=c.dom;c.setClass("projectbar");b.appendChild(c.dom);return this};MM.Projectbar.prototype.setSceneData=function(a){console.log("setSceneData",a);this.data=a;this.sceneUI()};
MM.Projectbar.prototype.sceneUI=function(){var a=document.createElement("ol");a.className="breadcrumb anim";this.dom.appendChild(a);var b=document.createElement("li"),c=document.createElement("a");c.href=this.data.projectsUrl;c.textContent="Projects";b.appendChild(c);a.appendChild(b);b=document.createElement("li");c=document.createElement("a");c.href=this.data.projectUrl;c.textContent=this.data.projectTitle;b.appendChild(c);a.appendChild(b);b=document.createElement("li");b.className="active";c=document.createElement("a");
c.href=this.data.shotUrl;c.textContent=this.data.shotTitle;b.appendChild(c);a.appendChild(b)};MM.Projectbar.prototype.setAssetData=function(a){console.log("setAssetData",a);this.data=a;this.assetUI()};
MM.Projectbar.prototype.assetUI=function(){var a=document.createElement("ol");a.className="breadcrumb anim";this.dom.appendChild(a);var b=document.createElement("li"),c=document.createElement("a");c.href=this.data.assetUrl;c.textContent="Assets";b.appendChild(c);a.appendChild(b);b=document.createElement("li");c=document.createElement("a");c.textContent=this.data.assetTitle;b.appendChild(c);a.appendChild(b)};
MM.Projectbar.prototype.setTryData=function(){var a=document.createElement("ol");a.className="breadcrumb anim";this.dom.appendChild(a);var b=document.createElement("li"),c=document.createElement("a");c.textContent="Demo Session - please login to enable saving.";b.appendChild(c);a.appendChild(b)};MM.SceneView=function(a,b,c){var d=this;this.editor=a;this.parentPanel=c;this.camera=a.cameras[0];this.left=this.top=this.height=this.width=0;this.prefix=b;this.isActive=!0;this.canvas=c.parentLayout.canvas;this.renderer=c.parentLayout.renderer;var e=this.editor.signals,f=new THREE.Raycaster,g=new THREE.Projector,h=new THREE.TransformControls(this.camera,this.parentPanel.dom,this.parentPanel.dom);h.scale=1;h.space=this.editor.activeSpace;h.mode=this.editor.activeTool;h.gizmo.name="manipulator"+this.prefix;
h.hide();this.editor.addHelper(h.gizmo);this.manipulator=h;h.addEventListener("start",function(){a.getUndoDataForTransformingObjects()});h.addEventListener("change",function(){console.log("SceneView.onChange manipulator");d.editor.activeTool=h.mode;d.editor.activeSpace=h.space;e.objectChanged.dispatch()});var k=new THREE.EditorControls(this.camera,this.parentPanel.dom,this.prefix);k.addEventListener("change",function(a){e.sceneGraphChanged.dispatch()});k.enabled=!1;this.viewportCameraControl=k;var l=
new THREE.Vector2,m=new THREE.Vector2;this.onMouseDown=function(a){l.set(a.layerX,a.layerY);!1===h.hovered?(h.enabled=!1,k.enabled=!0):(h.enabled=!0,k.enabled=!1);d.parentPanel.dom.addEventListener("mouseup",n,!1)};this.parentPanel.dom.addEventListener("mousedown",this.onMouseDown,!1);var n=function(a){var b="reset";!0===a.shiftKey?b="add":!0===a.altKey&&(b="remove");m.set(a.layerX,a.layerY);if(1>l.distanceTo(m)){var c;c=d.editor.selectableObjects;if(d.camera instanceof THREE.OrthographicCamera){a=
new THREE.Vector3(a.layerX/d.width*2-1,2*-(a.layerY/d.height)+1,-1);g.unprojectVector(a,d.camera);var e=(new THREE.Vector3(0,0,-1)).transformDirection(d.camera.matrixWorld);f.set(a,e)}else d.camera instanceof THREE.PerspectiveCamera?(a=new THREE.Vector3(a.layerX/d.width*2-1,2*-(a.layerY/d.height)+1,.5),g.unprojectVector(a,d.camera),f.set(d.camera.position,a.sub(d.camera.position).normalize())):console.log("Unsupported camera type");c=c instanceof Array?f.intersectObjects(c,!1):f.intersectObject(c,
!1);0<c.length?(c=c[0].object,"control"===c.tag&&d.editor.select(c,!1,b)):d.editor.deselect()}d.parentPanel.dom.removeEventListener("mouseup",n)};e.manipSpaceChange.add(function(a){h.space=a;e.objectChanged.dispatch()});e.manipModeChange.add(function(a){h.setMode(a);e.objectChanged.dispatch()});e.manipScaleChange.add(function(a){console.log("SceneView.manipScaleChange",a);h.scale+=a;h.scale=Math.max(h.scale,.1);e.objectChanged.dispatch()});e.objectSelected.add(function(){h.detach();0!==a.selectedObjects.length&&
(MM.containsInstanceWithinArray(THREE.PerspectiveCamera,a.selectedObjects)||h.multiAttach(a.selectedObjects))});e.objectSelected.add(function(a){h.update()});e.objectChanged.add(function(a){h.update()});e.sceneGraphChanged.add(function(){h.update()});e.timeChanged.add(function(){h.update()});return this};MM.SceneView.prototype=Object.create(MM.SceneView.prototype);
MM.SceneView.prototype.resize=function(){var a=this.parentPanel.parentPanel.dom;this.width=a.offsetWidth;this.height=a.offsetHeight;this.left=parseInt(a.style.left);this.top=parseInt(a.style.bottom);this.camera instanceof THREE.OrthographicCamera?(this.camera.left=this.width/-2,this.camera.right=this.width/2,this.camera.top=this.height/2,this.camera.bottom=this.height/-2,this.camera.near=-100,this.camera.far=100):this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix()};
MM.SceneView.prototype.activate=function(){this.isActive=!0;!1===this.manipulator.hovered?(this.manipulator.enabled=!1,this.manipulator.setMode(this.editor.activeTool),this.viewportCameraControl.enabled=!0,this.viewportCameraControl.resetEvents()):this.viewportCameraControl.enabled=!1};MM.SceneView.prototype.deactivate=function(){this.isActive=!1;this.viewportCameraControl.enabled=!1};
MM.SceneView.prototype.setCamera=function(a){this.camera=a;this.viewportCameraControl.setObject(a);this.manipulator.camera=a;this.editor.activeCamera=a;this.camera instanceof THREE.OrthographicCamera?(this.camera.left=this.width/-2,this.camera.right=this.width/2,this.camera.top=this.height/2,this.camera.bottom=this.height/-2,this.camera.near=-100,this.camera.far=100):this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix()};
MM.SceneView.prototype.focus=function(){var a=this.editor.selectedObjects.length;if(0!==a){var b,c=new THREE.Vector3(1E3,1E3,1E3),d=new THREE.Vector3(-1E3,-1E3,-1E3);for(b=0;b<a;b++)c.min(this.editor.selectedObjects[b].boundingBox.min),d.max(this.editor.selectedObjects[b].boundingBox.max);a=new THREE.Box3(c,d);b=a.size();a=a.center();b=b.length()/2;this.camera instanceof THREE.OrthographicCamera?(c=(this.camera.right-this.camera.left)/2,d=(this.camera.top-this.camera.bottom)/2,b=.5*Math.sqrt(c*c+
d*d)/b,"front"===this.camera.name&&(this.camera.position.setX(a.x),this.camera.position.setY(a.y)),"side"===this.camera.name&&(this.camera.position.setY(a.y),this.camera.position.setZ(a.z)),"top"===this.camera.name&&(this.camera.position.setX(a.x),this.camera.position.setZ(a.z)),this.camera.zoom=b):(c=2*Math.atan(Math.tan(this.camera.fov/2)*this.camera.aspect),c=Math.min(this.camera.fov,c),b=Math.abs(b/Math.sin(c)),this.camera.lookAt(a),c=(new THREE.Vector3).getPositionFromMatrix(this.camera.matrixWorld),
b=-1*(a.distanceTo(c)-b),this.camera.translateZ(b));this.viewportCameraControl.focusOnPoint(a)}};
MM.SceneView.prototype.render=function(){this.renderer.setViewport(this.left,this.top,this.width,this.height);this.renderer.setScissor(this.left,this.top,this.width,this.height);this.renderer.enableScissorTest(!0);this.renderer.setClearColor(this.editor.sceneBackgroundColor);this.renderer.clear();this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix();this.renderer.render(this.editor.scene,this.camera)};
MM.SceneView.prototype.clear=function(){this.editor.removeHelper(this.manipulator.gizmo);this.viewportCameraControl.clear();this.parentPanel.dom.removeEventListener("mousemove",this.onMouseDown);delete this.viewportCameraControl;this.viewportCameraControl={};this.manipulator={}};MM.Sidebar=function(a,b){var c=new MMUI.Panel;c.setClass("sidebar");var d=new MMUI.CollapsiblePanel;d.addStatic(new MMUI.Text("Channel Box")).collapse();d.add(new MM.Sidebar.ChannelBox(a,b));d.onCollapsedChange(function(a){console.log("collapsed",a);!1===a?d.setHeight("350px"):d.setHeight(null)});d.expand();c.add(d);var e=new MMUI.CollapsiblePanel;e.addStatic(new MMUI.Text("Asset Outliner")).collapse();var f=(new MMUI.Tab).setPosition("absolute").setMarginLeft("5px");f.addTab("asset","/ui/asset.gif");
f.addTab("material","/ui/material.gif");f.addTab("light","/ui/light.gif");f.addTab("camera","/ui/camera.gif");f.setWidth(185);f.build();f.onTabSelect(function(){h.gt=f.activeTab;h.update()});var g=new MMUI.Panel;g.dom.style.borderTopStyle="none";g.setMarginTop("22px").setMarginLeft("5px").setMarginRight("5px");c.add(g);var h=new MM.GroupViewList(a);h.setHeight("250px").setWidth("100%");g.add(h);e.add(f);e.add(g);c.add(e);e=new MMUI.CollapsiblePanel;e.addStatic(new MMUI.Text("Asset Selector")).collapse();
e.add(new MM.AssetSelect(a));c.add(e);return c};
MM.Sidebar.ChannelBox=function(a,b){function c(){console.log("dSidebar.ChannelBox: rebuildMenu");var a=(new MMUI.Panel).setClass("sidebar-popup");h.add(a);g.menu=a;var b=["Key Channel","Clear Channel"],c,d;c=0;for(d=b.length;c<d;c++)a.add((new MMUI.Panel).setTextContent(b[c]))}function d(){var b;b=0!==a.selectedObjects.length?a.selectedObjects[0]:null;for(g.channelValueUIs=[];h.dom.firstChild;)h.dom.removeChild(h.dom.firstChild);if(null!==b){h.setDisplay("block");var d=new MMUI.Panel;d.add((new MMUI.Text("Name")).setClass("sidebar-text"));
d.add((new MMUI.Input).setClass("channelbox-object").setValue(b.name));h.add(d);for(var d=b.getChannels(),e=0,k=d.length;e<k;e++)for(var l=d[e][0],t=d[e][1],u=0,B=t.length;u<B;u++){var x=b.getNiceName(l,t[u]),y=(new MMUI.Panel).setClass("sidebar-group").setId("channel-"+l+"-"+t[u]),x=(new MMUI.Text(x)).setClass("sidebar-text").setId("channel-name");y.add(x);var v,w;switch(b.getChannelType(l,t[u])){case "number":v=new MMUI.Number(0);w=b.getChannelRange(l,t[u]);v.min=w[0];v.max=w[1];w=b[l];break;case "boolean":v=
new MMUI.Checkbox;w=b[l];break;case "enum":v=new MMUI.Select;v.setOptions(b.getChannelRange(l,t[u]));w=b[l];break;case "color":v=new MMUI.Color,w=b[l]}v.setId("channel-value").setClass("sidebar-input");y.add(v);h.add(y);g.channelValueUIs.push(v);v.channelGroup=l;v.channel=t[u];b.isChannelAnimated([l,t[u]])&&v.addClass("keyed");if(w instanceof THREE.Euler)"order"===t[u]?v.setSelectedText(w["_"+t[u]]):v.setValue(w["_"+t[u]]);else{if(void 0===w)break;if(!w.hasOwnProperty(t[u]))break;w[t[u]].constructor==
THREE.Number?v.setValue(w[t[u]].value):"visibility"===t[u]?v.setValue(b.getVisibility()):"color"===t[u]?(console.log("\tpassing on color",w[t[u]]),v.setHexValue(w[t[u]].getHex())):v.setValue(w[t[u]])}v.onStart(function(c,d,e){return function(){a.getUndoDataForObjectValue(b,d,e)}}(v,l,t[u]));v.onChange(function(b,c,d){return function(){console.log("onChange:",c,d);var e,g,h,k,l,m;l=a.selectedObjects[0];m=l[c];console.log("\tchannelGroup",m);if(m[d].constructor===THREE.Number)for(console.log("\ttype Number"),
e=m[d].value,m[d].value=b.getValue(),k=m[d].value-e,e=1,g=a.selectedObjects.length;e<g;e++)l=a.selectedObjects[e],m=l[c],h=m[d].value,m[d].value=h+k;else if(m instanceof THREE.Euler){console.log("\ttype Euler");e=m[d];g=b.getValue();switch(d){case "x":case "y":case "z":m[d]=g;k=m[d]-e;e=1;for(g=a.selectedObjects.length;e<g;e++)l=a.selectedObjects[e],m=l[c],h=m[d],m[d]=h+k;break;case "order":for(g=b.getSelectedText(),console.log("\torder",g),m.order=g,m._updateQuaternion(),k=m.order,e=1,g=a.selectedObjects.length;e<
g;e++)l=a.selectedObjects[e],m=l[c],m.order=k}l.setRotationFromEuler(l.rotation)}else if("focusLength"===d)console.log("\ttype focusLength"),console.log("\t\tvalue",b.getValue()),m[d]=b.getValue(),l.setLens(b.getValue(),l.custom.frameHeight);else if("frameHeight"===d)m[d]=b.getValue(),l.setLens(l.custom.focusLength,b.getValue());else if("near"===d||"far"===d)m[d]=b.getValue(),l[d]=b.getValue(),l.updateProjectionMatrix();else if("visibility"===d)for(console.log("\ttype visibility"),console.log("\t\tvalue",
b.getValue()),l.setVisibility(b.getValue()),k=b.getValue(),e=1,g=a.selectedObjects.length;e<g;e++)l=a.selectedObjects[e],l.setVisibility(k);else if("color"===d)console.log("\ttype color"),console.log("\t\tvalue",b.getHexValue()),m[d].setHex(b.getHexValue());else if("parentMaster"===d||"parentSwitch"===d)console.log("\ttype enum"),console.log("\t\tvalue",b.getValue()),m[d]=b.getValue();else for(console.log("\ttype default"),e=m[d],m[d]=b.getValue(),console.log("\t\tsetting",d,"to",b.getValue()),k=
m[d]-e,e=1,g=a.selectedObjects.length;e<g;e++)l=a.selectedObjects[e],m=l[c],h=m[d],m[d]=h+k;f.objectChanged.dispatch(l)}}(v,l,t[u]))}c()}else h.setDisplay("none")}function e(){if(0!==a.selectedObjects.length){var b,c,d,e,f=a.selectedObjects[0];b=0;for(c=g.channelValueUIs.length;b<c;b++){d=g.channelValueUIs[b].channelGroup;e=g.channelValueUIs[b].channel;var h=f[d];if(h instanceof THREE.Euler)"order"===e?g.channelValueUIs[b].setSelectedText(h[e]):g.channelValueUIs[b].setValue(h[e]);else{if(!h.hasOwnProperty(e)){console.log("Unable to find channel",
d,e,"on",f,":",h);break}h[e].constructor==THREE.Number?g.channelValueUIs[b].setValue(h[e].value):"visibility"===e?g.channelValueUIs[b].setValue(f.getVisibility()):"color"===e?g.channelValueUIs[b].setHexValue(h[e].getHex()):g.channelValueUIs[b].setValue(h[e])}}}}var f=a.signals,g=this;this.channelValueUIs=[];this.selectedMenuItem=this.selectedChannel=this.menu=void 0;var h=(new MMUI.Panel).setClass("channelbox"),k=document.createEvent("HTMLEvents");k.initEvent("command",!0,!0);var l=function(a){2===
a.button&&void 0!==g.menu&&(g.selectedMenuItem=a.target.innerText,h.dom.dispatchEvent(k),g.menu.setDisplay("none"),b.removeEventListener("mouseup",l,!1))};b.addEventListener("mousedown",function(a){if(2===a.button&&void 0!==g.menu&&("channel-name"===a.target.id||"channel-value"===a.target.id)){var c=a.target.parentNode.id.split("-");3===c.length&&(g.selectedChannel=[c[1],c[2]],c=MM.elementWorldPosition(g.menu.dom.parentNode),g.menu.setDisplay("block"),g.menu.dom.style.left=a.clientX-c.x+"px",g.menu.dom.style.top=
a.clientY-c.y+50+"px",b.addEventListener("mouseup",l,!1))}},!1);h.dom.addEventListener("command",function(){switch(g.selectedMenuItem){case "Key Channel":a.keySelectedObjectsChannels([g.selectedChannel]);break;case "Clear Channel":a.clearSelectedObjectsChannels([g.selectedChannel])}});f.objectSelected.add(function(){d()});f.objectChanged.add(function(){e()});f.objectRefresh.add(function(){console.log("Sidebar.objectRefresh");e()});f.keyframeEditorKeysUpdated.add(function(){e()});f.keyframeEditorTangentUpdated.add(function(){e()});
return h};MM.SettingsWindow=function(a){MMUI.Element.call(this);var b=this;this.editor=a;a=document.createElement("div");a.className="modal";this.dom=a;var c=document.createElement("div");c.className="modal-dialog";a.appendChild(c);a=document.createElement("div");a.className="modal-content";c.appendChild(a);c=document.createElement("div");c.className="modal-header";a.appendChild(c);var d=document.createElement("button");d.setAttribute("type","button");d.className="close";d.setAttribute("data-dismiss","modal");
d.setAttribute("aria-label","Close");c.appendChild(d);d.onclick=function(){b.hide()};var e=document.createElement("span");e.setAttribute("aria-hidden","true");e.innerHTML="x";d.appendChild(e);d=document.createElement("h4");d.className="modal-title";d.innerHTML="Default Settings";c.appendChild(d);c=document.createElement("div");c.className="modal-body";a.appendChild(c);this.body=c;this.viewportSettings();c=document.createElement("hr");this.body.appendChild(c);this.animationSettings();c=document.createElement("div");
c.className="modal-footer";a.appendChild(c);a=document.createElement("button");a.className="btn btn-default";a.setAttribute("data-dismiss","modal");a.setAttribute("type","button");a.innerHTML="Close";c.appendChild(a);a.onclick=function(){b.hide()};a=document.createElement("button");a.className="btn btn-default";a.setAttribute("type","button");a.innerHTML="Save Settings and Close";c.appendChild(a);a.onclick=function(){b.editor.saveSceneSettings();b.hide()};this.hide();return this};
MM.SettingsWindow.prototype=Object.create(MMUI.Element.prototype);MM.SettingsWindow.prototype.hide=function(){this.dom.style.display="none";return this};
MM.SettingsWindow.prototype.show=function(){var a=this;this.dom.style.display="block";this.sceneColor.setHexValue(this.editor.sceneBackgroundColor.getHex());this.sceneColor.onChange(function(){a.editor.sceneBackgroundColor.setHex(a.sceneColor.getHexValue())});this.keyColor.setHexValue(this.editor.keyBackgroundColor.getHex());this.keyColor.onChange(function(){a.editor.keyBackgroundColor.setHex(a.keyColor.getHexValue())});this.iTanSelect.setValue(this.editor.defaultTangentType);this.iTanSelect.onChange(function(){a.editor.defaultTangentType=
parseInt(a.iTanSelect.getValue())});return this};
MM.SettingsWindow.prototype.viewportSettings=function(){var a=(new MMUI.Panel).setClass("modal-section");this.body.appendChild(a.dom);var b=(new MMUI.Text("Workspace")).setClass("modal-section-title").setClass("modal-section-title");a.add(b);b=(new MMUI.Panel).setClass("modal-section-content");a.add(b);var c=(new MMUI.Text("Scene View Color")).setClass("modal-section-text");b.add(c);c=(new MMUI.Color).setClass("modal-section-input");b.add(c);this.sceneColor=c;b=(new MMUI.Panel).setClass("modal-section-content");
a.add(b);c=(new MMUI.Text("Key View Color")).setClass("modal-section-text");b.add(c);c=(new MMUI.Color).setClass("modal-section-input");b.add(c);this.keyColor=c;return this};
MM.SettingsWindow.prototype.animationSettings=function(){var a=(new MMUI.Panel).setClass("modal-section");this.body.appendChild(a.dom);var b=(new MMUI.Text("Animation")).setClass("modal-section-title");a.add(b);b=(new MMUI.Panel).setClass("modal-section-content");a.add(b);a=(new MMUI.Text("Default Key Interpolation")).setClass("modal-section-text");b.add(a);a=(new MMUI.Select).setOptions({0:"Stepped",1:"Linear",2:"Smooth"}).setClass("modal-section-input");b.add(a);this.iTanSelect=a;return this};MM.Editor=function(){var a=this,b=signals.Signal;this.signals={sceneNew:new b,sceneSave:new b,assetAdded:new b,assetRemoved:new b,objectAdded:new b,objectRemoved:new b,objectChanged:new b,objectSelected:new b,objectRefresh:new b,helperAdded:new b,helperRemoved:new b,groupAdded:new b,groupContentAdded:new b,manipSpaceChange:new b,manipModeChange:new b,manipScaleChange:new b,cameraChange:new b,cameraAdded:new b,cameraRemoved:new b,keyAll:new b,keyAuto:new b,keyAdded:new b,keyRemoved:new b,keySelected:new b,
keyChanged:new b,keyFramed:new b,keyframeEditorReset:new b,keyframeEditorChanged:new b,keyframeEditorKeysUpdated:new b,keyframeEditorTangentUpdated:new b,animCurveAdded:new b,animCurveRemoved:new b,animCurvesSelected:new b,tangentStepped:new b,tangentLinear:new b,tangentBezier:new b,tangentSelected:new b,tangentBreak:new b,tangentUnify:new b,tangentLock:new b,tangentUnLock:new b,showInfo:new b,play:new b,setTime:new b,timeChanged:new b,timeShifted:new b,timeRangeChanged:new b,sceneGraphChanged:new b,
layoutResized:new b,windowResize:new b};this.projectObj=void 0;this.useHotKeys=!0;this.loader=new MM.Loader(this);this.groups={};this.groups.asset=new MM.GroupManager(this);this.groups.material=new MM.GroupManager(this);this.groups.light=new MM.GroupManager(this);this.groups.camera=new MM.GroupManager(this);this.assets=[];this.sceneBackgroundColor=(new THREE.Color).setRGB(.5,.5,.5);this.activeCamera=void 0;this.cameras=[];this.activePanel=0;this.panels=[];this.viewportCameraControl=null;this.viewportTransformControl=
void 0;this.scene=new THREE.Scene;this.scene.name="objectScene";this.selected=null;this.selectedObjects=[];this.selectableObjects=[];this.prevSelected=null;this.prevSelectedObjects=[];this.object={};this.objects=[];this.clock=new THREE.Clock;this.step1Nodes=[];this.step2Nodes=[];this.undoStack=[];this.redoStack=[];this.redoLimit=this.undoLimit=50;this.helpers=[];this.tooltip=void 0;this.showControls=this.showJoints=this.showGrid=!0;this.activeTool="select";this.activeSpace="local";this.keyBackgroundColor=
(new THREE.Color).setRGB(.5,.5,.5);this.autoKey=this.removedKey=!1;this.keyframeEditorCameraControl=null;this.sceneAnimCurves=new THREE.Scene;this.keyTimeline=this.keyGrid=this.keyProjector=this.keySelectionBox=this.keyCamera=void 0;this.animCurves=[];this.selectedAnimCurves=[];this.activeTimeValue=[];this.previouslySelectedAnimCurves=[];this.animCurveId=0;this.useTimeSnap=!1;this.timeSnapPrecision=0;this.useValueSnap=!1;this.valueSnapPrecision=1;this.pastedKeyValues=this.pastedKeyValue=void 0;this.defaultTangentType=
1;this.isPlaying=!1;this.startTime=this.time=this.timeAsDouble=0;this.endTime=96;this.startRange=0;this.endRange=48;this.playbackMode="fixed";this.playbackSpeed=24;this._fps=0;this.signals.keyframeEditorKeysUpdated.add(function(){a.setTimeValueFromSelectedAnimcurves()});this.signals.keyframeEditorChanged.add(function(){a.setTimeValueFromSelectedAnimcurves()});this.signals.sceneGraphChanged.add(function(){a.evaluateScene(!1)});this.signals.objectSelected.add(function(){a.evaluateScene(!1)});this.signals.objectChanged.add(function(){a.evaluateScene(!1);
a.autoKeySelectedObjects()});this.signals.keyframeEditorKeysUpdated.add(function(){a.evaluateScene(!0)});this.signals.timeChanged.add(function(){a.evaluateScene(!0)});this.signals.manipModeChange.add(function(b){a.activeTool=b});this.signals.manipSpaceChange.add(function(b){a.activeSpace=b})};MM.Editor.prototype.newScene=function(){console.log("Editor: sceneNew");this.loader.saveLayout();void 0!==localStorage.threejsEditor&&delete localStorage.threejsEditor;location.href=location.pathname;this.signals.sceneNew.dispatch()};MM.Editor.prototype.setScene=function(a){var b;for(this.scene.name=a.name;0<a.children.length;)if(b=a.children[0],void 0!==b&&(this.addObject(b),b.isAnimated())){b=b.animCurves;for(var c=0;c<b.length;c++)this.addAnimCurve(b[c])}};
MM.Editor.prototype.saveScene=function(a){console.log("Editor.saveScene",a);this.loader.saveLocalStorage();this.signals.sceneSave.dispatch(a)};MM.Editor.prototype.saveSceneLocal=function(){console.log("Editor.saveSceneLocal");this.loader.saveLocalStorage()};MM.Editor.prototype.loadSceneLocal=function(){console.log("Editor.loadLocalStorage");this.loader.loadLocalStorage()};MM.Editor.prototype.saveSceneAs=function(){return this.loader.saveAsJSON()};MM.Editor.prototype.loadScene=function(a){this.loader.loadJSONFile(a)};
MM.Editor.prototype.addHelper=function(a){this.helpers.push(a);this.scene.add(a);this.signals.helperAdded.dispatch(a);this.signals.sceneGraphChanged.dispatch()};MM.Editor.prototype.removeHelper=function(a){if(void 0!==a){this.helpers.splice(this.helpers.indexOf(a),1);for(var b=0;a.children.length;b++)this.removeHelper(a.children[0]);a.parent.remove(a);this.signals.helperRemoved.dispatch(a);this.signals.sceneGraphChanged.dispatch()}};
MM.Editor.prototype.deleteSelected=function(){console.log("deleteSelected");var a,b;if(0!==this.selectedObjects.length)if(0===this.selectedAnimCurves.length){a=0;for(b=this.selectedObjects.length;a<b;a++)void 0===this.selectedObjects[a].asset?this.removeObject(this.selectedObjects[a]):this.removeAsset(this.selectedObjects[a]);this.deselect(!0)}else for(a=0,b=this.selectedObjects.length;a<b;a++)!1===this.selectedObjects[a].hasKeysSelected()?(console.log("\t",this.selected.name,"has no keys selected"),
console.log("\tdeleting curve"),this.removeSelectedAnimCurves()):(console.log("\tdeleting keys"),this.removeKey())};
MM.Editor.prototype.initSimpleScene=function(){console.log("initSimpleScene");var a=new THREE.GridHelper(250,25);a.name="grid";this.addHelper(a);a=new THREE.PerspectiveCamera(50,1,.1,1E3);a.name="persp";a.tag="control";a.position.set(50,25,50);a.lookAt(new THREE.Vector3(0,0,0));this.cameras.push(a);this.addObject(a);a=new THREE.AmbientLight(3684408);a.name="ambient";this.addHelper(a);a=new THREE.DirectionalLight(16777215);a.position.set(0,1,1).normalize();this.addHelper(a);var a=new THREE.CubeGeometry(10,
20,10),b=new THREE.MeshPhongMaterial({ambient:328965,color:13311,specular:5592405,shininess:30}),a=new THREE.Mesh(a,b);a.name="cube1";a.tag="control";this.addObject(a)};
MM.Editor.prototype.setupDefaultScene=function(){var a=new THREE.GridHelper(250,25);a.name="grid";this.addHelper(a);var b=new THREE.PerspectiveCamera;b.name="persp";b.tag="control";b.setChannelsTranslateAndRotate();b.custom={focusLength:35,frameHeight:24,aspect:1,near:.1,far:2E3};b.addChannel("custom","focusLength");b.addChannel("custom","frameHeight");b.addChannel("custom","near");b.addChannel("custom","far");b.addChannel("custom","aspect");b.setLens(35,24);b.position.set(50,25,50);b.lookAt(new THREE.Vector3(0,
0,0));this.cameras.push(b);this.addObject(b);this.activeCamera=b;var c=new THREE.OrthographicCamera;c.name="front";c.tag="control";c.setChannelsTranslate();c.custom={near:.1,far:2E3};c.addChannel("custom","near");c.addChannel("custom","far");c.position.set(0,0,100);c.lookAt(new THREE.Vector3(0,0,0));this.cameras.push(c);this.addObject(c);var d=new THREE.OrthographicCamera;d.name="side";d.tag="control";d.setChannelsTranslate();d.custom={near:.1,far:2E3};d.addChannel("custom","near");d.addChannel("custom",
"far");d.position.set(100,0,0);d.lookAt(new THREE.Vector3(0,0,0));this.cameras.push(d);this.addObject(d);var e=new THREE.OrthographicCamera;e.name="top";e.tag="control";e.setChannelsTranslate();e.custom={near:.1,far:2E3};e.addChannel("custom","near");e.addChannel("custom","far");e.position.set(0,100,0);e.lookAt(new THREE.Vector3(0,0,0));this.cameras.push(e);this.addObject(e);this.addGroup("default","camera",!1);this.addGroupContent("default",[b,c,d,e],"camera",!0);var f=new THREE.AmbientLight(3684408);
f.name="ambient";this.addHelper(f);var g=new THREE.SpotLight(16777215,.25,0,Math.PI,1);g.tag="control";g.name="spot";g.target.name="spotTarget";g.target.tag="control";g.position.set(-25,100,50);g.target.position.set(0,0,0);g.castShadow=!0;g.shadowCameraNear=5;g.shadowCameraFar=150;g.shadowCameraFov=75;g.shadowDarkness=2;g.shadowMapWidth=1024;g.shadowMapHeight=1024;this.addObject(g);var h=new THREE.DirectionalLight(16777215,.25);h.name="perspDirectional";h.position.set(0,0,1);this.addHelper(h);b.add(h);
var k=new THREE.DirectionalLight(16777215,.25);k.name="frontDirectional";k.position.set(0,0,1);this.addHelper(k);c.add(k);var l=new THREE.DirectionalLight(16777215,.25);l.name="sideDirectional";l.position.set(0,0,1);this.addHelper(l);d.add(l);var m=new THREE.DirectionalLight(16777215,.25);m.name="topDirectional";m.position.set(0,0,1);this.addHelper(m);d.add(m);for(var a=[a,f,g,g.target,h,k,l,m,b,c,d,e],n=0;n<a.length;n++)a[n].exportType="DO_NOT_EXPORT";this.addGroup("default","light",!1);this.addGroupContent("default",
[f,g,g.target,h,k,l,m],"light",!0);return{pcam:b,plight:h,fcam:c,flight:k,scam:d,slight:l,tcam:e,tlight:m,ambient:f,shadow:g,shadowtarget:g.target}};MM.Editor.prototype.insertObjectInbetween=function(a){var b=a.clone(void 0,!1);b.name=a.name+"Zero";this.objects.push(b);a.parent.setParent(b);b.setParent(a);return b};MM.Editor.prototype.addSelectables=function(a){Array.prototype.push.apply(this.selectableObjects,a)};MM.Editor.prototype.addSelectable=function(a){this.selectableObjects.push(a)};
MM.Editor.prototype.removeSelectable=function(a){this.selectableObjects.splice(this.objects.indexOf(a),1)};
MM.Editor.prototype.addObject=function(a){function b(a,b){var d=c.scene.getObjectByName(a,!0);return void 0===d||d.uuid===b?!0:!1}""===a.name&&console.warn("Object",a,"has no name.");this.objects.push(a);var c=this;if(""!==a.name){for(var d=a.name,e=0;!1===b(d,a.uuid);)d=a.name+e,e+=1;a.name!==d&&console.warn("Object",a.name,"already exists. Renaming to",d);a.name=d}this.scene.add(a);this.signals.objectAdded.dispatch(a);this.signals.sceneGraphChanged.dispatch()};
MM.Editor.prototype.removeObjects=function(a){for(var b=0;b<a.length;b++)this.removeObject(a[b])};MM.Editor.prototype.removeObject=function(a){if(void 0!==a&&(this.objects.splice(this.objects.indexOf(a),1),this.removeSelectable(a),"grid"!==a.name&&"persp"!==a.name)){for(var b=0;a.children.length;b++)this.removeObject(a.children[0]);void 0!==a.parent&&a.parent.remove(a);this.selected===a&&(this.selected=null);this.signals.objectRemoved.dispatch(a);this.signals.sceneGraphChanged.dispatch()}};
MM.Editor.prototype.selectObjectByName=function(a){console.log("selectObjectByName",a);var b=this.scene.getObjectByName(a,!0);void 0!==b?this.select(b):console.log("\tobject",a,"does not exist.")};MM.Editor.prototype.selectObjectsByName=function(a){var b,c,d,e=[];b=0;for(c=a.length;b<c;b++)d=this.scene.getObjectByName(a[b],!0),void 0!==d&&e.push(d);this.select(e)};
MM.Editor.prototype.select=function(a,b,c){void 0===b&&(b=!1);!1===b&&this.getUndoDataForSelectedObjects();void 0===c&&(c="reset");this.prevSelectedObjects=0<this.selectedObjects.length?this.selectedObjects.slice(0):[];if(Array.isArray(a))switch(c){case "reset":this.selectedObjects=a;break;case "add":b=0;for(c=a.length;b<c;b++)this.selectedObjects.push(a[b]);break;case "remove":for(b=0,c=a.length;b<c;b++)d=this.selectedObjects.indexOf(a[b]),this.selectedObjects.splice(d,1)}else switch(c){case "reset":this.selectedObjects=
[];this.selectedObjects.push(a);break;case "add":this.selectedObjects.push(a);break;case "remove":var d=this.selectedObjects.indexOf(a);this.selectedObjects.splice(d,1)}b=0;for(c=this.prevSelectedObjects.length;b<c;b++)this.prevSelectedObjects[b]instanceof MM.Control&&this.prevSelectedObjects[b].updateDisplayColor(this.prevSelectedObjects[b].controlColor);b=0;for(c=this.selectedObjects.length-1;b<c;b++)this.selectedObjects[b]instanceof MM.Control&&this.selectedObjects[b].updateDisplayColor(new THREE.Color(65295));
b=this.selectedObjects.length-1;this.selectedObjects[b]instanceof MM.Control&&this.selectedObjects[b].updateDisplayColor(new THREE.Color(16777215));var d=[],e;b=0;for(c=this.selectedObjects.length;b<c;b++)e=this.selectedObjects[b].getAnimCurves(),MM.extendArrayWithArray(d,e);this.displayAnimCurves(d);this.signals.objectSelected.dispatch(a)};
MM.Editor.prototype.deselect=function(a){void 0===a&&(a=!1);!1===a&&this.getUndoDataForSelectedObjects();this.prevSelectedObjects=0<this.selectedObjects.length?this.selectedObjects.slice(0):[];var b;a=0;for(b=this.prevSelectedObjects.length;a<b;a++)this.prevSelectedObjects[a]instanceof MM.Control&&this.prevSelectedObjects[a].updateDisplayColor(this.prevSelectedObjects[a].controlColor);this.selectedObjects=[];this.selectedAnimCurves=[];this.signals.objectSelected.dispatch(null)};
MM.Editor.prototype.parent=function(a,b){void 0===b&&(b=this.scene);b.add(a);this.signals.sceneGraphChanged.dispatch()};MM.Editor.prototype.setupDefaultKeyScene=function(){var a=new THREE.PlaneHelper;a.material.depthTest=!1;a.material.transparent=!0;a.visible=!1;this.sceneAnimCurves.add(a);this.keySelectionBox=a;a=new THREE.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,0,20);a.position.z=10;a.name="keyframeCam";this.sceneAnimCurves.add(a);this.keyCamera=a;var b=new THREE.Projector;this.keyProjector=b;this.keyGrid=new MM.KeyframeGrid(a,b,this.sceneAnimCurves);
a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(this.time,750,4));a.vertices.push(new THREE.Vector3(this.time,-750,4));b=new THREE.LineBasicMaterial({color:16711680,linewidth:1});a=new THREE.Line(a,b);a.name="timeline";this.sceneAnimCurves.add(a);this.keyTimeline=a};MM.Editor.prototype.addAssetObject=function(a){this.addAsset(a)};MM.Editor.prototype.addAsset=function(a){this.assets.push(a);this.signals.assetAdded.dispatch(a)};MM.Editor.prototype.getAssetByName=function(a){console.log("Editor: getAssetByName",a);var b,c;b=0;for(c=this.assets.length;b<c;b++)if(this.assets[b].getAbsoluteName()===a)return console.log("\t",this.assets[b]),this.assets[b]};
MM.Editor.prototype.getNamespaceFromAssetObjects=function(){var a,b,c={"none:none":"none"};a=0;for(b=this.assets.length;a<b;a++)c[this.assets[a].getAbsoluteName()]=this.assets[a].getNamespace();return c};MM.Editor.prototype.getDescriptionFromAssetObjects=function(){var a,b,c={"none:none":"none"};a=0;for(b=this.assets.length;a<b;a++)c[this.assets[a].getAbsoluteName()]=this.assets[a].getName();return c};
MM.Editor.prototype.removeAssetObject=function(a){console.log("Removing assetObject",a);this.signals.assetRemoved.dispatch(a);var b,c;b=0;for(c=this.assets.length;b<c;b++)if(this.assets[b]===a){this.assets.splice(b,1);break}};
MM.Editor.prototype.removeAsset=function(a,b,c){void 0===a&&void 0===b?console.error("At least one arguments needs to be defined"):(void 0!==a&&void 0===b&&(b=a.getNamespace()),void 0===c&&(c=!1),a=this.scene.getObjectWithNamespace(b),this.removeObjects(a),a=this.groups.asset.scene.getObjectByNamespace(b),this.groups.asset.removeGroups(a),a=this.groups.material.scene.getObjectByNamespace(b),this.groups.material.removeGroups(a),a=this.getSetupsWithNamespace(b,"1"),this.removeSetups(a,"1"),a=this.getSetupsWithNamespace(b,
"2"),this.removeSetups(a,"2"),!1===c&&this.getUndoDataForRemoveAsset(b,"undo"))};MM.Editor.prototype.setTime=function(a){this.time=a;this.signals.timeChanged.dispatch();this.signals.showInfo.dispatch("Move to "+this.time)};MM.Editor.prototype.shiftTime=function(a){this.time=a;this.signals.timeShifted.dispatch();this.signals.showInfo.dispatch("Shift to "+this.time)};
MM.Editor.prototype.play=function(){!0===this.isPlaying?(this.isPlaying=!1,this.clock.stop(),this.timeAsDouble=this.time,this.signals.showInfo.dispatch("Stop playing")):(this.isPlaying=!0,this.clock.start(),this.timeAsDouble=this.time,this.signals.showInfo.dispatch("Start playing"));this.signals.play.dispatch();return this};MM.Editor.prototype.nextFrame=function(){this.setTime(this.time+1);this.signals.showInfo.dispatch("Move to next frame");return this};
MM.Editor.prototype.previousFrame=function(){this.setTime(this.time-1);this.signals.showInfo.dispatch("Move to previous frame");return this};MM.Editor.prototype.startFrame=function(){this.setTime(this.startRange);this.signals.showInfo.dispatch("Move to start frame");return this};MM.Editor.prototype.endFrame=function(){this.setTime(this.endRange);this.signals.showInfo.dispatch("Move to end frame");return this};
MM.Editor.prototype.animate=function(){if(this.isPlaying){if("fixed"===this.playbackMode){var a=this.clock.getDelta(),b=a/(1/this.playbackSpeed);this._fps=(1/a*b).toFixed(1);this.timeAsDouble+=b}else this.timeAsDouble+=1,this._fps=(1/this.clock.getDelta()).toFixed(1);this.timeAsDouble>this.endRange&&(this.timeAsDouble=this.startRange);this.time=Math.round(this.timeAsDouble);this.signals.timeChanged.dispatch()}};
MM.Editor.prototype.evaluateScene=function(a){void 0===a&&(a=!1);a&&this.scene.updateAnimation(this.time);a=0;for(var b=this.step1Nodes.length;a<b;a++)this.step1Nodes[a].update();a=0;for(b=this.step2Nodes.length;a<b;a++)this.step2Nodes[a].update();this.scene.updateMatrixWorld();this.scene.updateMatrixWorld();this.scene.updateMatrixWorld()};
MM.Editor.prototype.getAnimCurveByName=function(a){console.log("getAnimCurveByName",a);var b=this.animCurves.length,c;for(c=0;c<b;c++)if(this.animCurves[c].name===a)return console.log("\t",this.animCurves[c].name,"matches"),this.animCurves[c];console.log("\tUnable to find animation curve by name",a)};
MM.Editor.prototype.setTimeValueFromSelectedAnimcurves=function(){var a,b,c=[];a=0;for(b=this.selectedAnimCurves.length;a<b;a++)MM.extendArrayWithArray(c,this.selectedAnimCurves[a].t);this.activeTimeValue=_.uniq(c)};MM.Editor.prototype.toggleAutoKey=function(){this.autoKey?this.setAutoKey(!1):this.setAutoKey(!0)};MM.Editor.prototype.setAutoKey=function(a){this.autoKey=a;this.signals.keyAuto.dispatch();this.autoKey?this.signals.showInfo.dispatch("Setting autoKey on"):this.signals.showInfo.dispatch("Setting autoKey off")};
MM.Editor.prototype.autoKeySelectedObjects=function(){if(this.autoKey){var a,b;a=0;for(b=this.selectedObjects.length;a<b;a++)this.selectedObjects[a].keyAnimated(this.time,this.defaultTangentType,this.defaultTangentType)}};MM.Editor.prototype.hasKeysOrTangentsSelected=function(){var a=this.selectedAnimCurves.length;if(0===a)return!1;var b;for(b=0;b<a;b++)if(!0===this.selectedAnimCurves[b].hasSelection()||!0===this.selectedAnimCurves[b].hasTangentSelection())return!0;return!1};
MM.Editor.prototype.keyObjects=function(a){var b,c,d,e,f,g=[];b=0;for(c=a.length;b<c;b++)if(d=this.scene.getObjectByName(a[b],!0),void 0!==d)for(f=d.keyAll(this.time,this.defaultTangentType,this.defaultTangentType,g),d=0,e=f.length;d<e;d++)this.addAnimCurve(f[d]);this.signals.objectSelected.dispatch()};
MM.Editor.prototype.keySelectedObjectsChannels=function(a){console.log("Editor.keySelectedObjectsChannels",a);if(0===this.selectedObjects.length)console.log("\tNo selected objects. Skipping...");else{var b,c,d,e,f=[];b=0;for(c=this.selectedObjects.length;b<c;b++){var g=[];d=0;for(e=a.length;d<e;d++){var h=this.selectedObjects[b].keyChannel(this.time,this.defaultTangentType,this.defaultTangentType,a[d][0],a[d][1]);h&&g.push(h)}d=0;for(e=g.length;d<e;d++)this.addAnimCurve(g[d]),f.push(g[d])}this.displayAnimCurves();
this.signals.objectSelected.dispatch();return f}};
MM.Editor.prototype.clearSelectedObjectsChannels=function(a){console.log("clearSelectedObjectsChannels",a);if(0===this.selectedObjects.length)console.log("\tNo selected objects. Skipping...");else{var b,c,d,e;b=0;for(c=this.selectedObjects.length;b<c;b++)for(d=0,e=a.length;d<e;d++){var f=this.selectedObjects[b].getAnimCurveFromChannel(a[d]);f||console.log("No animCurve found for",a[d]);this.removeDisplayAnimCurves([f]);this.removeAnimCurve(f)}this.displayAnimCurves();this.signals.objectSelected.dispatch()}};
MM.Editor.prototype.keySelectedObjects=function(a){console.log("editor: keySelectedObjects");if(0===this.selectedObjects.length)console.log("\tNo selected objects. Skipping...");else{var b,c,d,e,f,g=[],h=[],k=[];b=0;for(c=this.selectedObjects.length;b<c;b++){f=this.selectedObjects[b].keyAll(this.time,this.defaultTangentType,this.defaultTangentType,a);d=0;for(e=f.length;d<e;d++)this.addAnimCurve(f[d],!0),g.push(f[d]);Array.prototype.push.apply(h,this.selectedObjects[b].animCurves);d=0;for(e=this.selectedObjects[b].animCurves.length;d<
e;d++)k.push([[this.time]])}this.getUndoDataFromAddKey(h,k,"undo");0<g.length&&this.getUndoDataFromAddAnimCurve(g,"undo");this.displayAnimCurves();this.signals.objectSelected.dispatch();void 0!==a?this.signals.showInfo.dispatch("Key selected objects but ship "+a):this.signals.showInfo.dispatch("Key selected objects")}};
MM.Editor.prototype.addAnimCurve=function(a,b){null!==a&&void 0!==a&&(void 0===b&&(b=!1),!1===b&&this.getUndoDataFromAddAnimCurve([a],"undo"),this.animCurves.push(a),a.id=this.animCurveId,this.animCurveId+=1)};
MM.Editor.prototype.removeAnimCurve=function(a,b){if(void 0!==a){void 0===b&&(b=!1);!1===b&&this.getUndoDataFromRemoveAnimCurve([a],"undo");var c=this.animCurves.indexOf(a);-1!=c&&this.animCurves.splice(c,1);c=this.selectedAnimCurves.indexOf(a);-1!=c&&this.selectedAnimCurves.splice(c,1);this.removeDisplayAnimCurve(a);a.driven.removeAnimCurve(a)}};MM.Editor.prototype.removeSelectedAnimCurves=function(){var a,b;a=0;for(b=this.selectedAnimCurves.length;a<b;a++)this.removeAnimCurve(this.selectedAnimCurves[a])};
MM.Editor.prototype.removeAllAnimCurves=function(){for(;0!==this.animCurves.length;)this.removeAnimCurve(this.animCurves[0])};MM.Editor.prototype.displaySelectedObjectsAnimCurves=function(){var a,b,c=[];a=0;for(b=this.selectedObjects.length;a<b;a++)Array.prototype.push.apply(c,this.selectedObjects[a].getAnimCurves());this.displayAnimCurves(c)};
MM.Editor.prototype.displayAnimCurves=function(a){this.removeDisplayAnimCurves(this.selectedAnimCurves);void 0!==a&&(this.selectedAnimCurves=a);for(var b=0;b<this.selectedAnimCurves.length;b++)this.selectedAnimCurves[b].addDisplay(),a=this.sceneAnimCurves.getObjectByName(this.selectedAnimCurves[b].dp.line.name,!0),void 0===a&&(this.sceneAnimCurves.add(this.selectedAnimCurves[b].dp.line),this.sceneAnimCurves.add(this.selectedAnimCurves[b].dp.dvrt),this.sceneAnimCurves.add(this.selectedAnimCurves[b].dp.svrt))};
MM.Editor.prototype.updateDisplayAnimCurves=function(){for(var a=0;a<this.selectedAnimCurves.length;a++)this.selectedAnimCurves[a].updateDisplay()};MM.Editor.prototype.clearSelectionAnimCurves=function(a){for(var b=0;b<a.length;b++)a[b].clearSelection()};MM.Editor.prototype.removeDisplayAnimCurvesFromPrevisouslySelected=function(){var a,b,c,d,e;a=0;for(b=this.prevSelectedObjects.length;a<b;a++)for(e=this.prevSelectedObjects[a].getAnimCurves(),c=0,d=e.length;c<d;c++)e[c].removeDisplay(this.sceneAnimCurves)};
MM.Editor.prototype.removeDisplayAnimCurve=function(a){console.log("removeDisplayAnimCurve",a);console.log("depricated... use animCurve.removeDisplay instead");a.removeDisplay(this.sceneAnimCurves)};MM.Editor.prototype.removeDisplayAnimCurves=function(a){0===a.length&&this.removeDisplayAnimCurvesFromPrevisouslySelected();for(var b=0;b<a.length;b++)a[b].removeDisplay(this.sceneAnimCurves)};
MM.Editor.prototype.addKey=function(){for(var a,b,c=[],d=[],e=0;e<this.selectedAnimCurves.length;e++)a=this.selectedAnimCurves[e],b=a.driven[a.attr[0]],a.add(this.time,b[a.attr[1]],this.defaultTangentType,this.defaultTangentType),c.push(a),d.push([[this.time]]);this.getUndoDataFromAddKey(c,d,"undo");this.signals.keyframeEditorChanged.dispatch()};
MM.Editor.prototype.removeKey=function(){for(var a=[],b=[],c,d=[],e=0;e<this.selectedAnimCurves.length;e++){c=this.selectedAnimCurves[e];for(var d=[],f=0;f<c.getNumberOfKeys();f++)!0===c.s[f]&&d.push(f);a.push(c);b.push(d)}this.getUndoDataFromRemoveKey(a,b,"undo");for(e=0;e<this.selectedAnimCurves.length;e++)for(c=this.selectedAnimCurves[e],f=0;f<c.getNumberOfKeys();f++)!0===c.s[f]&&c.removeIndex(f);this.signals.keyframeEditorChanged.dispatch()};
MM.Editor.prototype.copyKeys=function(){var a,b,c,d,e={};a=0;for(b=this.selectedAnimCurves.length;a<b;a++)d=this.selectedAnimCurves[a],c=d.hasSelection()?d.getAllFromSelected(this.time):d.getAll(this.time),e[d.name]=c;this.pastedKeyValues=e};
MM.Editor.prototype.pasteKeys=function(){console.log("pasteKeys");var a,b,c,d,e,f,g,h=this.selectedAnimCurves.length;if(0===this.selectedObjects.length)console.log("\tNo objects selected to apply the stored keys on.");else{var k=this.selectedAnimCurves;f=!1;a=0;for(b=k.length;a<b;a++)if(e=k[a],g=e.name,this.pastedKeyValues.hasOwnProperty(g))for(c=0,d=this.pastedKeyValues[g].length;c<d;c++)f=this.pastedKeyValues[g][c],e.add(this.time+f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7]),f=!0;if(!f&&0!==h)for(console.log("\tNo keys were added but we do have an animation curve selected."),
g=this.pastedKeyValues[Object.keys(this.pastedKeyValues)[0]],a=0,b=h;a<b;a++)for(e=k[a],c=0,d=g.length;c<d;c++)console.log("\tApplying keys",c),f=g[c],e.add(this.time+f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7]),f=!0;f&&(console.log("\tKeys were added, dispatch event."),this.signals.keyAdded.dispatch(),this.signals.keyframeEditorChanged.dispatch())}};MM.Editor.prototype.copyKey=function(){0!==this.selectedAnimCurves.length&&(this.pastedKeyValue=this.selectedAnimCurves[0].getTimeAndValueFromSelected(!0)[0][1])};
MM.Editor.prototype.pasteKey=function(){if(void 0===this.pastedKeyValue)console.log("\tNo value to paste.");else{for(var a=0;a<this.selectedAnimCurves.length;a++)this.selectedAnimCurves[a].add(this.time,this.pastedKeyValue);this.signals.keyAdded.dispatch();this.signals.keyframeEditorChanged.dispatch()}};MM.Editor.prototype.updateDisplayKeyTangents=function(){for(var a=0;a<this.selectedAnimCurves.length;a++)this.selectedAnimCurves[a].updateTangentDisplay()};
MM.Editor.prototype.displayKeyTangents=function(){this.removeDisplayKeyTangents();for(var a=0;a<this.selectedAnimCurves.length;a++)if(!0===this.selectedAnimCurves[a].hasSelection()||!0===this.selectedAnimCurves[a].hasTangentSelection()){var b;b=!0===this.selectedAnimCurves[a].hasSelection()?this.selectedAnimCurves[a].getSelectedIndices():this.selectedAnimCurves[a].getSelectedTangentIndices();this.selectedAnimCurves[a].addTangentDisplay(b);this.selectedAnimCurves[a].hasTangentDisplay()&&(this.sceneAnimCurves.add(this.selectedAnimCurves[a].tdp.line),
this.sceneAnimCurves.add(this.selectedAnimCurves[a].tdp.dvrt),this.sceneAnimCurves.add(this.selectedAnimCurves[a].tdp.svrt))}};MM.Editor.prototype.removeDisplayKeyTangents=function(){var a=this.sceneAnimCurves.getObjectOfInstance(THREE.Line),b,c,d;b=0;for(c=a.length;b<c;b++)a[b].hasOwnProperty("animParent")&&(d=a[b].animParent.animCurve,d.hasTangentDisplay()&&(this.sceneAnimCurves.remove(d.tdp.line),this.sceneAnimCurves.remove(d.tdp.dvrt),this.sceneAnimCurves.remove(d.tdp.svrt),d.removeTangentDisplay()))};
MM.Editor.prototype.clearSelectionTangents=function(){for(var a=0;a<this.selectedAnimCurves.length;a++)this.selectedAnimCurves[a].clearTangentSelection()};MM.Editor.prototype.setTangentMode=function(a){for(var b=0;b<this.selectedAnimCurves.length;b++)this.selectedAnimCurves[b].setTangentType(a)};MM.Editor.prototype.resetTangent=function(){for(var a=0;a<this.selectedAnimCurves.length;a++)this.selectedAnimCurves[a].resetTangent()};MM.Editor.prototype.breakTangent=function(){for(var a=0;a<this.selectedAnimCurves.length;a++)this.selectedAnimCurves[a].breakTangent()};
MM.Editor.prototype.unifyTangent=function(){for(var a=0;a<this.selectedAnimCurves.length;a++)this.selectedAnimCurves[a].unifyTangent()};MM.Editor.prototype.lockTangent=function(){for(var a=0;a<this.selectedAnimCurves.length;a++)this.selectedAnimCurves[a].lockTangent()};MM.Editor.prototype.unlockTangent=function(){for(var a=0;a<this.selectedAnimCurves.length;a++)this.selectedAnimCurves[a].unlockTangent()};MM.Editor.prototype.flattenTangent=function(){for(var a=0;a<this.selectedAnimCurves.length;a++)this.selectedAnimCurves[a].flattenTangent()};
MM.Editor.prototype.steppedTangents=function(){this.getUndoTransformDataFromSelectedKeys("undo");this.setTangentMode(0);this.resetTangent();this.displayAnimCurves();this.signals.keyframeEditorChanged.dispatch()};MM.Editor.prototype.linearTangents=function(){this.getUndoTransformDataFromSelectedKeys("undo");this.setTangentMode(1);this.resetTangent();this.displayAnimCurves();this.signals.keyframeEditorChanged.dispatch()};
MM.Editor.prototype.bezierTangents=function(){this.getUndoTransformDataFromSelectedKeys("undo");this.setTangentMode(2);this.displayAnimCurves();this.signals.keyframeEditorChanged.dispatch()};MM.Editor.prototype.breakTangents=function(){this.getUndoTransformDataFromSelectedKeys("undo");this.breakTangent();this.signals.keyframeEditorKeysUpdated.dispatch()};MM.Editor.prototype.unifyTangents=function(){this.getUndoTransformDataFromSelectedKeys("undo");this.unifyTangent();this.signals.keyframeEditorKeysUpdated.dispatch()};
MM.Editor.prototype.lockTangents=function(){this.getUndoTransformDataFromSelectedKeys("undo");this.lockTangent();this.signals.keyframeEditorKeysUpdated.dispatch()};MM.Editor.prototype.unlockTangents=function(){this.getUndoTransformDataFromSelectedKeys("undo");this.unlockTangent();this.signals.keyframeEditorKeysUpdated.dispatch()};MM.Editor.prototype.flattenTangents=function(){this.getUndoTransformDataFromSelectedKeys("undo");this.flattenTangent();this.signals.keyframeEditorKeysUpdated.dispatch()};MM.Editor.prototype.addToUndoStack=function(a,b){console.log("addToUndoStack",a,b);void 0===b&&(b="undo");switch(b){case "undo":this.undoStack.push(a);this.undoStack.length>this.undoLimit&&this.undoStack.shift();break;case "redo":this.redoStack.push(a);this.redoStack.length>this.redoLimit&&this.redoStack.shift();break;default:console.warn("Unknown mode:",b)}};MM.Editor.prototype.removeLastEntryFromUndoStack=function(){this.undoStack.pop()};
MM.Editor.prototype.removeLastEntriesFromUndoStack=function(a){for(var b=0;b<a;b++)this.undoStack.pop()};MM.Editor.prototype.flushUndoStack=function(){this.undoStack=[];this.redoStack=[]};
MM.Editor.prototype.undo=function(){var a=this.undoStack.length;if(0<a){a=this.undoStack[a-1];console.log("\trunning undoData",a);switch(a[0]){case "selectObject":this.getUndoDataForSelectedObjects("redo");var b=a[1];this.setUndoDataForSelectedObjects(b);this.signals.objectChanged.dispatch(b);break;case "setTransformation":console.log("\t\tsetTransformation",a);this.getUndoDataForTransformingObjects("redo");this.setUndoDataForTransformingObjects(a);this.signals.objectChanged.dispatch();break;case "setValue":this.getRedoDataForObjectValueUndoData(a,
"redo");this.setUndoDataForObjectValue(a);this.signals.objectChanged.dispatch(b);break;case "removeKey":console.log("\t\tremoveKey");a.shift();this.getRedoDataFromRemoveKeyUndoData(a,"redo");this.setUndoDataFromRemoveKey(a);this.signals.keyframeEditorChanged.dispatch();break;case "addKey":a.shift();this.getRedoDataFromAddKeyUndoData(a,"redo");this.setUndoDataFromAddKey(a);this.signals.keyframeEditorChanged.dispatch();break;case "setKey":this.getUndoTransformDataFromSelectedKeys("redo");this.setUndoTransformDataToSelectedKeys(a[1]);
this.signals.keyframeEditorChanged.dispatch();break;case "selectKey":this.getUndoSelectionDataFromKeysForSelection("redo");this.setUndoSelectionDataFromKeysForSelection(a[1],a[2]);this.signals.keyframeEditorChanged.dispatch();break;case "addAnimCurve":a.shift();this.getUndoDataFromRemoveAnimCurve(a[0],"redo");this.setUndoDataFromAddAnimCurve(a[0]);console.log("\trefesh keyframe editor");this.signals.objectSelected.dispatch(this.selected);break;case "removeAnimCurve":a.shift();this.getUndoDataFromAddAnimCurve(a[0],
"redo");this.setUndoDataFromRemoveAnimCurve(a[0]);console.log("\trefesh keyframe editor");this.signals.objectSelected.dispatch(this.selected);break;case "addAsset":a.shift();this.getUndoDataForRemoveAsset(a[0],"redo");this.setUndoDataForAddAsset(a[0]);break;case "deleteAsset":a.shift(),this.getUndoDataForAddAsset(a[0],"redo"),this.setUndoDataForRemoveAsset(a[0])}this.undoStack.pop()}};
MM.Editor.prototype.redo=function(){var a=this.redoStack.length;if(0<a){a=this.redoStack[a-1];console.log("\trunning redoData",a);switch(a[0]){case "selectObject":a.shift();this.getUndoDataForSelectedObjects("undo");var b=a[0];this.setUndoDataForSelectedObjects(b);this.signals.objectChanged.dispatch(b);break;case "setTransformation":this.getUndoDataForTransformingObjects("undo");this.setUndoDataForTransformingObjects(a);this.signals.objectChanged.dispatch();break;case "setValue":this.getRedoDataForObjectValueUndoData(a,
"undo");this.setUndoDataForObjectValue(a);this.signals.objectChanged.dispatch(b);break;case "removeKey":a.shift();this.getRedoDataFromRemoveKeyUndoData(a,"undo");this.setUndoDataFromRemoveKey(a);this.signals.keyframeEditorChanged.dispatch();break;case "addKey":a.shift();this.getRedoDataFromAddKeyUndoData(a,"undo");this.setUndoDataFromAddKey(a);this.signals.keyframeEditorChanged.dispatch();break;case "setKey":this.getUndoTransformDataFromSelectedKeys("undo");this.setUndoTransformDataToSelectedKeys(a[1]);
this.signals.keyframeEditorChanged.dispatch();break;case "selectKey":this.getUndoSelectionDataFromKeysForSelection("undo");this.setUndoSelectionDataFromKeysForSelection(a[1],a[2]);this.signals.keyframeEditorChanged.dispatch();break;case "addAnimCurve":console.log("\t\taddAnimCurve",a[1]);a.shift();this.getUndoDataFromRemoveAnimCurve(a[0],"undo");this.setUndoDataFromAddAnimCurve(a[0]);this.signals.objectSelected.dispatch(this.selected);break;case "removeAnimCurve":a.shift();this.getUndoDataFromAddAnimCurve(a[0],
"undo");this.setUndoDataFromRemoveAnimCurve(a[0]);this.signals.objectSelected.dispatch(this.selected);break;case "addAsset":a.shift();this.getUndoDataForRemoveAsset(a[0],"undo");this.setUndoDataForAddAsset(a[0]);break;case "deleteAsset":a.shift(),this.getUndoDataForAddAsset(a[0],"undo"),this.setUndoDataForRemoveAsset(a[0])}this.redoStack.pop()}};
MM.Editor.prototype.getUndoDataForSelectedObjects=function(a){console.log("getUndoDataForSelectedObjects",a);void 0===a&&(a="undo");var b=[],c,d;c=0;for(d=this.selectedObjects.length;c<d;c++)console.log("\tAdding",this.selectedObjects[c]),b.push(this.selectedObjects[c]);this.addToUndoStack(["selectObject",b],a)};MM.Editor.prototype.setUndoDataForSelectedObjects=function(a){console.log("setUndoDataForSelectedObjects",a);null===a?this.deselect(!0):this.select(a,!0)};
MM.Editor.prototype.getUndoDataForObjectValue=function(a,b,c){var d,e,f=[];a=0;for(d=this.selectedObjects.length;a<d;a++)e=this.selectedObjects[a][b],f.push(e[c]);this.addToUndoStack(["setValue",this.selectedObjects,b,c,f],"undo")};MM.Editor.prototype.getRedoDataForObjectValueUndoData=function(a,b){void 0===b&&(b="undo");var c=a[1],d=a[2],e=a[3],f,g=[],h,k;h=0;for(k=this.selectedObjects.length;h<k;h++)f=c[h][d],g.push(f[e]);this.addToUndoStack(["setValue",c,d,e,g],b)};
MM.Editor.prototype.setUndoDataForObjectValue=function(a){var b=a[1],c=a[2],d=a[3];a=a[4];var e,f,g;e=0;for(f=b.length;e<f;e++)g=b[e][c],g[d]=a[e]};MM.Editor.prototype.getUndoDataForTransformingObjects=function(a){void 0===a&&(a="undo");var b,c,d=[],e=["setTransformation",this.selectedObjects];b=0;for(c=this.selectedObjects.length;b<c;b++)d.push([this.selectedObjects[b].getTransformationData()]);this.addToUndoStack(e.concat(d),a)};
MM.Editor.prototype.setUndoDataForTransformingObjects=function(a){var b,c=a[1],d=a[2];a=0;for(b=c.length;a<b;a++)console.log("\t\t",c[a]),c[a].setTransformationData(d[a])};MM.Editor.prototype.getUndoDataFromAddAnimCurve=function(a,b){this.addToUndoStack(["addAnimCurve",a],b)};MM.Editor.prototype.setUndoDataFromAddAnimCurve=function(a){var b,c;b=0;for(c=a.length;b<c;b++)this.removeAnimCurve(a[b],!0),a[b].driven.removeAnimCurve(a[b])};
MM.Editor.prototype.getUndoDataFromRemoveAnimCurve=function(a,b){this.addToUndoStack(["removeAnimCurve",a],b)};MM.Editor.prototype.setUndoDataFromRemoveAnimCurve=function(a){var b,c;b=0;for(c=a.length;b<c;b++)this.addAnimCurve(a[b],!0),a[b].driven.addAnimCurve(a[b])};
MM.Editor.prototype.getUndoDataFromRemoveKey=function(a,b,c){void 0===c&&(c="undo");var d=[],e,f,g,h;e=0;for(f=a.length;e<f;e++){var k=[];g=0;for(h=b[e].length;g<h;g++)k.push(a[e].getTransformDataFromIndex(b[e][g]));d.push(k)}this.addToUndoStack(["removeKey",a,d],c)};MM.Editor.prototype.getRedoDataFromRemoveKeyUndoData=function(a,b){void 0===b&&(b="undo");this.getUndoDataFromAddKey(a[0],a[1],b)};
MM.Editor.prototype.setUndoDataFromRemoveKey=function(a){var b=a[0];a=a[1];var c,d,e,f;c=0;for(d=b.length;c<d;c++)for(e=0,f=a[c].length;e<f;e++)b[c].addFromList(a[c][e])};MM.Editor.prototype.getUndoDataFromAddKey=function(a,b,c){void 0===c&&(c="undo");this.addToUndoStack(["addKey",a,b],c)};
MM.Editor.prototype.getRedoDataFromAddKeyUndoData=function(a,b){void 0===b&&(b="undo");var c=a[0],d=a[1],e=[],f,g,h,k;f=0;for(g=c.length;f<g;f++){var l=[];h=0;for(k=d[f].length;h<k;h++)l.push([c[f].getIndexAtTime(d[f][h][0])]);e.push(l)}this.getUndoDataFromRemoveKey(c,e,b)};MM.Editor.prototype.setUndoDataFromAddKey=function(a){var b=a[0];a=a[1];var c,d,e,f;c=0;for(d=b.length;c<d;c++)for(e=0,f=a[c].length;e<f;e++)b[c].removeKeyAtTime(a[c][e][0])};
MM.Editor.prototype.getUndoTransformDataFromSelectedKeys=function(a){void 0===a&&(a="undo");for(var b={},c,d,e,f,g=0;g<this.selectedAnimCurves.length;g++){c=this.selectedAnimCurves[g];b[c.name]=[];e=c.getSelectedKeysAndTangents();f=e.length;d=[];for(var h=0;h<f;h++)d.push([e[h],c.getTransformDataFromIndex(e[h])]);b[c.name]=d}this.addToUndoStack(["setKey",b],a);return 0};
MM.Editor.prototype.setUndoTransformDataToSelectedKeys=function(a){var b,c,d,e;for(b in a)for(d=a[b].length,c=this.getAnimCurveByName(b),e=0;e<d;e++)console.log("\t",a[b][e][0],a[b][e][1]),c.setTransformDataToIndex(a[b][e][0],a[b][e][1])};
MM.Editor.prototype.getUndoSelectionDataFromKeysForSelection=function(a){void 0===a&&(a="undo");for(var b=0,c,d=[],e=[],f=0;f<this.selectedAnimCurves.length;f++)c=this.selectedAnimCurves[f],e.push(c),d.push(c.getSelectionData()),b+=1;this.addToUndoStack(["selectKey",e,d],a);return b};MM.Editor.prototype.setUndoSelectionDataFromKeysForSelection=function(a,b){var c,d;c=0;for(d=a.length;c<d;c++)a[c].setSelectionData(b[c])};
MM.Editor.prototype.getUndoDataForAddAsset=function(a,b){":"===a.slice(-1)&&(a=a.slice(0,a.length-1));this.addToUndoStack(["addAsset",a],b)};MM.Editor.prototype.setUndoDataForAddAsset=function(a){this.removeAsset(void 0,a,!0);this.deselect(!0)};MM.Editor.prototype.getUndoDataForRemoveAsset=function(a,b){":"===a.slice(-1)&&(a=a.slice(0,a.length-1));this.addToUndoStack(["deleteAsset",a],b)};
MM.Editor.prototype.setUndoDataForRemoveAsset=function(a){var b="insert"+a.slice(0,1).toUpperCase(),b=b+(a.slice(1,a.length)+"(this)");console.log("assetFunction",b);eval(b)};MM.Editor.prototype.addGroup=function(a,b,c){void 0===b&&(b="asset");void 0===c&&(c=!1);a=this.groups[b].addGroup(a);!0===!c&&this.signals.groupAdded.dispatch(a);return a};MM.Editor.prototype.addGroupContent=function(a,b,c,d){void 0===c&&(c="asset");void 0===d&&(d=!1);this.groups[c].addContent(a,b);!0===!d&&this.signals.groupContentAdded.dispatch(a)};MM.Editor.prototype.controlsVisibility=function(a){void 0===a&&(a=!0);this.showControls=a;for(var b=this.scene.getObjectOfInstance(MM.Control),c=0,d=b.length;c<d;c++)!0===a?!1===b[c].hasDisplay()&&(b[c].addDisplay(),!0===b[c].hasDisplay()&&this.addHelper(b[c].cd.line)):!0===b[c].hasDisplay()&&(this.removeHelper(b[c].cd.line),b[c].removeDisplay())};MM.Editor.prototype.gridVisibility=function(a){this.showGrid=a;this.scene.getObjectByName("grid").visible=a;this.signals.sceneGraphChanged.dispatch()};
MM.Editor.prototype.geometryVisibility=function(a){console.log("geometryVisibility",a);for(var b=this.scene.getObjectOfInstance(THREE.Mesh),c=b.length,d="TXYZ TXY TYZ TXZ TX TY TZ SXYZ SX SY SZ TXYZ TXY TYZ TXZ TX TY TZ RX RY RZ RXYZE RE SXYZ SX SY SZ".split(" "),e=0;e<c;e++)""!==b[e].name&&-1===d.indexOf(b[e].name)&&(console.log("\t",b[e].name),b[e].visible=a);this.signals.sceneGraphChanged.dispatch()};
MM.Editor.prototype.rotationAxisVisibility=function(a){console.log("rotationAxisVisibility",a);var b,c;b=0;for(c=this.selectedObjects.length;b<c;b++)console.log("\tshowing rotation axis for",this.selectedObjects[b]),"Joint"===this.selectedObjects[b].type&&(console.log("\tjoint already has display"),this.selectedObjects[b].hasDisplay()&&(this.removeHelper(this.selectedObjects[b].jd.line),this.selectedObjects[b].removeDisplay(),this.selectedObjects[b].showRotationAxis=a,this.selectedObjects[b].addDisplay(),
this.addHelper(this.selectedObjects[b].jd.line)))};MM.Editor.prototype.jointsVisibility=function(a){void 0===a&&(a=!0);this.showJoints=a;for(var b=this.scene.getObjectOfType("Joint"),c=0,d=b.length;c<d;c++)!0===a?!1===b[c].hasDisplay()&&(b[c].addDisplay(),this.addHelper(b[c].jd.line)):!0===b[c].hasDisplay()&&(this.removeHelper(b[c].jd.line),b[c].removeDisplay())};MM.Editor.prototype.initDrivenChannels=function(){var a=this.scene.getObjectWithProperty("driveChannel"),b=this,c;_.each(a,function(a){c=b.scene.getObjectByName(a.driveChannel.position,!0);a.connectChannelTo(c,"position")})};MM.Editor.prototype.importPTASettings=function(a){console.log("importPTASettings",a);this.projectObj=a};MM.Editor.prototype.exportPTASettings=function(){console.log("exportPTASettings");console.log("\tresult",this.projectObj);return this.projectObj};
MM.Editor.prototype.currentPTASettingsMatches=function(a,b,c){return this.projectObj.projectId!==a||this.projectObj.shotId!==b||this.projectObj.versionId!==c?!1:!0};
MM.Editor.prototype.localPTASettingsMatches=function(a,b,c){console.log("Editor.localPTASettings");if(void 0!==localStorage.threejsEditor){new THREE.ObjectLoader;if(void 0===localStorage.threejsEditor)return!1;var d=JSON.parse(localStorage.threejsEditor);if(!d.hasOwnProperty("project"))return!1;d=d.project;return d.projectId!==a||d.shotId!==b||d.versionId!==c?!1:!0}return!1};
MM.Editor.prototype.matchesPTASettings=function(a){return void 0===this.projectObj||this.projectObj.projectId!==a.projectId||this.projectObj.shotId!==a.shotId||this.projectObj.versionId!==a.versionId?!1:!0};MM.Editor.prototype.exportSelectables=function(){var a=[],b,c;b=0;for(c=this.selectableObjects.length;b<c;b++)a.push(this.selectableObjects[b].name);return a};
MM.Editor.prototype.importSelectables=function(a){console.log("importSelectables",a);var b,c;b=0;for(c=a.length;b<c;b++){var d=this.scene.getObjectByName(a[b],!0);d&&this.selectableObjects.push(d)}};
MM.Editor.prototype.exportSceneSettings=function(){console.log("editor.exportSceneSettings");var a={};a.showGrid=this.showGrid;a.showJoints=this.showJoints;a.showControls=this.showControls;a.sceneBackgroundColor=this.sceneBackgroundColor.toArray();a.keyBackgroundColor=this.keyBackgroundColor.toArray();a.time=this.time;a.startTime=this.startTime;a.endTime=this.endTime;a.startRange=this.startRange;a.endRange=this.endRange;console.log("\tresult:",a);return a};
MM.Editor.prototype.resetSceneSettings=function(){var a={showGrid:!0,showJoints:!0,showControls:!0};a.sceneBackgroundColor=(new THREE.Color).setRGB(.75,.75,.75).toArray();a.keyBackgroundColor=(new THREE.Color).setRGB(.75,.75,.75).toArray();a.time=0;a.startTime=0;a.startRange=0;a.endRange=24;a.endTime=48;return a};
MM.Editor.prototype.importSceneSettings=function(a){this.gridVisibility(a.showGrid);this.controlsVisibility(a.showControls);this.jointsVisibility(a.showJoints);this.sceneBackgroundColor.fromArray(a.sceneBackgroundColor);this.keyBackgroundColor.fromArray(a.keyBackgroundColor);this.time=a.time;this.startTime=a.startTime;this.endTime=a.endTime;this.startRange=a.startRange;this.endRange=a.endRange;this.signals.timeChanged.dispatch(a.time)};
MM.Editor.prototype.saveSceneSettings=function(){localStorage.moveMeSceneSettings=JSON.stringify(this.exportSceneSettings())};MM.Editor.prototype.loadSceneSettings=function(){void 0!==localStorage.moveMeSceneSettings&&this.importSceneSettings(JSON.parse(localStorage.moveMeSceneSettings));console.log("after load scene settings",this.time)};MM.Editor.prototype.loadResetSceneSettings=function(){this.importSceneSettings(this.resetSceneSettings())};
MM.Editor.prototype.exportAssetObjects=function(){var a={},b,c;b=0;for(c=this.assets.length;b<c;b++)a[this.assets[b].getNamespace()]=this.assets[b].exportData();return a};MM.Editor.prototype.importAssetObjects=function(a){this.assets=[];var b,c;for(c in a)b=new MM.Asset,b.importData(a[c],this.scene),this.assets.push(b);this.signals.assetAdded.dispatch()};MM.Editor.prototype.importGroups=function(a){for(var b in this.groups)this.groups[b].importData(a[b])};
MM.Editor.prototype.exportGroups=function(){var a={},b;for(b in this.groups)a[b]=this.groups[b].exportData();return a};
MM.Editor.prototype.importSetups=function(a){for(var b in a){var c=a[b];switch(c.type){case "SkinnedMesh":var d=this.scene.getObjectByUuid(b);if(void 0===d)break;var e=d.geometry.clone(),f=d.material.clone();f.skinning=!0;e.bones=[];for(var g=0;g<c.bones.length;g++){var h=this.scene.getObjectByName(c.bones[g],!0);if(void 0===h)break;e.bones.push(h)}e.skinWeights=[];e.skinIndices=[];for(g=0;g<c.skinWeights.length;g++)e.skinWeights.push(new THREE.Vector4(c.skinWeights[g].x,c.skinWeights[g].y,c.skinWeights[g].z,
c.skinWeights[g].w)),e.skinIndices.push(new THREE.Vector4(c.skinIndices[g].x,c.skinIndices[g].y,c.skinIndices[g].z,c.skinIndices[g].w));e=new THREE.SkinnedMesh(e,f);e.identityMatrix.fromArray(c.identityMatrix);e.name=d.name;e.boneInverses=void 0;e.updateMatrixWorld(!1);this.removeObject(d);this.addObject(e);e.uuid=b;break;case "ParentMaster":d=this.scene.getObjectByUuid(b,!0);if(void 0===d&&(d=this.scene.getObjectByName(c.name,!0),void 0===d))break;d.importSetup(this.scene,c);break;case "Spaceswitch":d=
this.scene.getObjectByUuid(b,!0);if(void 0===d&&(d=this.scene.getObjectByName(c.name,!0),void 0===d))break;d.importSetup(this.scene,c);break;case "Constraint":d=this.scene.getObjectByUuid(b,!0);if(void 0===d&&(d=this.scene.getObjectByName(c.name,!0),void 0===d))break;c=this.scene.getObjectByName(c.objectToSolve,!0);if(void 0===c)break;d.setObjectToSolve(c);break;case "FourBoneIkBlendSolver":d=this.scene.getObjectByUuid(b,!0);if(void 0===d)break;d.importSetup(this.scene,c);break;case "TwoBoneIkBlendSolver":d=
this.scene.getObjectByUuid(b,!0);if(void 0===d)break;d.importSetup(this.scene,c);break;case "TwoBoneSoftIkSolver":d=this.scene.getObjectByUuid(b,!0);if(void 0===d)break;d.importSetup(this.scene,c);break;case "TwoBoneIkSolver":d=this.scene.getObjectByUuid(b,!0);if(void 0===d)break;d.importSetup(this.scene,c);break;case "OneSimpleBoneIkSolver":d=this.scene.getObjectByUuid(b,!0);if(void 0===d)break;e=this.scene.getObjectByName(c.startJoint,!0);f=this.scene.getObjectByName(c.endJoint,!0);d.setStartJoint(e);
d.endJoint=f;d.startPreferedAngle.fromArray(c.startPreferedAngle);break;case "SplineSolver":d=new MM.SplineSolver(this);d.importData(c);break;case "MultiChannel":d=new MM.MultiChannel,d.importData(c,this.scene),this.step2Nodes.push(d)}}};
MM.Editor.prototype.exportSetups=function(){for(var a={},b={},c=this.scene.getObjectOfInstance(THREE.SkinnedMesh),d=0,e=c.length;d<e;d++){b={type:"SkinnedMesh"};b.name=c[d].name;b.identityMatrix=c[d].identityMatrix.elements;b.bones=[];for(var f=0,g=c[d].bones.length;f<g;f++)b.bones.push(c[d].bones[f].name);b.boneMatrices=[];f=0;for(g=c[d].boneMatrices.length;f<g;f++)b.boneMatrices.push(c[d].boneMatrices[f]);b.skinWeights=c[d].geometry.skinWeights;b.skinIndices=c[d].geometry.skinIndices;a[c[d].uuid]=
b}b=this.scene.getObjectOfInstance(MM.ParentMaster);d=0;for(e=b.length;d<e;d++)a[b[d].uuid]=b[d].exportSetup();b=this.scene.getObjectOfInstance(MM.Spaceswitch);d=0;for(e=b.length;d<e;d++)a[b[d].uuid]=b[d].exportSetup();c=this.scene.getObjectOfInstance(MM.Constraint);d=0;for(e=c.length;d<e;d++)b={type:"Constraint"},b.name=c[d].name,void 0!==c[d].objectToSolve&&(b.objectToSolve=c[d].objectToSolve.name),a[c[d].uuid]=b;b=this.scene.getObjectOfInstance(MM.FourBoneIkBlendSolver);d=0;for(e=b.length;d<e;d++)a[b[d].uuid]=
b[d].exportSetup();c=this.scene.getObjectOfInstance(MM.TwoBoneIkBlendSolver);d=0;for(e=c.length;d<e&&-1===b.indexOf(c[d]);d++)a[c[d].uuid]=c[d].exportSetup();f=this.scene.getObjectOfInstance(MM.TwoBoneSoftIkSolver);d=0;for(e=f.length;d<e&&-1===b.indexOf(f[d])&&-1===c.indexOf(f[d]);d++)a[f[d].uuid]=f[d].exportSetup();g=this.scene.getObjectOfInstance(MM.TwoBoneIkSolver);d=0;for(e=g.length;d<e&&-1===b.indexOf(g[d])&&-1===c.indexOf(g[d])&&-1===f.indexOf(g[d]);d++)a[g[d].uuid]=g[d].exportSetup();c=this.scene.getObjectOfInstance(MM.OneSimpleBoneIkSolver);
d=0;for(e=c.length;d<e;d++)b={type:"OneSimpleBoneIkSolver"},b.name=c[d].name,b.startJoint=c[d].startJoint.name,b.endJoint=c[d].endJoint.name,b.startPreferedAngle=c[d].startPreferedAngle.toArray(),a[c[d].uuid]=b;b=this.scene.getObjectOfInstance(MM.SplineCluster,"as SplineCluster");d=0;for(e=b.length;d<e;d++)"T"===b[d].mode&&(c=b[d].splineSolver,a[c.uuid]=c.exportData(),console.log(a[c.uuid]));d=0;for(e=this.step2Nodes.length;d<e;d++)this.step2Nodes[d]instanceof MM.MultiChannel&&(a[this.step2Nodes[d].uuid]=
this.step2Nodes[d].exportData());return a};MM.Editor.prototype.importAnimation=function(a){var b,c=this;window.XMLHttpRequest?b=new XMLHttpRequest:window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLHTTP"));b.onreadystatechange=function(){4==b.readyState&&c.importAnimationData(JSON.parse(b.responseText))};b.open("GET",a);b.send()};
MM.Editor.prototype.importAnimationData=function(a){if("animation"!==a.metadata.type)console.log("\twrong data type, looking for animation.");else if(a.hasOwnProperty("animCurves")){for(var b,c=1E3,d=0,e=0;e<a.animCurves.length;e++)if(b=this.scene.getObjectByName(a.animCurves[e].driven,!0),void 0===b)console.log("Unable to find",a.animCurves[e].driven);else{console.log("\t",e,a.animCurves[e].driven);console.log("\t",e,a.animCurves[e].attr);var f=new MM.AnimCurve(b,a.animCurves[e].attr);b.addAnimCurve(f);
this.addAnimCurve(f);f.importData(a.animCurves[e]);b=a.animCurves[e].t[0];f=a.animCurves[e].t[a.animCurves[e].t.length-1];b<c&&(c=b);f>d&&(d=f)}c>d&&(c=0,d=24);this.startRange=this.startTime=c;this.endRange=this.endTime=d;this.signals.timeRangeChanged.dispatch()}else console.log("# No animation data found")};
MM.Editor.prototype.exportAnimationData=function(){console.log("this.exportAnimationData");for(var a={metadata:{version:.1,type:"animation"}},b=0;b<this.animCurves.length;b++){void 0===a.animCurves&&(a.animCurves=[]);var c=this.animCurves[b].exportData();a.animCurves.push(c)}return a};MM.Editor.prototype.exportPoseData=function(){for(var a=this.scene.getObjectOfInstance(MM.Control),b=a.length,c={},d=0;d<b;d++)"control"===a[d].tag&&(c[a[d].name]=a[d].getChannelValues());return c};
MM.Editor.prototype.importPoseData=function(a){var b,c;for(c in a)b=this.scene.getObjectByName(c,!0),void 0!==b&&b.setChannelValues(a[c])};MM.Editor.prototype.exportPose=function(){console.log("exportPose is depricated. Use exportPoseData instead.");return this.exportPoseData()};MM.Editor.prototype.importPose=function(a){console.log("importPose is depricated. Use importPoseData instead.");this.importPoseData(a)};MM.Menubar=function(a,b,c,d){console.log("Menubar",d);var e=new MMUI.NavigationBar;e.dom.className="navbar navbar-default nav-lower navbar-anim";var f=new MMUI.Navigation;e.add(f);var g=!0;d.hasOwnProperty("server_actions")&&(g=d.server_actions);f.add(new MM.Menubar.Files(b,g));f.add(new MM.Menubar.Edits(b));f.add(new MM.Menubar.Views(a,b));f.add(new MM.Menubar.Inserts(b));f.add(new MM.Menubar.Animates(b));a=!0;d.hasOwnProperty("demo_actions")&&(a=d.demo_actions);a&&f.add(new MM.Menubar.Demos(b));
c&&c.appendChild(e.dom);this.dom=e.dom;return this};MM.Menubar.Animates=function(a){var b=new MMUI.MenuGrp("Animate"),c=new MMUI.SubMenuGrp("Set Key");b.add(c);var d=new MMUI.MenuItem("All");d.onClick(function(){a.keySelectedObjects()}).addShortcut("s");c.add(d);d=new MMUI.MenuItem("Translation");d.onClick(function(){a.keySelectedObjects(["rotation","scale"])}).addShortcut("Shift+w");c.add(d);d=new MMUI.MenuItem("Rotation");d.onClick(function(){a.keySelectedObjects(["position","scale"])}).addShortcut("Shift+e");c.add(d);d=new MMUI.MenuItem("Scale");
d.onClick(function(){a.keySelectedObjects(["position","rotation"])}).addShortcut("Shift+r");c.add(d);d=new MMUI.MenuItem("Other");c.add(d);c=(new MMUI.MenuItem("Add Key")).onClick(function(){a.addKey()});b.add(c);c=(new MMUI.MenuItem("Remove Key")).onClick(function(){a.removeKey()});b.add(c);c=new MMUI.MenuItem("Remove All Keys");c.onClick(function(){a.removeAllAnimCurves()});b.add(c);c=new MMUI.MenuDivider;b.add(c);c=(new MMUI.MenuItem("Copy Keys")).onClick(function(){a.copyKeys()});b.add(c);c=(new MMUI.MenuItem("Paste Keys")).onClick(function(){a.pasteKeys()});
b.add(c);c=new MMUI.MenuDivider;b.add(c);c=(new MMUI.MenuItem("Frame Selected Keys")).onClick(function(){a.signals.keyFramed.dispatch()}).addShortcut("f");b.add(c);c=new MMUI.MenuDivider;b.add(c);c=new MMUI.MenuItem("Set Tangents Stepped");c.onClick(function(){a.steppedTangents()});b.add(c);c=new MMUI.MenuItem("Set Tangents Linear");c.onClick(function(){a.linearTangents()});b.add(c);c=new MMUI.MenuItem("Set Tangents Bezier");c.onClick(function(){a.bezierTangents()});b.add(c);c=new MMUI.MenuDivider;
b.add(c);c=new MMUI.MenuItem("Break Tangents");c.onClick(function(){a.breakTangents()});b.add(c);c=new MMUI.MenuItem("Unify Tangents");c.onClick(function(){a.unifyTangents()});b.add(c);c=new MMUI.MenuDivider;b.add(c);c=new MMUI.MenuItem("Free Tangent Weight");c.onClick(function(){a.unlockTangents()});b.add(c);c=new MMUI.MenuItem("Lock Tangent Weight");c.onClick(function(){a.lockTangents()});b.add(c);c=new MMUI.MenuDivider;b.add(c);c=new MMUI.MenuItem("Flatten Tangent Weight");c.onClick(function(){a.flattenTangents()});
b.add(c);c=new MMUI.MenuDivider;b.add(c);c=new MMUI.MenuItem("Toggle Auto Key");c.onClick(function(){a.toggleAutoKey()});b.add(c);c=new MMUI.MenuDivider;b.add(c);c=new MMUI.SubMenuGrp("Set Default Tangent");b.add(c);d=new MMUI.MenuItem("Stepped");d.onClick(function(){a.defaultTangentType=0});c.add(d);d=new MMUI.MenuItem("Linear");d.onClick(function(){a.defaultTangentType=1});c.add(d);d=new MMUI.MenuItem("Bezier");d.onClick(function(){a.defaultTangentType=2});c.add(d);c=new MMUI.MenuDivider;b.add(c);
c=new MMUI.SubMenuGrp("Playback Speed");b.add(c);d=new MMUI.MenuItem("Every Frame");d.onClick(function(){a.playbackMode="free"});c.add(d);d=new MMUI.MenuItem("12fps");d.onClick(function(){a.playbackMode="fixed";a.playbackSpeed=12});c.add(d);d=new MMUI.MenuItem("24fps");d.onClick(function(){a.playbackMode="fixed";a.playbackSpeed=24});c.add(d);d=new MMUI.MenuItem("25fps");d.onClick(function(){a.playbackMode="fixed";a.playbackSpeed=25});c.add(d);d=new MMUI.MenuItem("30fps");d.onClick(function(){a.playbackMode=
"fixed";a.playbackSpeed=30});c.add(d);return b};MM.Menubar.Demos=function(a){var b=new MMUI.MenuGrp("Demos"),c=new MMUI.SubMenuGrp("Controls");b.add(c);var d=(new MMUI.MenuItem("Simple Control")).onClick(function(){MM.SimpleControl(a)});c.add(d);d=(new MMUI.MenuItem("Camera Facing Control")).onClick(function(){MM.FacingControl(a)});c.add(d);c=new MMUI.SubMenuGrp("Deform");b.add(c);d=(new MMUI.MenuItem("FFD")).onClick(function(){MM.FFDDemo(a)});c.add(d);c=new MMUI.SubMenuGrp("Multi Channel");b.add(c);d=(new MMUI.MenuItem("Tx drives Ty and Ry")).onClick(function(){MM.DemoMultiChannelPass(a)});
c.add(d);d=(new MMUI.MenuItem("Control drives Joints")).onClick(function(){MM.DemoMultiChannelShapesPass(a)});c.add(d);d=(new MMUI.MenuItem("Clamped channels")).onClick(function(){MM.DemoMultiChannelMouthPass(a)});c.add(d);d=(new MMUI.MenuItem("Custom channels")).onClick(function(){MM.DemoAnimatableChannels(a)});c.add(d);c=new MMUI.SubMenuGrp("Data Input");b.add(c);d=(new MMUI.MenuItem("Skeleton IO")).onClick(function(){MM.SkeletonIO(a)});c.add(d);d=(new MMUI.MenuItem("Model IO")).onClick(function(){MM.ModelIO(a)});
c.add(d);d=(new MMUI.MenuItem("Skinned Model IO")).onClick(function(){MM.SkinnedModelIO(a)});c.add(d);c=new MMUI.SubMenuGrp("Constraint");b.add(c);d=(new MMUI.MenuItem("Parent")).onClick(function(){MM.ParentConstraint(a)});c.add(d);d=(new MMUI.MenuItem("Parent and Scale")).onClick(function(){MM.ParentAndScaleConstraint(a)});c.add(d);d=(new MMUI.MenuItem("Parent Hierarchy")).onClick(function(){MM.ParentHierarchyConstraint(a)});c.add(d);d=(new MMUI.MenuItem("Aim with offset")).onClick(function(){MM.AimAndOffsetConstraint(a)});
c.add(d);d=(new MMUI.MenuItem("Spaceswitch One")).onClick(function(){MM.SpaceswitchDemo1(a)});c.add(d);d=(new MMUI.MenuItem("Spaceswitch Multi")).onClick(function(){MM.SpaceswitchDemo2(a)});c.add(d);d=(new MMUI.MenuItem("ParentMaster 1")).onClick(function(){MM.ParentMasterDemo1(a)});c.add(d);d=(new MMUI.MenuItem("ParentMaster 2")).onClick(function(){MM.ParentMasterDemo2(a)});c.add(d);c=new MMUI.SubMenuGrp("Inverse Kinematics");b.add(c);d=(new MMUI.MenuItem("Simple Leg Ik")).onClick(function(){MM.simpleIkLeg(a)});
c.add(d);d=(new MMUI.MenuItem("Custom Leg Ik")).onClick(function(){MM.simpleIkLeg(a,!0,void 0)});c.add(d);d=(new MMUI.MenuItem("Zero Leg Ik")).onClick(function(){MM.simpleIkLeg(a,!0,!0)});c.add(d);d=new MMUI.MenuDivider;c.add(d);d=(new MMUI.MenuItem("Blend Limb Ik")).onClick(function(){MM.simpleLimbIk(a)});c.add(d);d=new MMUI.MenuDivider;c.add(d);d=(new MMUI.MenuItem("Blend Leg Ik")).onClick(function(){MM.simpleBlendLeg(a)});c.add(d);d=new MMUI.MenuDivider;c.add(d);d=(new MMUI.MenuItem("Spline Ik")).onClick(function(){MM.splineIk(a)});
c.add(d);d=(new MMUI.MenuItem("Spline Ik plus")).onClick(function(){MM.splineIkPlus(a)});c.add(d);d=(new MMUI.MenuItem("Arm Ik")).onClick(function(){MM.armIk(a)});c.add(d);d=(new MMUI.MenuItem("Stacked IK Splines")).onClick(function(){MM.stackedSplines(a)});c.add(d);return b};MM.Menubar.Edits=function(a){var b=a.signals,c=new MMUI.MenuGrp("Edit"),d=(new MMUI.MenuItem("Undo")).onClick(function(){a.undo()}).addShortcut("Shift+z");c.add(d);d=(new MMUI.MenuItem("Redo")).onClick(function(){a.redo()}).addShortcut("Alt+z");c.add(d);d=(new MMUI.MenuItem("Flush Undo")).onClick(function(){a.flushUndoStack()});c.add(d);d=new MMUI.MenuDivider;c.add(d);d=(new MMUI.MenuItem("Select Tool")).onClick(function(){b.manipModeChange.dispatch("select")}).addShortcut("q");c.add(d);d=(new MMUI.MenuItem("Move Tool")).onClick(function(){b.manipModeChange.dispatch("translate")}).addShortcut("w");
c.add(d);d=(new MMUI.MenuItem("Rotate Tool")).onClick(function(){b.manipModeChange.dispatch("rotate")}).addShortcut("e");c.add(d);d=(new MMUI.MenuItem("Scale Tool")).onClick(function(){b.manipModeChange.dispatch("scale")}).addShortcut("r");c.add(d);d=new MMUI.MenuDivider;c.add(d);d=(new MMUI.MenuItem("Delete")).onClick(function(){a.deleteSelected()}).addShortcut("delete");c.add(d);return c};MM.Menubar.Files=function(a,b){void 0===b&&(b=!0);var c=new MMUI.MenuGrp("File"),d=document.createElement("input");d.type="file";d.addEventListener("change",function(b){a.loadScene(d.files[0])});var e=(new MMUI.MenuItem("New")).onClick(function(){a.newScene()}).addShortcut("Ctrl+n");c.add(e);e=(new MMUI.MenuItem("Import File")).onClick(function(){d.click()});c.add(e);e=new MMUI.MenuDivider;c.add(e);e=(new MMUI.MenuItem("Save Local")).onClick(function(){a.saveSceneLocal()}).addShortcut("Ctrl+s");c.add(e);
b&&(e=(new MMUI.MenuItem("Save Version")).onClick(function(){a.useHotKeys=!1;var b=document.getElementById("movemeanim"),c=new MMUI.Dialog("Save Version As","Scene Description...","Save Version");b.appendChild(c.dom);c.onAction=function(){a.useHotKeys=!0;a.saveScene(c.getValue());c.deleteUI();c=null}}),c.add(e));e=(new MMUI.MenuItem("Export File")).onClick(function(){console.log("MM.Menubar.saveFile");var b=a.saveSceneAs(),b=new Blob([b],{type:"text/plain"});saveAs(b,"MoveMeScene.json")});c.add(e);
e=new MMUI.MenuDivider;c.add(e);e=new MMUI.SubMenuGrp("Animation");c.add(e);var f=(new MMUI.MenuItem("Import All")).onClick(function(){g.click()});e.add(f);var g=document.createElement("input");g.type="file";g.addEventListener("change",function(b){b=g.files[0];var c=new FileReader;c.addEventListener("load",function(b){b=JSON.parse(b.target.result);a.importAnimationData(b)},!1);c.readAsText(b)});f=(new MMUI.MenuItem("Export All")).onClick(function(){var b=a.exportAnimationData(),b=JSON.stringify(b,
null,"\t"),b=b.replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1"),b=new Blob([b],{type:"text/plain"});saveAs(b,"MoveMeAnimation.json")});e.add(f);e=new MMUI.SubMenuGrp("Pose");c.add(e);f=(new MMUI.MenuItem("Import All")).onClick(function(){h.click()});e.add(f);var h=document.createElement("input");h.type="file";h.addEventListener("change",function(b){b=h.files[0];var c=new FileReader;c.addEventListener("load",function(b){b=JSON.parse(b.target.result);"pose"!==b.metadata.type?console.log("\twrong data type, looking for pose."):
(a.importPose(b.pose),a.signals.sceneGraphChanged.dispatch())},!1);c.readAsText(b)});f=(new MMUI.MenuItem("Export All")).onClick(function(){var b={metadata:{version:.1,type:"pose"}};b.pose=a.exportPose();b=JSON.stringify(b,null,"\t");b=b.replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1");b=new Blob([b],{type:"text/plain"});saveAs(b,"MoveMePose.json")});e.add(f);return c};MM.Menubar.Inserts=function(a){var b=new MMUI.MenuGrp("Insert"),c=new MMUI.SubMenuGrp("Camera");b.add(c);var d=new MMUI.MenuItem("Perspective");d.onClick(function(){MM.insertCamera(a)});c.add(d);d=new MMUI.MenuDivider;b.add(d);c=new MMUI.SubMenuGrp("Primitive");b.add(c);d=(new MMUI.MenuItem("Ground")).onClick(function(){MM.insertGround(a)});c.add(d);d=(new MMUI.MenuItem("Plane")).onClick(function(){MM.insertPlane(a)});c.add(d);d=(new MMUI.MenuItem("Ramp")).onClick(function(){MM.insertRamp(a)});c.add(d);
d=(new MMUI.MenuItem("Cube")).onClick(function(){MM.insertCube(a)});c.add(d);d=(new MMUI.MenuItem("Sphere")).onClick(function(){MM.insertSphere(a)});c.add(d);c=new MMUI.SubMenuGrp("Character");b.add(c);d=new MMUI.MenuItem("Ball");d.onClick(function(){console.log("Insert Ball");MM.insertSphere(a)});c.add(d);d=new MMUI.MenuDivider;c.add(d);d=new MMUI.MenuItem("Tail");d.onClick(function(){console.log("Insert Tail");MM.insertTail(a)});c.add(d);d=new MMUI.MenuDivider;c.add(d);d=new MMUI.MenuItem("Legs");
d.onClick(function(){console.log("Insert Legs");MM.insertLegs(a)});c.add(d);d=new MMUI.MenuDivider;c.add(d);d=new MMUI.MenuItem("Mini");c.add(d);d.onClick(function(){console.log("Insert Mini");MM.insertMini(a)});d=new MMUI.MenuItem("Midi");c.add(d);d.onClick(function(){console.log("Insert Midi");MM.insertMidi(a)});d=new MMUI.MenuItem("Maxi");c.add(d);d.onClick(function(){console.log("Insert Maxi");MM.insertMaxi(a)});return b};MM.Menubar.Views=function(a,b){var c=new MMUI.MenuGrp("View"),d=new MMUI.SubMenuGrp("Grid");c.add(d);var e=new MMUI.MenuItem("Show");e.onClick(function(){b.gridVisibility(!0)});d.add(e);e=new MMUI.MenuItem("Hide");e.onClick(function(){b.gridVisibility(!1)});d.add(e);d=new MMUI.SubMenuGrp("Controls");c.add(d);e=new MMUI.MenuItem("Show All");e.onClick(function(){b.controlsVisibility(!0)});d.add(e);e=new MMUI.MenuItem("Hide All");e.onClick(function(){b.controlsVisibility(!1)});d.add(e);d=new MMUI.SubMenuGrp("Joints");
c.add(d);e=new MMUI.MenuItem("Show All");e.onClick(function(){b.jointsVisibility(!0)});d.add(e);e=new MMUI.MenuItem("Hide All");e.onClick(function(){b.jointsVisibility(!1)});d.add(e);e=new MMUI.MenuDivider;d.add(e);e=new MMUI.MenuItem("Show Rotation Axis");e.onClick(function(){b.rotationAxisVisibility(!0)});d.add(e);e=new MMUI.MenuItem("Hide Rotation Axis");e.onClick(function(){b.rotationAxisVisibility(!1)});d.add(e);d=new MMUI.SubMenuGrp("Geometry");c.add(d);e=new MMUI.MenuItem("Show All");e.onClick(function(){b.geometryVisibility(!0)});
d.add(e);e=new MMUI.MenuItem("Hide All");e.onClick(function(){b.geometryVisibility(!1)});d.add(e);e=new MMUI.MenuDivider;c.add(e);d=new MMUI.SubMenuGrp("Panels");c.add(d);e=(new MMUI.MenuItem("Hide All")).onClick(function(){a.signals.sidebarVisibility.dispatch(0);a.signals.infoLineVisibility.dispatch(0);a.signals.timeLineVisibility.dispatch(0);a.signals.rangeSliderVisibility.dispatch(0)});d.add(e);e=(new MMUI.MenuItem("Show All")).onClick(function(){a.signals.sidebarVisibility.dispatch(1);a.signals.infoLineVisibility.dispatch(1);
a.signals.timeLineVisibility.dispatch(1);a.signals.rangeSliderVisibility.dispatch(1)});d.add(e);d=new MMUI.SubMenuGrp("Sidebar");c.add(d);e=(new MMUI.MenuItem("Hide")).onClick(function(){a.signals.sidebarVisibility.dispatch(0)});d.add(e);e=(new MMUI.MenuItem("Show")).onClick(function(){a.signals.sidebarVisibility.dispatch(1)});d.add(e);d=new MMUI.SubMenuGrp("Timeline");c.add(d);e=(new MMUI.MenuItem("Hide")).onClick(function(){a.signals.timeLineVisibility.dispatch(0)});d.add(e);e=(new MMUI.MenuItem("Show")).onClick(function(){a.signals.timeLineVisibility.dispatch(1)});
d.add(e);d=new MMUI.SubMenuGrp("Range Slider");c.add(d);e=(new MMUI.MenuItem("Hide")).onClick(function(){a.signals.rangeSliderVisibility.dispatch(0)});d.add(e);e=(new MMUI.MenuItem("Show")).onClick(function(){a.signals.rangeSliderVisibility.dispatch(1)});d.add(e);d=new MMUI.SubMenuGrp("Infoline");c.add(d);e=(new MMUI.MenuItem("Hide")).onClick(function(){a.signals.infoLineVisibility.dispatch(0)});d.add(e);e=(new MMUI.MenuItem("Show")).onClick(function(){a.signals.infoLineVisibility.dispatch(1)});d.add(e);
d=new MMUI.SubMenuGrp("Settings");c.add(d);e=(new MMUI.MenuItem("Save")).onClick(function(){b.saveSceneSettings()});d.add(e);e=(new MMUI.MenuItem("Load")).onClick(function(){b.loadSceneSettings()});d.add(e);e=(new MMUI.MenuItem("Reset")).onClick(function(){b.loadResetSceneSettings();b.saveSceneSettings()});d.add(e);return c};MM.Toolbar=function(a,b,c){var d=new MMUI.Panel;d.setClass("toolbar");b.appendChild(d.dom);b=!0;c.hasOwnProperty("server_actions")&&(b=c.server_actions);b&&new MM.FileToolBar(a,d);c=new MM.SceneViewToolBar(a,d);new MM.KeyViewToolBar(a,d);c.dom.style.float="left";return d};
MM.FileToolBar=function(a,b){var c=new MMUI.Panel;c.setClass("file-toolbar");b.add(c);var d=(new MMUI.Text).setValue("File").setClass("toolbar-intro");c.add(d);var e=new MMUI.ButtonToolBar;c.add(e);d=new MMUI.ButtonGroup;e.add(d);e=(new MMUI.Button).setImage("/ui/file_save.png").addToolTip("File Save").onClick(function(){a.saveSceneLocal()});d.add(e);return c};MM.KeyViewToolBar=function(a,b){function c(){!1===a.useTimeSnap?(a.useTimeSnap=!0,m.setBackgroundColor("#B3B3B3")):(a.useTimeSnap=!1,m.setBackgroundColor("#EBEBEA"))}function d(){if(0!==a.selectedAnimCurves.length){var b=a.selectedAnimCurves[0].getTimeAndValueFromSelected(!0);0!=b.length&&(h.input.value=b[0][0],k.input.value=b[0][1])}}var e=a.signals,f=new MMUI.Panel;f.setClass("keyview-toolbar");b.add(f);var g=(new MMUI.Text).setValue("Key").setClass("toolbar-intro");f.add(g);var h=(new MMUI.FloatGrp("Time")).addClass("keyview-floatgrp");
h.onChange(function(){if(0!==a.selectedAnimCurves.length){var b,c;b=0;for(c=a.selectedAnimCurves.length;b<c;b++)a.selectedAnimCurves[b].setTimeAndValueForFirstSelected(parseFloat(h.input.value),parseFloat(k.input.value));e.keyframeEditorKeysUpdated.dispatch()}}).onStart(function(){a.getUndoTransformDataFromSelectedKeys()});f.add(h);var k=(new MMUI.FloatGrp("Value")).addClass("keyview-floatgrp");k.dom.style.float="left";k.onChange(function(){if(0!==a.selectedAnimCurves.length){var b,c;b=0;for(c=a.selectedAnimCurves.length;b<
c;b++)a.selectedAnimCurves[b].setValueForSelected(parseFloat(k.input.value));e.keyframeEditorKeysUpdated.dispatch()}}).onStart(function(){a.getUndoTransformDataFromSelectedKeys()});f.add(k);g=new MMUI.ButtonToolBar;f.add(g);var l=new MMUI.ButtonGroup;g.add(l);var m=(new MMUI.Button).setImage("/ui/keySnapTime.gif").addToolTip("Snap Key to Time");m.onClick(c);l.add(m);var n=(new MMUI.Button).setImage("/ui/keySnapValue.gif").addToolTip("Snap Key to Value");n.onClick(function(){!1===a.useValueSnap?(a.useValueSnap=
!0,n.setBackgroundColor("#B3B3B3")):(a.useValueSnap=!1,n.setBackgroundColor("#EBEBEA"))});l.add(n);l=new MMUI.ButtonGroup;g.add(l);var r=(new MMUI.Button).setImage("/ui/keyAdd.gif").addToolTip("Add Key");r.onClick(function(){a.addKey()});l.add(r);var q=(new MMUI.Button("")).setImage("/ui/keyRemove.gif").addToolTip("Remove Key");q.onClick(function(){a.removeKey()});l.add(q);l=new MMUI.ButtonGroup;g.add(l);var p=(new MMUI.Button).setImage("/ui/frameCurve.gif");p.onClick(function(){e.keyFramed.dispatch()}).addToolTip("Frame Selected Curves");
l.add(p);l=new MMUI.ButtonGroup;g.add(l);var t=(new MMUI.Button).setImage("/ui/stepTan.gif").addToolTip("Set Key as Stepped");t.onClick(function(){a.steppedTangents()});l.add(t);var u=(new MMUI.Button).setImage("/ui/linTan.gif");u.onClick(function(){a.linearTangents()}).addToolTip("Set Key as Linear");l.add(u);var B=(new MMUI.Button).setImage("/ui/bezierTan.gif");B.onClick(function(){a.bezierTangents()}).addToolTip("Set Key as Smooth");l.add(B);l=new MMUI.ButtonGroup;g.add(l);var x=(new MMUI.Button).setImage("/ui/breakTan.gif");
x.onClick(function(){a.breakTangents()}).addToolTip("Break Tangents");l.add(x);var y=(new MMUI.Button).setImage("/ui/unifyTan.gif");y.onClick(function(){a.unifyTangents()}).addToolTip("Unify Tangents");l.add(y);var v=(new MMUI.Button).setImage("/ui/freeTan.gif").addToolTip("Free Tangents");v.onClick(function(){a.unlockTangents()});l.add(v);var w=(new MMUI.Button).setImage("/ui/lockTan.gif");w.onClick(function(){a.lockTangents()}).addToolTip("Lock Tangents");l.add(w);var C=(new MMUI.Button).setImage("/ui/flatTan.gif");
C.onClick(function(){a.flattenTangents()}).addToolTip("Flat Tangents");l.add(C);l=new MMUI.ButtonGroup;g.add(l);var D=(new MMUI.Button).setImage("/ui/copyKey.gif").addToolTip("Copy Keys");D.onClick(function(){a.copyKey()});l.add(D);var z=(new MMUI.Button).setImage("/ui/pasteKey.gif");z.onClick(function(){a.pasteKey()}).addToolTip("Past Keys");l.add(z);f.setWidth=function(a){255>a?m.setDisplay("none"):m.setDisplay("block");280>a?n.setDisplay("none"):n.setDisplay("block");300>a?(void 0).setDisplay("none"):
(void 0).setDisplay("block");340>a?r.setDisplay("none"):r.setDisplay("block");380>a?q.setDisplay("none"):q.setDisplay("block");385>a?(void 0).setDisplay("none"):(void 0).setDisplay("block");425>a?p.setDisplay("none"):p.setDisplay("block");430>a?(void 0).setDisplay("none"):(void 0).setDisplay("block");470>a?t.setDisplay("none"):t.setDisplay("block");510>a?u.setDisplay("none"):u.setDisplay("block");555>a?B.setDisplay("none"):B.setDisplay("block");560>a?(void 0).setDisplay("none"):(void 0).setDisplay("block");
600>a?x.setDisplay("none"):x.setDisplay("block");640>a?y.setDisplay("none"):y.setDisplay("block");680>a?v.setDisplay("none"):v.setDisplay("block");720>a?w.setDisplay("none"):w.setDisplay("block");760>a?C.setDisplay("none"):C.setDisplay("block");765>a?(void 0).setDisplay("none"):(void 0).setDisplay("block");805>a?D.setDisplay("none"):D.setDisplay("block");840>a?z.setDisplay("none"):z.setDisplay("block");850>a?(void 0).setDisplay("none"):(void 0).setDisplay("block")};c();e.keyframeEditorKeysUpdated.add(function(){d()});
e.keyframeEditorChanged.add(function(){d()});return f};MM.SceneViewToolBar=function(a,b){var c=a.signals,d=new MMUI.Panel;d.setClass("viewport-toolbar");b.add(d);var e=(new MMUI.Text).setValue("Scene").setClass("toolbar-intro");d.add(e);e=new MMUI.ButtonToolBar;d.add(e);var f=new MMUI.ButtonGroup;e.add(f);var g=(new MMUI.Button).setImage("/ui/manipSelect.gif");g.onClick(function(){console.log("ViewportOptions: select");d.setUIToolMode("select");c.manipModeChange.dispatch("select")}).addToolTip("Select Tool");f.add(g);"select"===a.activeTool&&g.setBackgroundColor("#B3B3B3");
var h=(new MMUI.Button).setImage("/ui/manipTranslate.gif");h.onClick(function(){console.log("ViewportOptions: move");d.setUIToolMode("translate");c.manipModeChange.dispatch("translate")}).addToolTip("Move Tool");f.add(h);"translate"===a.activeTool&&h.setBackgroundColor("#B3B3B3");var k=(new MMUI.Button).setImage("/ui/manipRotate.gif");k.onClick(function(){console.log("ViewportOptions: rotate");d.setUIToolMode("rotate");c.manipModeChange.dispatch("rotate")}).addToolTip("Rotate Tool");f.add(k);var l=
(new MMUI.Button).setImage("/ui/manipScale.gif");l.onClick(function(){console.log("ViewportOptions: scale");d.setUIToolMode("scale");c.manipModeChange.dispatch("scale")}).addToolTip("Scale Tool");f.add(l);f=new MMUI.ButtonGroup;e.add(f);var m=(new MMUI.Button).setImage("/ui/manipLocal.gif");m.onClick(function(){console.log("ViewportOptions: localSpace");d.setUIToolSpace("local");c.manipSpaceChange.dispatch("local")}).addToolTip("Local Mode");f.add(m);"local"===a.activeSpace&&m.setBackgroundColor("#B3B3B3");
var n=(new MMUI.Button).setImage("/ui/manipWorld.gif");n.onClick(function(){console.log("ViewportOptions: worldSpace");d.setUIToolSpace("world");c.manipSpaceChange.dispatch("world")}).addToolTip("World Mode");f.add(n);"world"===a.activeSpace&&n.setBackgroundColor("#B3B3B3");d.setUIToolSpace=function(a){switch(a){case "local":m.setBackgroundColor("#B3B3B3");n.setBackgroundColor("#EBEBEA");break;case "world":n.setBackgroundColor("#B3B3B3"),m.setBackgroundColor("#EBEBEA")}};d.setUIToolMode=function(a){switch(a){case "select":g.setBackgroundColor("#B3B3B3");
h.setBackgroundColor("#EBEBEA");k.setBackgroundColor("#EBEBEA");l.setBackgroundColor("#EBEBEA");break;case "translate":g.setBackgroundColor("#EBEBEA");h.setBackgroundColor("#B3B3B3");k.setBackgroundColor("#EBEBEA");l.setBackgroundColor("#EBEBEA");break;case "rotate":g.setBackgroundColor("#EBEBEA");h.setBackgroundColor("#EBEBEA");k.setBackgroundColor("#B3B3B3");l.setBackgroundColor("#EBEBEA");break;case "scale":g.setBackgroundColor("#EBEBEA"),h.setBackgroundColor("#EBEBEA"),k.setBackgroundColor("#EBEBEA"),
l.setBackgroundColor("#B3B3B3")}};a.signals.manipModeChange.add(function(a){console.log("SceneViewToolBar.manipModeChange",a);d.setUIToolMode(a)});return d};MM.AnimCurve=function(a,b){void 0===a&&console.error("AnimCurve: Object is not defined");void 0===b&&console.error("AnimCurve: Channel is not defined.");this.id=0;this.attr=b;this.driven=a;this.nattr=a.getNiceName(b[0],b[1]);this.name=this.driven.name+"_"+b[0]+"_"+b[1];this.TANGENT={STEPPED:0,LINEAR:1,BEZIER:2};this.t=[];this.v=[];this.s=[];this.it=[];this.ot=[];this.itv=[];this.otv=[];this.bt=[];this.wt=[];this.twv=5;this.lc=new THREE.Color;this.tdp=this.dp=void 0;this.tsi=[];this.tso=[]};
MM.AnimCurve.prototype={constructor:MM.AnimCurve,getChannelValue:function(){return this.driven[this.attr[0]][this.attr[1]]},importData:function(a){var b,c;b=0;for(c=a.t.length;b<c;b++)this.t.push(Number(a.t[b]));b=0;for(c=a.v.length;b<c;b++)this.v.push(Number(a.v[b]));b=0;for(c=a.s.length;b<c;b++)this.s.push(!1);this.it=a.it;this.ot=a.ot;this.lc.r=a.lc.r;this.lc.g=a.lc.g;this.lc.b=a.lc.b;b=0;for(c=a.itv.length;b<c;b++)this.itv.push(new THREE.Vector2(a.itv[b].x,a.itv[b].y));b=0;for(c=a.otv.length;b<
c;b++)this.otv.push(new THREE.Vector2(a.otv[b].x,a.otv[b].y));this.bt=a.bt;this.wt=a.wt},exportData:function(){var a={};a.name=this.name;a.driven=this.driven.name;a.attr=this.attr;a.t=this.t;a.v=this.v;a.s=this.s;a.it=this.it;a.ot=this.ot;a.lc=this.lc;a.itv=this.itv;a.otv=this.otv;a.bt=this.bt;a.wt=this.wt;return a},hasDisplay:function(){return this.dp instanceof MM.AnimCurveDisplay?!0:!1},addDisplay:function(){!1===this.hasDisplay()&&(this.dp=new MM.AnimCurveDisplay(this));return this},updateDisplay:function(){this.dp instanceof
MM.AnimCurveDisplay&&this.dp.update()},removeDisplay:function(a){void 0===a&&console.log("animCurve.removeDisplay. No animation curve scene has been defined.");!0===this.hasDisplay()&&(a.remove(this.dp.line),a.remove(this.dp.dvrt),a.remove(this.dp.svrt),this.dp=null);return this},hasTangentDisplay:function(){return this.tdp instanceof MM.KeyTangentDisplay?!0:!1},addTangentDisplay:function(a){if(!(2>this.t.length))return this.tdp=new MM.KeyTangentDisplay(this),this.tdp.keys=a,this},updateTangentDisplay:function(){this.tdp instanceof
MM.KeyTangentDisplay&&this.tdp.update()},removeTangentDisplay:function(){this.tdp=null;return this},setTangentType:function(a){this.setInTangentType(a);this.setOutTangentType(a)},setInTangentType:function(a){for(var b=this.getSelectedIndices(),c=0;c<b.length;c++)this.it[b[c]]=a},setOutTangentType:function(a){for(var b=this.getSelectedIndices(),c=0;c<b.length;c++)this.ot[b[c]]=a},breakTangent:function(){for(var a=this.getSelectedIndices(),b=0;b<a.length;b++)this.bt[a[b]]=!0},unifyTangent:function(){for(var a=
this.getSelectedIndices(),b=0;b<a.length;b++)this.bt[a[b]]=!1},lockTangent:function(){for(var a=this.getSelectedIndices(),b=0;b<a.length;b++)this.wt[a[b]]=!1},unlockTangent:function(){for(var a=this.getSelectedIndices(),b=0;b<a.length;b++)this.wt[a[b]]=!0},clearTangentSelection:function(){this.tsi=[];this.tso=[]},hasTangentSelection:function(){return 0!==this.tsi.length||0!==this.tso.length?!0:!1},getTangentSelection:function(a,b){return-1===("in"===a?this.tsi:this.tso).indexOf(b)?!1:!0},setTangentSelection:function(a,
b,c){var d;d="in"===a?this.tsi:this.tso;var e=d.length;if(!0===c)if(0===e)d.push(b);else for(c=0;c<e;c++)d[c]>b&&d.splice(c,0,b);else{var f;for(c=0;c<e;c++)if(d[c]===b){f=c;break}d.splice(f,1)}"in"===a?this.tsi=d:this.tso=d},getSelectedTangentIndices:function(){var a=[],b;for(b=0;b<this.tsi.length;b++)a.push(this.tsi[b]);for(b=0;b<this.tso.length;b++)-1===a.indexOf(this.tso[b])&&a.push(this.tso[b]);return a},resetTangent:function(){for(var a=this.getNumberOfKeys(),b=0;b<a;b++)this.itv[b].x=-1*this.twv,
this.itv[b].y=0,this.otv[b].x=this.twv,this.otv[b].y=0},flattenTangent:function(){var a=this.getSelectedIndices();0===a.length&&(a=this.getSelectedTangentIndices());for(var b=0;b<a.length;b++)this.itv[a[b]].x=-1*this.twv,this.itv[a[b]].y=0,this.otv[a[b]].x=this.twv,this.otv[a[b]].y=0},getIndexAtTime:function(a){for(var b=-1,c=0;c<this.t.length;c++)if(this.t[c]===a){b=c;break}return b},removeKeyAtTime:function(a){a=this.getIndexAtTime(a);-1!==a&&this.removeIndex(a)},removeIndex:function(a){this.t.splice(a,
1);this.v.splice(a,1);this.s.splice(a,1);this.it.splice(a,1);this.ot.splice(a,1);this.itv.splice(a,1);this.otv.splice(a,1);this.bt.splice(a,1);this.wt.splice(a,1)},addFromList:function(a){this.add(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7])},add:function(a,b,c,d,e,f,g,h){console.log("AnimCurve.add",a,b,c,d,e,f,g,h);b.constructor==THREE.Number&&(b=b.value);a=parseFloat(a);b=parseFloat(b);for(var k=0;k<this.t.length;k++)if(this.t[k]===a){this.v[k]=b;void 0!==c&&(this.it[k]=c);void 0!==d&&(this.ot[k]=d);
void 0!==e&&(this.itv[k]=e);void 0!==f&&(this.otv[k]=f);void 0!==g&&(this.bt[k]=g);void 0!==h&&(this.wt[k]=h);return}void 0===c&&(c=this.TANGENT.STEPPED);void 0===d&&(d=this.TANGENT.STEPPED);void 0===e&&(e=new THREE.Vector2(-2,0));void 0===f&&(f=new THREE.Vector2(2,0));void 0===g&&(g=!1);void 0===h&&(h=!0);var l=0;1===this.t.length&&this.t[0]<a&&(l=1);for(k=0;k<this.t.length-1;k++)this.t[k]<a&&a<this.t[k+1]&&(l=k+1);1<this.t.length&&this.t[this.t.length-1]<a&&(l=this.t.length+1);this.t.splice(l,0,
a);this.v.splice(l,0,b);this.s.splice(l,0,!1);this.it.splice(l,0,c);this.ot.splice(l,0,d);this.itv.splice(l,0,e);this.otv.splice(l,0,f);this.bt.splice(l,0,g);this.wt.splice(l,0,h);return this},getSelectionData:function(){var a=[];a.push(this.s.slice());a.push(this.tsi.slice());a.push(this.tso.slice());return a},setSelectionData:function(a){this.s=a[0];this.tsi=a[1];this.tso=a[2]},getSelectionDataFromIndex:function(a){var b=[];b.push(this.s[a]);b.push(this.getTangentSelection("in",a));b.push(this.getTangentSelection("out",
a));return b},setSelectionDataFromIndex:function(a,b){this.s[a]=b[0];this.setTangentSelection("in",a,b[1]);this.setTangentSelection("out",a,b[2])},getTransformDataFromIndex:function(a){var b=[];b.push(this.t[a]);b.push(this.v[a]);b.push(this.it[a]);b.push(this.ot[a]);b.push(this.itv[a].x);b.push(this.itv[a].y);b.push(this.otv[a].x);b.push(this.otv[a].y);b.push(this.bt[a]);b.push(this.wt[a]);return b},setTransformDataToIndex:function(a,b){this.t[a]=b[0];this.v[a]=b[1];this.it[a]=b[2];this.ot[a]=b[3];
this.itv[a].x=b[4];this.itv[a].y=b[5];this.otv[a].x=b[6];this.otv[a].y=b[7];this.bt[a]=b[8];this.wt[a]=b[9]},getNumberOfKeys:function(){return this.t.length},getSelectedIndices:function(a){void 0===a&&(a=!1);for(var b=[],c=0;c<this.t.length&&(!0!==this.s[c]||(b.push(c),!0!==a));c++);return b},getSelectedKeysAndTangents:function(){var a=this.getSelectedIndices(),b=this.getSelectedTangentIndices();return a.concat(b)},getTimeRange:function(){console.log("getTimeRange");return[this.t[0],this.t[this.t.length-
1]]},getValueRange:function(){console.log("getValueRange");for(var a=1E3,b=-1E3,c=0;c<this.v.length;c++)this.v[c]<a&&(a=this.v[c]),b<this.v[c]&&(b=this.v[c]);return[a,b]},getSelectedTimeRange:function(){console.log("getSelectedTimeRange");var a=this.getSelectedIndices();return[this.t[a[0]],this.t[a[a.length-1]]]},getSelectedValueRange:function(){console.log("getSelectedValueRange");for(var a=this.getSelectedIndices(),b=a.length,c=1E3,d=-1E3,e=0;e<b;e++)this.v[e]<c&&(c=this.v[a[e]]),d<this.v[a[e]]&&
(d=this.v[a[e]]);return[c,d]},setValueForSelected:function(a){var b=this.getSelectedIndices(),c,d;c=0;for(d=b.length;c<d;c++)this.v[b[c]]=a},getAll:function(a){for(var b=[],c=0;c<this.t.length;c++)b.push([this.t[c]-a,this.v[c],this.it[c],this.ot[c],this.itv[c],this.otv[c],this.bt[c],this.wt[c]]);return b},getAllFromSelected:function(a){for(var b=[],c=0;c<this.t.length;c++)!0===this.s[c]&&b.push([this.t[c]-a,this.v[c],this.it[c],this.ot[c],this.itv[c],this.otv[c],this.bt[c],this.wt[c]]);return b},
getTimeAndValueFromSelected:function(a){for(var b=[],c=0;c<this.t.length&&(!0!==this.s[c]||(b.push([this.t[c],this.v[c]]),!a));c++);return b},setTimeAndValueForFirstSelected:function(a,b){var c=this.getSelectedIndices(!0);this.t[c]=a;this.v[c]=b},set:function(a,b,c){this.t[a]=b;this.v[a]=c;return this},hasKeyOrTangentSelection:function(){return!0===this.hasSelection()||!0===this.hasTangentSelection()?!0:!1},hasIndexKeyOfTangentSelected:function(a){return!0===this.s[a]||-1!==this.tsi.indexOf(a)||-1!==
this.tso.indexOf(a)?!0:!1},hasSelection:function(){var a=this.s.length,b;for(b=0;b<a;b++)if(this.s[b])return!0;return!1},setSelection:function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.s[b]=!0;else this.s[a]=!0;return this},isSelected:function(a){return this.s[a]},clearSelection:function(){for(var a=0;a<this.t.length;a++)this.s[a]=!1;return this},setColor:function(a){this.lc=new THREE.Color(a)},getValue:function(a){var b=this.getNumberOfKeys();if(a<=this.t[0])return this.v[0];if(a>=
this.t[b-1])return this.v[b-1];for(var c=0,d=!1;!1===d&&c<b-1;)this.t[c]<=a&&this.t[c+1]>a?d=!0:c+=1;var e;this.ot[c]===this.TANGENT.STEPPED?e=this.v[c]:this.ot[c]===this.TANGENT.LINEAR?(b=this.t[c+1]-this.t[c],a-=this.t[c],a/=b,e=parseFloat(this.v[c])+parseFloat((this.v[c+1]-this.v[c])*a)):this.ot[c]===this.TANGENT.BEZIER?(b=this.t[c+1]-this.t[c],a-=this.t[c],e=THREE.Shape.Utils.b3(a/b,this.v[c],this.v[c]+this.otv[c].y,this.v[c+1]+this.itv[c+1].y,this.v[c+1])):console.log("\tUnsupported interpolation mode");
return e}};MM.AnimCurveDisplay=function(a){this.animCurve=a;this.keyDisplaySize=6;this.TANGENT={STEPPED:0,LINEAR:1,BEZIER:2};this.svrt=this.dvrt=this.line=void 0;var b=new THREE.Geometry,c=new THREE.LineBasicMaterial({color:a.lc,linewidth:1});this.line=new THREE.Line(b,c);this.line.name=a.name+"_curveLine";b=new THREE.Geometry;c=new THREE.ParticleBasicMaterial({size:this.keyDisplaySize,color:0,sizeAttenuation:!1});this.dvrt=new THREE.ParticleSystem(b,c);this.dvrt.name=a.name+"_curveKeyDefault";b=new THREE.Geometry;
c=new THREE.ParticleBasicMaterial({size:this.keyDisplaySize,color:65280,sizeAttenuation:!1});this.svrt=new THREE.ParticleSystem(b,c);this.svrt.name=a.name+"_curveKeySelected";this.update();return this};
MM.AnimCurveDisplay.prototype={constructor:MM.AnimCurveDisplay,updateKeys:function(){this.dvrt.geometry.verticesNeedUpdate=!0;this.svrt.geometry.verticesNeedUpdate=!0;this.dvrt.geometry.vertices=[];this.svrt.geometry.vertices=[];for(var a=0;a<this.animCurve.t.length;a++)!0===this.animCurve.s[a]?(this.dvrt.geometry.vertices.push(new THREE.Vector3(this.animCurve.t[a],this.animCurve.v[a],-1)),this.svrt.geometry.vertices.push(new THREE.Vector3(this.animCurve.t[a],this.animCurve.v[a],1))):(this.dvrt.geometry.vertices.push(new THREE.Vector3(this.animCurve.t[a],
this.animCurve.v[a],1)),this.svrt.geometry.vertices.push(new THREE.Vector3(this.animCurve.t[a],this.animCurve.v[a],-1)))},updateCurve:function(){this.line.geometry.verticesNeedUpdate=!0;this.line.geometry.buffersNeedUpdate=!0;this.line.geometry.vertices=[];for(var a=0;a<this.animCurve.t.length;a++)if(this.line.geometry.vertices.push(new THREE.Vector3(this.animCurve.t[a],this.animCurve.v[a],2)),this.animCurve.ot[a]===this.TANGENT.STEPPED)a<this.animCurve.t.length-1&&this.line.geometry.vertices.push(new THREE.Vector3(this.animCurve.t[a+
1],this.animCurve.v[a],2));else if(this.animCurve.ot[a]!==this.TANGENT.LINEAR&&this.animCurve.ot[a]===this.TANGENT.BEZIER&&a<this.animCurve.t.length-1&&this.animCurve.ot[a+1]===this.TANGENT.BEZIER)for(var b=this.animCurve.t[a],c=this.animCurve.t[a]+this.animCurve.otv[a].x,d=this.animCurve.t[a+1]+this.animCurve.itv[a+1].x,e=this.animCurve.t[a+1],f=this.animCurve.v[a],g=this.animCurve.v[a]+this.animCurve.otv[a].y,h=this.animCurve.v[a+1]+this.animCurve.itv[a+1].y,k=this.animCurve.v[a+1],l,m,n=1;10>n;n++)l=
.1*n,m=THREE.Shape.Utils.b3(l,b,c,d,e),l=THREE.Shape.Utils.b3(l,f,g,h,k),this.line.geometry.vertices.push(new THREE.Vector3(m,l,2))},update:function(){this.updateKeys();this.updateCurve()}};MM.KeyTangentDisplay=function(a){this.animCurve=a;this.keyDisplaySize=6;this.svrt=this.dvrt=this.line=void 0;this.keys=[];a=new THREE.Geometry;var b=new THREE.LineBasicMaterial({color:10027161,linewidth:1});this.line=new THREE.Line(a,b,THREE.LinePieces);this.line.name="tangentLine";this.line.animParent=this;a=new THREE.Geometry;b=new THREE.ParticleBasicMaterial({size:this.keyDisplaySize,color:10027161,sizeAttenuation:!1});this.dvrt=new THREE.ParticleSystem(a,b);this.dvrt.name="tangentKeyDefault";
a=new THREE.Geometry;b=new THREE.ParticleBasicMaterial({size:this.keyDisplaySize,color:16777011,sizeAttenuation:!1});this.svrt=new THREE.ParticleSystem(a,b);this.svrt.name="tangentKeySelected";this.update();return this};
MM.KeyTangentDisplay.prototype={constructor:MM.KeyTangentDisplay,updateTangents:function(){this.dvrt.geometry.verticesNeedUpdate=!0;this.svrt.geometry.verticesNeedUpdate=!0;this.line.geometry.verticesNeedUpdate=!0;this.dvrt.geometry.buffersNeedUpdate=!0;this.svrt.geometry.buffersNeedUpdate=!0;this.line.geometry.buffersNeedUpdate=!0;this.dvrt.geometry.vertices=[];this.svrt.geometry.vertices=[];this.line.geometry.vertices=[];for(var a,b,c,d,e,f=0;f<this.keys.length;f++)b=this.keys[f],a=!1,0<b&&2===
this.animCurve.it[b]&&2===this.animCurve.ot[b-1]&&(a=!0),b<this.animCurve.t.length-1&&2===this.animCurve.ot[b]&&2===this.animCurve.it[b+1]&&(a=!0),a&&(a=this.animCurve.t[b]+this.animCurve.itv[b].x,c=this.animCurve.v[b]+this.animCurve.itv[b].y,d=this.animCurve.t[b]+this.animCurve.otv[b].x,e=this.animCurve.v[b]+this.animCurve.otv[b].y,-1!==this.animCurve.tsi.indexOf(b)?(this.dvrt.geometry.vertices.push(new THREE.Vector3(a,c,-10)),this.svrt.geometry.vertices.push(new THREE.Vector3(a,c,10))):(this.dvrt.geometry.vertices.push(new THREE.Vector3(a,
c,10)),this.svrt.geometry.vertices.push(new THREE.Vector3(a,c,-10))),-1!==this.animCurve.tso.indexOf(b)?(this.dvrt.geometry.vertices.push(new THREE.Vector3(d,e,-10)),this.svrt.geometry.vertices.push(new THREE.Vector3(d,e,10))):(this.dvrt.geometry.vertices.push(new THREE.Vector3(d,e,10)),this.svrt.geometry.vertices.push(new THREE.Vector3(d,e,-10))),this.line.geometry.vertices.push(new THREE.Vector3(a,c,2)),this.line.geometry.vertices.push(new THREE.Vector3(this.animCurve.t[b],this.animCurve.v[b],2)),
this.line.geometry.vertices.push(new THREE.Vector3(this.animCurve.t[b],this.animCurve.v[b],2)),this.line.geometry.vertices.push(new THREE.Vector3(d,e,2)))},update:function(){this.updateTangents()}};MM.KeyView=function(a,b,c){function d(){g.renderer.setViewport(g.left,g.top,g.width,g.height);g.renderer.setScissor(g.left,g.top,g.width,g.height);g.renderer.enableScissorTest(!0);g.renderer.setClearColor(a.keyBackgroundColor);g.renderer.clear();p.aspect=g.width/g.height;p.updateProjectionMatrix();g.renderer.render(q,p)}function e(){var a=g.parentPanel.parentPanel.dom;g.width=a.offsetWidth-g.outlinerWidth;g.height=a.offsetHeight;g.left=parseInt(a.style.left)+g.outlinerWidth;g.top=parseInt(a.style.bottom);
p.left=g.width/-2;p.right=g.width/2;p.top=g.height/2;p.bottom=g.height/-2;p.updateProjectionMatrix()}function f(){a.displayAnimCurves();a.displayKeyTangents();a.updateDisplayKeyTangents();var b=new THREE.Vector3(-1,-1,.5);u.unprojectVector(b,p);var c=new THREE.Vector3(1,1,.5);u.unprojectVector(c,p);for(var e=Math.abs(b.y)+Math.abs(c.y),f=[[1E4,1E3,100],[1E3,500,50],[500,100,20],[100,50,10],[50,25,5],[25,1,1]],g,h=0;h<f.length;h++)if(e<f[h][0]&&e>f[h][1]){g=f[h][2];break}e=Math.abs(Math.ceil(b.y/g));
c=Math.floor(c.y/g);if(!(50<1+e+c)){var f=new THREE.Vector3,m=0,q=0;f.setX(b.x);H(f,m,q);m+=1;for(h=1;h<e;h++)q=-(h*g),f.setY(q),H(f,m,q),m+=1;for(h=1;h<c;h++)q=h*g,f.setY(q),H(f,m,q),m+=1;for(h=m;50>h;h++)l[h].textContent=""}b=new THREE.Vector3(-1,-1,.5);u.unprojectVector(b,p);c=new THREE.Vector3(1,1,.5);u.unprojectVector(c,p);e=Math.abs(b.x)+Math.abs(c.x);g=[[1E4,1E3,100],[1E3,500,50],[500,200,20],[200,100,10],[100,50,5],[50,1,1]];for(var n,h=0;h<g.length;h++)if(e<g[h][0]&&e>g[h][1]){n=g[h][2];
break}e=Math.abs(Math.ceil(b.x/n));c=Math.floor(c.x/n);if(!(50<1+e+c)){g=new THREE.Vector3;m=f=0;g.setY(b.y);I(g,f,m);f+=1;for(h=1;h<e+1;h++)m=-(h*n),g.setX(m),I(g,f,m),f+=1;for(h=1;h<c+1;h++)m=h*n,g.setX(m),I(g,f,m),f+=1;for(h=f;50>h;h++)k[h].textContent=""}B.update();L(a.time);d()}var g=this;void 0===b&&(b="view0");this.prefix=b;this.parentPanel=c;this.left=this.top=this.height=this.width=0;this.outlinerWidth=150;this.canvas=c.parentLayout.canvas;this.renderer=c.parentLayout.renderer;var h=a.signals,
k=[],l=[],m=new MMUI.Panel;m.setPosition("absolute");m.setWidth("100%");m.setHeight("100%");m.setClass("keyviewcontainer-"+this.prefix);c.dom.appendChild(m.dom);b=new MMUI.Panel;b.setPosition("absolute").setLeft("0px").setTop("0px").setBottom("0px").setWidth(this.outlinerWidth+"px");b.dom.id="keyframeList";m.add(b);var n=(new MM.KeyframeEditorOutliner(a)).addMenuItem("Delete");n.onCommand(function(){if("Delete"===n.selectedMenuItem){for(var b=n.getSelectedObjects(),c=0;c<b.length;c++)console.log("\t\t",
"removing",b[c].name),a.removeDisplayAnimCurves([b[c]]),a.removeAnimCurve(b[c]);h.objectSelected.dispatch();a.displaySelectedObjectsAnimCurves()}});b.add(n);var r=new MMUI.Panel;r.setPosition("absolute").setRight("0px").setTop("0px").setBottom("0px").setLeft("150px");r.dom.id="keyvieweditor-"+this.prefix;m.add(r);var q=a.sceneAnimCurves,p=a.keyCamera,t=a.keySelectionBox,u=a.keyProjector,B=a.keyGrid,x=a.keyTimeline,y=new MM.KeyframeEditorControls(p,r.dom);y.addEventListener("keyframeEditorChange",
function(){h.keyframeEditorChanged.dispatch()});a.keyframeEditorCameraControl=y;var v=!1,w=!1,C=new THREE.Vector2,D=new THREE.Vector2,z=new THREE.Vector3,A=new THREE.Vector3,E=new THREE.Vector3,F=!1,G=!1,J=function(a){a.preventDefault();D.set(a.layerX,a.layerY);0==a.button&&1<C.distanceTo(D)&&(A.x=a.layerX/r.dom.offsetWidth*2-1,A.y=2*-(a.layerY/r.dom.offsetHeight)+1,A.z=.5,u.unprojectVector(A,p),!0===v?(t.visible=!1,M(a)):!0===w?(t.visible=!1,N(a)):(t.visible=!0,t.scale.x=A.x-z.x,t.scale.y=A.y-z.y,
t.position=z),E.copy(A));h.keyframeEditorKeysUpdated.dispatch()},K=function(b){b.preventDefault();D.set(b.layerX,b.layerY);if(0===b.button){if(1>C.distanceTo(D)){console.log("getKeysWithinRange");console.log("\tevent",b);console.log("\tshift",b.shiftKey);var c=15*p.scale.x,d=15*p.scale.y,e=new THREE.Vector3;e.x=b.layerX/r.dom.offsetWidth*2-1;e.y=2*-(b.layerY/r.dom.offsetHeight)+1;e.z=.5;u.unprojectVector(e,p);v=!1;for(var f,g=0;g<a.selectedAnimCurves.length;g++){f=a.selectedAnimCurves[g];for(var k=
0;k<f.getNumberOfKeys();k++)Math.abs(e.x-f.t[k])<c&&Math.abs(e.y-f.v[k])<d?v=f.s[k]=!0:!0!==b.shiftKey&&!0!==b.ctrlKey&&(f.s[k]=!1)}if(v)a.clearSelectionTangents(),a.displayKeyTangents();else{console.log("getTangentsWithinRange");c=15*p.scale.x;d=15*p.scale.y;e=new THREE.Vector3;e.x=b.layerX/r.dom.offsetWidth*2-1;e.y=2*-(b.layerY/r.dom.offsetHeight)+1;e.z=.5;u.unprojectVector(e,p);w=!1;for(var l,m,q,n=0;n<a.selectedAnimCurves.length;n++)if(f=a.selectedAnimCurves[n],!0!==b.shiftKey&&!0!==b.ctrlKey&&
(f.tsi=[],f.tso=[]),!0===f.hasTangentDisplay()){q=f.tdp.keys;for(var x=0;x<q.length;x++)g=f.t[q[x]]+f.itv[q[x]].x,k=f.v[q[x]]+f.itv[q[x]].y,l=f.t[q[x]]+f.otv[q[x]].x,m=f.v[q[x]]+f.otv[q[x]].y,Math.abs(e.x-g)<c&&Math.abs(e.y-k)<d&&(f.tsi.push(q[x]),w=!0),Math.abs(e.x-l)<c&&Math.abs(e.y-m)<d&&(f.tso.push(q[x]),w=!0)}}}else if(!0===t.visible){z.x<A.x?(c=z.x,d=A.x):(c=A.x,d=z.x);z.y<A.y?(e=z.y,f=A.y):(e=A.y,f=z.y);v=!1;for(k=0;k<a.selectedAnimCurves.length;k++)for(g=a.selectedAnimCurves[k],l=0;l<g.getNumberOfKeys();l++)g.t[l]<
d&&g.t[l]>c&&g.v[l]<f&&g.v[l]>e?v=g.s[l]=!0:!0!==b.shiftKey&&!0!==b.ctrlKey&&(g.s[l]=!1);if(v)a.clearSelectionTangents(),a.displayKeyTangents();else{console.log("getTangentsWithinBoundingBox");z.x<A.x?(c=z.x,d=A.x):(c=A.x,d=z.x);z.y<A.y?(e=z.y,f=A.y):(e=A.y,f=z.y);l=!1;for(var B=0;B<a.selectedAnimCurves.length;B++)if(g=a.selectedAnimCurves[B],!0!==b.shiftKey&&!0!==b.ctrlKey&&(g.tsi=[],g.tso=[]),!0===g.hasTangentDisplay())for(var k=g.tdp.keys,y=0;y<k.length;y++)m=g.t[k[y]]+g.itv[k[y]].x,q=g.v[k[y]]+
g.itv[k[y]].y,n=g.t[k[y]]+g.otv[k[y]].x,x=g.v[k[y]]+g.otv[k[y]].y,m<d&&m>c&&q<f&&q>e&&(g.tsi.push(k[y]),l=!0),n<d&&n>c&&x<f&&x>e&&(g.tso.push(k[y]),l=!0);l&&(w=!0)}t.visible=!1}else w?(N(b),G=!1):v&&(M(b),F=!1);h.keyframeEditorKeysUpdated.dispatch()}r.dom.removeEventListener("mouseup",K);r.dom.removeEventListener("mousemove",J)};r.dom.addEventListener("mousedown",function(b){b.preventDefault();C.set(b.layerX,b.layerY);if(0===b.button){z.x=b.layerX/r.dom.offsetWidth*2-1;z.y=2*-(b.layerY/r.dom.offsetHeight)+
1;z.z=.5;u.unprojectVector(z,p);E.copy(z);var c;a:{c=15*p.scale.x;var d=15*p.scale.y,e=new THREE.Vector3;e.x=b.layerX/r.dom.offsetWidth*2-1;e.y=2*-(b.layerY/r.dom.offsetHeight)+1;e.z=.5;u.unprojectVector(e,p);for(var f,g=0;g<a.selectedAnimCurves.length;g++){f=a.selectedAnimCurves[g];for(var h=0;h<f.getNumberOfKeys();h++)if(!0===f.s[h]&&Math.abs(e.x-f.t[h])<c&&Math.abs(e.y-f.v[h])<d){c=!0;break a}}c=!1}v=!0===c&&!0===v?!0:!1;a:{c=15*p.scale.x;d=15*p.scale.y;e=new THREE.Vector3;e.x=b.layerX/r.dom.offsetWidth*
2-1;e.y=2*-(b.layerY/r.dom.offsetHeight)+1;e.z=.5;u.unprojectVector(e,p);for(f=0;f<a.selectedAnimCurves.length;f++)if(b=a.selectedAnimCurves[f],!0===b.hasTangentDisplay())for(g=b.tdp.keys,h=0;h<g.length;h++){var k=b.v[g[h]]+b.itv[g[h]].y,l=b.t[g[h]]+b.otv[g[h]].x,m=b.v[g[h]]+b.otv[g[h]].y;if(Math.abs(e.x-(b.t[g[h]]+b.itv[g[h]].x))<c&&Math.abs(e.y-k)<d){b=!0;break a}if(Math.abs(e.x-l)<c&&Math.abs(e.y-m)<d){b=!0;break a}}b=!1}w=!0===b&&!0===w?!0:!1;!1===v&&!1===w&&a.getUndoSelectionDataFromKeysForSelection()}r.dom.addEventListener("mouseup",
K,!1);r.dom.addEventListener("mousemove",J,!1)},!1);var N=function(b){console.log("keyframeEditor.moveActiveTangent");!1===G&&(console.log("\tstarted moving tangents, recording state"),G=!0,a.getUndoTransformDataFromSelectedKeys());b=A.x-E.x;for(var c=A.y-E.y,d=!1,e=!1,f,g,h,k=0;k<a.selectedAnimCurves.length;k++)if(f=a.selectedAnimCurves[k],!0===f.hasTangentDisplay()){h=f.tdp.keys;for(var l=0;l<h.length;l++)g=h[l],-1!==f.tsi.indexOf(g)&&(d=!0,f.itv[g].x+=b,f.itv[g].y+=c,!1===f.bt[g]&&(e=!0,f.otv[g].x-=
b,f.otv[g].y-=c)),-1!==f.tso.indexOf(g)&&(e=!0,f.otv[g].x+=b,f.otv[g].y+=c,!1===f.bt[g]&&(d=!0,f.itv[g].x-=b,f.itv[g].y-=c)),!1===f.wt[g]&&(d&&f.itv[g].normalize().multiplyScalar(f.twv),e&&f.otv[g].normalize().multiplyScalar(f.twv))}},M=function(b){console.log("keyframeEditor.moveActiveKeys");!1===F&&(console.log("\tstarted moving keys, recording state"),F=!0,a.getUndoTransformDataFromSelectedKeys());var c;b=!0===a.useTimeSnap?Math.round(A.x)-Math.round(E.x):A.x-E.x;c=!0===a.useValueSnap?Math.round(A.y)-
Math.round(E.y):A.y-E.y;for(var d,e=0;e<a.selectedAnimCurves.length;e++){d=a.selectedAnimCurves[e];for(var f=0;f<d.getNumberOfKeys();f++)!0===d.s[f]&&(d.t[f]+=b,d.v[f]+=c)}},O=function(a){var b=document.createElement("span");b.style.position="absolute";b.style.cursor="default";b.style.pointerEvents="none";b.style.fontSize="1.35vmin";a.appendChild(b);return b};(function(){l=[];for(var a,b=0;50>b;b++)a=O(r.dom),a.id="TextValue",l.push(a)})();var H=function(a,b,c){a=MM.toScreenXY(a,p,r.dom);l[b].style.left=
a.x+2+"px";l[b].style.bottom=a.y+"px";l[b].textContent=c};(function(){k=[];for(var a,b=0;50>b;b++)a=O(r.dom),a.id="TextFrame",k.push(a)})();var I=function(a,b,c){a=MM.toScreenXY(a,p,r.dom);k[b].style.left=a.x+"px";k[b].style.bottom=a.y+2+"px";k[b].textContent=c},L=function(a){void 0===a&&(a=0);x.geometry.verticesNeedUpdate=!0;x.geometry.vertices=[];x.geometry.vertices.push(new THREE.Vector3(a,750,4));x.geometry.vertices.push(new THREE.Vector3(a,-750,4))},P=function(){var b=1E3,c=-1E3,e=1E3,f=-1E3;
0===a.selectedAnimCurves.length&&(b=-1,c=48,e=-1,f=10);for(var g=0;g<a.selectedAnimCurves.length;g++){var h=a.selectedAnimCurves[g].getSelectedTimeRange();h[0]<b&&(b=h[0]);h[1]>c&&(c=h[1]);h=a.selectedAnimCurves[g].getSelectedValueRange();h[0]<e&&(e=h[0]);h[1]>f&&(f=h[1])}if(1E3===b&&-1E3===c&&1E3===e&&-1E3===f)for(g=0;g<a.selectedAnimCurves.length;g++)h=a.selectedAnimCurves[g].getTimeRange(),h[0]<b&&(b=h[0]),h[1]>c&&(c=h[1]),h=a.selectedAnimCurves[g].getValueRange(),h[0]<e&&(e=h[0]),h[1]>f&&(f=h[1]);
b==c&&(b-=10,c+=10);e==f&&(e-=10,f+=10);c=Math.abs(b)+c;f=Math.abs(e)+f;h=new THREE.Vector3(-1,-1,0);u.unprojectVector(h,p);var k=new THREE.Vector3(1,1,0);u.unprojectVector(k,p);h.x*=.8;k.x*=.8;h.y*=.5;k.y*=.5;g=Math.abs(h.x)+k.x;h=Math.abs(h.y)+k.y;g=1/(g/c);h=1/(h/f);isNaN(g)||isNaN(h)||(b=c/2+b,e=f/2+e,c=(new THREE.Matrix4).makeScale(g*p.scale.x,h*p.scale.y,1),e=(new THREE.Matrix4).setPosition(new THREE.Vector3(b,e,10)),e=(new THREE.Matrix4).multiplyMatrices(e,c),p.matrix=e,p.position.getPositionFromMatrix(p.matrix),
p.scale.getScaleFromMatrix(p.matrix),e=new THREE.Matrix4,e.extractRotation(p.matrix),p.quaternion.setFromRotationMatrix(e),d(),a.signals.showInfo.dispatch("Frame keys"))};m.focus=function(){P()};m.activate=function(){y.enabled=!0};m.deactivate=function(){y.enabled=!1};m.render=function(){d()};m.clear=function(){c.dom.removeChild(m.dom)};m.resize=function(){e()};h.windowResize.add(function(){e()});h.keyFramed.add(function(){P()});h.keyframeEditorReset.add(function(){p.scale.x=1;p.scale.y=1;p.scale.z=
1;p.matrix=(new THREE.Matrix4).identity();p.matrixWorld=(new THREE.Matrix4).identity();f()});h.keyframeEditorChanged.add(function(){f()});h.keyframeEditorKeysUpdated.add(function(){a.updateDisplayAnimCurves();a.updateDisplayKeyTangents();d()});h.keyframeEditorTangentUpdated.add(function(){a.updateDisplayAnimCurves();a.updateDisplayKeyTangents();d()});h.timeChanged.add(function(){L(a.time);d()});h.objectSelected.add(function(){f()});h.objectChanged.add(function(){f()});return m};MM.KeyframeEditorControls=function(a,b){function c(a){if(!1!==f.enabled){a.preventDefault();var b=a.movementX||a.webkitMovementX||a.mozMovementX||a.oMovementX||0;a=a.movementY||a.webkitMovementY||a.mozMovementY||a.oMovementY||0;h===g.PAN?f.pan(new THREE.Vector3(-b,a,0)):h===g.ZOOM&&(console.log("zzzzzzzooom"),f.zoom(new THREE.Vector3(-b,a,0)))}}function d(a){!1!==f.enabled&&(b.removeEventListener("mousemove",c,!1),b.removeEventListener("mouseup",d,!1),b.removeEventListener("mouseout",d,!1),h=g.NONE)}
function e(a){if(!1!==f.enabled){var b=0;a.wheelDelta?b=-a.wheelDelta:a.detail&&(b=10*a.detail);f.zoom(b/1E3)}}console.log("KeyframeEditorControls",a.name);console.log("\tdom",b);b=void 0!==b?b:document;this.enabled=!0;var f=this;new THREE.Vector3;var g={NONE:-1,ZOOM:1,PAN:2},h=g.NONE,k=new THREE.Vector3;new THREE.Matrix3;new THREE.Projector;a.clone();a.position.set(0,0,10);var l={type:"keyframeEditorChange"};this.focus=function(b){console.log("focus");k.getPositionFromMatrix(b.matrixWorld);a.lookAt(k);
f.dispatchEvent(l)};this.pan=function(b){b=(new THREE.Vector3).multiplyVectors(b,a.scale);a.position.add(b);f.dispatchEvent(l)};this.zoom=function(b){console.log("zoom",a.name,b);var c;b instanceof THREE.Vector3?(c=b.x/(1/a.scale.x*50),b=b.y/(1/a.scale.y*50)):(c=b/(1/a.scale.x*25),b/=1/a.scale.x*25);a.scale.x+=c;a.scale.y+=b;.001>a.scale.x&&(a.scale.x=.001,a.scale.y=.001);.001>a.scale.y&&(a.scale.y=.001);f.dispatchEvent(l)};b.addEventListener("contextmenu",function(a){a.preventDefault()},!1);b.addEventListener("mousedown",
function(a){!1!==f.enabled&&(a.preventDefault(),1===a.button?h=g.ZOOM:2===a.button&&(h=g.PAN),b.addEventListener("mousemove",c,!1),b.addEventListener("mouseup",d,!1),b.addEventListener("mouseout",d,!1))},!1);b.addEventListener("mousewheel",e,!1);b.addEventListener("DOMMouseScroll",e,!1);var m=new THREE.Vector3,n=new THREE.Vector3,r=null;b.addEventListener("touchstart",function(a){if(!1!==f.enabled){a=a.touches;switch(a.length){case 2:var b=a[0].pageX-a[1].pageX,c=a[0].pageY-a[1].pageY;r=Math.sqrt(b*
b+c*c)}n.set(a[0].pageX,a[0].pageY,0)}},!1);b.addEventListener("touchmove",function(a){if(!1!==f.enabled){a.preventDefault();a.stopPropagation();a=a.touches;m.set(a[0].pageX,a[0].pageY,0);switch(a.length){case 2:var b=a[0].pageX-a[1].pageX,c=a[0].pageY-a[1].pageY,b=Math.sqrt(b*b+c*c);f.zoom(new THREE.Vector3(0,0,r-b));r=b;break;case 3:f.pan(m.sub(n).setX(-m.x))}n.set(a[0].pageX,a[0].pageY,0)}},!1)};MM.KeyframeEditorControls.prototype=Object.create(THREE.EventDispatcher.prototype);MM.KeyframeGrid=function(a,b,c){this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);this.camera=a;this.projector=b;this.scene=c;this.update();this.line=void 0;return this};
MM.KeyframeGrid.prototype={constructor:MM.KeyframeGrid,update:function(){var a=new THREE.Geometry,b=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}),b=new THREE.Line(a,b,THREE.LinePieces);b.name="gridLine";var c=new THREE.Vector3(-1,-1,.5);this.projector.unprojectVector(c,this.camera);var d=new THREE.Vector3(1,1,.5);this.projector.unprojectVector(d,this.camera);for(var e=Math.abs(c.y)+Math.abs(d.y),f=Math.abs(c.x)+Math.abs(d.x),g=[[1E4,1E3,100],[1E3,500,50],[500,100,20],[100,50,10],
[50,25,5],[25,1,1]],h,k=0;k<g.length;k++)if(e<g[k][0]&&e>g[k][1]){h=g[k][2];break}var e=Math.abs(Math.ceil(c.y/h)),g=Math.floor(d.y/h),l=h;a.vertices.push(new THREE.Vector3(c.x-10,0,0),new THREE.Vector3(d.x+10,0,0));a.colors.push(this.color1,this.color1);for(var m,k=1;k<e;k++)m=-(k*l),a.vertices.push(new THREE.Vector3(c.x-10,m,0),new THREE.Vector3(d.x+10,m,0)),a.colors.push(this.color2,this.color2);for(k=1;k<g;k++)m=k*l,a.vertices.push(new THREE.Vector3(c.x-10,m,0),new THREE.Vector3(d.x+10,m,0)),
a.colors.push(this.color2,this.color2);g=[[1E4,1E3,100],[1E3,500,50],[500,100,10],[100,50,5],[50,1,1]];for(k=0;k<g.length;k++)if(f<g[k][0]&&f>g[k][1]){h=g[k][2];break}e=Math.abs(Math.ceil(c.x/h));g=Math.floor(d.x/h);l=h;a.vertices.push(new THREE.Vector3(0,c.y,0),new THREE.Vector3(0,d.y,0));a.colors.push(this.color1,this.color1);for(k=1;k<e;k++)m=-(k*l),a.vertices.push(new THREE.Vector3(m,c.y,0),new THREE.Vector3(m,d.y,0)),a.colors.push(this.color2,this.color2);for(k=1;k<g;k++)m=k*l,a.vertices.push(new THREE.Vector3(m,
c.y,0),new THREE.Vector3(m,d.y,0)),a.colors.push(this.color2,this.color2);this.scene.remove(this.line);this.scene.add(b);this.line=b}};MM.KeyframeEditorOptions=function(a){function b(){!1===a.useTimeSnap?(a.useTimeSnap=!0,k.setBackgroundColor("#B3B3B3")):(a.useTimeSnap=!1,k.setBackgroundColor("#EBEBEA"))}function c(){if(0!==a.selectedAnimCurves.length){var b=a.selectedAnimCurves[0].getTimeAndValueFromSelected(!0);0!=b.length&&(g.dom.value=b[0][0],h.dom.value=b[0][1])}}var d=a.signals,e=new MMUI.Panel;e.setPosition("absolute").setLeft("2px").setTop("0px").setHeight("25px").setWidth("100%");e.setClass("keframeEditorOptions");var f=
(new MMUI.Text("Time")).setPosition("absolute").setWidth("30px").setTop("6px").setLeft("4px");e.add(f);var g=(new MMUI.Number).setPosition("absolute").setWidth("50px");g.dom.id="timeNumber";g.setTop("2px").setLeft("40px").onChange(function(){0!==a.selectedAnimCurves.length&&(a.selectedAnimCurves[0].setTimeAndValueForFirstSelected(parseFloat(g.dom.value),parseFloat(h.dom.value)),d.keyframeEditorKeysUpdated.dispatch())}).onStart(function(){a.getUndoTransformDataFromSelectedKeys()});e.add(g);f=(new MMUI.Text("Value")).setPosition("absolute").setWidth("30px");
f.setLeft("105px").setTop("6px");e.add(f);var h=(new MMUI.Number).setPosition("absolute").setWidth("50px");h.dom.id="valueNumber";h.setTop("2px").setLeft("150px").onChange(function(){0!==a.selectedAnimCurves.length&&(a.selectedAnimCurves[0].setValueForSelected(parseFloat(h.dom.value)),d.keyframeEditorKeysUpdated.dispatch())}).onStart(function(){a.getUndoTransformDataFromSelectedKeys()});e.add(h);var k=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");k.dom.id="timeSnapUI";k.setTop("0px").setLeft("215px").onClick(b).setBottom("0px");
k.dom.style.backgroundImage="url('ui/keySnapTime.gif')";k.dom.style.backgroundPosition="center center";k.dom.style.backgroundRepeat="no-repeat";e.add(k);var l=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");l.dom.id="valueSnapUI";l.setTop("0px").setLeft("255px").onClick(function(){!1===a.useValueSnap?(a.useValueSnap=!0,l.setBackgroundColor("#B3B3B3")):(a.useValueSnap=!1,l.setBackgroundColor("#EBEBEA"))}).setBottom("0px");l.dom.style.backgroundImage="url('ui/keySnapValue.gif')";l.dom.style.backgroundPosition=
"center center";l.dom.style.backgroundRepeat="no-repeat";e.add(l);var m=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");m.dom.id="addKeyUI";m.setTop("0px").setLeft("300px").onClick(function(){a.addKey()}).setBottom("0px");m.dom.style.backgroundImage="url('ui/keyAdd.gif')";m.dom.style.backgroundPosition="center center";m.dom.style.backgroundRepeat="no-repeat";e.add(m);var n=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");n.dom.id="removeKeyUI";n.setTop("0px").setLeft("340px").onClick(function(){a.removeKey()}).setBottom("0px");
n.dom.style.backgroundImage="url('ui/keyRemove.gif')";n.dom.style.backgroundPosition="center center";n.dom.style.backgroundRepeat="no-repeat";e.add(n);var r=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");r.dom.id="focusUI";r.setTop("0px").setLeft("385px").onClick(function(){d.keyFramed.dispatch()});r.dom.style.backgroundImage="url('ui/frameCurve.gif')";r.dom.style.backgroundPosition="center center";r.dom.style.backgroundRepeat="no-repeat";r.setTop("0px").setBottom("0px");e.add(r);
var q=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");q.dom.id="steppedUI";q.dom.style.backgroundImage="url('ui/stepTan.gif')";q.dom.style.backgroundPosition="center center";q.dom.style.backgroundRepeat="no-repeat";q.setTop("0px").setLeft("430px").setBottom("0px");q.onClick(function(){a.steppedTangents()});e.add(q);var p=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");p.dom.id="linearUI";p.onClick(function(){a.linearTangents()});p.dom.style.backgroundImage="url('ui/linTan.gif')";
p.dom.style.backgroundPosition="center center";p.dom.style.backgroundRepeat="no-repeat";p.setTop("0px").setLeft("470px").setBottom("0px");e.add(p);var t=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");t.dom.id="bezierUI";t.onClick(function(){a.bezierTangents()});t.dom.style.backgroundImage="url('ui/bezierTan.gif')";t.dom.style.backgroundPosition="center center";t.dom.style.backgroundRepeat="no-repeat";t.setTop("0px").setLeft("510px").setBottom("0px");e.add(t);var u=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");
u.dom.id="breakTangentsUI";u.setTop("0px").setLeft("560px").setBottom("0px");u.dom.style.backgroundImage="url('ui/breakTan.gif')";u.dom.style.backgroundPosition="center center";u.dom.style.backgroundRepeat="no-repeat";u.onClick(function(){a.breakTangents()});e.add(u);var B=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");B.dom.id="unifyTangentsUI";B.onClick(function(){a.unifyTangents()});B.dom.style.backgroundImage="url('ui/unifyTan.gif')";B.dom.style.backgroundPosition="center center";
B.dom.style.backgroundRepeat="no-repeat";B.setTop("0px").setLeft("600px").setBottom("0px");e.add(B);var x=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");x.dom.id="freeTangentsUI";x.onClick(function(){a.unlockTangents()});x.dom.style.backgroundImage="url('ui/freeTan.gif')";x.dom.style.backgroundPosition="center center";x.dom.style.backgroundRepeat="no-repeat";x.setTop("0px").setLeft("640px").setBottom("0px");e.add(x);var y=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");
y.dom.id="lockTangentsUI";y.onClick(function(){a.lockTangents()});y.dom.style.backgroundImage="url('ui/lockTan.gif')";y.dom.style.backgroundPosition="center center";y.dom.style.backgroundRepeat="no-repeat";y.setTop("0px").setLeft("680px").setBottom("0px");e.add(y);var v=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");v.dom.id="flattenTangentsUI";v.onClick(function(){a.flattenTangents()});v.dom.style.backgroundImage="url('ui/flatTan.gif')";v.dom.style.backgroundPosition="center center";
v.dom.style.backgroundRepeat="no-repeat";v.setTop("0px").setLeft("720px").setBottom("0px");e.add(v);var w=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");w.dom.id="copyKeyUI";w.onClick(function(){a.copyKeys()});w.setTop("0px").setLeft("765px").setBottom("0px");w.dom.style.backgroundImage="url('ui/copyKey.gif')";w.dom.style.backgroundPosition="center center";w.dom.style.backgroundRepeat="no-repeat";e.add(w);var C=(new MMUI.Button("")).setPosition("absolute").setWidth("36px");C.dom.id=
"pasteKeyUI";C.onClick(function(){a.pasteKeys()});C.setTop("0px").setLeft("805px").setBottom("0px");C.dom.style.backgroundImage="url('ui/pasteKey.gif')";C.dom.style.backgroundPosition="center center";C.dom.style.backgroundRepeat="no-repeat";e.add(C);e.setWidth=function(a){255>a?k.setDisplay("none"):k.setDisplay("block");280>a?l.setDisplay("none"):l.setDisplay("block");300>a?(void 0).setDisplay("none"):(void 0).setDisplay("block");340>a?m.setDisplay("none"):m.setDisplay("block");380>a?n.setDisplay("none"):
n.setDisplay("block");385>a?(void 0).setDisplay("none"):(void 0).setDisplay("block");425>a?r.setDisplay("none"):r.setDisplay("block");430>a?(void 0).setDisplay("none"):(void 0).setDisplay("block");470>a?q.setDisplay("none"):q.setDisplay("block");510>a?p.setDisplay("none"):p.setDisplay("block");555>a?t.setDisplay("none"):t.setDisplay("block");560>a?(void 0).setDisplay("none"):(void 0).setDisplay("block");600>a?u.setDisplay("none"):u.setDisplay("block");640>a?B.setDisplay("none"):B.setDisplay("block");
680>a?x.setDisplay("none"):x.setDisplay("block");720>a?y.setDisplay("none"):y.setDisplay("block");760>a?v.setDisplay("none"):v.setDisplay("block");765>a?(void 0).setDisplay("none"):(void 0).setDisplay("block");805>a?w.setDisplay("none"):w.setDisplay("block");840>a?C.setDisplay("none"):C.setDisplay("block");850>a?(void 0).setDisplay("none"):(void 0).setDisplay("block")};b();d.keyframeEditorKeysUpdated.add(function(){c()});d.keyframeEditorChanged.add(function(){c()});return e};MM.KeyframeEditorOutliner=function(a){function b(){var b,f,g=[];b=0;for(f=d.sGroups.length;b<f;b++){var h=a.scene.getObjectByName(d.sGroups[b],!0);void 0!==h&&h.hasOwnProperty("animCurves")&&Array.prototype.push.apply(g,h.animCurves)}a.displayAnimCurves(g);c.keyframeEditorChanged.dispatch()}var c=a.signals,d=(new MMUI.GroupScrollList).setWidth("100%").setHeight("100%");d.name="animCurveList";d.onMaximize(function(){console.log("KeyframeEditorOutliner: maxi")});d.onGroupSelect(b);d.onObjectSelect(function(){a.displayAnimCurves(d.sObjects);
a.clearSelectionAnimCurves(d.sObjects);c.keyframeEditorChanged.dispatch()});c.objectSelected.add(function(c){d.clear();var f,g,h;if(0!==a.selectedObjects.length)for(c=0,f=a.selectedObjects.length;c<f;c++)if(d.addGroup(a.selectedObjects[c].name),a.selectedObjects[c].hasOwnProperty("animCurves")){g=0;for(h=a.selectedObjects[c].animCurves.length;g<h;g++)d.addObject(a.selectedObjects[c].name,a.selectedObjects[c].animCurves[g]);d.selectGroup(a.selectedObjects[c].name,"add")}d.updateUI();b()});c.objectChanged.add(function(b){if(null===
!a.selected&&void 0===!a.selected&&d.hasGroup(a.selected.name)&&a.selected.hasOwnProperty("animCurves"))for(b=0;b<a.selected.animCurves.length;b++)d.hasObject(a.selected.name,a.selected.animCurves[b])||d.addObject(a.selected.name,a.selected.animCurves[b]);d.updateUI()});c.animCurveRemoved.add(function(a){d.removeObject(a.driven.name,a);d.updateUI()});return d};MM.Group=function(a){this.name=a;this.parent=void 0;this.children=[];this.content=[];this.depth=0};
MM.Group.prototype={constructor:MM.Group,add:function(a){a!==this&&a instanceof MM.Group&&(a.parent=this,this.children.push(a),a.depth=this.depth+1)},remove:function(a){var b=this.children.indexOf(a);-1!==b&&(a.parent=void 0,this.children.splice(b,1))},getObjectByName:function(a,b){for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c];if(e.name===a||!0===b&&(e=e.getObjectByName(a,b),void 0!==e))return e}},getNamespace:function(){var a=this.name.split(":"),b=a.length-1;if(!(1>b)){for(var c=
a[0],d=1;d<b;d++)c+=":"+a[d];return c}},getObjectByNamespace:function(a,b){void 0==b&&(b=[]);for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c];e.getNamespace()===a&&b.push(e);e.getObjectByNamespace(a,b)}return b},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a)},exportData:function(a){void 0===a&&(a={});var b,c;a.name=this.name;a.parent=void 0!==this.parent?this.parent.name:void 0;a.depth=this.depth;a.content=[];b=0;for(c=this.content.length;b<
c;b++)a.content.push(this.content[b].name);a.children=[];b=0;for(c=this.children.length;b<c;b++)a.children.push(this.children[b].exportData());return a}};MM.GroupManager=function(a){this.scene=new MM.Group("scene");this.editor=a;return this};
MM.GroupManager.prototype={constructor:MM.GroupManager,addGroup:function(a,b,c){void 0===c&&(c=!0);if(void 0===b)b=this.scene;else if(b=this.scene.getObjectByName(b,!0),void 0===b)return;var d=a;if(!0===c)for(var e=0;void 0!==b.getObjectByName(d,!1);)d=a+e,e+=1;!1===c&&!0===this.hasGroup(d)?a=this.getGroup(d):(a=new MM.Group(d),b.add(a));return a},hasGroup:function(a){return void 0===this.scene.getObjectByName(a,!0)?!1:!0},getGroup:function(a){return this.scene.getObjectByName(a,!0)},removeGroup:function(a){var b=
a;if(!a instanceof MM.Group&&(b=this.scene.getObjectByName(a,!0),void 0===b))return;void 0!==b.parent&&b.parent.remove(b)},removeGroups:function(a){for(var b=0;b<a.length;b++)this.removeGroup(a[b])},addContent:function(a,b){var c=void 0,c=a instanceof MM.Group?a:this.scene.getObjectByName(a,!0);if(void 0!=c)for(var d=0;d<b.length;d++)!1===MM.containsObjectWithinArray(b[d],c.content)&&c.content.push(b[d])},removeContent:function(a,b){var c=this.scene.getObjectByName(a,!0);if(void 0!=c)for(var d=0;d<
b.length;d++){var e=c.content.indexOf(b[d]);-1!==e&&c.content.splice(e,1)}},exportData:function(){console.log("MM.GroupManager.exportData");return this.scene.exportData()},importData:function(a,b){for(var c=void 0,c="scene"===a.name?this.scene:void 0===b||"scene"===b.name?this.addGroup(a.name,void 0,!1):this.addGroup(a.name,b.name,!1),d=[],e,f=0,g=a.content.length;f<g;f++)e=this.editor.scene.getObjectByName(a.content[f],!0),void 0!==e&&d.push(e);this.addContent(c,d);f=0;for(g=a.children.length;f<
g;f++)this.importData(a.children[f],c)},logAllContent:function(){this.scene.traverse(function(a){for(var b=0;b<a.depth;b++);})}};MMUI.Group=function(a){MMUI.Element.call(this);var b=this,c=document.createElement("div");c.className="group-panel";this.uiGroups={};this.maximized={};this.sGroups={};this.sObjects=[];this.dom=c;this.document=document;this.selectedMenuItem=this.menu=void 0;this.menuItemTxts=[];this.gm=a;this.gt="asset";var d=document.createEvent("HTMLEvents");d.initEvent("maximize",!0,!0);var e=document.createEvent("HTMLEvents");e.initEvent("groupselect",!0,!0);var f=document.createEvent("HTMLEvents");f.initEvent("objectselect",
!0,!0);var g=document.createEvent("HTMLEvents");g.initEvent("command",!0,!0);var h=function(a){console.log("Group: onMouseUp");if(0===a.button){if(-1!==a.target.id.indexOf("$M")&&(console.log("maximize target",a.target),b.setMaximizeGroupValue(a.target.value),b.dom.dispatchEvent(d)),-1!==a.target.id.indexOf("$G")&&(b.selectGroup(a.target.value),b.dom.dispatchEvent(e)),-1!==a.target.id.indexOf("$O")){console.log("\tSelecting object");var c="reset";!0===a.ctrlKey||!0===a.shiftKey?c="add":!0===a.altKey&&
(c="remove");console.log("\tObject",a.target.value);console.log("\tMode",c);b.selectObject(a.target.value,c);b.dom.dispatchEvent(f)}}else 2===a.button&&void 0!==b.menu&&(b.menu.setDisplay("none"),b.selectedMenuItem=a.target.textContent,b.dom.dispatchEvent(g),b.dom.removeEventListener("mouseup",h,!1))};c.addEventListener("mousedown",function(a){console.log("Group: onMouseDown");a.preventDefault();0===a.button?c.addEventListener("mouseup",h,!1):2===a.button&&void 0!==b.menu&&(b.menu.setDisplay("block"),
console.log("position",a.layerX,a.layerY),console.log("\tparent",b.dom),MM.elementWorldPosition(b.dom),b.menu.dom.style.left=a.layerX+"px",b.menu.dom.style.top=a.layerY+"px",console.log("\tmenu",b.menu.dom),c.addEventListener("mouseup",h,!1))},!1);c.addEventListener("maximize",function(a){b.update()},!1);c.addEventListener("groupselect",function(a){b.update()},!1);c.addEventListener("objectselect",function(a){b.update()},!1);c.addEventListener("command",function(a){},!1);return this};
MMUI.Group.prototype=Object.create(MMUI.Element.prototype);var events=["Maximize","GroupSelect","ObjectSelect"];events.forEach(function(a){MMUI.Group.prototype["on"+a]=function(b){this.dom.addEventListener(a.toLowerCase(),b,!1);return this}});MMUI.Group.prototype.setMaximizeGroupValue=function(a){console.log("MMUI.Group: setMaximizeGroupValue",a);this.maximized[this.gt][a]=!0===this.maximized[this.gt][a]?!1:!0};
MMUI.Group.prototype.maximize=function(){for(var a in this.maximized[this.gt])if(!1===this.maximized[this.gt][a]){console.log("maximizing",a);for(var b=this.uiGroups[a].children,c=2,d=b.length;c<d;c++)b[c].style.display="none"}};MMUI.Group.prototype.removeAll=function(){for(;0<this.dom.children.length;)this.dom.removeChild(this.dom.firstChild);this.gOptions=[];this.oOptions={};return this};
MMUI.Group.prototype.isGroupSelected=function(a){this.sGroups.hasOwnProperty(this.gt)||(this.sGroups[this.gt]=[]);return-1!=this.sGroups[this.gt].indexOf(a)?!0:!1};MMUI.Group.prototype.selectGroup=function(a){this.sGroups.hasOwnProperty(this.gt)||(this.sGroups[this.gt]=[]);this.sGroups[this.gt]=[];this.sObjects=[];this.sGroups[this.gt].push(a)};
MMUI.Group.prototype.addGroup=function(a,b,c){b=document.createElement("div");b.className="group-group";!0===this.isGroupSelected(a)&&(b.className="group-group group-group-selected");void 0===c?this.dom.appendChild(b):this.uiGroups[c].appendChild(b);this.uiGroups[a]=b;c=document.createElement("div");c.value=a;c.style.float="left";c.className="group-group-min-max";c.id=a+"$M";this.maximized.hasOwnProperty(this.gt)||(this.maximized[this.gt]={});this.maximized[this.gt].hasOwnProperty(a)||(this.maximized[this.gt][a]=
!0);c.innerHTML=1==this.maximized[this.gt][a]?"-":"+";b.appendChild(c);c=document.createElement("div");c.className="group-group-name";c.value=a;c.innerHTML=a;c.id=a+"$G";b.appendChild(c);return b};MMUI.Group.prototype.selectObjects=function(a){this.sGroups=[];this.sObjects=a};
MMUI.Group.prototype.selectObject=function(a,b){console.log("MMUI.Group: selectObject",a,b);if("add"===b)this.sObjects.push(a),console.log("\tadding",a,"to selection");else if("remove"===b){var c=this.sObjects.indexOf(a);this.sObjects.splice(c,1);console.log("\tremoving",a,"from selection")}else console.log("\tsetting selection to",a),this.sGroups=[],this.sObjects=[],this.sObjects.push(a);console.log("\tnew selection",this.sObjects)};
MMUI.Group.prototype.isObjectSelected=function(a){return-1!=this.sObjects.indexOf(a)?!0:!1};MMUI.Group.prototype.addObject=function(a,b,c){b=document.createElement("div");b.value=a;b.id=a.name+"$O";b.className="group-object";b.innerHTML=a.name;!0===this.isObjectSelected(a)&&(b.className="group-object group-object-selected");void 0===c?this.dom.appendChild(b):this.uiGroups[c].appendChild(b)};MMUI.Group.prototype.addMenuItem=function(a){this.menuItemTxts.push(a);return this};
MMUI.Group.prototype.addMenu=function(){var a=new MMUI.Panel;a.setClass("group-popup");this.dom.appendChild(a.dom);this.menu=a;var b,c,d;b=0;for(c=this.menuItemTxts.length;b<c;b++)d=new MMUI.Panel,d.setTextContent(this.menuItemTxts[b]),a.add(d)};
MMUI.Group.prototype.update=function(){this.removeAll();var a=this;this.gm[this.gt].scene.traverse(function(b){void 0!=b.parent?a.addGroup(b.name,b.depth,b.parent.name):a.addGroup(b.name,b.depth);for(var c=0;c<b.content.length;c++)a.addObject(b.content[c],b.depth,b.name)});this.maximize();this.menu=void 0;this.addMenu()};MM.GroupViewList=function(a){var b=a.signals,c=(new MMUI.Group(a.groups)).setWidth("100%").setHeight("100%");c.onObjectSelect(function(){console.log("ViewportOutliner: objectSelected");a.select(c.sObjects);b.sceneGraphChanged.dispatch()});c.onCommand(function(){console.log("ViewportOutliner: onCommand")});c.addMenuItem("Toggle Visibility");c.addMenuItem("Delete Object");c.objectsWithTag="control";b.groupAdded.add(function(a){c.update()});b.groupContentAdded.add(function(a,b){c.update()});b.objectSelected.add(function(){c.selectObjects(a.selectedObjects);
c.update()});return c};MM.Control=function(){THREE.Object3D.call(this);this.type="control";this.controlColor=new THREE.Color(16776960);this.controlSize=10;this.controlScale=new THREE.Vector3(1,1,1);this.controlOffset=new THREE.Vector3(0,0,0);this.controlType=0;this.controlShape=void 0;this.displayRotationAxis=!1;this.controlSide="C";this.cd=this.asset=void 0;this.boundingBox=null;this.isFacing=this.isFull=!1;this.facingCamera=void 0;this.computeBoundingBox()};MM.Control.prototype=Object.create(THREE.Object3D.prototype);
MM.Control.prototype.setFacingCamera=function(a){console.log("MM.Control.setFacingCamera",a);this.isFacing=!0;this.facingCamera=a};
MM.Control.prototype.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var a=(new THREE.Vector3).getPositionFromMatrix(this.matrixWorld),b=this.controlSize/2*this.controlScale.x+this.controlOffset.x+a.x,c=this.controlSize/2*this.controlScale.y+this.controlOffset.y+a.y,d=this.controlSize/2*this.controlScale.z+this.controlOffset.z+a.z;this.boundingBox.min.set(this.controlSize/2*this.controlScale.x*-1+this.controlOffset.x+a.x,this.controlSize/2*this.controlScale.y*
-1+this.controlOffset.y+a.y,this.controlSize/2*this.controlScale.z*-1+this.controlOffset.z+a.z);this.boundingBox.max.set(b,c,d)};MM.Control.prototype.updateMatrixWorld=function(a){THREE.Object3D.prototype.updateMatrixWorld.call(this,a);this.computeBoundingBox();!0===this.hasDisplay()&&this.cd.update()};MM.Control.prototype.setVisibility=function(a){console.log("setVisibility",a);!0===a?this.show():this.hide()};
MM.Control.prototype.hide=function(){!0===this.hasDisplay()&&(this.visible=!1,this.cd.line.visible=!1)};MM.Control.prototype.show=function(){!0===this.hasDisplay()&&(this.visible=!0,this.cd.line.visible=!0)};MM.Control.prototype.hasDisplay=function(){return void 0===this.cd?!1:!0};MM.Control.prototype.addDisplay=function(){if(void 0===this.controlShape)return this;this.cd=!0===this.isFull?new MM.ControlDisplayFull(this):new MM.ControlDisplay(this);this.cd.controlColor=this.controlColor;return this};
MM.Control.prototype.removeDisplay=function(){this.cd=void 0;this.computeBoundingBox();return this};MM.Control.prototype.updateDisplayColor=function(a){!0===this.hasDisplay()&&(this.cd.controlColor=a,this.cd.update())};MM.Control.prototype.setDisplayColor=function(a){this.controlColor=a;!0===this.hasDisplay()&&(this.cd.controlColor=this.controlColor)};
MM.Control.prototype.setControlShape=function(a,b,c){void 0===a&&(a="c");void 0===b&&(b="plane");void 0===c&&(c=10);this.tag="control";this.controlSide=a;this.controlShape=b;this.controlSize=c};MM.createControlGroup=function(a,b,c,d){void 0===c&&(c="plane");void 0===d&&(d=10);var e=new MM.Spaceswitch;e.name=b+"Zero";var f=new MM.Control;f.name=b;e.setParent(f);f.tag="control";f.controlShape=c;f.controlSize=d;f.controlSide=a;return{control:f,zero:e}};MM.Constraint=function(){MM.Control.call(this);this.constraintMode=0;this.objectToSolve=void 0;this.offsetMatrix=new THREE.Matrix4;this.useOffset=!1;this.order="XYZ"};MM.Constraint.prototype=Object.create(MM.Control.prototype);MM.Constraint.prototype.setObjectToSolve=function(a){this.objectToSolve=a;a=(new THREE.Matrix4).getInverse(this.matrixWorld);this.offsetMatrix.multiplyMatrices(a,this.objectToSolve.matrixWorld)};
MM.Constraint.prototype.updateMatrixWorld=function(a){MM.Control.prototype.updateMatrixWorld.call(this);this.doSolve()};
MM.Constraint.prototype.doSolve=function(){if(void 0!==this.objectToSolve){if(0==this.constraintMode){if(void 0===this.objectToSolve.parent)return;var a=new THREE.Matrix4;a.getInverse(this.objectToSolve.parent.matrixWorld);var b=new THREE.Matrix4;b.multiplyMatrices(a,this.matrixWorld);b=(new THREE.Vector3).getPositionFromMatrix(b);this.objectToSolve.position.set(b.x,b.y,b.z)}if(1==this.constraintMode){if(void 0===this.objectToSolve.parent)return;a=new THREE.Matrix4;a.getInverse(this.objectToSolve.parent.matrixWorld);
b=new THREE.Matrix4;b.multiplyMatrices(a,this.matrixWorld);this.objectToSolve.setRotationFromMatrix(b)}2==this.constraintMode&&(a=new THREE.Matrix4,a.getInverse(this.objectToSolve.matrixWorld),b=new THREE.Matrix4,b.multiplyMatrices(this.matrixWorld,a),this.objectToSolve.applyMatrix(b));if(3==this.constraintMode||5==this.constraintMode){if(void 0===this.objectToSolve.parent)return;a=new THREE.Matrix4;a.getInverse(this.objectToSolve.parent.matrixWorld);b=new THREE.Matrix4;b.multiplyMatrices(a,this.matrixWorld);
a=new THREE.Matrix4;a.multiplyMatrices(b,this.offsetMatrix);this.objectToSolve.position.getPositionFromMatrix(a);b=new THREE.Matrix4;b.extractRotation(a);this.objectToSolve.quaternion.setFromRotationMatrix(b);5==this.constraintMode&&this.objectToSolve.scale.getScaleFromMatrix(a)}if(4==this.constraintMode){var a=this.getWorldPosition(),c=this.objectToSolve.getWorldPosition(),d,e;d=void 0===this.up?this.objectToSolve.getWorldUp():this.up;e=void 0===this.side?this.objectToSolve.getWorldSide():this.side;
b=(new THREE.Matrix4).copy(this.matrixWorld);b.lookAt(a,c,d,e);void 0!==this.objectToSolve.parent?(a=(new THREE.Matrix4).getInverse(this.objectToSolve.parent.matrixWorld),b=(new THREE.Matrix4).multiplyMatrices(a,b),void 0!==this.aimOffset&&!0===this.useOffset&&(b=(new THREE.Matrix4).multiplyMatrices(b,this.aimOffset))):void 0!==this.aimOffset&&!0===this.useOffset&&(b=(new THREE.Matrix4).multiplyMatrices(this.aimOffset,b));this.objectToSolve.rotation.setFromRotationMatrix(b);void 0===this.aimOffset&&
(this.objectToSolve.updateMatrix(),this.aimOffset=(new THREE.Matrix4).getInverse(this.objectToSolve.matrix))}this.objectToSolve.updateMatrix()}};MM.createConstraintGroup=function(a,b,c,d){void 0===c&&(c="plane");void 0===d&&(d=10);var e=new THREE.Object3D;e.name=b+"Zero";var f=new MM.Constraint;f.name=b;e.add(f);f.tag="control";f.controlShape=c;f.controlSize=d;f.controlSide=a;return{constraint:f,zero:e}};MM.ControlDisplay=function(a){this.control=a;this.name=a.name+"Display";this.geometry=new THREE.Geometry;this.material=new THREE.LineBasicMaterial;this.line=new THREE.Line(this.geometry,this.material);this.line.name=this.name+"Line";this.line.exportType="DO_NOT_EXPORT";this.update();this.controlColor=new THREE.Color;return this};
MM.ControlDisplay.prototype={constructor:MM.ControlDisplay,update:function(){var a=new THREE.Matrix4;a.setPosition(this.control.controlOffset);a=(new THREE.Matrix4).multiplyMatrices(this.control.matrixWorld,a);if(!0===this.control.isFacing){var b=(new THREE.Matrix4).extractRotation(this.control.facingCamera.matrixWorld);b.copyPosition(a);a=b}b=this.control.controlScale.clone().multiplyScalar(this.control.controlSize);this.material.color=this.controlColor;this.geometry.vertices=[];this.geometry.verticesNeedUpdate=
!0;!0===this.control.displayRotationAxis&&(this.geometry.vertices.push((new THREE.Vector3).applyMatrix4(a)),this.geometry.vertices.push((new THREE.Vector3(b.x,0,0)).applyMatrix4(a)),this.geometry.vertices.push((new THREE.Vector3).applyMatrix4(a)),this.geometry.vertices.push((new THREE.Vector3(0,b.y,0)).applyMatrix4(a)),this.geometry.vertices.push((new THREE.Vector3).applyMatrix4(a)),this.geometry.vertices.push((new THREE.Vector3(0,0,b.z)).applyMatrix4(a)));switch(this.control.controlShape){case "triangle":this.geometry.vertices.push((new THREE.Vector3(0,
0,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,0,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,0,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,0,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,0,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,0,-b.z)).applyMatrix4(a));break;case "triangleX":this.geometry.vertices.push((new THREE.Vector3(0,-b.z,0)).applyMatrix4(a));
this.geometry.vertices.push((new THREE.Vector3(0,b.z,b.x)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,b.z,b.x)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,b.z,-b.x)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,b.z,-b.x)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,-b.z,0)).applyMatrix4(a));break;case "triangleZ":this.geometry.vertices.push((new THREE.Vector3(-b.z,0,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.z,
b.x,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.z,b.x,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.z,-b.x,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.z,-b.x,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.z,0,0)).applyMatrix4(a));break;case "plane":this.geometry.vertices.push((new THREE.Vector3(b.x,0,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,0,b.z)).applyMatrix4(a));
this.geometry.vertices.push((new THREE.Vector3(b.x,0,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,0,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,0,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,0,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,0,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,0,-b.z)).applyMatrix4(a));break;case "planeX":this.geometry.vertices.push((new THREE.Vector3(0,
-b.z,b.x)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,b.z,b.x)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,b.z,b.x)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,b.z,-b.x)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,b.z,-b.x)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,-b.z,-b.x)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,-b.z,-b.x)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,
-b.z,b.x)).applyMatrix4(a));break;case "planeZ":this.geometry.vertices.push((new THREE.Vector3(-b.z,b.x,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.z,b.x,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.z,b.x,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.z,-b.x,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.z,-b.x,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.z,-b.x,0)).applyMatrix4(a));
this.geometry.vertices.push((new THREE.Vector3(-b.z,-b.x,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.z,b.x,0)).applyMatrix4(a));break;case "circle":for(var b=0,c=2*Math.PI,d=20,e=this.control.controlSize,f=0;f<=d;f++){var g=b+f/d*c,h=e*Math.cos(g),g=e*Math.sin(g);this.geometry.vertices.push((new THREE.Vector3(h,0,g)).applyMatrix4(a))}break;case "circleX":b=0;c=2*Math.PI;d=20;e=this.control.controlSize;for(f=0;f<=d;f++)g=b+f/d*c,h=e*Math.cos(g),g=e*Math.sin(g),this.geometry.vertices.push((new THREE.Vector3(0,
h,g)).applyMatrix4(a));break;case "circleZ":b=0;c=2*Math.PI;d=20;e=this.control.controlSize;for(f=0;f<=d;f++)g=b+f/d*c,h=e*Math.cos(g),g=e*Math.sin(g),this.geometry.vertices.push((new THREE.Vector3(h,g,0)).applyMatrix4(a));break;case "cube":this.geometry.vertices.push((new THREE.Vector3(-b.x,-b.y,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,b.y,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,b.y,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,
b.y,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,b.y,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,-b.y,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,-b.y,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,-b.y,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,-b.y,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,b.y,b.z)).applyMatrix4(a));
this.geometry.vertices.push((new THREE.Vector3(-b.x,b.y,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,b.y,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,b.y,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,-b.y,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,-b.y,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,-b.y,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,
-b.y,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,-b.y,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,b.y,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,b.y,-b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-b.x,b.y,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,b.y,b.z)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(b.x,b.y,-b.z)).applyMatrix4(a));
break;case "default":console.log("Unknown shape type.")}this.geometry.boundingBox=null;this.geometry.computeBoundingBox();--this.geometry.boundingBox.min.y;this.geometry.boundingBox.max.y+=1;this.control.boundingBox=this.geometry.boundingBox;return this}};MM.ControlDisplayFull=function(a){console.log("MM.ControlDisplayFull init");this.control=a;this.name=a.name+"Display";this.geometry=new THREE.Geometry;this.material=new THREE.MeshBasicMaterial;this.line=new THREE.Mesh(this.geometry,this.material);this.line.name=this.name+"Line";this.line.exportType="DO_NOT_EXPORT";this.create();this.update();this.controlColor=new THREE.Color;return this};
MM.ControlDisplayFull.prototype={constructor:MM.ControlDisplay,create:function(){console.log("\tcreating shape",this.control.controlShape);this.material.color=this.controlColor;this.geometry.verticesNeedUpdate=!0;this.geometry.elementsNeedUpdate=!0;this.geometry.normalsNeedUpdate=!0;this.geometry.buffersNeedUpdate=!0;this.geometry.vertices=[];this.geometry.faces=[];var a=this.control.controlScale.clone().multiplyScalar(this.control.controlSize),b=new THREE.Vector3(0,0,-1);switch(this.control.controlShape){case "plane":var c,
d,e;c=new THREE.Vector3(a.x,a.y,0);d=new THREE.Vector3(a.x,-1*a.y,0);e=new THREE.Vector3(-1*a.x,-1*a.y,0);a=new THREE.Vector3(-1*a.x,a.y,0);this.geometry.vertices.push(c);this.geometry.vertices.push(d);this.geometry.vertices.push(e);this.geometry.vertices.push(a);d=new THREE.Face3(1,0,3);d.normal.copy(b);d.vertexNormals.push(b.clone(),b.clone(),b.clone());this.geometry.faces.push(d);d=new THREE.Face3(3,2,1);d.normal.copy(b);d.vertexNormals.push(b.clone(),b.clone(),b.clone());this.geometry.faces.push(d);
break;case "triangleUp":c=new THREE.Vector3(0,a.y,0);d=new THREE.Vector3(a.x,0,0);e=new THREE.Vector3(-1*a.x,0,0);this.geometry.vertices.push(c);this.geometry.vertices.push(d);this.geometry.vertices.push(e);d=new THREE.Face3(2,1,0);d.normal.copy(b);d.vertexNormals.push(b.clone(),b.clone(),b.clone());this.geometry.faces.push(d);break;case "triangleDown":c=new THREE.Vector3(-1*a.x,0,0);d=new THREE.Vector3(a.x,0,0);e=new THREE.Vector3(0,-a.y,0);this.geometry.vertices.push(c);this.geometry.vertices.push(d);
this.geometry.vertices.push(e);d=new THREE.Face3(2,1,0);d.normal.copy(b);d.vertexNormals.push(b.clone(),b.clone(),b.clone());this.geometry.faces.push(d);break;case "triangleLeft":c=new THREE.Vector3(0,a.y,0);d=new THREE.Vector3(0,-1*a.y,0);e=new THREE.Vector3(-1*a.x,0,0);this.geometry.vertices.push(c);this.geometry.vertices.push(d);this.geometry.vertices.push(e);d=new THREE.Face3(2,1,0);d.normal.copy(b);d.vertexNormals.push(b.clone(),b.clone(),b.clone());this.geometry.faces.push(d);break;case "triangleRight":c=
new THREE.Vector3(0,a.y,0);d=new THREE.Vector3(0,-1*a.y,0);e=new THREE.Vector3(1*a.x,0,0);this.geometry.vertices.push(c);this.geometry.vertices.push(d);this.geometry.vertices.push(e);d=new THREE.Face3(0,1,2);d.normal.copy(b);d.vertexNormals.push(b.clone(),b.clone(),b.clone());this.geometry.faces.push(d);break;case "circle":d=2*Math.PI;e=this.control.controlSize;var f;for(c=0;20>=c;c++)f=0+c/20*d,a=e*Math.cos(f),f=e*Math.sin(f),this.geometry.vertices.push(new THREE.Vector3(a,f,0));for(c=0;20>=c;c++)d=
c+1,20<d&&(d=0),d=new THREE.Face3(0,c,d),d.normal.copy(b),d.vertexNormals.push(b.clone(),b.clone(),b.clone()),this.geometry.faces.push(d);break;default:console.log("\tUnsupported shape",this.control.controlShape)}this.geometry.computeCentroids();this.geometry.computeFaceNormals();return this},update:function(){this.material.color=this.controlColor;var a=new THREE.Matrix4;a.setPosition(this.control.controlOffset);a=(new THREE.Matrix4).multiplyMatrices(this.control.matrixWorld,a);if(!0===this.control.isFacing){var b=
(new THREE.Matrix4).extractRotation(this.control.facingCamera.matrixWorld);b.copyPosition(a);a=b}b=this.control.controlScale.clone().multiplyScalar(this.control.controlSize);this.geometry.vertices=[];this.geometry.verticesNeedUpdate=!0;switch(this.control.controlShape){case "plane":this.geometry.vertices.push((new THREE.Vector3(1*b.x,1*b.y,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(1*b.x,-1*b.y,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-1*b.x,-1*
b.y,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-1*b.x,1*b.y,0)).applyMatrix4(a));break;case "triangleUp":this.geometry.vertices.push((new THREE.Vector3(0,b.y,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(1*b.x,0,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-1*b.x,0,0)).applyMatrix4(a));break;case "triangleDown":this.geometry.vertices.push((new THREE.Vector3(-1*b.x,0,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(1*
b.x,0,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,-b.y,0)).applyMatrix4(a));break;case "triangleLeft":this.geometry.vertices.push((new THREE.Vector3(0,1*b.y,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,-1*b.y,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(-1*b.x,0,0)).applyMatrix4(a));break;case "triangleRight":this.geometry.vertices.push((new THREE.Vector3(0,1*b.y,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(0,
-1*b.y,0)).applyMatrix4(a));this.geometry.vertices.push((new THREE.Vector3(1*b.x,0,0)).applyMatrix4(a));break;case "circle":for(var b=2*Math.PI,c=this.control.controlSize,d=0;20>=d;d++){var e=0+d/20*b,f=c*Math.cos(e),e=c*Math.sin(e);this.geometry.vertices.push((new THREE.Vector3(f,e,0)).applyMatrix4(a))}break;default:console.log("\tUnsupported shape",this.control.controlShape)}this.geometry.computeCentroids();this.geometry.computeFaceNormals();return this}};MM.Joint=function(){THREE.Object3D.call(this);this.skinMatrix=new THREE.Matrix4;this.preferedAngle=new THREE.Vector3;this.type="Joint";this.radius=10;this.controlSize=1;this.showRotationAxis=!1;this.showHierarchy=!0;this.showControl=!1;this.jd=void 0;this.hasShapes=!1;this.shapesPosition={};this.shapes={};this.bindPosition=new THREE.Vector3;this.offsetPosition=new THREE.Vector3};MM.Joint.prototype=Object.create(THREE.Object3D.prototype);
MM.Joint.prototype.importData=function(a){this.radius=a.radius;this.controlSize=a.controlSize;this.showRotationAxis=a.showRotationAxis;this.showHierarchy=a.showHierarchy;this.showControl=a.showControl;this.skinMatrix.fromArray(a.skinMatrix);this.preferedAngle.set(a.preferedAngle.x,a.preferedAngle.y,a.preferedAngle.z)};
MM.Joint.prototype.exportData=function(){var a={};a.radius=this.radius;a.controlSize=this.controlSize;a.showRotationAxis=this.showRotationAxis;a.showHierarchy=this.showHierarchy;a.showControl=this.showControl;a.skinMatrix=this.skinMatrix.toArray();a.preferedAngle=this.preferedAngle;return a};MM.Joint.prototype.addTarget=function(a,b,c){!1===this.hasShapes&&(this.bindPosition=this.position.clone(),this.hasShapes=!0);this.shapesPosition[c]=a;this.shapes[c]=b};
MM.Joint.prototype.setBindPose=function(){this.skinMatrix=this.matrixWorld.clone()};MM.Joint.prototype.setParent=function(a){var b=new THREE.Matrix4;b.getInverse(this.matrixWorld);var c=new THREE.Matrix4;c.multiplyMatrices(a.matrixWorld,b);THREE.Object3D.prototype.add.call(this,a);a.position.getPositionFromMatrix(c);b=new THREE.Matrix4;b.extractRotation(c);a.quaternion.setFromRotationMatrix(b)};
MM.Joint.prototype.updateMatrix=function(){var a=new THREE.Vector3;if(!0===this.hasShapes){for(var b in this.shapes)if(0<this.shapes[b]){var c=this.shapesPosition[b].clone().multiplyScalar(this.shapes[b]);a.add(c)}this.matrix.compose((new THREE.Vector3).addVectors(this.bindPosition,a).add(this.offsetPosition),this.quaternion,this.scale)}else this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0};
MM.Joint.prototype.updateMatrixWorld=function(a){THREE.Object3D.prototype.updateMatrixWorld.call(this,a);!0===this.hasDisplay()&&this.jd.update()};MM.Joint.prototype.getPreferedAngle=function(){return this.preferedAngle};MM.Joint.prototype.setPreferedAngle=function(a){a instanceof THREE.Vector3&&(this.preferedAngle=a)};MM.Joint.prototype.hasDisplay=function(){return this.jd instanceof MM.JointDisplay?!0:!1};MM.Joint.prototype.addDisplay=function(){this.jd=new MM.JointDisplay(this);return this};
MM.Joint.prototype.removeDisplay=function(){this.jd=null;return this};MM.Joint.prototype.updateDisplay=function(){this.jd instanceof MM.JointDisplay&&this.jd.update()};MM.JointDisplay=function(a){this.joint=a;this.jointColor=new THREE.Color(16755200);this.controlColor=new THREE.Color(16711680);this.geometry=new THREE.Geometry;this.material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.line=new THREE.Line(this.geometry,this.material);this.line.name=a.name+"Line";this.line.exportType="DO_NOT_EXPORT";this.update();return this};
MM.JointDisplay.prototype={constructor:MM.JointDisplay,update:function(){this.geometry.verticesNeedUpdate=!0;this.geometry.vertices=[];this.geometry.colors=[];!0===this.joint.showHierarchy&&this.drawHierarchy();!0===this.joint.showRotationAxis&&this.drawRotationAxis();!0===this.joint.showControl&&this.drawControl()},drawHierarchy:function(){if(0!==this.joint.children.length)for(var a=0;a<this.joint.children.length;a++)this.geometry.vertices.push((new THREE.Vector3).getPositionFromMatrix(this.joint.matrixWorld)),
this.geometry.vertices.push((new THREE.Vector3).getPositionFromMatrix(this.joint.children[a].matrixWorld)),this.geometry.colors.push(this.jointColor),this.geometry.colors.push(this.jointColor)},drawRotationAxis:function(){this.geometry.vertices.push((new THREE.Vector3).applyMatrix4(this.joint.matrixWorld),(new THREE.Vector3(this.joint.radius,0,0)).applyMatrix4(this.joint.matrixWorld),(new THREE.Vector3).applyMatrix4(this.joint.matrixWorld),(new THREE.Vector3(0,this.joint.radius,0)).applyMatrix4(this.joint.matrixWorld),
(new THREE.Vector3).applyMatrix4(this.joint.matrixWorld),(new THREE.Vector3(0,0,this.joint.radius)).applyMatrix4(this.joint.matrixWorld));this.geometry.colors.push(new THREE.Color(16711680),new THREE.Color(16711680),new THREE.Color(65280),new THREE.Color(65280),new THREE.Color(255),new THREE.Color(255))},drawControl:function(){for(var a=this.controlSize,b=0;4>=b;b++){var c=b/4*Math.PI*2,d=(b+1)/4*Math.PI*2;this.geometry.vertices.push(new THREE.Vector3(0,Math.cos(c)*a,Math.sin(c)*a));this.geometry.vertices.push(new THREE.Vector3(0,
Math.cos(d)*a,Math.sin(d)*a));this.geometry.colors.push(this.controlColor);this.geometry.colors.push(this.controlColor)}this.geometry.computeBoundingBox()}};MM.Spaceswitch=function(){MM.Control.call(this);this.offsetMatrices=[];this.spaces=[];this.spaceNames=[];this.objectType="Spaceswitch";this.channelName="spaceSwitch";this.addChannel("custom",this.channelName,[],"enum");this.custom={spaceSwitch:0};this.channelObject=void 0};MM.Spaceswitch.prototype=Object.create(MM.Control.prototype);
MM.Spaceswitch.prototype.importData=function(a){this.name=a.name;this.uuid=a.uuid;this.controlColor.setRGB(a.controlColor.r,a.controlColor.g,a.controlColor.b);this.controlSize=a.controlSize;this.controlScale.set(a.controlScale.x,a.controlScale.y,a.controlScale.z);this.controlOffset.set(a.controlOffset.x,a.controlOffset.y,a.controlOffset.z);this.controlSide=a.controlSide;this.displayRotationAxis=a.displayRotationAxis;a.hasOwnProperty("controlShape")&&(this.controlShape=a.controlShape);a.hasOwnProperty("custom")&&
(this.custom=a.custom);this.spaceNames=a.spaceNames;this.offsetMatrices=[];for(var b,c=0;c<a.offsetMatrices.length;c++)b=(new THREE.Matrix4).fromArray(a.offsetMatrices[c]),this.offsetMatrices.push(b)};
MM.Spaceswitch.prototype.exportData=function(){var a={};a.name=this.name;a.uuid=this.uuid;a.type=this.objectType;a.controlColor=this.controlColor;a.controlSize=this.controlSize;a.controlScale=this.controlScale;a.controlOffset=this.controlOffset;a.controlSide=this.controlSide;a.displayRotationAxis=this.displayRotationAxis;void 0!==this.controlShape&&(a.controlShape=this.controlShape);this.hasOwnProperty("custom")&&(a.custom=this.custom);a.spaceNames=this.spaceNames;a.offsetMatrices=[];for(var b,c=
0;c<this.offsetMatrices.length;c++)b=this.offsetMatrices[c].toArray(),a.offsetMatrices.push(b);return a};
MM.Spaceswitch.prototype.importSetup=function(a,b){console.log("Spaceswitch.importSetup",b);for(var c,d=0;d<this.spaceNames.length;d++)c=a.getObjectByName(this.spaceNames[d],!0),void 0!==c?this.spaces.push(c):console.error("Unable to find",this.spaceNames[d]);b.hasOwnProperty("channelObject")&&(c=a.getObjectByName(b.channelObject,!0),void 0!==c?this.addSpaceswitchChannel(c):console.error("Unable to find channel object",b.foundObject))};
MM.Spaceswitch.prototype.exportSetup=function(){var a={};a.type=this.objectType;a.name=this.name;void 0!==this.channelObject&&(a.channelObject=this.channelObject.name);return a};MM.Spaceswitch.prototype.addSpace=function(a){this.spaces.push(a);this.spaceNames.push(a.name);this.custom[this.channelName]=this.spaces.length-1;this.addToChannelRange("custom",this.channelName,a.name);a=(new THREE.Matrix4).getInverse(a.matrixWorld);a=(new THREE.Matrix4).multiplyMatrices(a,this.matrixWorld);this.offsetMatrices.push(a)};
MM.Spaceswitch.prototype.hasSpace=function(a){return-1!==this.spaces.indexOf(a)?!0:!1};MM.Spaceswitch.prototype.updateSpace=function(a){console.log("updateSpace",a.name)};MM.Spaceswitch.prototype.setChannelsTranslateAndRotate=function(){this.animChannels=[this._getChannelsTranslate(),this._getChannelsRotate(),["custom",[this.channelName],[],"enum"]]};
MM.Spaceswitch.prototype.updateMatrixWorld=function(){MM.Control.prototype.updateMatrixWorld.call(this);if(0!==this.spaces.length){var a=this.custom[this.channelName],b=new THREE.Matrix4;b.getInverse(this.parent.matrixWorld);var c=new THREE.Matrix4;c.multiplyMatrices(b,this.spaces[a].matrixWorld);b=new THREE.Matrix4;b.multiplyMatrices(c,this.offsetMatrices[a]);this.position.getPositionFromMatrix(b);a=new THREE.Matrix4;a.extractRotation(b);this.quaternion.setFromRotationMatrix(a);this.updateMatrix()}};
MM.Spaceswitch.prototype.addSpaceswitchChannel=function(a){console.log("addSpaceswitchChannel",a.name);a.addChannel("custom",this.channelName,this.spaceNames,"enum");a.custom=this.custom;a.spaces=this.spaces;a.spaceNames=this.spaceNames;this.channelObject=a};MM.ParentMaster=function(){MM.Spaceswitch.call(this);this.objectType="ParentMaster";this.channelName="parentMaster";this.addChannel("custom",this.channelName);this.custom={parentMaster:""}};MM.ParentMaster.prototype=Object.create(MM.Spaceswitch.prototype);
MM.ParentMasterView=function(a){var b=a.signals,c=new MMUI.Panel,d=new MMUI.Panel;d.setPadding("5px");c.add(d);var e=(new MMUI.Text("Driver")).setClass("sidebar-text");d.add(e);var f=(new MMUI.Select).setClass("sidebar-input");d.add(f);d=new MMUI.Panel;d.setPadding("5px");c.add(d);e=(new MMUI.Text("Control")).setClass("sidebar-text");d.add(e);var g=(new MMUI.Select).setOptions(["none"]).setClass("sidebar-input");d.add(g);f.onChange(function(){console.log("ParentMaster: driver change");var b=f.getValue();
console.log("\tSelected",b);b=a.getAssetByName(b);void 0!==b&&g.setOptions(b.getControlNames())});d=new MMUI.Panel;d.setPadding("5px");c.add(d);e=(new MMUI.Text("Driven")).setClass("sidebar-text");d.add(e);var h=(new MMUI.Select).setClass("sidebar-input");d.add(h);d=new MMUI.Panel;d.setPadding("5px");c.add(d);e=(new MMUI.Text("Control")).setClass("sidebar-text");d.add(e);var k=(new MMUI.Select).setOptions(["none"]).setClass("sidebar-input");d.add(k);h.onChange(function(){console.log("ParentMaster: driven change");
var b=h.getValue();console.log("\tSelected",b);b=a.getAssetByName(b);void 0!==b&&k.setOptions(b.getControlNames())});d=new MMUI.Panel;d.setPadding("5px");c.add(d);e=(new MMUI.Button("Add Space")).onClick(function(){console.log("ParentMaster: Add Space onClick");var b=f.getValue(),c=g.getSelectedText();console.log("\tdriver asset:",b);console.log("\tdriver control:",c);var d=h.getValue(),b=k.getSelectedText();console.log("\tdriven asset:",d);console.log("\tdriven control:",b);d=a.scene.getObjectByName(c,
!0);void 0===d?console.log("\tunable to find",c):(c=a.scene.getObjectByName(b,!0),void 0===c?console.log("\tunable to find",b):c.parent instanceof THREE.ParentMaster?(console.log("\tdriven already has a parentMaster node"),b=c.parent,b.hasSpace(d)||b.addSpace(d)):(console.log("\tadding parentMaster node to",c),b=c.addInbetween(c.name+"PM","ParentMaster"),b.addSpace(d),b.addSpaceswitchChannel(c)))});d.add(e);e=(new MMUI.Button("Update Space")).onClick(function(){console.log("Yet to be implemented")});
d.add(e);b.assetAdded.add(function(){console.log("ParentMaster: assetAdded");f.setOptions(a.getNamespaceFromAssetObjects());h.setOptions(a.getNamespaceFromAssetObjects())});b.assetRemoved.add(function(){console.log("ParentMaster: assetRemoved");f.setOptions(a.getNamespaceFromAssetObjects());h.setOptions(a.getNamespaceFromAssetObjects())});return c};MM.MultiChannel=function(){this.id=THREE.Object3DIdCount++;this.uuid=THREE.Math.generateUUID();this.driverChannel=this.driverChannelGroup=this.driver=this.name=void 0;this.driven=[];this.drivenChannelGroups=[];this.drivenChannels=[];this.drivenBehavior=[];this.drivenV0=[];this.drivenV1=[];this.drivenV2=[];return this};
MM.MultiChannel.prototype={constructor:MM.MultiChannel,exportData:function(){var a={type:"MultiChannel"};a.driver=this.driver.name;a.driverChannelGroup=this.driverChannelGroup;a.driverChannel=this.driverChannel;a.driven=[];a.drivenChannelGroups=this.drivenChannelGroups;a.drivenChannels=this.drivenChannels;a.drivenBehavior=this.drivenBehavior;a.drivenV0=this.drivenV0;a.drivenV1=this.drivenV1;a.drivenV2=this.drivenV2;for(var b=0,c=this.driven.length;b<c;b++)a.driven[b]=this.driven[b].name;return a},
importData:function(a,b){var c=b.getObjectByName(a.driver,!0);void 0===c&&console.warn("\tUnable to find",a.driver);this.driver=c;this.driverChannelGroup=a.driverChannelGroup;this.driverChannel=a.driverChannel;for(var c=0,d=a.driven.length;c<d;c++){var e=b.getObjectByName(a.driven[c],!0);void 0===e&&console.warn("\tUnable to find",a.driven[c]);this.driven.push(e)}this.drivenChannelGroups=a.drivenChannelGroups;this.drivenChannels=a.drivenChannels;this.drivenBehavior=a.drivenBehavior;this.drivenV0=
a.drivenV0;this.drivenV1=a.drivenV1;this.drivenV2=a.drivenV2},addDrivenChannel:function(a,b,c){this.driven.push(a);this.drivenChannelGroups.push(b);this.drivenChannels.push(c);this.drivenBehavior.push(0);return this.drivenBehavior.length-1},setDrivenBehavior:function(a,b,c,d,e){switch(b){case "INVERSE":this.drivenBehavior[a]=1;break;case "CLAMP":this.drivenBehavior[a]=2;this.drivenV0[a]=c;this.drivenV1[a]=d;break;case "MULTIPLY":this.drivenBehavior[a]=3;this.drivenV0[a]=c;break;case "CLAMP_MULTIPLY":this.drivenBehavior[a]=
4;this.drivenV0[a]=c;this.drivenV1[a]=d;this.drivenV2[a]=e;break;default:console.log("\tUnknown behavior. Defaulting to PASS.")}},setDriverChannel:function(a,b,c){this.driver=a;this.driverChannelGroup=b;this.driverChannel=c},update:function(){var a=this.driver[this.driverChannelGroup],b,c,d,e;b=0;for(c=this.driven.length;b<c;b++)switch(d=this.driven[b][this.drivenChannelGroups[b]],e=a[this.driverChannel],this.drivenBehavior[b]){case 0:d[this.drivenChannels[b]]=e;break;case 1:0>e&&(e=0);1<e&&(e=1);
d[this.drivenChannels[b]]=1-e;break;case 2:e<=this.drivenV0[b]&&(e=this.drivenV0[b]);e>=this.drivenV1[b]&&(e=this.drivenV1[b]);d[this.drivenChannels[b]]=e;break;case 3:d[this.drivenChannels[b]]=e*this.drivenV0[b];break;case 4:e<=this.drivenV0[b]&&(e=this.drivenV0[b]),e>=this.drivenV1[b]&&(e=this.drivenV1[b]),d[this.drivenChannels[b]]=e*this.drivenV2[b]}}};MM.Number=function(){this.value=0};MM.Number.prototype={constructor:MM.Number,getValue:function(){return this.value},setValue:function(a){this.value=a}};MM.LipZip=function(a){this.editor=a;this.tJoints=[];this.bJoints=[];this.position=[];this.range=.25;this.zip=.5;return this};
MM.LipZip.prototype={constructor:MM.LipZip,update:function(){var a=this.zip;this.zip.constructor===MM.Number&&(a=this.zip.value);var b=this.range;this.range.constructor===MM.Number&&(b=this.range.value);var c,d,e,f=a+b;c=0;for(d=this.position.length;c<d;c++){e=this.position[c]>f?0:a>this.position[c]?1:1-(this.position[c]-a)/b;var g=new THREE.Vector3,h=new THREE.Vector3;if(0<e){this.tJoints[c].offsetPosition=g;this.tJoints[c].updateMatrix();this.tJoints[c].updateMatrixWorld();this.bJoints[c].offsetPosition=
g;this.bJoints[c].updateMatrix();this.bJoints[c].updateMatrixWorld();var g=(new THREE.Vector3).getPositionFromMatrix(this.tJoints[c].matrixWorld),h=(new THREE.Vector3).getPositionFromMatrix(this.bJoints[c].matrixWorld),h=(new THREE.Vector3).addVectors(g,h).multiplyScalar(.5),g=(new THREE.Matrix4).getInverse(this.tJoints[c].parent.matrixWorld),g=h.clone().applyMatrix4(g),g=(new THREE.Vector3).subVectors(g,(new THREE.Vector3).getPositionFromMatrix(this.tJoints[c].matrix)).multiplyScalar(e),k=(new THREE.Matrix4).getInverse(this.bJoints[c].parent.matrixWorld),
h=h.clone().applyMatrix4(k),h=(new THREE.Vector3).subVectors(h,(new THREE.Vector3).getPositionFromMatrix(this.bJoints[c].matrix)).multiplyScalar(e)}this.tJoints[c].offsetPosition=g;this.tJoints[c].updateMatrix();this.tJoints[c].updateMatrixWorld();this.bJoints[c].offsetPosition=h;this.bJoints[c].updateMatrix();this.bJoints[c].updateMatrixWorld()}},addJointPairByName:function(a,b,c){a=this.editor.scene.getObjectByName(a,!0);b=this.editor.scene.getObjectByName(b,!0);this.tJoints.push(a);this.bJoints.push(b);
this.position.push(c)}};MM.factorials=function(a){for(var b=a,c=1,b=a;0<b;b--)c*=b;return c};MM.bernstein=function(a,b,c){console.log("bernstein",a,b,c);a=MM.factorials(b)/(MM.factorials(b-a)*MM.factorials(a))*Math.pow(c,a*Math.pow(1-c,b-a));console.log("\tresult",a);return a};MM.CrossProduct=function(a,b){var c=new THREE.Vector3;c.x=a.y*b.z-a.z*b.y;c.y=a.z*b.x-a.x*b.z;c.z=a.x*b.y-a.y*b.x;return c};MM.DotProduct=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};
MM.VectorSubtraction=function(a,b){var c=new THREE.Vector3;c.x=a.x-b.x;c.y=a.y-b.y;c.z=a.z-b.z;return c};MM.FFDDisplay=function(a){console.log("FFDDisplay",a);this.ffd=a;this.displaySize=10;a=new THREE.Geometry;var b=new THREE.ParticleBasicMaterial({size:this.displaySize,color:0,sizeAttenuation:!1});this.dvrt=new THREE.ParticleSystem(a,b);this.update()};
MM.FFDDisplay.prototype.update=function(){this.dvrt.geometry.verticesNeedUpdate=!0;this.dvrt.geometry.vertices=[];var a,b,c;for(a=0;a<=this.ffd.l;a++)for(b=0;b<=this.ffd.m;b++)for(c=0;c<=this.ffd.n;c++)this.dvrt.geometry.vertices.push(this.ffd.PCI[a][b][c])};MM.FFD=function(){THREE.Object3D.call(this);this.type="ffd";this.cd=this.dg=void 0;this.solved=!1};MM.FFD.prototype=Object.create(THREE.Object3D.prototype);MM.FFD.prototype.setGeometry=function(a){this.dg=a};
MM.FFD.prototype.updateMatrixWorld=function(a){THREE.Object3D.prototype.updateMatrixWorld.call(this,a);void 0!==this.cd&&this.cd.update();if(void 0!==this.dg&&!1===this.solved){a=this.dg.vertices.length;var b;for(b=0;b<a;b++)console.log("----------------------------------------"),console.log("\tBEFORE",b,":",this.dg.vertices[b].x,this.dg.vertices[b].y,this.dg.vertices[b].z),this.dg.vertices[b]=this.deformMesh(this.dg.vertices[b]),console.log("\tAFTER",b,":",this.dg.vertices[b].x,this.dg.vertices[b].y,
this.dg.vertices[b].z);this.solved=!0}};MM.FFD.prototype.addDisplay=function(){if(void 0===this.cd)return this.cd=new MM.FFDDisplay(this),this};
MM.FFD.prototype.initialize=function(a,b){this.origin=new THREE.Vector3;this.origin.x=a.x;this.origin.y=a.y;this.origin.z=a.z;this.axis=new THREE.Vector3;this.axis.x=b.x-a.x;this.axis.y=b.y-a.y;this.axis.z=b.z-a.z;this.S_axis=new THREE.Vector3;this.S_axis.x=this.axis.x;this.T_axis=new THREE.Vector3;this.T_axis.y=this.axis.y;this.U_axis=new THREE.Vector3;this.U_axis.z=this.axis.z;this.n=this.m=this.l=1;this.PCI=[]};
MM.FFD.prototype.CPSetup=function(){var a,b,c,d;for(a=0;a<=this.l;a++)for(void 0===this.PCI[a]&&(this.PCI[a]=[]),b=0;b<=this.m;b++)for(void 0===this.PCI[a][b]&&(this.PCI[a][b]=[]),c=0;c<=this.n;c++)d=new THREE.Vector3,d.x=this.origin.x+a/this.l*this.axis.x,d.y=this.origin.y+b/this.m*this.axis.y,d.z=this.origin.z+c/this.n*this.axis.z,this.PCI[a][b][c]=new THREE.Vector3(d.x,d.y,d.z)};
MM.FFD.prototype.convertToSTU=function(a){console.log("convertToSTU",a.x,a.y,a.z);var b=MM.CrossProduct(this.T_axis,this.U_axis),c=MM.CrossProduct(this.S_axis,this.U_axis),d=MM.CrossProduct(this.S_axis,this.T_axis);a=MM.VectorSubtraction(a,this.origin);var e=new THREE.Vector3;e.x=MM.DotProduct(b,a)/MM.DotProduct(b,this.S_axis);e.y=MM.DotProduct(c,a)/MM.DotProduct(c,this.T_axis);e.z=MM.DotProduct(d,a)/MM.DotProduct(d,this.U_axis);console.log("\tresult",e.x,e.y,e.z);return e};
MM.FFD.prototype.deformMesh=function(a){var b=this.convertToSTU(a);console.log("deformMesh",a.x,a.y,a.z);a=new THREE.Vector3;var c=new THREE.Vector3,d=new THREE.Vector3,e=0,f=0,f=0,g,h;for(g=0;g<=this.l;g++){c.x=0;c.y=0;for(e=c.z=0;e<=this.m;e++){d.x=0;d.y=0;for(h=d.z=0;h<=this.n;h++)f=MM.bernstein(h,this.n,b.z),d.x+=f*this.PCI[g][e][h].x,d.y+=f*this.PCI[g][e][h].y,d.z+=f*this.PCI[g][e][h].z;f=MM.bernstein(e,this.m,b.y);c.x+=f*d.x;c.y+=f*d.y;c.z+=f*d.z}e=MM.bernstein(g,this.l,b.x);a.x+=e*c.x;a.y+=
e*c.y;a.z+=e*c.z}console.log("\tresult",a);return a};MM.powf=function(a,b){switch(b){case 0:return 1;case 1:return a;case 2:return a*a;case 3:return a*a*a}};MM.FFD1Display=function(a){console.log("FFD1Display",a);this.ffd=a;this.displaySize=10;a=new THREE.Geometry;var b=new THREE.ParticleBasicMaterial({size:this.displaySize,color:0,sizeAttenuation:!1});this.dvrt=new THREE.ParticleSystem(a,b);this.update()};
MM.FFD1Display.prototype.update=function(){this.dvrt.geometry.verticesNeedUpdate=!0;this.dvrt.geometry.vertices=[];for(var a=0,a=0;a<this.ffd.control_points.length;a++)this.dvrt.geometry.vertices.push(this.ffd.control_points[a])};MM.FFD1=function(){THREE.Object3D.call(this);this.type="ffd";this.cd=this.dg=void 0;this.solved=!1;this.coefficients=[]};MM.FFD1.prototype=Object.create(THREE.Object3D.prototype);
MM.FFD1.prototype.updateMatrixWorld=function(a){THREE.Object3D.prototype.updateMatrixWorld.call(this,a);void 0!==this.cd&&this.cd.update();void 0!==this.dg&&!1===this.solved&&0<this.coefficients.length&&(this.calculateNewPoints(),this.solved=!0)};MM.FFD1.prototype.addDisplay=function(){if(void 0===this.cd)return this.cd=new MM.FFD1Display(this),this};MM.FFD1.prototype.setGeometry=function(a){this.dg=a};
MM.FFD1.prototype.initControlPoints=function(){var a,b,c;this.control_points=[];for(c=0;1>=c;c+=1/3)for(b=0;1>=b;b+=1/3)for(a=0;1>=a;a+=1/3)this.control_points.push(new THREE.Vector3(a,b,c))};
MM.FFD1.prototype.createBernsteinCoefficients=function(){var a=[1,3,3,1],b,c,d,e,f,g,h;this.coefficients=[];for(b=0;b<this.dg.vertices.length;b++)for(h=this.dg.vertices[b],e=0;4>e;e++)for(f=a[e]*MM.powf(h.z,e)*MM.powf(1-h.z,3-e),d=0;4>d;d++)for(g=a[d]*MM.powf(h.y,d)*MM.powf(1-h.y,3-d)*f,c=0;4>c;c++)this.coefficients.push(a[c]*MM.powf(h.x,c)*MM.powf(1-h.x,3-c)*g)};MM.FFD1.prototype.moveControlPoint=function(a,b){this.control_points[a].add(b)};
MM.FFD1.prototype.calculateNewPoints=function(){console.log("calculateNewPoints");var a,b,c,d,e=new THREE.Vector3;for(a=0;a<this.dg.vertices.length;a++){e.x=0;e.y=0;for(b=d=e.z=0;64>b;b++,c++,d++)console.log("index:",a,"coof:",c,"ctl:",d),e.x+=this.coefficients[c]*this.control_points[d].x,e.y+=this.coefficients[c]*this.control_points[d].y,e.z+=this.coefficients[c]*this.control_points[d].z;this.dg.vertices[a].x=e.x;this.dg.vertices[a].y=e.y;this.dg.vertices[a].z=e.z;console.log("\t",a,":",e.x,e.y,
e.z)}};MM.SplineCluster=function(){MM.Control.call(this);this.mode=this.splineSolver=this.curve=void 0;this.indices=[];this.bindMatrix=new THREE.Matrix4};MM.SplineCluster.prototype=Object.create(MM.Control.prototype);
MM.SplineCluster.prototype.exportData=function(){var a={};a.name=this.name;a.uuid=this.uuid;a.parent=this.parent.name;a.matrix=this.matrix.toArray();a.bindMatrix=this.bindMatrix.toArray();a.controlColor=this.controlColor.toArray();a.controlSize=this.controlSize;a.controlScale=this.controlScale.toArray();a.controlOffset=this.controlOffset.toArray();a.controlSide=this.controlSide;void 0!==this.controlShape&&(a.controlShape=this.controlShape);this.hasOwnProperty("tag")&&(a.tag=this.tag);return a};
MM.SplineCluster.prototype.importData=function(a,b){console.log("SplineCluster.importData",a);var c=b.scene.getObjectByUuid(a.uuid,!0);for(void 0===c&&console.error("Source object with uuid",a.uuid,"does not exist. This is strange.");0!==c.children.length;)this.add(c.children[0]);this.setChannels(c.getChannels());if(c.hasOwnProperty("animCurves"))for(var d=0;d<c.animCurves.length;d++)this.addAnimCurve(c.animCurves[d]);b.removeObject(c);this.name=a.name;this.uuid=a.uuid;"objectScene"===a.parent?c=
b.scene:(c=b.scene.getObjectByName(a.parent,!0),void 0===c&&console.error("Unable to find",a.parent));c.add(this);a.hasOwnProperty("tag")&&(this.tag=a.tag);this.controlColor.fromArray(a.controlColor);this.controlSize=a.controlSize;this.controlScale.fromArray(a.controlScale);this.controlOffset.fromArray(a.controlOffset);this.controlSide=a.controlSide;(new THREE.Matrix4).fromArray(a.matrix).decompose(this.position,this.quaternion,this.scale);this.bindMatrix.fromArray(a.bindMatrix)};
MM.SplineCluster.prototype.updateMatrixWorld=function(a){MM.Control.prototype.updateMatrixWorld.call(this);this.doSolve()};MM.SplineCluster.prototype.addIndex=function(a){this.indices.push(a)};
MM.SplineCluster.prototype.doSolve=function(){if(void 0!==this.curve){var a=this.indices.length;this.curve.geometry.verticesNeedUpdate=!0;for(var b=0;b<a;b++){var c=this.indices[b],d=this.curve.origPoints[c].clone(),e=new THREE.Matrix4;e.getInverse(this.bindMatrix);var f=new THREE.Matrix4;f.multiplyMatrices(this.matrixWorld,e);d.applyMatrix4(f);this.curve.geometry.vertices[c].copy(d)}void 0!==this.splineSolver&&this.splineSolver instanceof MM.SplineSolver&&this.splineSolver.update()}};
MM.SplineSolver=function(a){this.id=THREE.Object3DIdCount++;this.uuid=THREE.Math.generateUUID();this.editor=a;this.joints=[];this.nurbsControlPoints=[];this.topControl=void 0;this.topControlSize=10;this.topControlScale=new THREE.Vector3(1,1,1);this.bottomControl=void 0;this.bottomControlSize=10;this.bottomControlScale=new THREE.Vector3(1,1,1);this.linearCurve=void 0;this.controlPoints=[];this.skipFirstJoint=this.followBottomControl=!1};MM.SplineSolver.prototype=Object.create(null);
MM.SplineSolver.prototype.importData=function(a){console.log("SplineSolver.importData",a);this.uuid=a.uuid;this.name=a.name;for(var b,c=0;c<a.joints.length;c++)b=this.editor.scene.getObjectByName(a.joints[c],!0),void 0===b&&console.error("Unable to find",a.joints[c]),this.joints.push(b);this.followBottomControl=a.followBottomControl;this.skipFirstJoint=a.skipFirstJoint;for(c=0;c<a.nurbsControlPoints.length;c++)this.nurbsControlPoints.push(new THREE.Vector3(a.nurbsControlPoints[c],a.nurbsControlPoints[c+
1],a.nurbsControlPoints[c+2])),c+=2;console.log("\tnurbsControlPoints:",this.nurbsControlPoints);this.build();this.bottomControl.importData(a.bottomControl,this.editor);this.topControl.importData(a.topControl,this.editor);console.log("\tresult",this)};
MM.SplineSolver.prototype.exportData=function(){var a={type:"SplineSolver"};a.uuid=this.uuid;a.name=this.name;a.joints=[];for(var b=0;b<this.joints.length;b++)a.joints.push(this.joints[b].name);a.nurbsControlPoints=[];for(b=0;b<this.nurbsControlPoints.length;b++)a.nurbsControlPoints.push(this.nurbsControlPoints[b].x),a.nurbsControlPoints.push(this.nurbsControlPoints[b].y),a.nurbsControlPoints.push(this.nurbsControlPoints[b].z);a.topControlScale=this.topControlScale.toArray();a.topControlSize=this.topControlSize;
a.topControl=this.topControl.exportData();a.bottomControlScale=this.bottomControlScale.toArray();a.bottomControlSize=this.bottomControlSize;a.bottomControl=this.bottomControl.exportData();a.followBottomControl=this.followBottomControl;a.skipFirstJoint=this.skipFirstJoint;return a};
MM.SplineSolver.prototype.build=function(){var a=this.joints.length;if(0===this.nurbsControlPoints.length)for(var b=0;b<a;b++)this.nurbsControlPoints.push(this.joints[b].getWorldPosition());for(var c=[],d=0,b=0;1>=b;b++)c.push(0);b=0;for(d=5;b<d;b++)c.push(THREE.Math.clamp((b+1)/(d-1),0,1));c=new THREE.NURBSCurve(1,c,this.nurbsControlPoints);b=new THREE.Geometry;b.vertices=c.controlPoints;c=this.nurbsControlPoints;d=new THREE.LineBasicMaterial({linewidth:2,color:16711935,opacity:.5,transparent:!0});
this.linearCurve=new THREE.Line(b,d);this.linearCurve.origPoints=c;this.linearCurve.name="splineSolverLinearCurve";this.linearCurve.exportType="DO_NOT_EXPORT";this.editor.addObject(this.linearCurve);b=this.joints[a-1].getWorldPosition();this.topControl=new MM.SplineCluster;this.topControl.name="splineSolverTopControlCluster";this.topControl.controlScale=this.topControlScale;this.topControl.controlSize=this.topControlSize;this.topControl.controlShape="cube";this.topControl.mode="T";this.topControl.position.set(b.x,
b.y,b.z);this.editor.addObject(this.topControl);this.topControl.curve=this.linearCurve;this.topControl.indices=[a-1,a-2];this.topControl.bindMatrix=this.topControl.matrixWorld.clone();this.topControl.splineSolver=this;a=this.joints[0].getWorldPosition();this.bottomControl=new MM.SplineCluster;this.bottomControl.name="splineSolverBottomsControlCluster";this.bottomControl.controlSize=this.bottomControlSize;this.bottomControl.controlScale=this.bottomControlScale;this.bottomControl.controlShape="cube";
this.bottomControl.mode="B";this.bottomControl.position.set(a.x,a.y,a.z);this.editor.addObject(this.bottomControl);this.bottomControl.curve=this.linearCurve;this.bottomControl.indices=[0,1];this.bottomControl.bindMatrix=this.bottomControl.matrixWorld.clone();this.bottomControl.splineSolver=this};
MM.SplineSolver.prototype.update=function(){for(var a=[],b=[],c=this.joints.length,d=[],e=0,e=a=0;3>=e;e++)d.push(0);e=0;for(a=c;e<a;e++)d.push(THREE.Math.clamp((e+1)/(a-3),0,1));a=[];b=[];for(e=0;e<c;e++){var f=1/(c-1)*e;a.push(f);f=THREE.NURBSUtils.calcBSplinePoint(3,d,this.linearCurve.geometry.vertices,f);b.push(f)}e=0;!0===this.skipFirstJoint&&(e=1);if(!0===this.followBottomControl&&!1===this.skipFirstJoint&&void 0!==this.joints[0].parent){f=new THREE.Matrix4;f.getInverse(this.joints[0].parent.matrixWorld);
var g=new THREE.Matrix4;g.multiplyMatrices(f,this.bottomControl.matrixWorld);d=new THREE.Matrix4;this.joints[0].position.getPositionFromMatrix(g);d.extractRotation(g);this.joints[0].quaternion.setFromRotationMatrix(d);this.joints[0].updateMatrix();this.joints[0].updateMatrixWorld(!0);e=1}else console.log("following curve");for(d=new THREE.Matrix4;e<c-1;e++){f=new THREE.Quaternion;f.setFromRotationMatrix(this.bottomControl.matrixWorld);g=new THREE.Quaternion;g.setFromRotationMatrix(this.topControl.matrixWorld);
f.slerp(g,a[e]);g=new THREE.Matrix4;g.makeRotationFromQuaternion(f);var h=new THREE.Vector3;h.x=-1*g.elements[4];h.y=-1*g.elements[5];h.z=-1*g.elements[6];h.normalize();var k=new THREE.Vector3(b[e].x,b[e].y,b[e].z);k.sub(b[e+1]);k.normalize();g=k.angleTo(new THREE.Vector3(h.x,h.y,h.z));h=new THREE.Vector3(h.x,h.y,h.z);h.cross(k);h.normalize();k=new THREE.Quaternion;k.setFromAxisAngle(h,g*THREE.Math.rad);k.multiply(f);h=new THREE.Matrix4;h.makeRotationFromQuaternion(k);h.setPosition(b[e]);void 0!==
this.joints[e].parent&&(f=new THREE.Matrix4,f.getInverse(this.joints[e].parent.matrixWorld),g=new THREE.Matrix4,g.multiplyMatrices(f,h),this.joints[e].position.getPositionFromMatrix(g),d.extractRotation(g),this.joints[e].quaternion.setFromRotationMatrix(d),this.joints[e].updateMatrix(),this.joints[e].updateMatrixWorld(!0))}--c;void 0!==this.joints[c].parent&&(f=new THREE.Matrix4,f.getInverse(this.joints[c].parent.matrixWorld),g=new THREE.Matrix4,g.multiplyMatrices(f,this.topControl.matrixWorld),this.joints[c].position.getPositionFromMatrix(g),
d.extractRotation(g),this.joints[c].quaternion.setFromRotationMatrix(d),this.joints[c].updateMatrix(),this.joints[c].updateMatrixWorld(!0))};MM.OneSimpleBoneIkSolver=function(){MM.Control.call(this);this.endJoint=this.startJoint=void 0;this.startPreferedAngle=new THREE.Vector3;this.prevStartMatrix=new THREE.Matrix4;this.prevStartPos=new THREE.Vector3;this.prevHandlePos=new THREE.Vector3};MM.OneSimpleBoneIkSolver.prototype=Object.create(MM.Control.prototype);
MM.OneSimpleBoneIkSolver.prototype.importData=function(a){this.name=a.name;this.uuid=a.uuid;this.controlColor.setRGB(a.controlColor.r,a.controlColor.g,a.controlColor.b);this.controlSize=a.controlSize;this.controlScale.set(a.controlScale.x,a.controlScale.y,a.controlScale.z);this.controlOffset.set(a.controlOffset.x,a.controlOffset.y,a.controlOffset.z);this.controlSide=a.controlSide;a.hasOwnProperty("controlShape")&&(this.controlShape=a.controlShape);a.hasOwnProperty("custom")&&(this.custom=a.custom)};
MM.OneSimpleBoneIkSolver.prototype.exportData=function(){var a={};a.name=this.name;a.uuid=this.uuid;a.type="OneSimpleBoneIkSolver";a.controlColor=this.controlColor;a.controlSize=this.controlSize;a.controlScale=this.controlScale;a.controlOffset=this.controlOffset;a.controlSide=this.controlSide;void 0!==this.controlShape&&(a.controlShape=this.controlShape);this.hasOwnProperty("custom")&&(a.custom=this.custom);return a};
MM.OneSimpleBoneIkSolver.prototype.updateMatrixWorld=function(a){MM.Control.prototype.updateMatrixWorld.call(this);this.doSolve()};MM.OneSimpleBoneIkSolver.prototype.setStartJoint=function(a){this.startJoint=a;this.prevStartMatrix=a.matrixWorld};MM.OneSimpleBoneIkSolver.prototype.updateJoints=function(){this.startJoint.updateMatrix();this.startJoint.updateMatrixWorld(!0);this.endJoint.updateMatrix();this.endJoint.updateMatrixWorld(!0)};
MM.OneSimpleBoneIkSolver.prototype.doSolve=function(){if(void 0!==this.startJoint&&void 0!==this.endJoint){this.updateJoints();var a=this.startJoint.matrixWorld.clone(),b=this.startJoint.getWorldPosition(),c=this.getWorldPosition();if(!this.prevStartMatrix.isEquivalent(a)||!this.prevHandlePos.isEquivalent(c)){this.startJoint.rotation.x=this.startPreferedAngle.x;this.startJoint.rotation.y=this.startPreferedAngle.y;this.startJoint.rotation.z=this.startPreferedAngle.z;this.updateJoints();var a=this.endJoint.getWorldPosition(),
a=this.ikSolve(b,a,c),d=new THREE.Quaternion;d.multiplyQuaternions(a,this.startJoint.quaternion);this.startJoint.setRotationFromQuaternion(d);this.updateJoints();a=this.endJoint.getWorldPosition();a.isEquivalentWithinTolerance(c,.1);a.subVectors(a,c);this.prevStartMatrix=this.startJoint.matrixWorld.clone();this.prevStartPos=b;this.prevHandlePos=c}}};
MM.OneSimpleBoneIkSolver.prototype.ikSolve=function(a,b,c){var d=new THREE.Quaternion(0,0,0,1),e=new THREE.Vector3;e.subVectors(c,a);c=new THREE.Vector3;c.subVectors(b,a);e.length();c.length();a=new THREE.Vector3;a=a.crossVectors(c,e);a.normalize();b=c.length()*e.length();e=e.dot(c)/b;e=Math.min(Math.max(e,-1),1);e=Math.acos(e);d.setFromAxisAngle(a,e*THREE.Math.rad);return d};MM.TwoBoneIkSolver=function(){MM.Control.call(this);this.endJoint=this.middleJoint=this.startJoint=void 0;this.startMatrix=new THREE.Matrix4;this.twist=0;this.handleControl=this.poleVector=void 0;this.customHandlePos=!1;this.handlePos=new THREE.Vector3;this.showEnd=this.showStart=void 0;this.prevStartMatrix=new THREE.Matrix4;this.prevHandlePos=new THREE.Vector3;this.prevPoleVector=new THREE.Vector3};MM.TwoBoneIkSolver.prototype=Object.create(MM.Control.prototype);
MM.TwoBoneIkSolver.prototype.importData=function(a){this.name=a.name;this.uuid=a.uuid;this.twist=a.twist;this.poleVector=new THREE.Vector3(a.poleVector);this.controlColor.setRGB(a.controlColor.r,a.controlColor.g,a.controlColor.b);this.controlSize=a.controlSize;this.controlScale.set(a.controlScale.x,a.controlScale.y,a.controlScale.z);this.controlOffset.set(a.controlOffset.x,a.controlOffset.y,a.controlOffset.z);this.controlSide=a.controlSide;a.hasOwnProperty("controlShape")&&(this.controlShape=a.controlShape);
a.hasOwnProperty("custom")&&(this.custom=a.custom)};MM.TwoBoneIkSolver.prototype.exportData=function(){var a={type:"TwoBoneIkSolver"};a.name=this.name;a.uuid=this.uuid;a.twist=this.twist;a.controlColor=this.controlColor;a.controlSize=this.controlSize;a.controlScale=this.controlScale;a.controlOffset=this.controlOffset;a.controlSide=this.controlSide;void 0!==this.controlShape&&(a.controlShape=this.controlShape);this.hasOwnProperty("custom")&&(a.custom=this.custom);return a};
MM.TwoBoneIkSolver.prototype.exportSetup=function(){var a={type:"TwoBoneIkSolver"};a.name=this.name;a.startMatrix=this.startMatrix.toArray();a.startJoint=this.startJoint.name;a.middleJoint=this.middleJoint.name;a.endJoint=this.endJoint.name;a.poleVector=this.poleVector.name;void 0!==this.handleControl&&(a.handleControl=this.handleControl.name);return a};
MM.TwoBoneIkSolver.prototype.importSetup=function(a,b){console.log("TwoBoneIkSolver.importSetup",b);this.poleVector=a.getObjectByName(b.poleVector,!0);this.setStartJoint(a.getObjectByName(b.startJoint,!0));this.startMatrix.fromArray(b.startMatrix);this.middleJoint=a.getObjectByName(b.middleJoint,!0);this.endJoint=a.getObjectByName(b.endJoint,!0);b.hasOwnProperty("handleControl")&&(this.handleControl=a.getObjectByName(b.handleControl,!0))};
MM.TwoBoneIkSolver.prototype.updateMatrixWorld=function(a){THREE.Object3D.prototype.updateMatrixWorld.call(this);this.doSolve(a);if(void 0!==this.handleControl&&void 0!==this.endJoint.parent){a=new THREE.Matrix4;a.getInverse(this.endJoint.parent.matrixWorld);var b=new THREE.Matrix4;b.multiplyMatrices(a,this.handleControl.matrixWorld);this.endJoint.setRotationFromMatrix(b);this.endJoint.updateMatrix()}};
MM.TwoBoneIkSolver.prototype.setStartJoint=function(a){this.startJoint=a;this.startMatrix.extractRotation(a.matrixWorld);this.prevStartMatrix=a.matrixWorld};MM.TwoBoneIkSolver.prototype.setMidJoint=function(a){this.middleJoint=a};MM.TwoBoneIkSolver.prototype.setEndJoint=function(a){this.endJoint=a};
MM.TwoBoneIkSolver.prototype.updateJoints=function(){this.startJoint.updateMatrix();this.startJoint.updateMatrixWorld(!0);this.middleJoint.updateMatrix();this.middleJoint.updateMatrixWorld(!0);this.endJoint.updateMatrix();this.endJoint.updateMatrixWorld(!0)};
MM.TwoBoneIkSolver.prototype.doSolve=function(a){void 0===a&&(a=!1);if(void 0!==this.startJoint&&void 0!==this.middleJoint&&void 0!==this.endJoint){this.updateJoints();var b=new THREE.Vector3(0,0,-10);void 0!==this.poleVector&&(b=(new THREE.Vector3).subVectors(this.poleVector.getWorldPosition(),this.startJoint.getWorldPosition()));var c=this.startJoint.matrixWorld.clone();!1===this.customHandlePos&&(this.handlePos=this.getWorldPosition());if(!(this.prevStartMatrix.isEquivalent(c)&&this.prevHandlePos.isEquivalent(this.handlePos)&&
this.prevPoleVector.isEquivalent(b))||a){this.prevStartMatrix.isEquivalent(c);this.prevHandlePos.isEquivalent(this.handlePos);this.prevPoleVector.isEquivalent(b);this.startJoint.parent instanceof MM.Joint?(a=new THREE.Matrix4,a.getInverse(this.startJoint.parent.matrixWorld),c=new THREE.Matrix4,c.multiplyMatrices(this.startMatrix,a),this.startJoint.setRotationFromMatrix(c)):this.startJoint.setRotationFromMatrix(this.startMatrix);a=this.middleJoint.getPreferedAngle();this.middleJoint.rotation.set(a.x,
a.y,a.z,"XYZ");this.updateJoints();a=this.startJoint.getWorldPosition();var c=this.middleJoint.getWorldPosition(),d=this.endJoint.getWorldPosition();void 0!==this.showStart&&this.showStart.position.set(a.x,a.y,a.z);void 0!==this.showEnd&&this.showEnd.position.set(d.x,d.y,d.z);a=this.ikSolve(a,c,d,this.handlePos,b,this.twist);c=new THREE.Quaternion;(new THREE.Quaternion).setFromRotationMatrix(this.startJoint.matrixWorld);c.multiplyQuaternions(this.startJoint.quaternion,a[0]);this.startJoint.setRotationFromQuaternion(c);
c=new THREE.Quaternion;d=(new THREE.Quaternion).setFromRotationMatrix(this.middleJoint.matrixWorld);c.multiplyQuaternions(a[1],d);this.middleJoint.setRotationFromQuaternion(c);this.updateJoints();a=this.endJoint.getWorldPosition();a.isEquivalentWithinTolerance(this.handlePos,.001);a.subVectors(a,this.handlePos);this.prevStartMatrix=this.startJoint.matrixWorld.clone();this.prevHandlePos=this.handlePos;this.prevPoleVector=b}}};
MM.TwoBoneIkSolver.prototype.ikSolve=function(a,b,c,d,e,f){f=new THREE.Quaternion(0,0,0,1);var g=new THREE.Quaternion(0,0,0,1),h=new THREE.Vector3,g=new THREE.Vector3,k=(new THREE.Vector3).subVectors(b,a);b=(new THREE.Vector3).subVectors(c,b);d=(new THREE.Vector3).subVectors(d,a);var l=(new THREE.Vector3).subVectors(c,a),m=k.length(),n=b.length();a=d.length();a*=a;h.copy(l);h.multiplyScalar(k.dot(l)/l.dot(l));var r=(new THREE.Vector3).subVectors(k,h);c=k.angleTo(b);var q=(new THREE.Vector3).crossVectors(k,
b),m=(a-m*m-n*n)/(2*m*n);1<m?m=1:-1>m&&(m=-1);m=Math.acos(m);h.copy(q);h.normalize();c=(new THREE.Quaternion).setFromAxisAngle(h,(m-c)*THREE.Math.rad);b.applyQuaternion(c);l.addVectors(k,b);h.copy(l);h.normalize();g.copy(d);g.normalize();b=(new THREE.Quaternion).setFromVectors(h,g);k.applyQuaternion(b);k.isParalell(d)&&(k=r.applyQuaternion(b));l=new THREE.Quaternion;e.isParalell(d)||0==a||(h.copy(d),h.multiplyScalar(k.dot(d)/a),h=(new THREE.Vector3).subVectors(k,h),g.copy(d),g.multiplyScalar(e.dot(d)/
a),e=(new THREE.Vector3).subVectors(e,g),g=h.dot(e)/h.length()*e.length(),1E-5>Math.abs(g+1)?(e=new THREE.Quaternion,e.setFromAxisAngle(d,THREEkPi*THREErad),e.normalize(),l=e):(d=new THREE.Quaternion,g=new THREE.Vector3,g.copy(h),g.normalize(),h=new THREE.Vector3,h.copy(e),h.normalize(),d.setFromVectors(g,h),d.normalize(),l=d));g=c;f.multiplyQuaternions(l,b);return[f,g]};MM.TwoBoneSoftIkSolver=function(){MM.TwoBoneIkSolver.call(this);this.initB=this.initA=1;this.softControl=this.inputMatrix_CTL=this.inputMatrix_ROOT=void 0;this.stretchAxis="y"};MM.TwoBoneSoftIkSolver.prototype=Object.create(MM.TwoBoneIkSolver.prototype);MM.TwoBoneSoftIkSolver.prototype.exportData=function(){var a=MM.TwoBoneIkSolver.prototype.exportData.call(this);a.type="TwoBoneSoftIkSolver";return a};
MM.TwoBoneSoftIkSolver.prototype.importSetup=function(a,b){console.log("TwoBoneSoftIkSolver.importSetup",b);MM.TwoBoneIkSolver.prototype.importSetup.call(this,a,b);this.initA=b.initA;this.initB=b.initB;this.inputMatrix_CTL=this.matrixWorld;this.inputMatrix_ROOT=this.startJoint.matrixWorld;this.softControl=a.getObjectByName(b.softControl,!0);this.stretchAxis=b.stretchAxis};
MM.TwoBoneSoftIkSolver.prototype.exportSetup=function(){console.log("TwoBoneSoftIkSolver.exportSetup",this.name);var a=MM.TwoBoneIkSolver.prototype.exportSetup.call(this);a.type="TwoBoneSoftIkSolver";a.initA=this.initA;a.initB=this.initB;a.softControl=this.softControl.name;a.stretchAxis=this.stretchAxis;return a};
MM.TwoBoneSoftIkSolver.prototype.setSoftControl=function(a){this.softControl=a;this.softControl.addChannel("custom","useSoft",[],"boolean");this.softControl.addChannel("custom","globalScale",[.1,2]);this.softControl.addChannel("custom","scaleBone1",[.01,5]);this.softControl.addChannel("custom","scaleBone2",[.01,5]);this.softControl.addChannel("custom","stretch",[.01,5]);this.softControl.addChannel("custom","soft",[0,1]);this.softControl.addChannel("custom","slide",[0,1]);this.softControl.hasOwnProperty("custom")||
(this.softControl.custom={});_.extend(this.softControl.custom,{useSoft:!0,globalScale:1,scaleBone1:1,scaleBone2:1,stretch:1,soft:0,slide:.5})};MM.TwoBoneSoftIkSolver.prototype.setSoftIk=function(){this.inputMatrix_CTL=this.matrixWorld;this.inputMatrix_ROOT=this.startJoint.matrixWorld;this.initA=this.middleJoint.position[this.stretchAxis];this.initB=this.endJoint.position[this.stretchAxis]};
MM.TwoBoneSoftIkSolver.prototype.solveSoftIk=function(){if(void 0===this.inputMatrix_ROOT)console.log("TwoBoneSoftIkSolver: no root matrix defined.");else if(void 0===this.inputMatrix_CTL)console.log("TwoBoneSoftIkSolver: no handle matrix defined.");else if(void 0===this.softControl)console.log("TwoBoneSoftIkSolver: no control defined.");else{this.globalScale=this.softControl.custom.globalScale;this.stretch=this.softControl.custom.stretch;this.soft=this.softControl.custom.soft;this.slide=this.softControl.custom.slide;
this.scaleJnt1=this.softControl.custom.scaleBone1;this.scaleJnt2=this.softControl.custom.scaleBone2;var a=(new THREE.Vector3).getPositionFromMatrix(this.inputMatrix_ROOT),b=(new THREE.Vector3).getPositionFromMatrix(this.inputMatrix_CTL),c=(this.slide+.5)*this.scaleJnt1,d=(1-this.slide+.5)*this.scaleJnt2,e=Math.abs((this.initA*c+this.initB*d)*this.globalScale),f=(new THREE.Vector3).subVectors(a,b),g=Math.abs(f.length()),h=this.soft*(Math.abs(this.initA+this.initB)/20)*this.globalScale,k=e-h;0<g-(e-
h)?(f.multiplyScalar(1/g),g=h*(1-Math.exp(-1*(g-k)/h))+k,f.multiplyScalar(g),f=(new THREE.Vector3).addVectors(f,a),f=f.multiplyScalar(1-this.stretch),b=b.multiplyScalar(this.stretch),f=(new THREE.Vector3).addVectors(f,b)):f=b;a=(new THREE.Vector3).subVectors(a,f).length();h*=this.stretch;e-=h;b=1;a>e&&0<this.stretch?(e=h*(1-Math.exp(-1*(a-e)/h))+e,b=a/e):b=1;this.middleJoint.position[this.stretchAxis]=b*c*this.initA;this.endJoint.position[this.stretchAxis]=b*d*this.initB;this.handlePos=f}};
MM.TwoBoneSoftIkSolver.prototype.updateMatrixWorld=function(a){this.customHandlePos=!1;void 0!==this.softControl&&this.softControl.custom.useSoft&&(this.customHandlePos=!0,this.solveSoftIk());MM.TwoBoneIkSolver.prototype.updateMatrixWorld.call(this,a)};MM.TwoBoneIkBlendSolver=function(){MM.TwoBoneSoftIkSolver.call(this);this.ikFkBlendChannel=this.ikFkBlendGroup=this.customCtrl=void 0;this.doBlend=!0;this.endFkCtrl=this.middleFkCtrl=this.startFkCtrl=void 0};MM.TwoBoneIkBlendSolver.prototype=Object.create(MM.TwoBoneSoftIkSolver.prototype);MM.TwoBoneIkBlendSolver.prototype.exportData=function(){var a=MM.TwoBoneSoftIkSolver.prototype.exportData.call(this);a.type="TwoBoneIkBlendSolver";return a};
MM.TwoBoneIkBlendSolver.prototype.importSetup=function(a,b){console.log("TwoBoneIkBlendSolver.importSetup",this.name);console.log("\tdata",b);MM.TwoBoneSoftIkSolver.prototype.importSetup.call(this,a,b);this.startFkCtrl=a.getObjectByName(b.startFkCtrl,!0);this.middleFkCtrl=a.getObjectByName(b.middleFkCtrl,!0);this.endFkCtrl=a.getObjectByName(b.endFkCtrl,!0);this.customCtrl=a.getObjectByName(b.customCtrl,!0);this.ikFkBlendGroup=b.ikFkBlendGroup;this.ikFkBlendChannel=b.ikFkBlendChannel};
MM.TwoBoneIkBlendSolver.prototype.exportSetup=function(){console.log("TwoBoneIkBlendSolver.exportSetup",this.name);var a=MM.TwoBoneSoftIkSolver.prototype.exportSetup.call(this);a.type="TwoBoneIkBlendSolver";a.startFkCtrl=this.startFkCtrl.name;a.middleFkCtrl=this.middleFkCtrl.name;a.endFkCtrl=this.endFkCtrl.name;a.customCtrl=this.customCtrl.name;a.ikFkBlendGroup=this.ikFkBlendGroup;a.ikFkBlendChannel=this.ikFkBlendChannel;return a};
MM.TwoBoneIkBlendSolver.prototype.setBlendControl=function(a){this.customCtrl=a;this.customCtrl.addChannel("custom","ikFkBlend",[0,1]);this.customCtrl.hasOwnProperty("custom")||(this.customCtrl.custom={});_.extend(this.customCtrl.custom,{ikFkBlend:0})};
MM.TwoBoneIkBlendSolver.prototype.solveSoftIk=function(){MM.TwoBoneSoftIkSolver.prototype.solveSoftIk.call(this);void 0!==this.middleFkCtrl&&void 0!==this.endFkCtrl&&(this.middleFkCtrl.parent.position[this.stretchAxis]=this.middleJoint.position[this.stretchAxis],this.endFkCtrl.parent.position[this.stretchAxis]=this.endJoint.position[this.stretchAxis])};
MM.TwoBoneIkBlendSolver.prototype.updateMatrixWorld=function(a){MM.TwoBoneSoftIkSolver.prototype.updateMatrixWorld.call(this,a);void 0!==this.customCtrl&&void 0!==this.ikFkBlendGroup&&void 0!==this.ikFkBlendChannel&&!0===this.doBlend&&void 0!==this.handleControl&&(a=this.customCtrl[this.ikFkBlendGroup][this.ikFkBlendChannel],0>a&&(a=0),1<a&&(a=1),this.startJoint.quaternion.slerp(this.startFkCtrl.quaternion,a),this.middleJoint.quaternion.slerp(this.middleFkCtrl.quaternion,a),this.endJoint.quaternion.slerp(this.endFkCtrl.quaternion,
a),this.updateJoints(),0===a?(this.startFkCtrl.hide(),this.middleFkCtrl.hide(),this.endFkCtrl.hide(),this.poleVector.show(),this.handleControl.show()):1===a?(this.startFkCtrl.show(),this.middleFkCtrl.show(),this.endFkCtrl.show(),this.poleVector.hide(),this.handleControl.hide()):(this.startFkCtrl.show(),this.middleFkCtrl.show(),this.endFkCtrl.show(),this.poleVector.show(),this.handleControl.show()))};MM.FourBoneIkBlendSolver=function(){MM.TwoBoneIkBlendSolver.call(this);this.ballJointRotationOffset=this.toeRotateChannel=this.heelChannel=this.ballChannel=this.toeChannel=this.ankleObject=this.heelObject=this.ballObject=this.toeObject=this.ballFkCtl=this.toeJoint=this.ballJoint=this.heelJoint=void 0};MM.FourBoneIkBlendSolver.prototype=Object.create(MM.TwoBoneIkBlendSolver.prototype);
MM.FourBoneIkBlendSolver.prototype.exportData=function(){var a=MM.TwoBoneIkBlendSolver.prototype.exportData.call(this);a.type="FourBoneIkBlendSolver";return a};
MM.FourBoneIkBlendSolver.prototype.importSetup=function(a,b){console.log("FourBoneIkBlendSolver.importSetup",this.name);console.log("\tdata",b);MM.TwoBoneIkBlendSolver.prototype.importSetup.call(this,a,b);this.heelJoint=a.getObjectByName(b.heelJoint,!0);this.ballJoint=a.getObjectByName(b.ballJoint,!0);this.toeJoint=a.getObjectByName(b.toeJoint,!0);this.ballFkCtl=a.getObjectByName(b.ballFkCtl,!0);this.toeObject=a.getObjectByName(b.toeObject,!0);this.ballObject=a.getObjectByName(b.ballObject,!0);this.heelObject=
a.getObjectByName(b.heelObject,!0);this.ankleObject=a.getObjectByName(b.ankleObject,!0);this.toeChannel=b.toeChannel;this.ballChannel=b.ballChannel;this.heelChannel=b.heelChannel;this.toeRotateChannel=b.toeRotateChannel;this.ballJointRotationOffset=(new THREE.Matrix4).fromArray(b.ballJointRotationOffset)};
MM.FourBoneIkBlendSolver.prototype.exportSetup=function(){console.log("FourBoneIkBlendSolver.exportSetup",this.name);var a=MM.TwoBoneIkBlendSolver.prototype.exportSetup.call(this);a.type="FourBoneIkBlendSolver";a.heelJoint=this.heelJoint.name;a.ballJoint=this.ballJoint.name;a.toeJoint=this.toeJoint.name;a.ballFkCtl=this.ballFkCtl.name;a.toeObject=this.toeObject.name;a.ballObject=this.ballObject.name;a.heelObject=this.heelObject.name;a.ankleObject=this.ankleObject.name;a.toeChannel=this.toeChannel;
a.ballChannel=this.ballChannel;a.heelChannel=this.heelChannel;a.toeRotateChannel=this.toeRotateChannel;a.ballJointRotationOffset=this.ballJointRotationOffset.toArray();return a};
MM.FourBoneIkBlendSolver.prototype.updateMatrixWorld=function(a){void 0!==this.handleControl&&(this.toeObject.rotation.x=this.handleControl.custom[this.toeChannel],this.ballObject.rotation.x=this.handleControl.custom[this.ballChannel],this.heelObject.rotation.x=this.handleControl.custom[this.heelChannel]);this.doBlend=!1;MM.TwoBoneIkBlendSolver.prototype.updateMatrixWorld.call(this,a);var b,c;void 0!==this.ballObject&&(b=this.ballObject.getWorldUp(),b.multiplyScalar(5),c=this.ballObject.getWorldSide(),
c.multiplyScalar(5));if(void 0!==this.ballObject&&void 0!==this.endJoint.parent){this.endJoint.matrix=new THREE.Matrix4;this.endJoint.updateMatrix();a=this.ballObject.getWorldPosition();var d=this.endJoint.getWorldPosition(),e=new THREE.Matrix4;e.setPosition(new THREE.Vector3(d.x,d.y,d.z));e.lookAt(a,d,b,c);c=(new THREE.Matrix4).getInverse(this.endJoint.parent.matrixWorld);c=(new THREE.Matrix4).multiplyMatrices(c,e);c.unify();this.updateJoints();void 0===this.aimAnkleOffset?(c=(new THREE.Matrix4).getInverse(c),
this.aimAnkleOffset=(new THREE.Matrix4).multiplyMatrices(c,this.endJoint.matrixWorld)):(c=(new THREE.Matrix4).multiplyMatrices(c,this.aimAnkleOffset),this.endJoint.rotation.setFromRotationMatrix(c));this.updateJoints()}void 0!==this.toeObject&&void 0!==this.ballJoint.parent&&(a=this.toeObject.getWorldPosition(),d=this.ballJoint.getWorldPosition(),c=(new THREE.Matrix4).copy(this.ballJoint.matrixWorld),c.lookAt(a,d,b),void 0===this.ballJointRotationOffset?this.ballJointRotationOffset=(new THREE.Matrix4).getInverse(c):
(b=(new THREE.Matrix4).copy(c),c=(new THREE.Matrix4).multiplyMatrices(b,this.ballJointRotationOffset)),b=(new THREE.Matrix4).getInverse(this.ballJoint.parent.matrixWorld),b=(new THREE.Matrix4).multiplyMatrices(b,c),this.ballJoint.rotation.setFromRotationMatrix(b),this.ballJoint.rotateX(this.handleControl.custom[this.toeRotateChannel]),this.updateJoints());void 0!==this.customCtrl&&void 0!==this.ikFkBlendGroup&&void 0!==this.ikFkBlendChannel&&(b=this.customCtrl[this.ikFkBlendGroup][this.ikFkBlendChannel],
0>b&&(b=0),1<b&&(b=1),this.startJoint.quaternion.slerp(this.startFkCtrl.quaternion,b),this.middleJoint.quaternion.slerp(this.middleFkCtrl.quaternion,b),this.endJoint.quaternion.slerp(this.endFkCtrl.quaternion,b),this.ballJoint.quaternion.slerp(this.ballFkCtl.quaternion,b),0===b?(this.startFkCtrl.hide(),this.middleFkCtrl.hide(),this.endFkCtrl.hide(),this.ballFkCtl.hide(),this.poleVector.show(),this.handleControl.show()):1===b?(this.startFkCtrl.show(),this.middleFkCtrl.show(),this.endFkCtrl.show(),
this.ballFkCtl.show(),this.poleVector.hide(),this.handleControl.hide()):(this.startFkCtrl.show(),this.middleFkCtrl.show(),this.endFkCtrl.show(),this.ballFkCtl.show(),this.poleVector.show(),this.handleControl.show()),this.updateJoints())};MM.TwoStepFourBoneIkBlendSolver=function(){MM.TwoBoneIkBlendSolver.call(this);this.toeRotateChannel=this.heelChannel=this.ballChannel=this.toeChannel=this.heelObject=this.ball1Object=this.ball0Object=this.toeObject=this.ball1FkCtl=this.ball0FkCtl=this.toeJoint=this.ball1Joint=this.ball0Joint=this.heelJoint=void 0;this.ball1EndValue=this.ball0EndValue=20};MM.TwoStepFourBoneIkBlendSolver.prototype=Object.create(MM.TwoBoneIkBlendSolver.prototype);
MM.TwoStepFourBoneIkBlendSolver.prototype.exportData=function(){var a=MM.TwoBoneIkBlendSolver.prototype.exportData.call(this);a.type="TwoStepFourBoneIkBlendSolver";return a};
MM.TwoStepFourBoneIkBlendSolver.prototype.updateMatrixWorld=function(a){if(void 0!==this.handleControl){this.toeObject.rotation.x=this.handleControl.custom[this.toeChannel];var b=this.handleControl.custom[this.ballChannel];this.ball0EndValue>b?(this.ball0Object.rotation.x=b,this.ball1Object.rotation.x=0):(this.ball0Object.rotation.x=this.ball0EndValue,this.ball1Object.rotation.x=b-this.ball0EndValue);this.heelObject.rotation.x=this.handleControl.custom[this.heelChannel]}this.doBlend=!1;MM.TwoBoneIkBlendSolver.prototype.updateMatrixWorld.call(this,
a);var c,d;void 0!==this.ball0Object&&(c=this.ball0Object.getWorldUp(),c.multiplyScalar(5),d=this.ball0Object.getWorldSide(),d.multiplyScalar(5));if(void 0!==this.ball0Object&&void 0!==this.endJoint.parent){this.endJoint.matrix=new THREE.Matrix4;this.endJoint.updateMatrix();a=this.ball0Object.getWorldPosition();var b=this.endJoint.getWorldPosition(),e=new THREE.Matrix4;e.setPosition(new THREE.Vector3(b.x,b.y,b.z));e.lookAt(a,b,c,d);d=(new THREE.Matrix4).getInverse(this.endJoint.parent.matrixWorld);
d=(new THREE.Matrix4).multiplyMatrices(d,e);d.unify();this.updateJoints();void 0===this.aimAnkleOffset?(d=(new THREE.Matrix4).getInverse(d),this.aimAnkleOffset=(new THREE.Matrix4).multiplyMatrices(d,this.endJoint.matrixWorld)):(d=(new THREE.Matrix4).multiplyMatrices(d,this.aimAnkleOffset),this.endJoint.rotation.setFromRotationMatrix(d));this.updateJoints()}void 0!==this.ball1Object&&void 0!==this.ball0Joint.parent&&(a=this.ball1Object.getWorldPosition(),b=this.ball0Joint.getWorldPosition(),d=(new THREE.Matrix4).copy(this.ball0Joint.matrixWorld),
d.lookAt(a,b,c),a=(new THREE.Matrix4).getInverse(this.ball0Joint.parent.matrixWorld),d=(new THREE.Matrix4).multiplyMatrices(a,d),this.ball0Joint.rotation.setFromRotationMatrix(d),this.updateJoints());void 0!==this.toeObject&&void 0!==this.ball1Joint.parent&&(a=this.toeObject.getWorldPosition(),b=this.ball1Joint.getWorldPosition(),d=(new THREE.Matrix4).copy(this.ball1Joint.matrixWorld),d.lookAt(a,b,c),a=(new THREE.Matrix4).getInverse(this.ball1Joint.parent.matrixWorld),d=(new THREE.Matrix4).multiplyMatrices(a,
d),this.ball1Joint.rotation.setFromRotationMatrix(d),this.ball1Joint.rotateX(this.handleControl.custom[this.toeRotateChannel]),this.updateJoints());void 0!==this.customCtrl&&void 0!==this.ikFkBlendGroup&&void 0!==this.ikFkBlendChannel&&(c=this.customCtrl[this.ikFkBlendGroup][this.ikFkBlendChannel],0>c&&(c=0),1<c&&(c=1),this.startJoint.quaternion.slerp(this.startFkCtrl.quaternion,c),this.middleJoint.quaternion.slerp(this.middleFkCtrl.quaternion,c),this.endJoint.quaternion.slerp(this.endFkCtrl.quaternion,
c),this.ball0Joint.quaternion.slerp(this.ball0FkCtl.quaternion,c),this.ball1Joint.quaternion.slerp(this.ball1FkCtl.quaternion,c),0===c?(this.startFkCtrl.hide(),this.middleFkCtrl.hide(),this.endFkCtrl.hide(),this.ball0FkCtl.hide(),this.ball1FkCtl.hide(),this.poleVector.show(),this.handleControl.show()):1===c?(this.startFkCtrl.show(),this.middleFkCtrl.show(),this.endFkCtrl.show(),this.ball0FkCtl.show(),this.ball1FkCtl.show(),this.poleVector.hide(),this.handleControl.hide()):(this.startFkCtrl.show(),
this.middleFkCtrl.show(),this.endFkCtrl.show(),this.ball0FkCtl.show(),this.ball1FkCtl.show(),this.poleVector.show(),this.handleControl.show()),this.updateJoints())};MM.Asset=function(){this.namespace=this.name="";this.controls=[];this.models=[];this.skeleton=[];return this};
MM.Asset.prototype={getAbsoluteName:function(){return this.namespace+this.name},getName:function(){return this.name},getNamespace:function(){var a=this.namespace;":"==a.substring(a.length-1)&&(a=a.substring(0,a.length-1));return a},getControlNames:function(){var a,b,c=[];a=0;for(b=this.controls.length;a<b;a++)c.push(this.controls[a].name);return c},addControls:function(a){this.controls=MM.extendArrayWithArray(this.controls,a);return this},exportData:function(){console.log("assetObject: exportData");
console.log("\tname",this.name);var a,b,c={};c.name=this.name;c.namespace=this.namespace;c.controls=[];a=0;for(b=this.controls.length;a<b;a++)c.controls.push(this.controls[a].name);c.models=[];a=0;for(b=this.models.length;a<b;a++)c.models.push(this.models[a].name);c.skeleton=[];a=0;for(b=this.skeleton.length;a<b;a++)c.skeleton.push(this.skeleton[a].name);return c},importData:function(a,b){var c,d;this.name=a.name;this.namespace=a.namespace;var e;c=0;for(d=a.controls.length;c<d;c++)e=b.getObjectByName(a.controls[c],
!0),void 0!==e?this.controls.push(e):console.log("\tUnable to find",a.controls[c]);c=0;for(d=a.models.length;c<d;c++)e=b.getObjectByName(a.models[c],!0),void 0!==e?this.models.push(e):console.log("\tUnable to find",a.models[c]);c=0;for(d=a.skeleton.length;c<d;c++)e=b.getObjectByName(a.skeleton[c],!0),void 0!==e?this.skeleton.push(e):console.log("\tUnable to find",a.skeleton[c])}};MM.Build=function(a){this.tasks=[];return this};
MM.Build.prototype={addDataProcess:function(a){console.log("Build: addDataProcess");var b=new MM.BuildProcess;b.dataToLoad=a.filename;a.hasOwnProperty("onLoaded")&&(console.log("\tsetting onLoaded function"),b.onLoaded=a.onLoaded);a.hasOwnProperty("onFinished")&&(console.log("\tsetting onFinished function"),b.onFinished=a.onFinished);0!==this.tasks.length&&(this.tasks[this.tasks.length-1].nextProcess=b);this.tasks.push(b)},run:function(){console.log("Build: run");this.tasks[0].run()}};MM.AssetBuild=function(a){this._build=new MM.Build;this._editor=a;this.fTasks=this.nTasks=0;this.assetName=void 0;this.modelFiles=[];this.weightFiles=[];this.skeletonPostFunction=this.skeletonFile=void 0;this.textureFiles=[];this.textureModel=[];this.rigComponents=[];this.rigComponentsName=[];this.assetGroup=this.namespace=this.lastFunction=this.shapeFile=void 0;this.models=[];this.joints=[];this.controls=[];this.progressTxt=this.progressBar=this.win=this.assetObject=void 0;return this};
MM.AssetBuild.prototype={setNamespace:function(a){this.namespace=this._editor.scene.getUniqueNamespace(a);this.assetGroup=this._editor.addGroup(this.namespace,"asset");this.materialGroup=this._editor.addGroup(this.namespace,"material")},addControls:function(a){this.controls=MM.extendArrayWithArray(this.controls,a)},getControl:function(a){var b,c;b=0;for(c=this.controls.length;b<c;b++)if(this.controls[b].name===this.namespace+a)return this.controls[b]},addModel:function(a){this.modelFiles.push(a);
this.nTasks+=1},loadModel:function(a){console.log("loading model");var b=this,c=this.modelFiles[a].replace(/^.*[\\\/]/,"").split(".")[0];this._build.addDataProcess({filename:this.modelFiles[a],onLoaded:function(a){a=(new THREE.OBJLoader).parse(a);a.children[0].scale=new THREE.Vector3(10,10,10);a.children[0].name=void 0===b.namespace?c:b.namespace+c;MM.freezeTransformations(a.children[0]);a.traverse(function(a){a instanceof THREE.Mesh&&(a.material.color=new THREE.Color(12632256))});a.children[0].castShadow=
!0;b.models.push(a.children[0]);a.children[0].setChannelsEmpty();a.children[0].addChannel("custom","visibility");a.children[0].custom={visibility:!0};a.children[0].asset=b.assetName;b._editor.addObject(a.children[0]);a.children=[];b.updateProgress()}})},addSkin:function(a){this.weightFiles.push(a);this.nTasks+=1},loadSkin:function(a){console.log("loading skin",this.weightFiles[a]);var b=this;this._build.addDataProcess({filename:this.weightFiles[a],onLoaded:function(a){a=JSON.parse(a);a=MM.weightsConvert(a,
b._editor,b.namespace);b._editor.addGroupContent(b.materialGroup,[a]);b.models.push(a);a.addChannel("custom","visibility");a.custom={visibility:!0};b.updateProgress()}})},addSkeleton:function(a){this.skeletonFile=a;this.nTasks+=1},addSkeletonPostFunction:function(a){this.skeletonPostFunction=a},loadSkeleton:function(){console.log("loading skeleton");var a=this;this._build.addDataProcess({filename:this.skeletonFile,onLoaded:function(b){b=JSON.parse(b);a.joints=MM.jointsConvert(b,a._editor,a.namespace,
a.asset);a.updateProgress()},onFinished:this.skeletonPostFunction})},addTexture:function(a,b){this.textureModel.push(a);this.textureFiles.push(b);this.nTasks+=1},loadTexture:function(a){console.log("loading texture",this.textureFiles[a],"on",this.textureModel[a]);var b=this,c=b.textureFiles[a],d=b.textureModel[a];this._build.addDataProcess({onFinished:function(){console.log("loading texture",c,"on",d);var a=THREE.ImageUtils.loadTexture(c),f=b._editor.scene.getObjectByName(d);void 0!==f?(console.log("assigning texture to",
f.name),console.log(f),f.geometry.buffersNeedUpdate=!0,f.geometry.uvsNeedUpdate=!0,f.material.map=a,f.material.needsUpdate=!0):console.log("unable to find",d);b.updateProgress()}})},addRigComponent:function(a,b){this.rigComponents.push(a);this.rigComponentsName.push(b);this.nTasks+=1},getRigComponent:function(a){a=this.rigComponentsName.indexOf(a);if(-1!==a)return this.rigComponents[a]},buildRigComponent:function(a){var b=this.rigComponents[a];b.editor=this._editor;var c=this;this._build.addDataProcess({onFinished:function(){void 0!==
c.namespace&&(b.namespace=c.namespace);void 0!==c.assetGroup&&(b.assetGroup=c.assetGroup);var a=b.build();c.addControls(MM.getDictionaryAsArray(a.controls));c.updateProgress()}})},addShape:function(a){this.shapeFile=a;this.nTasks+=1},loadShape:function(){var a=this;this._build.addDataProcess({filename:this.shapeFile,onLoaded:function(b){console.log("setupShapes");b=JSON.parse(b);MM.shapeConvert(b,a._editor);a.updateProgress()}})},addLast:function(a){var b=this;this.lastFunction=function(){a();b.updateProgress();
var c=new MM.Asset;c.name=b.assetName;c.namespace=b.namespace;c.assetGroup=b.assetGroup;c.models=b.models;c.controls=b.controls;c.joints=b.joints;b.assetObject=c;b._editor.addAssetObject(c)};this.nTasks+=1},loadLast:function(){this._build.addDataProcess({onFinished:this.lastFunction})},addPost:function(a){this.postFunction=a},loadPost:function(){this._build.addDataProcess({onFinished:this.postFunction})},build:function(){console.log("build me the asset");var a,b;a=0;for(b=this.modelFiles.length;a<
b;a++)this.loadModel(a);this.loadSkeleton();a=0;for(b=this.weightFiles.length;a<b;a++)this.loadSkin(a);a=0;for(b=this.textureFiles.length;a<b;a++)this.loadTexture(a);a=0;for(b=this.rigComponents.length;a<b;a++)this.buildRigComponent(a);this.loadShape();this.loadLast();this.loadPost();this._build.run()},showProgress:function(){var a=document.createElement("div");a.className="asset-progress";document.body.appendChild(a);this.win=a;var b=new MMUI.Text("Loading Asset");a.appendChild(b.dom);b=new MMUI.Panel;
b.dom.className="asset-progress-content";b.dom.style.backgroundColor="#B3B3B3";a.appendChild(b.dom);this.progressBar=new MMUI.Panel;this.progressBar.dom.className="asset-progress-bar";b.add(this.progressBar);this.progressTxt=new MMUI.Text("0/"+this.nTasks);this.progressTxt.className="asset-progress-text";this.progressBar.add(this.progressTxt)},updateProgress:function(){this.fTasks+=1;if(void 0!==this.progressTxt){var a=1/this.nTasks,a=244*a*this.fTasks;this.progressTxt.setValue(this.fTasks+"/"+this.nTasks);
this.progressBar.dom.style.width=a+"px";this.fTasks===this.nTasks&&document.body.removeChild(this.win)}}};MM.BuildProcess=function(){this.nextProcess=this.onFinished=this.onLoaded=this.dataToLoad=void 0;return this};
MM.BuildProcess.prototype={run:function(){var a=this;if(void 0===this.dataToLoad){if(void 0!==a.onFinished)a.onFinished();void 0!==a.nextProcess&&a.nextProcess.run()}else{var b;window.XMLHttpRequest?b=new XMLHttpRequest:window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLHTTP"));b.onreadystatechange=function(){if(4==b.readyState){if(void 0!==a.onLoaded)a.onLoaded(b.responseText);if(void 0!==a.onFinished)a.onFinished();void 0!==a.nextProcess&&a.nextProcess.run()}};b.open("GET",this.dataToLoad);
b.send()}}};MM.getClosestIndex=function(a,b,c){void 0===c&&(c=.1);c=a.clone().multiplyScalar(c);for(var d,e=1E6,f,g=0;g<b.length;g++)d=(new THREE.Vector3).subVectors(c,new THREE.Vector3(b[g][0],b[g][1],b[g][2])),d.length()<e&&(e=d.length(),f=g);.1<e&&console.log("warning: ",e,":",a.x,a.y,a.z);return f};
MM.shapeConvert=function(a,b){var c=new MM.Control;c.name="cFaceCtl";c.tag="control";b.addObject(c);var d=new MM.Control;d.name="lEyeCtl";d.tag="control";b.addObject(d);var e=new MM.Control;e.name="lMouthCtl";e.tag="control";b.addObject(e);var f=new MM.Control;f.name="rEyeCtl";f.tag="control";b.addObject(f);var g=new MM.Control;g.name="rMouthCtl";g.tag="control";b.addObject(g);var h,k,l;for(l in a){l.match("Lid")||l.match("Brow")?(h=d,k=f):l.match("Mouth")?(h=e,k=g):k=h=c;h.addChannel("shapes",l);
!1===h.hasOwnProperty("shapes")&&(h.shapes={});h.shapes[l]=new THREE.Number;var m,n;for(n in a[l])if(m=b.scene.getObjectByName(n,!0),void 0!==m){var r=a[l],r=(new THREE.Vector3(r[n][0],r[n][1],r[n][2])).multiplyScalar(10);m.addTarget(r,h.shapes[l],l)}if("l"===l.charAt(0))for(n in h="r"+l.slice(1),k.addChannel("shapes",h),!1===k.hasOwnProperty("shapes")&&(k.shapes={}),k.shapes[h]=new THREE.Number,a[l])m=n,"l"===n.charAt(0)&&(m="r"+n.slice(1)),m=b.scene.getObjectByName(m,!0),void 0!==m&&(r=a[l],r=(new THREE.Vector3(-1*
r[n][0],r[n][1],r[n][2])).multiplyScalar(10),m.addTarget(r,k.shapes[h],h))}c=new MM.LipZip(b);c.addJointPairByName("lULip3","lDLip3",.25);c.addJointPairByName("lULip2","lDLip2",.5);c.addJointPairByName("lULip1","lDLip1",.75);c.addJointPairByName("cULip1","cDLip1",1);b.step1Nodes.push(c);e.addChannel("shapes","lZip");e.shapes.lZip=new MM.Number;c.zip=e.shapes.lZip;e.addChannel("shapes","lZipRange");e.shapes.lZipRange=new MM.Number;c.range=e.shapes.lZipRange;e=new MM.LipZip(b);e.addJointPairByName("rULip3",
"rDLip3",.25);e.addJointPairByName("rULip2","rDLip2",.5);e.addJointPairByName("rULip1","rDLip1",.75);e.addJointPairByName("cULip1","cDLip1",1);b.step1Nodes.push(e);g.addChannel("shapes","rZip");g.shapes.rZip=new MM.Number;e.zip=g.shapes.rZip;g.addChannel("shapes","rZipRange");g.shapes.rZipRange=new MM.Number;e.range=g.shapes.rZipRange};
MM.weightsConvert=function(a,b,c){void 0===c&&(c="");var d=b.scene.getObjectByName(c+a.shape,!0);void 0===d&&console.warn("Unable to find ",c+a.shape);var e,f,g;g=d.name;e=d.geometry.clone();f=d.material.clone();f.skinning=!0;d.visible=!1;b.signals.sceneGraphChanged.dispatch();console.log(e);e.bones=[];for(var h=0;h<a.influences.length;h++){var k=b.scene.getObjectByName(c+a.influences[h],!0);if(void 0===k)return;e.bones.push(k);k.setBindPose()}if(a.npoints!==e.vertices.length)console.error("Vertex count does not match"),
console.error("Source",a.npoints,"destination",e.vertices.length);else{e.skinWeights=[];e.skinIndices=[];for(var l,m,n,r,q,h=0;h<a.npoints;h++){for(var p=MM.getClosestIndex(e.vertices[h],a.positions),t=q=r=m=k=n=l=c=0;t<a.weights[p].length;t++)0<a.weights[p][t]&&(0==q?(c=a.weights[p][t],k=t):1==q?(l=a.weights[p][t],m=t):2==q?(n=a.weights[p][t],r=t):console.warn("\t\t",h,t,"More then 3 influences"),q+=1);0===l&&0===k&&(m=1);e.skinWeights.push(new THREE.Vector4(c,l,n,0));e.skinIndices.push(new THREE.Vector4(k,
m,r,0))}e.computeCentroids();e.computeFaceNormals();e.computeBoundingSphere();b.removeObject(d);d.geometry.dispose();a=new THREE.SkinnedMesh(e,f);a.name=g;a.castShadow=!0;b.addObject(a);return a}};
MM.jointsConvert=function(a,b,c,d){void 0===c&&(c="");void 0===d&&(d="");for(var e=a.length,f=[],g,h=0;h<e;h++)if(g=a[h],"m:cGlasses_jnt"!=g.name&&"m:cHair_jnt"!=g.name){var k=new MM.Joint;f.push(k);k.name=c+g.name.split("_")[0];k.radius=2;k.tag="control";k.asset=d;k.controlSize=1;b.addObject(k);var l=new THREE.Matrix4;l.fromArray(g.matrix);k.applyMatrix(l);l=new THREE.Vector3;l.multiplyVectors(k.position,new THREE.Vector3(10,10,10));k.position.set(l.x,l.y,l.z);null!==g.parent?(console.log(g.parent[0]),
g=b.scene.getObjectByName(c+g.parent[0].split("_")[0],!0),void 0!==g&&g instanceof MM.Joint&&b.parent(k,g)):b.parent(k)}a=b.addGroup(c,"asset");b.addGroupContent(a,f);return f};MM.AssetKeySelectControls=function(a){console.log("MM.AssetKeySelectControls");this.editor=a;this.controls=[];var b=this;this.panel=(new MMUI.Panel).setClass("pnl-asset-select");this.titleTxt=(new MMUI.Text).setClass("sidebar-text");this.selectBtn=(new MMUI.Button("Select")).setClass("btn btn-asset-select").onClick(function(){b.selectControls()});this.keyBtn=(new MMUI.Button("Key")).setClass("btn btn-asset-select").onClick(function(){b.keyControls()});this.panel.add(this.titleTxt);this.panel.add(this.selectBtn);
this.panel.add(this.keyBtn);console.log("\treturning",this)};
MM.AssetKeySelectControls.prototype={setTitle:function(a){console.log("\tsetTitle",a);this.titleTxt.setValue(a);return this},setControls:function(a){console.log("\tsetControls",a);this.controls=a;return this},keyControls:function(){console.log("AssetKeySelectControls: keyControls",this.controls);this.editor.keyObjects(this.controls);return this},selectControls:function(){console.log("AssetKeySelectControls: selectControls",this.controls);this.editor.selectObjectsByName(this.controls);return this},
setBackgroundColor:function(a){this.panel.setBackgroundColor(a);return this}};
MM.AssetKeyGlobal=function(a){var b=a.signals,c=new MMUI.Panel;c.setClass("assetKey");c.setMarginTop("5px");c.keyObjects=function(c){console.log("keyObjects",c);var e,f,g;e=0;for(f=c.length;e<f;e++)console.log("\tkeying",c[e]),g=a.scene.getObjectByName(c[e],!0),void 0!==g?g.keyAnimated(a.time,a.defaultTangentType,a.defaultTangentType):console.warn("\tUnable to find",c[e]);b.objectChanged.dispatch(this.selected)};b.objectSelected.add(function(a){console.log("AssetKeyGlobal: objectSelected",a);for(c.setDisplay("none");c.dom.firstChild;)c.dom.removeChild(c.dom.firstChild);
if(null!==a&&void 0!==a&&void 0!==a.asset){c.setDisplay("block");try{var b=a.name.getNamespace(),f=a.asset+'KeyAll("'+b+'",container)';console.log("Trying to run",f);eval(f)}catch(g){console.log("No selection interface available for",a.asset)}}});return c};MM.AssetSelect=function(a){function b(){console.log("getBindData from",k);if(void 0!==k){var a=[],b,c,d,e,f,g,h=["left","right","top","bottom"];b=0;for(c=k.dom.childNodes.length;b<c;b++)if(console.log("\t",k.dom.childNodes[b]),e=k.dom.childNodes[b],"IMG"===e.nodeName&&a.push({name:"img",width:e.width,height:e.height}),"BUTTON"===e.nodeName){f={};for(d=0;4>d;d++)g=parseFloat(e.style[h[d]]),isNaN(g)||(console.log("\t",h[d],g),f[h[d]]=g);a.push(f)}return a}}function c(){console.log("updateUI");console.log("\tdata",
l);console.log("\tpanel",k);if(void 0!==k){var a=k.dom.parentNode.offsetWidth/l[0].width,b,c,d,e;b=0;for(c=k.dom.childNodes.length;b<c;b++){e=k.dom.childNodes[b];"IMG"===e.nodeName&&(e.width=l[0].width*a,e.height=l[0].height*a,console.log(k.dom.parentNode),k.dom.parentNode.style.height=l[0].height*a+"px");var f=["left","right","top","bottom"];if("BUTTON"===e.nodeName)for(d=0;4>d;d++)l[b].hasOwnProperty(f[d])&&(e.style[f[d]]=a*l[b][f[d]]+"px")}}}var d=a.signals,e=new MMUI.Panel;e.setClass("assetSelect");
var f=void 0,g=void 0,h=void 0,k=void 0,l=void 0,m=function(a,d,e){for(;f.dom.firstChild;)f.dom.removeChild(f.dom.firstChild);try{e="MM."+d+'Select("'+a+'", assetPanel, editor)',console.log("Trying to run",e),k=eval(e)}catch(g){console.log("No selection interface available for",d,"with namespace",a)}for(;h.dom.firstChild;)h.dom.removeChild(h.dom.firstChild);try{e="MM."+d+'KeyAll("'+a+'",assetKeyPanel, editor)',console.log("Trying to run",e),eval(e)}catch(m){console.log("No key interface available for",
d,"with namespace",a)}l=b();c()};(function(){var b=(new MMUI.Panel).setClass("assetSelectList"),c=(new MMUI.Text("Asset")).setClass("sidebar-text");g=(new MMUI.Select).setClass("sidebar-input");g.setOptions({"none:none":"none"}).onChange(function(){var b=g.getValue();console.log("\tselected",b);b=b.split(":");m(b[0],b[1],a)});b.add(c);b.add(g);f=(new MMUI.Panel).setClass("asset-select-view");b.add(f);h=(new MMUI.Panel).setClass("assetKeyView");b.add(h);e.add(b)})();d.assetAdded.add(function(){console.log("AssetSelect: assetAdded");
g.setOptions(a.getNamespaceFromAssetObjects())});d.assetRemoved.add(function(){console.log("AssetSelect: assetRemoved");g.setOptions(a.getNamespaceFromAssetObjects())});d.layoutResized.add(function(a){"main"===a&&(console.log("resizing selection menu"),c())});return e};MM.ParentConstraint=function(a){var b=new MM.Control;b.name="driven";b.tag="control";b.position.set(0,5,0);b.controlShape="plane";a.addObject(b);b.setChannelsEmpty();var c=new MM.Constraint;c.name="driver";c.tag="control";c.controlShape="plane";c.position.set(0,-5,0);a.addObject(c);c.setObjectToSolve(b);c.constraintMode=3;a.controlsVisibility();var d=a.addGroup("setup");a.addGroupContent(d,[b,c])};
MM.ParentAndScaleConstraint=function(a){var b=new MM.Control;b.name="driven";b.tag="control";b.position.set(0,5,0);b.controlShape="plane";a.addObject(b);b.setChannelsEmpty();var c=new MM.Constraint;c.name="driver";c.tag="control";c.controlShape="plane";c.position.set(0,-5,0);a.addObject(c);c.setObjectToSolve(b);c.constraintMode=5;a.controlsVisibility();var d=a.addGroup("setup");a.addGroupContent(d,[b,c])};
MM.ParentHierarchyConstraint=function(a){var b=new MM.Control;b.name="drivenParent";b.setControlShape("c","plane",10);b.position.set(0,1,0);a.addObject(b);var c=new MM.Control;c.name="driven";c.setControlShape("c","plane",10);b.setParent(c);c.position.set(0,5,0);c.setChannelsEmpty();var d=new MM.Constraint;d.name="driverParent";d.setControlShape("c","plane",10);d.position.set(0,-10,0);a.addObject(d);var e=new MM.Constraint;e.name="driver";e.setControlShape("c","plane",10);e.controlColor=new THREE.Color("red");
e.position.set(0,-5,0);a.addObject(e);d.setParent(e);e.setObjectToSolve(c);e.constraintMode=3;a.controlsVisibility();var f=a.addGroup("setup");a.addGroupContent(f,[b,c,d,e])};
MM.AimAndOffsetConstraint=function(a){var b=new MM.Control;b.name="rootCtl";b.setControlShape("l");a.addObject(b);var c=new MM.Control;c.setControlShape("l");c.name="rootAimWithOffset";b.add(c);c.rotation.order="YZX";c.position.y=10;var d=new MM.Constraint;d.name="lookAtMe";d.useOffset=!0;d.side=new THREE.Vector3(1,0,0);d.up=new THREE.Vector3(0,1,0);d.setControlShape("l","triangle");a.addObject(d);d.position.z=10;d.setObjectToSolve(c);d.constraintMode=4;a.controlsVisibility(!0);var e=a.addGroup("setup");
a.addGroupContent(e,[b,c,d])};MM.SpaceswitchDemo1=function(a){var b=new MM.Control;b.name="driver";b.tag="control";b.controlSize=10;b.controlShape="plane";b.setChannelsTranslateAndRotate();a.addObject(b);var c=new MM.Spaceswitch;c.name="driven";c.tag="control";c.controlShape="";c.controlSize=10;c.displayRotationAxis=!0;c.setChannelsTranslateAndRotate();c.translateY(10);a.addObject(c);c.addSpace(b);var d=a.addGroup("multiChannel","asset");a.addGroupContent(d,[b,c]);a.controlsVisibility()};
MM.SpaceswitchDemo2=function(a){var b=new MM.Control;b.name="a";b.tag="control";b.controlSize=10;b.controlShape="plane";b.setChannelsTranslateAndRotate();b.translateY(10);a.addObject(b);var c=new MM.Control;c.name="b";c.tag="control";c.controlSize=10;c.controlShape="plane";c.setChannelsTranslateAndRotate();c.translateY(-10);a.addObject(c);var d=new MM.Spaceswitch;d.name="driven";d.tag="control";d.controlShape="";d.controlSize=10;d.displayRotationAxis=!0;d.setChannelsTranslateAndRotate();d.translateX(10);
a.addObject(d);d.addSpace(b);d.addSpace(c);var e=a.addGroup("multiChannel","asset");a.addGroupContent(e,[b,c,d]);a.controlsVisibility()};
MM.ParentMasterDemo1=function(a){console.log("ParentMasterDemo1");var b=new MM.Control;b.name="a";b.tag="control";b.controlSize=10;b.controlShape="plane";b.setChannelsTranslateAndRotate();b.translateY(10);a.addObject(b);var c=new MM.Control;c.name="b";c.tag="control";c.controlSize=10;c.controlShape="plane";c.setChannelsTranslateAndRotate();c.translateY(-10);a.addObject(c);var d=b.addInbetween(b.name+"PM","ParentMaster");d.addSpace(c);d.addSpaceswitchChannel(b);var e=a.addGroup("multiChannel","asset");
a.addGroupContent(e,[b,c,d]);a.controlsVisibility()};
MM.ParentMasterDemo2=function(a){console.log("ParentMasterDemo2");var b=new MM.Control;b.name="a";b.tag="control";b.controlSize=10;b.controlShape="plane";b.setChannelsTranslateAndRotate();b.translateY(10);a.addObject(b);var c=new MM.Control;c.name="b";c.tag="control";c.controlSize=10;c.controlShape="plane";c.setChannelsTranslateAndRotate();c.translateY(-10);a.addObject(c);var d=new MM.Control;d.name="c";d.tag="control";d.controlSize=10;d.controlShape="plane";d.setChannelsTranslateAndRotate();a.addObject(d);
var e=d.addInbetween(d.name+"PM","ParentMaster");e.addSpace(b);e.addSpace(c);e.addSpaceswitchChannel(d);var f=a.addGroup("multiChannel","asset");a.addGroupContent(f,[b,c,d,e]);a.controlsVisibility()};MM.SimpleControl=function(a){console.log("SimpleControl");var b=new MM.Control;b.name="driven";b.tag="control";b.position.set(0,5,0);b.controlShape="plane";a.addObject(b);a.controlsVisibility()};
MM.FacingControl=function(a){console.log("FacingControl");var b=new MM.Control;b.name="lineControl";b.tag="control";b.position.set(0,5,0);b.controlShape="planeZ";b.controlSize=.5;b.setFacingCamera(a.cameras[0]);a.addObject(b);var c=new MM.Control;c.name="fullControl";c.tag="control";c.position.set(0,0,0);c.controlShape="circle";c.controlSize=.5;c.isFull=!0;c.setFacingCamera(a.cameras[0]);a.addObject(c);a.controlsVisibility();var d=a.addGroup("setup");a.addGroupContent(d,[b,c])};MM.SkeletonIO=function(a){var b=new MM.AssetBuild(a);b.namespace="skeleton:";b.asset="skeleton";b.addSkeleton("/data/tiny1/skeleton/cRoot_skeleton.json");b.addLast(function(){for(var c=a.addGroup("skeleton","asset"),d=0;d<b.joints.length;d++)console.log("\t",b.joints[d].name),a.addGroupContent(c,[b.joints[d]]);a.jointsVisibility()});b.build()};
MM.ModelIO=function(a){var b=new MM.AssetBuild(a);b.setNamespace("smurf");b.assetName="smurf";b.addModel("/data/smurf/model/body.obj");b.addModel("/data/smurf/model/pants.obj");b.addModel("/data/smurf/model/eyes.obj");b.addModel("/data/smurf/model/hat.obj");b.addModel("/data/smurf/model/pupil.obj");b.addModel("/data/smurf/model/tail.obj");b.addLast(function(){var c=new THREE.Object3D;c.name=b.namespace+"group";c.asset=b.assetName;a.addObject(c);for(var d=0;d<b.models.length;d++)switch(c.add(b.models[d]),
a.addGroupContent(b.materialGroup,[b.models[d]]),b.models[d].name){case b.namespace+"pants":case b.namespace+"hat":case b.namespace+"eyes":b.models[d].material.color.r=1;b.models[d].material.color.g=1;b.models[d].material.color.b=1;break;case b.namespace+"pupil":b.models[d].material.color.r=0;b.models[d].material.color.g=0;b.models[d].material.color.b=0;break;case b.namespace+"tail":case b.namespace+"body":b.models[d].material.color.r=47/255,b.models[d].material.color.g=186/255,b.models[d].material.color.b=
239/255}a.addGroupContent(b.assetGroup,[c]);c.keyChannel(0,1,1,"rotation","y");c.rotation.y=360;c.keyChannel(48,1,1,"rotation","y");a.play()});b.build()};
MM.SkinnedModelIO=function(a){var b=new MM.AssetBuild(a);b.namespace="legs:";b.addModel("/data/drone/model/body.obj");b.addSkeleton("/data/drone/skeleton/ground_skeleton.json");b.addSkin("/data/drone/weights/body_skin.json");b.addLast(function(){for(var b=a.addGroup("legs","asset"),d="ground root lHip lKnee lAnkle lBall rHip rKnee rAnkle lToe rToe rBall rHeel lHeel".split(" "),e,f=0,g=d.length;f<g;f++)e=a.scene.getObjectByName("legs:"+d[f],!0),void 0!==e?a.addGroupContent(b,[e]):console.log("Unable to find",
d[f])});b.build()};MM.FFDDemo=function(a){var b=new THREE.CubeGeometry(1,1,1,1,1,1),b=new THREE.Mesh(b,new THREE.MeshLambertMaterial);a.addObject(b);b.position.set(.5,.5,.5);MM.freezeTransformations(b);var c=new MM.FFD1;c.initControlPoints();c.addDisplay();c.setGeometry(b.geometry);c.createBernsteinCoefficients();c.moveControlPoint(0,new THREE.Vector3(0,-.5,0));a.addObject(c);a.addHelper(c.cd.dvrt)};MM.DemoMultiChannelPass=function(a){var b=new MM.Control;b.name="driveTxAndRyWithTx";b.tag="control";b.displayRotationAxis=!0;b.controlSize=10;b.controlShape="";b.setChannelsTranslateAndRotate();a.addObject(b);var c=new MM.MultiChannel;c.setDriverChannel(b,"position","x");c.addDrivenChannel(b,"position","y");c.addDrivenChannel(b,"rotation","y");a.step2Nodes.push(c);b.removeChannel("position","y");b.removeChannel("rotation","y");c=a.addGroup("multiChannel","asset");a.addGroupContent(c,[b]);a.controlsVisibility()};
MM.DemoMultiChannelShapesPass=function(a){var b=new MM.AssetBuild(a);b.addModel("data/skinnedCube/model/pCube1.obj");b.addSkeleton("data/skinnedCube/skeleton/joint1_skeleton.json");b.addSkin("data/skinnedCube/weights/pCube1_skin.json");b.addLast(function(){var b=a.scene.getObjectByName("joint2",!0),d=a.scene.getObjectByName("joint3",!0);b.addTarget(new THREE.Vector3(1,0,0),0,"test2X");d.addTarget(new THREE.Vector3(1,0,0),0,"test3X");var e=new MM.Control;e.name="TxAndTyDriveJoints";e.setChannelsTranslate();
e.setControlShape();a.addObject(e);var f=new MM.MultiChannel;f.setDriverChannel(e,"position","y");b=f.addDrivenChannel(b,"shapes","test2X");f.setDrivenBehavior(b,"MULTIPLY",.5);console.log("Created driven channel ",b);a.step2Nodes.push(f);f=new MM.MultiChannel;f.setDriverChannel(e,"position","x");d=f.addDrivenChannel(d,"shapes","test3X");f.setDrivenBehavior(d,"CLAMP",0,10);console.log("Created driven channel ",d);a.step2Nodes.push(f);d=a.addGroup("multiChannel","asset");a.addGroupContent(d,[e]);a.controlsVisibility()});
b.build()};
MM.DemoMultiChannelMouthPass=function(a){var b=new MM.AssetBuild(a);b.addModel("data/skinnedCube/model/pCube1.obj");b.addSkeleton("data/skinnedCube/skeleton/joint1_skeleton.json");b.addSkin("data/skinnedCube/weights/pCube1_skin.json");b.addLast(function(){var b=a.scene.getObjectByName("joint3",!0),d=new MM.Control;d.name="lMouthCtl";d.setChannelsTranslate();d.setControlShape("c","planeX",5);a.addObject(d);var e=new MM.Control;a.addObject(e);e.add(d);e.translateZ(-20);b.addTarget(new THREE.Vector3(0,0,
-1),0,"xMin");b.addTarget(new THREE.Vector3(0,0,1),0,"xMax");b.addTarget(new THREE.Vector3(0,-1,0),0,"yMin");b.addTarget(new THREE.Vector3(0,1,0),0,"yMax");e=new MM.MultiChannel;e.setDriverChannel(d,"position","y");var f=e.addDrivenChannel(b,"shapes","yMin");e.setDrivenBehavior(f,"CLAMP_MULTIPLY",-5,0,-1);f=e.addDrivenChannel(b,"shapes","yMax");e.setDrivenBehavior(f,"CLAMP_MULTIPLY",0,5,1);a.step2Nodes.push(e);e=new MM.MultiChannel;e.setDriverChannel(d,"position","z");f=e.addDrivenChannel(b,"shapes",
"xMin");e.setDrivenBehavior(f,"CLAMP_MULTIPLY",-5,0,-1);f=e.addDrivenChannel(b,"shapes","xMax");e.setDrivenBehavior(f,"CLAMP_MULTIPLY",0,5,1);a.step2Nodes.push(e);b=a.addGroup("multiChannel","asset");a.addGroupContent(b,[d]);a.controlsVisibility()});b.build()};
MM.DemoAnimatableChannels=function(a){var b=new MM.Control;b.name="globalCtl";b.tag="control";b.controlSize=5;b.controlShape="cube";a.addObject(b);var c=new MM.Control;c.name="drivenCtl";c.tag="control";c.controlSize=2.5;c.controlShape="cube";a.addObject(c);b.addChannel("position","x");b.addChannel("position","y");b.removeChannel("position","y");b.removeChannelGroup("position");b.addChannel("custom","heelPivot");b.custom={};b.custom.heelPivot=0;var d=new MM.MultiChannel;d.setDriverChannel(b,"custom",
"heelPivot");d.addDrivenChannel(c,"position","y");a.step2Nodes.push(d);c=new MM.AnimCurve(b,["custom","heelPivot"]);b.addAnimCurve(c);a.addAnimCurve(c);c.add(0,0);c.add(10,5);c.add(20,0);c.it=[1,1,1];c.ot=[1,1,1];a.controlsVisibility()};MM.simpleIkLeg=function(a,b,c){var d=["KneeCtl","BallCtl","ToeCtl","HeelCtl","FootCtl"],e="Hip Knee Ankle Ball Toe Heel".split(" "),f=new MM.AssetBuild(a);f.setNamespace("legs:");f.addSkeleton("/data/tiny1/skeleton/cRoot_skeleton.json");void 0===b&&(b=!1);_.each(["l"],function(a){f.addRigComponent(new MM.LegComponent({controlSize:10,controlScale:1,side:a,asset:"legs",names:d,joints:e,useCustomAttributes:b}))});f.addLast(function(){var b=a.addGroup(f.namespace,"asset"),d=[];_.each("KneeCtl BallCtl ToeCtl HeelCtl FootCtl LegIkSolver".split(" "),
function(a){d.push("l"+a);d.push("r"+a)});for(var e,l=0,m=d.length;l<m;l++)e=a.scene.getObjectByName(f.namespace+d[l],!0),void 0!==e?a.addGroupContent(b,[e]):console.log("Unable to find",f.namespace+d[l]);console.log("zeroGroup",c);void 0!==c&&(l=a.scene.getObjectByName(f.namespace+"lFootCtl",!0),e=a.scene.getObjectByName(f.namespace+"lKneeCtl",!0),l=a.insertObjectInbetween(l),e=a.insertObjectInbetween(e),a.addGroupContent(b,[l]),a.addGroupContent(b,[e]));a.jointsVisibility();a.controlsVisibility()});
f.build()};
MM.simpleLimbIk=function(a){var b=new MM.AssetBuild(a);b.setNamespace("blend:");b.addSkeleton("/data/tiny1/skeleton/cRoot_skeleton.json");b.addRigComponent(new MM.LimbComponent({side:"l",controlSize:.5,asset:"blend"}));b.addLast(function(){var c=a.scene.getObjectByName("blend:lHip",!0),d=a.scene.getObjectByName("blend:lKnee",!0),e=a.scene.getObjectByName("blend:lAnkle",!0),f=a.scene.getObjectByName("blend:lIkSolver",!0);a.addGroupContent(b.assetGroup,[c,d,e,f]);a.jointsVisibility();a.controlsVisibility()});b.build()};
MM.simpleBlendLeg=function(a){var b=new MM.AssetBuild(a);b.setNamespace("blend:");b.addModel("/data/tiny1/model/cBody.obj");b.addSkeleton("/data/tiny1/skeleton/cRoot_skeleton.json");b.addSkin("/data/tiny1/weights/cBody_skin.json");b.addRigComponent(new MM.LegBlendComponent({side:"l",controlSize:.5,asset:"blend"}));b.addLast(function(){var c=a.scene.getObjectByName("blend:lIkSolver",!0);a.addGroupContent(b.assetGroup,[c]);a.jointsVisibility();a.controlsVisibility()});b.build()};
MM.twoStepBlendIk=function(a){var b=new MM.AssetBuild(a);b.setNamespace("twoStep");b.addSkeleton("/data/spaceTunny/skeleton/cRoot_skeleton.json");b.addRigComponent(new MM.TwoStepLegBlendComponent({asset:"twoStep",side:"l"}));b.addLast(function(){a.jointsVisibility();a.controlsVisibility();console.log(b);for(var c=0;c<b.joints.length;c++)a.addGroupContent(b.assetGroup,[b.joints[c]])});b.build()};
MM.legIkPlus=function(a){var b=["KneeCtl","BallCtl","ToeCtl","HeelCtl","FootCtl"],c="Hip Knee Ankle Ball Toe Heel".split(" "),d=new MM.AssetBuild(a);d.setNamespace("legs:");d.addSkeleton("/data/drone/skeleton/ground_skeleton.json");d.addRigComponent(new MM.LegComponent({controlSize:10,controlScale:1,side:"l",asset:"legs",names:b,joints:c,useCustomAttributes:!0}));d.addRigComponent(new MM.LegComponent({controlSize:10,controlScale:1,side:"r",asset:"legs",names:b,joints:c,useCustomAttributes:!0}));d.addLast(function(){for(var b=
a.addGroup(d.namespace,"asset"),c="lKneeCtl lBallCtl lToeCtl lHeelCtl lFootCtl rKneeCtl rBallCtl rToeCtl rHeelCtl rFootCtl".split(" "),g,h=0,k=c.length;h<k;h++)g=a.scene.getObjectByName(d.namespace+c[h],!0),void 0!==g?a.addGroupContent(b,[g]):console.log("Unable to find",d.namespace+c[h]);a.jointsVisibility();a.controlsVisibility()});d.build()};
MM.splineIk=function(a){console.log("Building spline IK");var b=new MM.Asset(a);b.setNamespace("spline:");b.addSkeleton("/data/manWithFace/skeleton/cRoot_skeleton.json");b.addRigComponent(new MM.SpineComponent({controlSize:.5,asset:"spline",names:["cBodyCtl","cHipCtl","cBChestCtl"],joints:["cSpine0","cSpine1","cSpine2","cSpine3"]}));b.addLast(function(){for(var c=["cSpine0","cSpine1","cSpine2","cSpine3"],d=0;d<c.length;d++){var e=a.scene.getObjectByName("spline:"+c[d],!0);void 0!==e&&(e.showHierarchy=
!1,e.showRotationAxis=!0,e.radius=5,a.addGroupContent(b.assetGroup,[e]))}a.jointsVisibility();a.controlsVisibility()});b.build()};
MM.splineIkPlus=function(a){var b=new MM.Asset(a);b.setNamespace("spline:");b.addSkeleton("/data/tiny/skeleton/cRoot_skeleton.json");b.addRigComponent(new MM.SpineComponent({controlSize:.5,asset:"spline",names:["cBodyCtl","cHipCtl","cBChestCtl"],joints:["cSpine0","cSpine1","cSpine2","cSpine3"]}));for(var c=["l"],d=["Collar","Shoulder"],e=["ElbowCtl","HandCtl"],f=["Shoulder","Elbow","Wrist"],g=0;g<c.length;g++)b.addRigComponent(new MM.ShoulderComponent({controlSize:.5,side:c[g],parentJoint:"cSpine4",
asset:"spline",names:["ShoulderCtl"],joints:d})),b.addRigComponent(new MM.ArmComponent({controlSize:.5,asset:"spline",side:c[g],names:e,joints:f}));b.addLast(function(){for(var c=a.addGroup("spline","asset"),d="cBodyCtl cHipCtl cBChestCtl lShoulderCtl rShoulderCtl lElbowCtl lHandCtl rElbowCtl rHandCtl".split(" "),e,f=0,g=d.length;f<g;f++)e=a.scene.getObjectByName(b.namespace+d[f],!0),void 0!==e&&a.addGroupContent(c,[e]);c=a.scene.getObjectByName(b.namespace+"lShoulderCtl",!0);a.scene.getObjectByName(b.namespace+
"cBChestCtl",!0).setParent(c);a.jointsVisibility();a.controlsVisibility()});b.build()};
MM.armIk=function(a){var b=new MM.AssetBuild(a);b.setNamespace("arm:");b.addSkeleton("/data/tiny2/skeleton/cRoot_skeleton.json");for(var c=["l"],d=["Collar","Shoulder"],e=["ElbowCtl","HandCtl"],f=["Shoulder","Elbow","Wrist"],g=0;g<c.length;g++)b.addRigComponent(new MM.ShoulderComponent({controlSize:.5,side:c[g],parentJoint:"cSpine4",asset:"arm",names:["ShoulderCtl"],joints:d})),b.addRigComponent(new MM.LimbComponent({controlSize:.5,asset:"arm",side:c[g],names:e,joints:f}));b.addLast(function(){for(var c=
a.addGroup("spline","asset"),d=["lShoulderCtl","lElbowCtl","lHandCtl"],e,f=0,g=d.length;f<g;f++)e=a.scene.getObjectByName(b.namespace+d[f],!0),void 0!==e&&a.addGroupContent(c,[e]);a.jointsVisibility();a.controlsVisibility()});b.build()};
MM.stackedSplines=function(a){var b=new MM.Asset(a);b.setNamespace("sSpline");b.addSkeleton("/data/tiny/skeleton/cRoot_skeleton.json");b.addRigComponent(new MM.SpineComponent({controlSize:.5,asset:"sSpline",names:["cBodyCtl","cHipCtl","cBChestCtl"],joints:["cSpine0","cSpine1","cSpine2","cSpine3"]}));b.addRigComponent(new MM.SpineComponent({controlSize:.5,globalControl:!1,asset:"sSpline",names:["","cTChestCtl","cHeadCtl"],joints:["cSpine4","cNeck0","cNeck1","cNeck2"]}));b.addLast(function(){for(var c=
["cTChestCtl","cBChestCtl","cHeadCtl"],d={},e=a.addGroup(b.namespace,"asset"),f=0;f<c.length;f++){var g=a.scene.getObjectByName(b.namespace+c[f],!0);void 0===g&&console.error("Unable to find",b.namespace+c[f]);d[c[f]]=g;a.addGroupContent(e,[g])}d.cBChestCtl.setParent(d.cTChestCtl);d.cTChestCtl.setParent(d.cHeadCtl);c=new THREE.Object3D;c.name="test";c.tag="control";a.addObject(c);a.addGroupContent(e,[c]);d.cBChestCtl.setParent(c);a.jointsVisibility();a.controlsVisibility()});b.build()};MM.RigComponent=function(){this.assetGroup=this.namespace=this.asset=void 0;this.side="C";this.controlShape="circle";this.controlScale=this.controlSize=1;this.editor=void 0;this.joints=[];this.controlNames=[];this.controls={};this.globalColor0=new THREE.Color(16711935);this.globalColor1=new THREE.Color(13369548);this.globalColor2=new THREE.Color(6684774);this.centerColor0=new THREE.Color(16776960);this.centerColor1=new THREE.Color(13421568);this.centerColor2=new THREE.Color(6710784);this.leftColor0=
new THREE.Color(255);this.leftColor1=new THREE.Color(204);this.leftColor2=new THREE.Color(102);this.rightColor0=new THREE.Color(16711680);this.rightColor1=new THREE.Color(13369344);this.rightColor2=new THREE.Color(6684672);return this};
MM.RigComponent.prototype={constructor:MM.RigComponent,addControl:function(a,b){if(void 0===b)console.error("No key was defined");else{switch(this.side){case "C":case "c":a.setDisplayColor(this["centerColor"+a.controlType]);break;case "G":case "g":a.setDisplayColor(this["globalColor"+a.controlType]);break;case "L":case "l":a.setDisplayColor(this["leftColor"+a.controlType]);break;case "R":case "r":a.setDisplayColor(this["rightColor"+a.controlType]);break;default:console.log("No coloring for",a.name)}this.controls[b]=
a;void 0!==this.asset&&(a.asset=this.asset)}},setValues:function(a){void 0!==a&&(a.hasOwnProperty("controlScale")&&(this.controlScale=a.controlScale),a.hasOwnProperty("controlSize")&&(this.controlSize=a.controlSize),a.hasOwnProperty("controlShape")&&(this.controlShape=a.controlShape),a.hasOwnProperty("side")&&(this.side=a.side),a.hasOwnProperty("names")&&(this.controlNames=a.names),a.hasOwnProperty("asset")&&(this.asset=a.asset),a.hasOwnProperty("joints")&&(this.joints=a.joints))},getJoints:function(){for(var a=
{},b,c,d=0,e=this.joints.length;d<e;d++)c=this.namespace+this.side+this.joints[d],b=this.editor.scene.getObjectByName(c,!0),void 0===b&&console.warn("Unable to find ",c),a[this.joints[d]]=b;return a},getJointPositions:function(){for(var a={},b,c,d=0,e=this.joints.length;d<e;d++)c=this.namespace+this.side+this.joints[d],b=this.editor.scene.getObjectByName(c,!0),void 0===b&&console.warn("Unable to find ",c),a[this.joints[d]]=(new THREE.Vector3).getPositionFromMatrix(b.matrixWorld);return a},getName:function(a){return this.namespace+
this.side+a}};MM.GlobalComponent=function(a){MM.RigComponent.call(this);this.setValues(a)};MM.GlobalComponent.prototype=Object.create(MM.RigComponent.prototype);
MM.GlobalComponent.prototype.build=function(){for(var a=this.joints.length,b=this.getJoints(),c=0;c<a;c++){var d=MM.createControlGroup(this.side,this.getName(this.controlNames[c]),this.controlShape,this.controlSize-2*c);d.zero.applyMatrix(b[this.joints[c]].matrixWorld);console.log("\t",b[this.joints[c]].matrixWorld.elements);this.editor.addObject(d.zero);this.editor.addSelectable(d.control);0!==c&&this.controls[this.controlNames[c-1]].setParent(d.zero);c===a-1&&d.control.setParent(b[this.joints[c]]);
d.control.setChannelsTranslateAndRotate();this.addControl(d.control,this.controlNames[c]);this.editor.addGroupContent(this.assetGroup,[d.control])}return this};MM.FkChainComponent=function(a){MM.RigComponent.call(this);this.setValues(a)};MM.FkChainComponent.prototype=Object.create(MM.RigComponent.prototype);
MM.FkChainComponent.prototype.build=function(){var a=this.getJoints(),b,c,d=[],e;b=0;for(c=this.joints.length;b<c;b++)e=MM.createControlGroup(this.side,this.getName(this.controlNames[b]),this.controlShape,this.controlSize),e.zero.applyMatrix(a[this.joints[b]].matrixWorld),e.control.setChannelsRotate(),this.editor.addObject(e.zero),e.control.setParent(a[this.joints[b]]),this.addControl(e.control,this.controlNames[b]),this.editor.addSelectables([e.control]),d.push(e),0<b&&d[b-1].control.setParent(d[b].zero),
this.editor.addGroupContent(this.assetGroup,[e.control]);return this};MM.ShoulderComponent=function(a){MM.RigComponent.call(this);this.joints=[];this.parentJoint=void 0;this.controlNames=["_shoulder_0_ctrl"];this.setValues(a);return this};MM.ShoulderComponent.prototype=Object.create(MM.RigComponent.prototype);
MM.ShoulderComponent.prototype.setValues=function(a){MM.RigComponent.prototype.setValues.call(this,a);this.joints=["_collar_0_jnt","_shoulder_0_jnt"];void 0!==a&&(a.hasOwnProperty("joints")&&(console.log("\tsetting joints value to",a.joints),this.joints=a.joints),a.hasOwnProperty("parentJoint")&&(console.log("\tsetting parentJoint value to",a.parentJoint),this.parentJoint=a.parentJoint))};
MM.ShoulderComponent.prototype.build=function(){void 0===this.editor.scene.getObjectByName(this.namespace+this.parentJoint,!0)&&console.log("Unable to find parent joint",this.parentJoint);var a=this.editor.scene.getObjectByName(this.namespace+this.side+this.joints[0],!0);void 0===a&&console.log("Unable to find collar joint",this.joints[0]);var b=this.editor.scene.getObjectByName(this.namespace+this.side+this.joints[1],!0);void 0===b&&console.log("Unable to find shoulder joint",this.joints[1]);var c=
new THREE.Vector3,c=b.matrixWorld.getPosition(),d=new THREE.Object3D;d.name=this.namespace+this.side+this.controlNames[0]+"Zero";this.editor.addObject(d);d.position.set(c.x,c.y,c.z);c=new MM.OneSimpleBoneIkSolver;c.name=this.namespace+this.side+this.controlNames[0];c.tag="control";c.controlSide=this.side;c.startJoint=a;c.startPreferedAngle.set(a.rotation.x,a.rotation.y,a.rotation.z);c.endJoint=b;c.setChannelsTranslate();c.controlSize=8*this.controlScale;c.controlScale.set(.1,.4,.4);c.controlShape=
"plane";d.setParent(c);this.addControl(c,this.controlNames[0]);this.editor.addSelectables([c]);this.editor.addGroupContent(this.assetGroup,[c]);return this};MM.SpineComponent=function(a){MM.RigComponent.call(this);this.joints=[];this.controlNames=["C_body_0_ctrl","C_hip_0_ctrl","C_chest_0_ctrl"];this.createGlobalControl=!0;this.setValues(a);return this};MM.SpineComponent.prototype=Object.create(MM.RigComponent.prototype);
MM.SpineComponent.prototype.setValues=function(a){MM.RigComponent.prototype.setValues.call(this,a);this.joints=["C_spine0_0_jnt","C_spine1_0_jnt","C_spine2_0_jnt","C_spine3_0_jnt"];void 0!==a&&(a.hasOwnProperty("joints")&&(console.log("\tsetting joints value to",a.joints),this.joints=a.joints),a.hasOwnProperty("globalControl")&&(console.log("\tsetting create global control to",a.globalControl),this.createGlobalControl=a.globalControl))};
MM.SpineComponent.prototype.build=function(){var a=this.editor.scene.getObjectByName(this.namespace+this.joints[0],!0),b=new MM.SplineSolver(this.editor);b.topControlScale.set(1.25*this.controlSize,.4*this.controlSize,1.25*this.controlSize);b.bottomControlScale.set(1.25*this.controlSize,.4*this.controlSize,1.25*this.controlSize);b.followBottomControl=!0;for(var c=0;c<this.joints.length;c++){var d=this.editor.scene.getObjectByName(this.namespace+this.joints[c],!0);void 0===d&&console.error("Unable to find joint",
this.namespace+this.joints[c]);b.joints.push(d)}b.build();b.bottomControl.name=this.namespace+this.controlNames[1];b.bottomControl.controlSide=this.side;b.bottomControl.setChannelsTranslateAndRotate();this.addControl(b.bottomControl,this.controlNames[1]);this.editor.addSelectables([b.bottomControl]);b.topControl.name=this.namespace+this.controlNames[2];b.topControl.controlSide=this.side;b.topControl.setChannelsTranslateAndRotate();this.addControl(b.topControl,this.controlNames[2]);this.editor.addSelectables([b.topControl]);
b.topControl.tag="control";b.bottomControl.tag="control";b.topControl.curve.name=this.namespace+this.controlNames[1]+"Curve";c=b.bottomControl.addInbetween(this.namespace+this.controlNames[1]+"zero");d=b.topControl.addInbetween(this.namespace+this.controlNames[2]+"zero");if(!0===this.createGlobalControl){var a=a.matrixWorld.getPosition(),e=MM.createControlGroup(this.side,this.getName(this.controlNames[0]));e.zero.setChannelsTranslateAndRotate();e.zero.position.set(a.x,a.y,a.z);this.editor.addObject(e.zero);
this.addControl(e.control,this.controlNames[0]);e.control.setParent(c);e.control.setParent(d);this.editor.addGroupContent(this.assetGroup,[e.control,b.topControl,b.bottomControl]);this.editor.addSelectables([e.control])}else this.editor.addGroupContent(this.assetGroup,[b.topControl,b.bottomControl]);return this};MM.LimbComponent=function(a){MM.RigComponent.call(this);this.joints=["Hip","Knee","Ankle"];this.controlNames="HipFkCtl KneeFkCtl AnkleFkCtl LegSwitch KneeIkCtl FootIkCtl".split(" ");this.buildIkControlOnFloor=!0;this.poleVectorOffset=25;this.stretchAxis="y";this.setValues(a);return this};MM.LimbComponent.prototype=Object.create(MM.RigComponent.prototype);
MM.LimbComponent.prototype.setValues=function(a){MM.RigComponent.prototype.setValues.call(this,a);void 0!==a&&(a.hasOwnProperty("buildIkControlOnFloor")&&(this.buildIkControlOnFloor=a.buildIkControlOnFloor),a.hasOwnProperty("poleVectorOffset")&&(this.poleVectorOffset=a.poleVectorOffset),a.hasOwnProperty("fkControlShape")&&(this.fkControlShape=a.fkControlShape),a.hasOwnProperty("ikControlShape")&&(this.ikControlShape=a.ikControlShape),a.hasOwnProperty("stretchAxis")&&(this.stretchAxis=a.stretchAxis))};
MM.LimbComponent.prototype.build=function(){var a=this.getJoints(),b=this.getJointPositions(),c=MM.createControlGroup(this.side,this.getName(this.controlNames[0]),this.fkControlShape,this.controlSize);c.control.setChannelsRotate();void 0!==a[this.joints[0]].parent&&a[this.joints[0]].parent.add(c.zero);c.zero.applyMatrix(a[this.joints[0]].matrix);this.addControl(c.control,this.controlNames[0]);var d=MM.createControlGroup(this.side,this.getName(this.controlNames[1]),this.fkControlShape,this.controlSize);
d.control.setChannelsRotate();c.control.add(d.zero);d.zero.applyMatrix(a[this.joints[1]].matrix);this.addControl(d.control,this.controlNames[1]);var e=MM.createControlGroup(this.side,this.getName(this.controlNames[2]),this.fkControlShape,this.controlSize);e.control.setChannelsRotate();d.control.add(e.zero);e.zero.applyMatrix(a[this.joints[2]].matrix);this.addControl(e.control,this.controlNames[2]);var f=new MM.Control;f.name=this.getName(this.controlNames[3]);f.setControlShape(this.side,"triangle",
.5*this.controlSize);a[this.joints[2]].add(f);this.addControl(f,this.controlNames[3]);f.setChannelsEmpty();var g=MM.createControlGroup(this.side,this.getName(this.controlNames[5]),this.ikControlShape,this.controlSize);!0===this.buildIkControlOnFloor?g.zero.position.set(b[this.joints[2]].x,0,b[this.joints[2]].z):g.zero.position.set(b[this.joints[2]].x,b[this.joints[2]].y,b[this.joints[2]].z);g.control.setChannelsTranslateAndRotate();this.editor.addObject(g.zero);g.control.controlType=2;this.addControl(g.control,
this.controlNames[5]);var h=MM.createControlGroup(this.side,this.getName(this.controlNames[4]),"planeZ",this.controlSize);h.zero.position.set(b[this.joints[1]].x,b[this.joints[1]].y,b[this.joints[1]].z+this.poleVectorOffset*this.controlScale);h.control.setChannelsTranslate();h.control.controlType=2;this.editor.addObject(h.zero);this.addControl(h.control,this.controlNames[4]);var k=new MM.TwoBoneIkBlendSolver;k.stretchAxis=this.stretchAxis;k.endJointEqualsHandleOrientation=!0;k.name=this.getName("IkSolver");
k.position.set(b[this.joints[2]].x,b[this.joints[2]].y,b[this.joints[2]].z);this.editor.addObject(k);this.editor.addObject(g.zero);g.control.setParent(k);k.setStartJoint(a[this.joints[0]]);k.middleJoint=a[this.joints[1]];k.endJoint=a[this.joints[2]];k.startFkCtrl=c.control;k.middleFkCtrl=d.control;k.endFkCtrl=e.control;k.setSoftControl(f);k.setSoftIk();k.setBlendControl(f);k.ikFkBlendGroup="custom";k.ikFkBlendChannel="ikFkBlend";k.poleVector=h.control;k.handleControl=g.control;a=[k.customCtrl,k.startFkCtrl,
k.middleFkCtrl,k.endFkCtrl,k.poleVector,k.handleControl];this.editor.addGroupContent(this.assetGroup,a);this.editor.addSelectables(a);this.editor.addGroupContent(this.assetGroup,[h.control,g.control]);return this};MM.ArmComponent=function(a){MM.RigComponent.call(this);this.joints=[];this.parentJoint=void 0;this.controlNames=["_elbow_0_ctrl","_hand_0_ctrl"];this.setValues(a);return this};MM.ArmComponent.prototype=Object.create(MM.RigComponent.prototype);
MM.ArmComponent.prototype.setValues=function(a){MM.RigComponent.prototype.setValues.call(this,a);this.joints=["_shoulder_0_jnt","_elbow_0_jnt","_wrist_0_jnt"];void 0!==a&&a.hasOwnProperty("joints")&&(console.log("\tsetting joints value to",a.joints),this.joints=a.joints)};
MM.ArmComponent.prototype.build=function(){var a=this.editor.scene.getObjectByName(this.namespace+this.side+this.joints[0],!0);void 0===a&&console.warn("Unable to find ",this.namespace+this.side+this.joints[0]);var b=this.editor.scene.getObjectByName(this.namespace+this.side+this.joints[1],!0);void 0===b&&console.warn("Unable to find ",this.namespace+this.side+this.joints[1]);var c=this.editor.scene.getObjectByName(this.namespace+this.side+this.joints[2],!0);void 0===c&&console.warn("Unable to find ",
this.namespace+this.side+this.joints[2]);var d=c.matrixWorld.getPosition(),e=new MM.TwoBoneIkSolver;e.name="armTwoBoneIkSolver";e.position.set(d.x,d.y,d.z);e.setStartJoint(a);e.middleJoint=b;e.endJoint=c;this.editor.addObject(e);d=b.matrixWorld.getPosition();a=new MM.Control;a.controlSize=2*this.controlScale;a.controlShape="cube";a.name=this.namespace+this.side+this.controlNames[0];a.controlSide=this.side;a.tag="control";a.position.set(d.x,d.y,d.z-25*this.controlScale);a.setChannelsTranslate();e.poleVector=
a;this.addControl(a);this.editor.addObject(a);a=new MM.Constraint;a.name=this.namespace+this.side+this.controlNames[1];d=c.matrixWorld.getPosition();a.position.set(d.x,d.y,d.z);a.constraintMode=1;a.controlSide=this.side;a.tag="control";a.controlSize=4*this.controlScale;a.controlScale.set(.4,1,1);a.controlShape="cube";a.setChannelsTranslateAndRotate();this.editor.addObject(a);this.addControl(a);a.setObjectToSolve(c);a.setParent(e);return this};MM.LegComponent=function(a){MM.RigComponent.call(this);this.joints=[];this.controlNames=["_knee_0_ctrl","_ball_0_ctrl","_toe_0_ctrl","_heel_0_ctrl","_foot_0_ctrl"];this.useCustomAttributes=!1;this.setValues(a);return this};MM.LegComponent.prototype=Object.create(MM.RigComponent.prototype);
MM.LegComponent.prototype.setValues=function(a){MM.RigComponent.prototype.setValues.call(this,a);this.joints="_hip_0_jnt _knee_0_jnt _ankle_0_jnt _ball_0_jnt _toe_0_jnt _heel_0_jnt".split(" ");void 0!==a&&(a.hasOwnProperty("joints")&&(console.log("\tsetting joints value to",a.joints),this.joints=a.joints),a.hasOwnProperty("useCustomAttributes")&&(console.log("\tsetting useCustomAttributes to",a.useCustomAttributes),this.useCustomAttributes=a.useCustomAttributes))};
MM.LegComponent.prototype.build=function(){console.log("LegComponent.build");console.log("\tnamespace",this.namespace);var a=this.editor.scene.getObjectByName(this.namespace+this.side+this.joints[0],!0);if(void 0===a)console.log("\tUnable to find",this.namespace+this.side+this.joints[0]);else{var b=this.editor.scene.getObjectByName(this.namespace+this.side+this.joints[1],!0);if(void 0===b)console.log("\tUnable to find",this.namespace+this.side+this.joints[1]);else{var c=this.editor.scene.getObjectByName(this.namespace+
this.side+this.joints[2],!0);if(void 0===c)console.log("\tUnable to find",this.namespace+this.side+this.joints[2]);else{var d=this.editor.scene.getObjectByName(this.namespace+this.side+this.joints[3],!0);if(void 0===d)console.log("\tUnable to find",this.namespace+this.side+this.joints[3]);else{var e=this.editor.scene.getObjectByName(this.namespace+this.side+this.joints[4],!0);if(void 0===e)console.log("\tUnable to find",this.namespace+this.side+this.joints[4]);else{var f=this.editor.scene.getObjectByName(this.namespace+
this.side+this.joints[5],!0);if(void 0===f)console.log("\tUnable to find",this.namespace+this.side+this.joints[5]);else{var g=(new THREE.Vector3).getPositionFromMatrix(c.matrixWorld),h=(new THREE.Vector3).getPositionFromMatrix(b.matrixWorld),k=(new THREE.Vector3).getPositionFromMatrix(d.matrixWorld),l=(new THREE.Vector3).getPositionFromMatrix(e.matrixWorld),m=(new THREE.Vector3).getPositionFromMatrix(f.matrixWorld),f=(new THREE.Vector3).getPositionFromMatrix(c.matrixWorld),n=new MM.TwoBoneSoftIkSolver;
n.name=this.namespace+this.side+"LegIkSolver";n.position.set(g.x,g.y,g.z);n.setStartJoint(a);n.middleJoint=b;n.endJoint=c;this.editor.addObject(n);console.log("\tAdding ik handle to scene");n.setSoftIk();b=new MM.Control;b.controlSize=2*this.controlScale;b.controlScale.set(1*this.controlScale,1*this.controlScale,1*this.controlScale);b.controlShape="cube";b.name=this.namespace+this.side+this.controlNames[0];b.tag="control";b.controlSide=this.side;b.position.set(h.x,h.y,h.z+25*this.controlScale);b.setChannelsTranslate();
n.poleVector=b;this.editor.addObject(b);this.addControl(b,this.controlNames[0]);a=new MM.Constraint;a.name=this.namespace+this.side+this.controlNames[1];a.position.set(k.x,k.y,k.z);this.editor.addObject(a);a.setObjectToSolve(d);a.constraintMode=0;a.setChannelsRotate();a.setParent(n);h=new MM.Constraint;h.name=this.namespace+this.side+this.controlNames[2];h.setChannelsRotate();h.position.set(l.x,l.y,l.z);this.editor.addObject(h);h.setParent(a);h.constraintMode=3;h.setObjectToSolve(e);e=new MM.Constraint;
e.name=this.namespace+this.side+"BallOrient";k=d.matrixWorld.getPosition();e.position.set(k.x,k.y,k.z);this.editor.addObject(e);h.setParent(e);e.constraintMode=1;e.setObjectToSolve(d);k=new MM.Control;k.name=this.namespace+this.side+this.controlNames[3];k.controlSide=this.side;k.position.set(m.x,m.y,m.z);k.setChannelsRotate();this.editor.addObject(k);k.setParent(h);d=new MM.Control;d.name=this.namespace+this.side+this.controlNames[4];d.tag="control";d.controlSide=this.side;d.controlSize=4*this.controlScale;
d.controlOffset.set(0,0,2);d.controlScale.set(.8,0,1.4);d.controlShape="plane";d.position.set(f.x,0,f.z);this.editor.addObject(d);d.setParent(k);d.setParent(b);d.setChannelsTranslateAndRotate();d.custom={};n.setSoftControl(d);this.addControl(d,this.controlNames[4]);f=new MM.Constraint;f.name=this.namespace+this.side+"AnkleOrient";f.position.set(g.x,g.y,g.z);a.setParent(f);f.constraintMode=1;f.setObjectToSolve(c);!0===this.useCustomAttributes&&(d.addChannel("custom","toePivot"),d.addChannel("custom",
"ballPivot"),d.addChannel("custom","heelPivot"),_.extend(d.custom,{toePivot:0,ballPivot:0,heelPivot:0}),c=new MM.MultiChannel,c.name=this.namespace+this.side+"HeelPivotMC",c.setDriverChannel(d,"custom","heelPivot"),c.addDrivenChannel(k,"rotation","x"),this.editor.step2Nodes.push(c),c=new MM.MultiChannel,c.name=this.namespace+this.side+"BallPivotMC",c.setDriverChannel(d,"custom","ballPivot"),c.addDrivenChannel(a,"rotation","x"),this.editor.step2Nodes.push(c),c=new MM.MultiChannel,c.name=this.namespace+
this.side+"ToePivotMC",c.setDriverChannel(d,"custom","toePivot"),c.addDrivenChannel(h,"rotation","x"),this.editor.step2Nodes.push(c));return this}}}}}}};MM.LegBlendComponent=function(a){MM.RigComponent.call(this);this.joints="Hip Knee Ankle Heel Ball Toe".split(" ");this.controlNames="HipFkCtl KneeFkCtl AnkleFkCtl BallFkCtl LegSwitch KneeIkCtl FootIkCtl".split(" ");this.poleVectorOffset=25;this.setValues(a);return this};MM.LegBlendComponent.prototype=Object.create(MM.RigComponent.prototype);
MM.LegBlendComponent.prototype.setValues=function(a){MM.RigComponent.prototype.setValues.call(this,a);void 0!==a&&a.hasOwnProperty("poleVectorOffset")&&(this.poleVectorOffset=a.poleVectorOffset)};
MM.LegBlendComponent.prototype.build=function(){var a=this.getJoints(),b=this.getJointPositions(),c=MM.createControlGroup(this.side,this.getName(this.controlNames[0]),"circle",this.controlSize);c.control.setChannelsRotate();void 0!==a[this.joints[0]].parent&&a[this.joints[0]].parent.add(c.zero);c.zero.applyMatrix(a[this.joints[0]].matrix);c.control.controlType=1;this.addControl(c.control,this.controlNames[0]);var d=MM.createControlGroup(this.side,this.getName(this.controlNames[1]),"circle",this.controlSize);
d.control.setChannelsRotate();c.control.add(d.zero);d.zero.applyMatrix(a[this.joints[1]].matrix);d.control.controlType=1;this.addControl(d.control,this.controlNames[1]);var e=MM.createControlGroup(this.side,this.getName(this.controlNames[2]),"circle",this.controlSize);e.control.setChannelsRotate();d.control.add(e.zero);e.zero.applyMatrix(a[this.joints[2]].matrix);e.control.controlType=1;this.addControl(e.control,this.controlNames[2]);var f=MM.createControlGroup(this.side,this.getName(this.controlNames[3]),
"circleZ",this.controlSize);f.control.setChannelsRotate();e.control.add(f.zero);f.zero.applyMatrix(a[this.joints[4]].matrix);f.control.controlType=1;this.addControl(f.control,this.controlNames[3]);var g=MM.createControlGroup(this.side,this.getName(this.controlNames[6]),"plane",this.controlSize);g.zero.position.set(b[this.joints[2]].x,0,b[this.joints[2]].z);g.control.setChannelsTranslateAndRotate();this.editor.addObject(g.zero);g.control.controlType=2;this.addControl(g.control,this.controlNames[6]);
g.control.addChannel("custom","heelRoll");g.control.addChannel("custom","toeRoll");g.control.addChannel("custom","ballRoll");g.control.addChannel("custom","toeRotate");g.control.custom={heelRoll:0,toeRoll:0,ballRoll:0,toeRotate:0};var h=MM.createControlGroup(this.side,this.getName(this.controlNames[5]),"planeZ",this.controlSize);h.zero.position.set(b[this.joints[1]].x,b[this.joints[1]].y,b[this.joints[1]].z+this.poleVectorOffset*this.controlScale);h.control.setChannelsTranslate();h.control.controlType=
2;this.editor.addObject(h.zero);this.addControl(h.control,this.controlNames[5]);var k=new THREE.Object3D;k.name=this.getName("heelIkGrp");k.position.set(b[this.joints[3]].x,b[this.joints[3]].y,b[this.joints[3]].z);this.editor.addObject(k);g.control.setParent(k);var l=new THREE.Object3D;l.name=this.getName("toeIkGrp");l.position.set(b[this.joints[5]].x,b[this.joints[5]].y,b[this.joints[5]].z);this.editor.addObject(l);k.setParent(l);var m=new THREE.Object3D;m.name=this.getName("ballIkGrp");m.position.set(b[this.joints[4]].x,
b[this.joints[4]].y,b[this.joints[4]].z);this.editor.addObject(m);l.setParent(m);var n=new THREE.Object3D;n.name=this.getName("ankleIkGrp");n.position.set(b[this.joints[2]].x,b[this.joints[2]].y,b[this.joints[2]].z);this.editor.addObject(n);m.setParent(n);var r=new MM.Control;r.name=this.getName(this.controlNames[4]);r.controlOffset.z=-5;r.setControlShape(this.side,"triangleX",.5*this.controlSize);a[this.joints[2]].add(r);this.addControl(r,this.controlNames[4]);r.setChannelsEmpty();var q=new MM.FourBoneIkBlendSolver;
q.endJointEqualsHandleOrientation=!0;q.name=this.getName("IkSolver");console.log("\tik",q);q.position.set(b[this.joints[2]].x,b[this.joints[2]].y,b[this.joints[2]].z);this.editor.addObject(q);n.setParent(q);q.setStartJoint(a[this.joints[0]]);q.middleJoint=a[this.joints[1]];q.endJoint=a[this.joints[2]];q.endJoint.rotation.order="YXZ";q.heelJoint=a[this.joints[3]];q.ballJoint=a[this.joints[4]];q.toeJoint=a[this.joints[5]];q.startFkCtrl=c.control;q.middleFkCtrl=d.control;q.endFkCtrl=e.control;q.ballFkCtl=
f.control;q.setSoftControl(r);q.setSoftIk();q.setBlendControl(r);q.ikFkBlendGroup="custom";q.ikFkBlendChannel="ikFkBlend";q.poleVector=h.control;q.handleControl=g.control;r.custom.stretchMax=2;q.footCtrl=g.control;q.toeObject=l;q.ballObject=m;q.heelObject=k;q.ankleObject=n;q.toeChannel="toeRoll";q.ballChannel="ballRoll";q.heelChannel="heelRoll";q.toeRotateChannel="toeRotate";a=[q.customCtrl,q.startFkCtrl,q.middleFkCtrl,q.endFkCtrl,q.ballFkCtl,q.poleVector,q.handleControl];this.editor.addGroupContent(this.assetGroup,
a);this.editor.addSelectables(a);this.editor.addGroupContent(this.assetGroup,[h.control,g.control]);return this};MM.TwoStepLegBlendComponent=function(a){MM.RigComponent.call(this);this.joints="Hip Knee Ankle Heel Ball0 Ball1 Toe".split(" ");this.controlNames="HipFkCtl KneeFkCtl AnkleFkCtl BallFkCtl ToeFkCtl LegSwitch KneeIkCtl FootIkCtl".split(" ");this.setValues(a);return this};MM.TwoStepLegBlendComponent.prototype=Object.create(MM.RigComponent.prototype);
MM.TwoStepLegBlendComponent.prototype.build=function(){var a=this.getJoints(),b=this.getJointPositions(),c=MM.createControlGroup(this.side,this.getName(this.controlNames[0]),"circle",2);c.control.setChannelsRotate();void 0!==a[this.joints[0]].parent&&a[this.joints[0]].parent.add(c.zero);c.zero.applyMatrix(a[this.joints[0]].matrix);c.control.controlType=1;this.addControl(c.control,this.controlNames[0]);var d=MM.createControlGroup(this.side,this.getName(this.controlNames[1]),"circle",2);d.control.setChannelsRotate();
c.control.add(d.zero);d.zero.applyMatrix(a[this.joints[1]].matrix);d.control.controlType=1;this.addControl(d.control,this.controlNames[1]);var e=MM.createControlGroup(this.side,this.getName(this.controlNames[2]),"circle",3);e.control.setChannelsRotate();d.control.add(e.zero);e.zero.applyMatrix(a[this.joints[2]].matrix);e.control.controlType=1;this.addControl(e.control,this.controlNames[2]);var f=MM.createControlGroup(this.side,this.getName(this.controlNames[3]),"circleZ",3);f.control.setChannelsRotate();
e.control.add(f.zero);f.zero.applyMatrix(a[this.joints[4]].matrix);f.control.controlType=1;this.addControl(f.control,this.controlNames[3]);var g=MM.createControlGroup(this.side,this.getName(this.controlNames[4]),"circleZ",3);g.control.setChannelsRotate();f.control.add(g.zero);g.zero.applyMatrix(a[this.joints[5]].matrix);g.control.controlType=1;this.addControl(g.control,this.controlNames[3]);var h=MM.createControlGroup(this.side,this.getName(this.controlNames[7]),"plane",5);h.zero.position.set(b[this.joints[2]].x,
0,b[this.joints[2]].z);h.control.setChannelsTranslateAndRotate();this.editor.addObject(h.zero);h.control.controlType=2;this.addControl(h.control,this.controlNames[7]);h.control.addChannel("custom","heelRoll");h.control.addChannel("custom","toeRoll");h.control.addChannel("custom","ballRoll");h.control.addChannel("custom","toeRotate");h.control.custom={heelRoll:0,toeRoll:0,ballRoll:0,toeRotate:0};var k=MM.createControlGroup(this.side,this.getName(this.controlNames[6]),"planeZ",2.5);k.zero.position.set(b[this.joints[1]].x,
b[this.joints[1]].y,b[this.joints[1]].z+25*this.controlScale);k.control.setChannelsTranslate();k.control.controlType=2;this.editor.addObject(k.zero);this.addControl(k.control,this.controlNames[6]);var l=new MM.Control;l.name=this.getName(this.controlNames[5]);l.controlOffset.z=-5;l.setControlShape(this.side,"triangleX",2);a[this.joints[2]].add(l);this.addControl(l,this.controlNames[5]);l.setChannelsEmpty();l.addChannel("custom","ikFkBlend");l.addChannel("custom","stretchFactor");l.addChannel("custom",
"stretchAuto");l.addChannel("custom","stretchMin");l.addChannel("custom","stretchMax");l.custom={ikFkBlend:0,stretchFactor:1,stretchAuto:1,stretchMin:.5,stretchMax:1.5};var m=new THREE.Object3D;m.name=this.getName("heelIkGrp");m.position.set(b[this.joints[3]].x,b[this.joints[3]].y,b[this.joints[3]].z);this.editor.addObject(m);h.control.setParent(m);var n=new THREE.Object3D;n.name=this.getName("toeIkGrp");n.position.set(b[this.joints[6]].x,b[this.joints[6]].y,b[this.joints[6]].z);this.editor.addObject(n);
m.setParent(n);var r=new THREE.Object3D;r.name=this.getName("ball1IkGrp");r.position.set(b[this.joints[5]].x,b[this.joints[5]].y,b[this.joints[5]].z);this.editor.addObject(r);n.setParent(r);var q=new THREE.Object3D;q.name=this.getName("ball0IkGrp");q.position.set(b[this.joints[4]].x,b[this.joints[4]].y,b[this.joints[4]].z);this.editor.addObject(q);r.setParent(q);this.editor.addGroupContent(this.assetGroup,[h.control,m,n,r,q]);var p=new MM.TwoStepFourBoneIkBlendSolver;p.endJointEqualsHandleOrientation=
!0;p.name=this.getName("IkSolver");p.position.set(b[this.joints[2]].x,b[this.joints[2]].y,b[this.joints[2]].z);this.editor.addObject(p);q.setParent(p);p.setStartJoint(a[this.joints[0]]);p.middleJoint=a[this.joints[1]];p.endJoint=a[this.joints[2]];p.endJoint.rotation.order="YXZ";p.heelJoint=a[this.joints[3]];p.ball0Joint=a[this.joints[4]];p.ball1Joint=a[this.joints[5]];p.toeJoint=a[this.joints[6]];p.startFkCtrl=c.control;p.middleFkCtrl=d.control;p.endFkCtrl=e.control;p.ball0FkCtl=f.control;p.ball1FkCtl=
g.control;p.customCtrl=l;p.ikFkBlendGroup="custom";p.ikFkBlendChannel="ikFkBlend";p.poleVector=k.control;p.handleControl=h.control;p.stretchAxis="y";p.stretchGroup="custom";p.stretchChannel="stretchFactor";p.autoStretchGroup="custom";p.autoStretchChannel="stretchAuto";p.autoMinChannel="stretchMin";p.autoMaxChannel="stretchMax";l.custom.stretchMax=1;p.footCtrl=h.control;p.toeObject=n;p.ball0Object=q;p.ball1Object=r;p.heelObject=m;p.toeChannel="toeRoll";p.ballChannel="ballRoll";p.heelChannel="heelRoll";
p.toeRotateChannel="toeRotate";return this};MM.insertCamera=function(a){var b=a.signals,c=new THREE.PerspectiveCamera(50,100,.1,1E3);c.name="camera";c.tag="control";c.position.set(50,25,50);c.lookAt(new THREE.Vector3(0,0,0));a.addObject(c);a.cameras.push(c);b.cameraAdded.dispatch();c.setChannelsTranslateAndRotate();c.custom={focusLength:35,frameHeight:24,near:.1,far:2E3};c.addChannel("custom","focusLength");c.addChannel("custom","frameHeight");c.addChannel("custom","near");c.addChannel("custom","far");c.setLens(35,24);b=a.scene.getUniqueNamespace("camera");
b=a.addGroup(b+"group","camera");a.addGroupContent(b,[c])};MM.insertCube=function(a){console.log("insertCube",a);var b=a.scene.getUniqueNamespace("cube"),c=new THREE.CubeGeometry(10,10,10,1,1,1),c=new THREE.Mesh(c,new THREE.MeshLambertMaterial);c.name=b+"mesh";c.asset="cube";c.castShadow=!0;c.receiveShadow=!1;a.addObject(c);var d=new MM.Control;d.asset="cube";d.name=b+"parent";d.setControlShape("c","plane",10);a.addObject(d);a.addSelectables([d]);var e=new MM.Control;e.asset="cube";e.name=b+"main";e.setControlShape("c","plane",6);d.add(e);e.setChannelsTranslateAndRotate();
e.add(c);a.addSelectables([e]);var f=a.addGroup(b+"group","asset"),g=a.addGroup(b+"group","material");a.addGroupContent(f,[d,e]);a.addGroupContent(g,[c]);c.addChannel("custom","visibility");c.addChannel("custom","color");c.custom={visibility:c.visible,color:c.material.color};a.controlsVisibility();g=new MM.Asset;g.name="cube";g.namespace=b;g.models.push(c);g.controls.push(d);g.controls.push(e);g.assetGroup=f;a.addAssetObject(g);a.getUndoDataForAddAsset(b,"undo")};MM.insertDino=function(a){console.log("insertDino")};MM.insertGround=function(a){var b=a.scene.getUniqueNamespace("ground");console.log("namespace",b);var c=new THREE.PlaneGeometry(250,250,1,1),d=new THREE.MeshBasicMaterial({color:11776947});d.shading=THREE.FlatShading;d.opacity=.05;d.transparent=!0;c=new THREE.Mesh(c,d);c.name=b+"main";c.tag="control";c.asset="ground";c.rotateX(-90);c.castShadow=!1;c.receiveShadow=!0;a.addObject(c);d=a.addGroup(b+"group");a.addGroupContent(d,[c]);d=new MM.Asset;d.name="ground";d.namespace=b;d.models.push(c);a.addAssetObject(d);
a.addSelectables([c]);a.getUndoDataForAddAsset(b,"undo")};MM.insertLegs=function(a){console.log("insertLegs");var b=new MM.AssetBuild(a);b.assetName="legs";b.setNamespace("legs:");b.addModel("/data/drone1/model/cBody.obj");b.addModel("/data/drone1/model/cJoints.obj");b.addSkeleton("/data/drone1/skeleton/cRoot_skeleton.json");b.addSkin("/data/drone1/weights/cBody_skin.json");b.addSkin("/data/drone1/weights/cJoints_skin.json");b.addRigComponent(new MM.GlobalComponent({controlShape:"plane",controlSize:12,asset:"legs",side:"c",names:["GlobalCtl"],joints:["Root"]}));
b.addRigComponent(new MM.GlobalComponent({controlShape:"plane",controlSize:10,asset:"legs",side:"c",names:["BodyCtl","HipCtl"],joints:["Spine0","Spine0"]}));for(var c="HipFkCtl KneeFkCtl AnkleFkCtl BallFkCtl LegSwitch KneeIkCtl FootIkCtl".split(" "),d="Hip Knee Ankle Heel Ball Toe".split(" "),e=["l","r"],f=0;f<e.length;f++)b.addRigComponent(new MM.LegBlendComponent({controlSize:2.5,side:e[f],asset:"legs",names:c,joints:d}));b.addLast(function(){for(var c=["l","r"],d=["Ankle","Knee"],e,f,m=0;m<c.length;m++)for(var n=
0;n<d.length;n++)e="legs:"+c[m]+d[n],f="legs:"+c[m]+d[n]+"Stretch",e=a.scene.getObjectByName(e,!0),f=a.scene.getObjectByName(f,!0),e.connectChannelTo(f,"position");b.rigComponents[2].controls.FootIkCtl.controlScale.x=1.2;b.rigComponents[2].controls.FootIkCtl.controlScale.z=2.4;b.rigComponents[2].controls.FootIkCtl.controlOffset.z=2;b.rigComponents[3].controls.FootIkCtl.controlScale.x=1.2;b.rigComponents[3].controls.FootIkCtl.controlScale.z=2.4;b.rigComponents[3].controls.FootIkCtl.controlOffset.z=
2;b.rigComponents[1].controls.BodyCtl.controlOffset.y=-1;b.rigComponents[1].controls.HipCtl.controlOffset.y=1;b.rigComponents[0].controls.GlobalCtl.setParent(b.rigComponents[1].controls.BodyCtl.parent);b.rigComponents[0].controls.GlobalCtl.setParent(b.rigComponents[2].controls.FootIkCtl.parent);b.rigComponents[0].controls.GlobalCtl.setParent(b.rigComponents[3].controls.FootIkCtl.parent);b.rigComponents[0].controls.GlobalCtl.setParent(b.rigComponents[2].controls.KneeIkCtl.parent);b.rigComponents[0].controls.GlobalCtl.setParent(b.rigComponents[3].controls.KneeIkCtl.parent);
a.controlsVisibility();m=0;for(n=b.models.length;m<n;m++)switch(b.models[m].addChannel("custom","color"),b.models[m].custom={visibility:b.models[m].visible,color:b.models[m].material.color},b.models[m].name){case b.namespace+"cBody":b.models[m].material.color.setRGB(85/255,72/255,68/255);break;case b.namespace+"cJoints":b.models[m].material.color.setRGB(114/255,63/255,55/255)}a.getUndoDataForAddAsset(b.namespace,"undo")});b.showProgress();b.build()};
MM.legsSelect=function(a,b,c){console.log("legsSelect",a,b,c);b.setHeight("128px");var d=new MMUI.Panel;d.setPosition("absolute");b.add(d);b=document.createElement("img");b.src="/ui/legsSelect1.gif";b.width=205;b.height=128;d.dom.appendChild(b);b=new MMUI.Button("");b.setClass("gCtrlButton");b.setPosition("absolute");b.setLeft("95px");b.setBottom("6px");b.onClick(function(){c.selectObjectByName(a+":cGlobalCtl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButton");b.setPosition("absolute");b.setLeft("95px");
b.setBottom("84px");b.onClick(function(){c.selectObjectByName(a+":cBodyCtl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButtonIk");b.setPosition("absolute");b.setLeft("95px");b.setBottom("110px");b.onClick(function(){c.selectObjectByName(a+":cHipCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButtonIk");b.setPosition("absolute");b.setRight("10px");b.setBottom("108px");b.onClick(function(){c.selectObjectByName(a+":lKneeIkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButton");
b.setPosition("absolute");b.setRight("40px");b.setBottom("108px");b.onClick(function(){c.selectObjectByName(a+":lKneeFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButton");b.setPosition("absolute");b.setRight("66px");b.setBottom("108px");b.onClick(function(){c.selectObjectByName(a+":lHipFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButton");b.setPosition("absolute");b.setRight("40px");b.setBottom("84px");b.onClick(function(){c.selectObjectByName(a+":lAnkleFkCtl")});d.add(b);
b=new MMUI.Button("");b.setClass("lCtrlButtonIk");b.setPosition("absolute");b.setRight("20px");b.setBottom("84px");b.onClick(function(){c.selectObjectByName(a+":lFootIkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButtonSwitch");b.setPosition("absolute");b.setRight("0px");b.setBottom("84px");b.onClick(function(){c.selectObjectByName(a+":lLegSwitch")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButton");b.setPosition("absolute");b.setRight("40px");b.setBottom("48px");b.onClick(function(){c.selectObjectByName(a+
":lBallFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButtonIk");b.setPosition("absolute");b.setLeft("10px");b.setBottom("108px");b.onClick(function(){c.selectObjectByName(a+":rKneeIkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");b.setPosition("absolute");b.setLeft("40px");b.setBottom("108px");b.onClick(function(){c.selectObjectByName(a+":rKneeFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");b.setPosition("absolute");b.setLeft("66px");b.setBottom("108px");
b.onClick(function(){c.selectObjectByName(a+":rHipFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");b.setPosition("absolute");b.setLeft("40px");b.setBottom("84px");b.onClick(function(){c.selectObjectByName(a+":rAnkleFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButtonIk");b.setPosition("absolute");b.setLeft("20px");b.setBottom("84px");b.onClick(function(){c.selectObjectByName(a+":rFootIkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButtonSwitch");b.setPosition("absolute");
b.setLeft("0px");b.setBottom("84px");b.onClick(function(){c.selectObjectByName(a+":rLegSwitch")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");b.setPosition("absolute");b.setLeft("40px");b.setBottom("48px");b.onClick(function(){c.selectObjectByName(a+":rBallFkCtl")});d.add(b);return d};
MM.legsKeyAll=function(a,b,c){console.log("legsKeyAll",a,b,c);var d=[a+":cGlobalCtl",a+":cBodyCtl",a+":cHipCtl",a+":lLegSwitch",a+":rLegSwitch",a+":lKneeIkCtl",a+":lFootIkCtl",a+":rKneeIkCtl",a+":rFootIkCtl",a+":lHipFkCtl",a+":lKneeFkCtl",a+":lAnkleFkCtl",a+":lBallFkCtl",a+":rHipFkCtl",a+":rKneeFkCtl",a+":rAnkleFkCtl",a+":rBallFkCtl"],e=new MM.AssetKeySelectControls(c);e.setTitle("All").setControls(d);e.setBackgroundColor("#D8D8D8");b.add(e.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Global").setControls([a+
":cGlobalCtl"]);b.add(d.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Body").setControls([a+":cBodyCtl"]);d.setBackgroundColor("#D8D8D8");b.add(d.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Left Leg IK").setControls([a+":lKneeIkCtl",a+":lFootIkCtl"]);b.add(d.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Right Leg IK").setControls([a+":rKneeIkCtl",a+":rFootIkCtl"]);b.add(d.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Left Leg FK").setControls([a+":lHipFkCtl",a+":lKneeFkCtl",
a+":lAnkleFkCtl",a+":lBallFkCtl"]);d.setBackgroundColor("#D8D8D8");b.add(d.panel);c=new MM.AssetKeySelectControls(c);c.setTitle("Right Leg FK").setControls([a+":rHipFkCtl",a+":rKneeFkCtl",a+":rAnkleFkCtl",a+":rBallFkCtl"]);c.setBackgroundColor("#D8D8D8");b.add(c.panel);return b};MM.insertPlane=function(a){console.log("insertPlane");var b=a.scene.getUniqueNamespace("plane"),c=new THREE.PlaneGeometry(250,250,1,1),c=new THREE.Mesh(c,new THREE.MeshLambertMaterial);c.name=b+"main";c.tag="control";c.asset="plane";c.rotateX(-90);c.castShadow=!1;c.receiveShadow=!0;a.addObject(c);a.addSelectables([c]);var d=a.addGroup(b+"group","asset");a.addGroupContent(d,[c]);var e=new MM.Asset;e.name="plane";e.namespace=b;e.models.push(c);e.assetGroup=d;a.addAssetObject(e);a.getUndoDataForAddAsset(b,
"undo")};MM.insertRamp=function(a){console.log("insertRamp");var b=new MM.AssetBuild(a);b.setNamespace("ramp");b.assetName="ramp";b.addModel("/data/ramp/model/ramp.obj");b.addLast(function(){var d=new MM.Control;d.name=b.namespace+"main";d.asset="ramp";d.setControlShape();a.addObject(d);a.addSelectables([d]);d.add(c.models[0]);c.models[0].name=b.namespace+"mesh";a.addGroupContent(b.assetGroup,[d]);a.addGroupContent(b.materialGroup,[c.models[0]]);a.controlsVisibility();a.getUndoDataForAddAsset(b.namespace,
"undo")});b.build();var c=b};MM.insertSphere=function(a){var b=a.scene.getUniqueNamespace("sphere"),c=new THREE.SphereGeometry(5,16,16),c=new THREE.Mesh(c,new THREE.MeshLambertMaterial);c.name=b+"mesh";c.asset="sphere";c.castShadow=!0;c.receiveShadow=!1;c.material.color.r=85/255;c.material.color.g=72/255;c.material.color.b=68/255;a.addObject(c);console.log("building");var d=new MM.createControlGroup("c",b+"ground","plane",10);a.addObject(d.zero);d.control.setChannelsTranslateAndRotate();var e=new MM.createControlGroup("c",b+
"main","circle",7.5);a.addObject(d.zero);d.control.add(e.zero);e.zero.position.set(0,5,0);e.control.add(c);a.addSelectables([d.control,e.control]);var f=a.addGroup(b+"group","asset"),g=a.addGroup(b+"group","material");a.addGroupContent(f,[d.control,e.control]);a.addGroupContent(g,[c]);c.addChannel("custom","color");c.custom={visibility:c.visible,color:c.material.color};g=new MM.Asset;g.name="sphere";g.namespace=b;g.models.push(c);g.controls.push(d.control);g.controls.push(e.control);g.assetGroup=
f;a.addAssetObject(g);a.controlsVisibility()};
MM.sphereSelect=function(a,b,c){console.log("MM.sphereSelect",a,b,c);b.setHeight("180px");var d=new MMUI.Panel;d.setPosition("absolute");b.add(d);b=document.createElement("img");b.src="/ui/sphereSelect.gif";b.width=180;b.height=180;d.dom.appendChild(b);b=new MMUI.Button("");b.setClass("gCtrlButton");b.setPosition("absolute");b.setLeft("85px");b.setBottom("10px");b.onClick(function(){c.selectObjectByName(a+":ground")});d.add(b);b=new MMUI.Button("");b.setClass("gCtrlButton");b.setPosition("absolute");
b.setLeft("85px");b.setBottom("30px");b.onClick(function(){c.selectObjectByName(a+":main")});d.add(b);return d};MM.insertTail=function(a){var b=new MM.AssetBuild(a);b.assetName="tail";b.setNamespace("tail:");b.addModel("/data/tail/model/cMain.obj");b.addSkeleton("/data/tail/skeleton/cRoot_skeleton.json");b.addSkin("/data/tail/weights/cMain_skin.json");b.addRigComponent(new MM.GlobalComponent({controlShape:"plane",controlSize:20,asset:"tail",side:"c",names:["GlobalCtl"],joints:["Root"]}));b.addRigComponent(new MM.GlobalComponent({controlShape:"circle",controlSize:14,asset:"tail",side:"c",names:["BodyCtl","Body2Ctl"],
joints:["Body","Body"]}));b.addRigComponent(new MM.FkChainComponent({controlSize:7,controlShape:"circleZ",asset:"tail",side:"c",names:["Tail0Ctl","Tail1Ctl","Tail2Ctl","Tail3Ctl","Tail4Ctl"],joints:["Tail0","Tail1","Tail2","Tail3","Tail4"]}));b.addLast(function(){b.rigComponents[0].controls.GlobalCtl.setParent(b.rigComponents[1].controls.BodyCtl.parent);b.rigComponents[1].controls.Body2Ctl.setParent(b.rigComponents[2].controls.Tail0Ctl.parent);a.controlsVisibility();a.jointsVisibility();var c,d;c=
0;for(d=b.models.length;c<d;c++)switch(b.models[c].name){case b.namespace+"cMain":b.models[c].material.color.setRGB(85/255,72/255,68/255)}a.getUndoDataForAddAsset(b.namespace,"undo")});b.showProgress();b.build()};
MM.tailSelect=function(a,b,c){console.log("tailSelect",a,b,c);b.setHeight("306px");var d=new MMUI.Panel;d.setPosition("absolute");b.add(d);b=document.createElement("img");b.src="/ui/tailSelect1.gif";b.width=205;b.height=306;d.dom.appendChild(b);b=new MMUI.Button("");b.setClass("gCtrlButton");b.setPosition("absolute");b.setLeft("92px");b.setTop("10px");b.onClick(function(){c.selectObjectByName(a+":cGlobalCtl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButton");b.setPosition("absolute");b.setLeft("92px");
b.setTop("60px");b.onClick(function(){c.selectObjectByName(a+":cBodyCtl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButton");b.setPosition("absolute");b.setLeft("92px");b.setTop("80px");b.onClick(function(){c.selectObjectByName(a+":cBody2Ctl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButton");b.setPosition("absolute");b.setLeft("92px");b.setTop("130px");b.onClick(function(){c.selectObjectByName(a+":cTail0Ctl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButton");b.setPosition("absolute");
b.setLeft("92px");b.setTop("160px");b.onClick(function(){c.selectObjectByName(a+":cTail1Ctl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButton");b.setPosition("absolute");b.setLeft("92px");b.setTop("190px");b.onClick(function(){c.selectObjectByName(a+":cTail2Ctl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButton");b.setPosition("absolute");b.setLeft("92px");b.setTop("220px");b.onClick(function(){c.selectObjectByName(a+":cTail3Ctl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButton");
b.setPosition("absolute");b.setLeft("92px");b.setTop("250px");b.onClick(function(){c.selectObjectByName(a+":cTail4Ctl")});d.add(b);return d};
MM.tailKeyAll=function(a,b,c){console.log("cubeKeyAll",a,b);var d=[a+":cGlobalCtl",a+":cBodyCtl",a+":cBody2Ctl",a+":cTail4Ctl",a+":cTail3Ctl",a+":cTail2Ctl",a+":cTail1Ctl",a+":cTail0Ctl"],e=new MM.AssetKeySelectControls(c);e.setTitle("All").setControls(d);e.setBackgroundColor("#D8D8D8");b.add(e.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Global").setControls([a+":cGlobalCtl"]);b.add(d.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Body").setControls([a+":cBodyCtl"]);d.setBackgroundColor("#D8D8D8");
b.add(d.panel);c=new MM.AssetKeySelectControls(c);c.setTitle("Tail").setControls([a+":cTail4Ctl",a+":cTail3Ctl",a+":cTail2Ctl",a+":cTail1Ctl",a+":cTail0Ctl"]);b.add(c.panel);return b};MM.insertBiped=function(a,b){console.log("insertBiped ",a,b);if(void 0==b)console.log("\tNo config file defined.");else{var c=new MM.AssetBuild(a);c.setNamespace(b.namespace);c.assetName=b.name;if(b.hasOwnProperty("root_path")){var d;if(b.hasOwnProperty("models"))for(d in b.models)console.log("\tmodel ",b.models[d]),c.addModel(b.root_path+b.models[d]);var e;if(b.hasOwnProperty("joints"))for(e in b.joints)console.log("\tjoint ",b.joints[e]),c.addSkeleton(b.root_path+b.joints[e]);var f;if(b.hasOwnProperty("skins"))for(f in b.skins)console.log("\tskin ",
b.skins[f]),c.addSkin(b.root_path+b.skins[f]);c.addRigComponent(new MM.GlobalComponent({controlSize:10*b.control_scale,controlShape:"plane",asset:b.name,side:"c",names:["GlobalCtl"],joints:["Root"]}),"global");c.addRigComponent(new MM.SpineComponent({controlSize:1*b.control_scale,asset:b.name,names:["cBodyCtl","cHipCtl","cBChestCtl"],joints:["cSpine0","cSpine1","cSpine2","cSpine3"]}),"back");c.addRigComponent(new MM.SpineComponent({controlSize:1*b.control_scale,globalControl:!1,asset:b.name,names:["",
"cTChestCtl","cHeadCtl"],joints:["cSpine4","cNeck0","cNeck1","cNeck2"]}),"head");d="HipFkCtl KneeFkCtl AnkleFkCtl BallFkCtl LegSwitch KneeIkCtl FootIkCtl".split(" ");e="Hip Knee Ankle Heel Ball Toe".split(" ");f=["Collar","Shoulder"];for(var g="ShoulderFkCtl ElbowFkCtl WristFkCtl ArmSwitch ElbowCtl HandCtl".split(" "),h=["Shoulder","Elbow","Wrist"],k=["l","r"],l=0;l<k.length;l++)c.addRigComponent(new MM.LegBlendComponent({controlSize:2*b.control_scale,side:k[l],stretchAxis:"y",asset:b.name,names:d,
joints:e,poleVectorOffset:25*b.control_distance}),k[l]+"Leg"),c.addRigComponent(new MM.ShoulderComponent({controlSize:1*b.control_scale,side:k[l],parentJoint:"cSpine4",asset:b.name,names:["ShoulderCtl"],joints:f}),k[l]+"Shoulder"),c.addRigComponent(new MM.LimbComponent({controlSize:2*b.control_scale,asset:b.name,side:k[l],fkControlShape:"circleX",ikControlShape:"plane",stretchAxis:"x",buildIkControlOnFloor:!1,names:g,joints:h,poleVectorOffset:-25*b.control_distance}),k[l]+"Arm");c.addLast(function(){for(var d=
["l","r"],e=["Ankle","Knee","Elbow","Wrist"],f,g,h=0;h<d.length;h++)for(var k=0;k<e.length;k++)f=c.namespace+d[h]+e[k],g=c.namespace+d[h]+e[k]+"Stretch",f=a.scene.getObjectByName(f,!0),g=a.scene.getObjectByName(g,!0),f.connectChannelTo(g,"position");for(h=0;h<d.length;h++)e=a.scene.getObjectByName(c.namespace+d[h]+"Eye",!0),k=MM.createConstraintGroup(d[h],c.namespace+d[h]+"EyeCtl","planeZ",1),k.constraint.controlOffset.z=1,c.rigComponents[2].controls.cHeadCtl.setParent(k.zero),k.zero.applyMatrix(e.matrix),
k.zero.updateMatrixWorld(),k.constraint.constraintMode=5,k.constraint.setObjectToSolve(e),a.addGroupContent(c.assetGroup,[k.constraint]),a.addSelectables([k.constraint]),c.addControls([k]),k=a.scene.getObjectByName(c.namespace+d[h]+"Finger",!0),f=MM.createConstraintGroup(d[h],c.namespace+d[h]+"FingerCtl","circleZ",1.25),e=a.scene.getObjectByName(c.namespace+d[h]+"Wrist",!0),void 0===e&&console.error("Unable to find",c.namespace+d[h]+"Wrist"),e.setParent(f.zero),0===h?f.constraint.setDisplayColor(new THREE.Color(102)):
f.constraint.setDisplayColor(new THREE.Color(6684672)),f.constraint.animChannels=[["rotation",["z"]]],f.constraint.constraintMode=1,f.constraint.setObjectToSolve(k),f.constraint.asset=c.assetName,f.zero.applyMatrix(k.matrix),a.addGroupContent(c.assetGroup,[f.constraint]),a.addSelectables([f.constraint]),c.addControls([f]),k=a.scene.getObjectByName(c.namespace+d[h]+"Thumb",!0),f=MM.createConstraintGroup(d[h],c.namespace+d[h]+"ThumbCtl","circle",1.25),e.setParent(f.zero),0===h?f.constraint.setDisplayColor(new THREE.Color(102)):
f.constraint.setDisplayColor(new THREE.Color(6684672)),f.constraint.setChannelsRotate(),f.constraint.constraintMode=1,f.constraint.setObjectToSolve(k),f.constraint.asset=c.assetName,f.zero.applyMatrix(k.matrix),a.addGroupContent(c.assetGroup,[f.constraint]),a.addSelectables([f.constraint]),c.addControls([f]);h=a.scene.getObjectByName(c.namespace+"cJaw",!0);e=new MM.Constraint;e.name=c.namespace+"cJawCtl";e.asset=c.assetName;e.setControlShape("c","cube",5);c.rigComponents[2].controls.cHeadCtl.add(e);
e.constraintMode=1;e.setObjectToSolve(h);a.addGroupContent(c.assetGroup,[e]);e.setChannelsRotate();a.addSelectables([e]);c.addControls([e]);c.getRigComponent("back").controls.cBChestCtl.setParent(c.getRigComponent("head").controls.cTChestCtl.parent);c.getRigComponent("head").controls.cHeadCtl.parent.addSpace(c.getRigComponent("global").controls.GlobalCtl);c.getRigComponent("head").controls.cHeadCtl.parent.addSpace(c.getRigComponent("back").controls.cBodyCtl);c.getRigComponent("head").controls.cHeadCtl.parent.addSpace(c.getRigComponent("head").controls.cTChestCtl);
c.getRigComponent("head").controls.cHeadCtl.parent.addSpaceswitchChannel(c.getRigComponent("head").controls.cHeadCtl);c.getRigComponent("head").controls.cTChestCtl.setParent(c.getRigComponent("lShoulder").controls.ShoulderCtl.parent);c.getRigComponent("head").controls.cTChestCtl.setParent(c.getRigComponent("rShoulder").controls.ShoulderCtl.parent);c.getRigComponent("global").controls.GlobalCtl.setParent(c.getRigComponent("back").controls.cBodyCtl.getParent());for(h=0;h<d.length;h++)c.getRigComponent(d[h]+
"Arm").controls.HandCtl.parent.addSpace(c.getRigComponent("global").controls.GlobalCtl),c.getRigComponent(d[h]+"Arm").controls.HandCtl.parent.addSpace(c.getRigComponent("head").controls.cTChestCtl),c.getRigComponent(d[h]+"Arm").controls.HandCtl.parent.addSpace(c.getRigComponent(d[h]+"Shoulder").controls.ShoulderCtl),c.getRigComponent(d[h]+"Arm").controls.HandCtl.parent.addSpaceswitchChannel(c.getRigComponent(d[h]+"Arm").controls.HandCtl),c.getRigComponent(d[h]+"Arm").controls.ElbowCtl.parent.addSpace(c.getRigComponent("global").controls.GlobalCtl),
c.getRigComponent(d[h]+"Arm").controls.ElbowCtl.parent.addSpace(c.getRigComponent("head").controls.cTChestCtl),c.getRigComponent(d[h]+"Arm").controls.ElbowCtl.parent.addSpace(c.getRigComponent(d[h]+"Shoulder").controls.ShoulderCtl),c.getRigComponent(d[h]+"Arm").controls.ElbowCtl.parent.addSpaceswitchChannel(c.getRigComponent(d[h]+"Arm").controls.ElbowCtl),c.getRigComponent("global").controls.GlobalCtl.setParent(c.getRigComponent(d[h]+"Leg").controls.FootIkCtl.parent),c.getRigComponent("global").controls.GlobalCtl.setParent(c.getRigComponent(d[h]+
"Leg").controls.KneeIkCtl.parent),c.getRigComponent(d[h]+"Leg").controls.KneeIkCtl.parent.addSpace(c.getRigComponent("global").controls.GlobalCtl),c.getRigComponent(d[h]+"Leg").controls.KneeIkCtl.parent.addSpace(c.getRigComponent("back").controls.cBodyCtl);a.controlsVisibility();for(var l,h=0,k=c.models.length;h<k;h++)for(l in c.models[h].addChannel("custom","color"),c.models[h].custom={visibility:c.models[h].visible,color:c.models[h].material.color},b.materials)c.models[h].name===c.namespace+l&&
(c.models[h].material.color=b.materials[l]);a.getUndoDataForAddAsset(c.namespace,"undo")});c.showProgress();return c}console.log("\tNo root data path has been defined.")}};
MM.bipedSelect=function(a,b,c){b.setHeight("331px");var d=new MMUI.Panel;d.setPosition("absolute");b.add(d);b=document.createElement("img");b.src="/ui/tinySelect2.gif";b.width=205;b.height=331;d.dom.appendChild(b);b=new MMUI.Button("");b.setClass("gCtrlButton");b.setPosition("absolute");b.setLeft("95px");b.setBottom("6px");b.onClick(function(){c.selectObjectByName(a+":cGlobalCtl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButton");b.setPosition("absolute");b.setLeft("95px");b.setBottom("84px");
b.onClick(function(){c.selectObjectByName(a+":CcBodyCtl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButtonIk");b.setPosition("absolute");b.setLeft("95px");b.setBottom("110px");b.onClick(function(){c.selectObjectByName(a+":cHipCtl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButtonIk");b.setPosition("absolute");b.setLeft("95px");b.setBottom("158px");b.onClick(function(){c.selectObjectByName(a+":cBChestCtl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButton");b.setPosition("absolute");
b.setLeft("95px");b.setBottom("184px");b.onClick(function(){c.selectObjectByName(a+":cTChestCtl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButton");b.setPosition("absolute");b.setLeft("95px");b.setBottom("245px");b.onClick(function(){c.selectObjectByName(a+":cJawCtl")});d.add(b);b=new MMUI.Button("");b.setClass("cCtrlButtonIk");b.setPosition("absolute");b.setLeft("95px");b.setBottom("265px");b.onClick(function(){c.selectObjectByName(a+":cHeadCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButton");
b.setPosition("absolute");b.setRight("72px");b.setBottom("286px");b.onClick(function(){c.selectObjectByName(a+":lEyeCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");b.setPosition("absolute");b.setLeft("72px");b.setBottom("286px");b.onClick(function(){c.selectObjectByName(a+":rEyeCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButtonIk");b.setPosition("absolute");b.setRight("75px");b.setBottom("238px");b.onClick(function(){c.selectObjectByName(a+":lShoulderCtl")});d.add(b);
b=new MMUI.Button("");b.setClass("lCtrlButton");b.setPosition("absolute");b.setRight("56px");b.setBottom("222px");b.onClick(function(){c.selectObjectByName(a+":lShoulderFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButtonIk");b.setPosition("absolute");b.setLeft("75px");b.setBottom("240px");b.onClick(function(){c.selectObjectByName(a+":rShoulderCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");b.setPosition("absolute");b.setLeft("56px");b.setBottom("222px");b.onClick(function(){c.selectObjectByName(a+
":rShoulderFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButton");b.setPosition("absolute");b.setRight("32px");b.setBottom("222px");b.onClick(function(){c.selectObjectByName(a+":lElbowFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButtonIk");b.setPosition("absolute");b.setRight("4px");b.setBottom("222px");b.onClick(function(){c.selectObjectByName(a+":lElbowCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButton");b.setPosition("absolute");b.setRight("32px");b.setBottom("194px");
b.onClick(function(){c.selectObjectByName(a+":lWristFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButtonIk");b.setPosition("absolute");b.setRight("16px");b.setBottom("194px");b.onClick(function(){c.selectObjectByName(a+":lHandCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButtonSwitch");b.setPosition("absolute");b.setRight("0px");b.setBottom("194px");b.onClick(function(){c.selectObjectByName(a+":lArmSwitch")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButton");b.setPosition("absolute");
b.setRight("32px");b.setBottom("160px");b.onClick(function(){c.selectObjectByName(a+":lFingerCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButton");b.setPosition("absolute");b.setRight("72px");b.setBottom("184px");b.onClick(function(){c.selectObjectByName(a+":lThumbCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");b.setPosition("absolute");b.setLeft("32px");b.setBottom("222px");b.onClick(function(){c.selectObjectByName(a+":rElbowFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButtonIk");
b.setPosition("absolute");b.setLeft("4px");b.setBottom("222px");b.onClick(function(){c.selectObjectByName(a+":rElbowCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");b.setPosition("absolute");b.setLeft("32px");b.setBottom("194px");b.onClick(function(){c.selectObjectByName(a+":rWristFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButtonIk");b.setPosition("absolute");b.setLeft("16px");b.setBottom("194px");b.onClick(function(){c.selectObjectByName(a+":rHandCtl")});d.add(b);b=
new MMUI.Button("");b.setClass("rCtrlButtonSwitch");b.setPosition("absolute");b.setLeft("0px");b.setBottom("194px");b.onClick(function(){c.selectObjectByName(a+":rArmSwitch")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");b.setPosition("absolute");b.setLeft("32px");b.setBottom("160px");b.onClick(function(){c.selectObjectByName(a+":rFingerCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");b.setPosition("absolute");b.setLeft("72px");b.setBottom("184px");b.onClick(function(){c.selectObjectByName(a+
":rThumbCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButtonIk");b.setPosition("absolute");b.setRight("10px");b.setBottom("108px");b.onClick(function(){c.selectObjectByName(a+":lKneeIkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButton");b.setPosition("absolute");b.setRight("40px");b.setBottom("108px");b.onClick(function(){c.selectObjectByName(a+":lKneeFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButton");b.setPosition("absolute");b.setRight("66px");b.setBottom("108px");
b.onClick(function(){c.selectObjectByName(a+":lHipFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButton");b.setPosition("absolute");b.setRight("40px");b.setBottom("84px");b.onClick(function(){c.selectObjectByName(a+":lAnkleFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButtonIk");b.setPosition("absolute");b.setRight("20px");b.setBottom("84px");b.onClick(function(){c.selectObjectByName(a+":lFootIkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButtonSwitch");b.setPosition("absolute");
b.setRight("0px");b.setBottom("84px");b.onClick(function(){c.selectObjectByName(a+":lLegSwitch")});d.add(b);b=new MMUI.Button("");b.setClass("lCtrlButton");b.setPosition("absolute");b.setRight("40px");b.setBottom("48px");b.onClick(function(){c.selectObjectByName(a+":lBallFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButtonIk");b.setPosition("absolute");b.setLeft("10px");b.setBottom("108px");b.onClick(function(){c.selectObjectByName(a+":lKneeIkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");
b.setPosition("absolute");b.setLeft("40px");b.setBottom("108px");b.onClick(function(){c.selectObjectByName(a+":rKneeFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");b.setPosition("absolute");b.setLeft("66px");b.setBottom("108px");b.onClick(function(){c.selectObjectByName(a+":rHipFkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");b.setPosition("absolute");b.setLeft("40px");b.setBottom("84px");b.onClick(function(){c.selectObjectByName(a+":rAnkleFkCtl")});d.add(b);b=
new MMUI.Button("");b.setClass("rCtrlButtonIk");b.setPosition("absolute");b.setLeft("20px");b.setBottom("84px");b.onClick(function(){c.selectObjectByName(a+":rFootIkCtl")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButtonSwitch");b.setPosition("absolute");b.setLeft("0px");b.setBottom("84px");b.onClick(function(){c.selectObjectByName(a+":rLegSwitch")});d.add(b);b=new MMUI.Button("");b.setClass("rCtrlButton");b.setPosition("absolute");b.setLeft("40px");b.setBottom("48px");b.onClick(function(){c.selectObjectByName(a+
":rBallFkCtl")});d.add(b);return d};
MM.bipedKeyAll=function(a,b,c){var d=[a+":cGlobalCtl",a+":CcBodyCtl",a+":cHipCtl",a+":cBChestCtl",a+":cTChestCtl",a+":cHeadCtl",a+":lShoulderFkCtl",a+":lElbowFkCtl",a+":lWristFkCtl",a+":rShoulderFkCtl",a+":rElbowFkCtl",a+":rWristFkCtl",a+":rHipFkCtl",a+":rKneeFkCtl",a+":rAnkleFkCtl",a+":rBallFkCtl",a+":lKneeIkCtl",a+":lFootIkCtl",a+":rKneeIkCtl",a+":rFootIkCtl",a+":lFingerCtl",a+":lThumbCtl",a+":rFingerCtl",a+":rThumbCtl"],e=new MM.AssetKeySelectControls(c);e.setTitle("All").setControls(d);b.add(e.panel);
d=new MM.AssetKeySelectControls(c);d.setTitle("Global").setControls([a+":cGlobalCtl"]);d.setBackgroundColor("#D8D8D8");b.add(d.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Back").setControls([a+":CcBodyCtl",a+":cHipCtl",a+":cBChestCtl",a+":cTChestCtl",a+":cHeadCtl"]);b.add(d.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Left Arm FK").setControls([a+":lShoulderFkCtl",a+":lElbowFkCtl",a+":lWristFkCtl"]);d.setBackgroundColor("#D8D8D8");b.add(d.panel);d=new MM.AssetKeySelectControls(c);
d.setTitle("Right Arm FK").setControls([a+":rShoulderFkCtl",a+":rElbowFkCtl",a+":rWristFkCtl"]);d.setBackgroundColor("#D8D8D8");b.add(d.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Left Arm IK").setControls([a+":lShoulderCtl",a+":lElbowCtl",a+":lHandCtl"]);b.add(d.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Right Arm IK").setControls([a+":rShoulderCtl",a+":rElbowCtl",a+":rHandCtl"]);b.add(d.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Right Leg FK").setControls([a+":rHipFkCtl",
a+":rKneeFkCtl",a+":rAnkleFkCtl",a+":rBallFkCtl"]);d.setBackgroundColor("#D8D8D8");b.add(d.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Left Leg FK").setControls([a+":lHipFkCtl",a+":lKneeFkCtl",a+":lAnkleFkCtl",a+":lBallFkCtl"]);d.setBackgroundColor("#D8D8D8");b.add(d.panel);d=new MM.AssetKeySelectControls(c);d.setTitle("Left Leg IK").setControls([a+":lKneeIkCtl",a+":lFootIkCtl"]);b.add(d.panel);c=new MM.AssetKeySelectControls(c);c.setTitle("Right Leg IK").setControls([a+":rKneeIkCtl",a+
":rFootIkCtl"]);b.add(c.panel);return b};MM.insertMidi=function(a){console.log("insertMidi");var b={namespace:"midi:",name:"midi",control_scale:1,control_distance:1,root_path:"/data/tiny2/",models:{cBody:"model/cBody.obj",cEyes:"model/cEyes.obj",cJoints:"model/cJoints.obj"},joints:{cBody:"skeleton/cRoot_skeleton.json"},skins:{cBody:"weights/cBody_skin.json",cEyes:"weights/cEyes_skin.json",cJoints:"weights/cJoints_skin.json"},materials:{cBody:(new THREE.Color).setRGB(85/255,72/255,68/255),cEyes:(new THREE.Color).setRGB(10/255,10/255,10/255),
cJoints:(new THREE.Color).setRGB(114/255,63/255,55/255)}},c=MM.insertBiped(a,b);c.addPost(function(){var a=c.getControl("cJawCtl");a.controlOffset.y=-2.5;a.controlOffset.z=1.5;a.controlScale.y=.3;c.getRigComponent("head").controls.cHeadCtl.controlScale.y=.5;c.getRigComponent("head").controls.cHeadCtl.controlScale.x=.6;c.getRigComponent("head").controls.cHeadCtl.controlScale.z=.6;c.getRigComponent("head").controls.cHeadCtl.controlOffset.y=4;c.getRigComponent("head").controls.cTChestCtl.controlScale.x=
.1;c.getRigComponent("head").controls.cTChestCtl.controlScale.y=.1;c.getRigComponent("head").controls.cTChestCtl.controlScale.z=.1;c.getRigComponent("head").controls.cTChestCtl.controlOffset.z=2.5;c.getRigComponent("back").controls.cBChestCtl.controlScale.x=.4;c.getRigComponent("back").controls.cBChestCtl.controlScale.y=.125;c.getRigComponent("back").controls.cBChestCtl.controlScale.z=.4;c.getRigComponent("back").controls.cHipCtl.controlScale.x=.625;c.getRigComponent("back").controls.cHipCtl.controlScale.y=
.125;c.getRigComponent("back").controls.cHipCtl.controlScale.z=.625;var a=["l","r"],b;for(b=0;2>b;b++){var f=c.getRigComponent(a[b]+"Shoulder").controls.ShoulderCtl;f.controlOffset.y=1.25;f.controlScale.x=.2;f.controlScale.z=.4;f=c.getRigComponent(a[b]+"Leg").controls.FootIkCtl;f.controlScale.x=1.5;f.controlScale.z=3;f.controlOffset.z=2;c.getRigComponent(a[b]+"Arm").controls.HandCtl.controlShape="planeX";c.getRigComponent(a[b]+"Arm").controls.ArmSwitch.controlOffset.z=-10}});c.build();return c};
MM.midiSelect=function(a,b,c){console.log("midiSelect",a,b,c);return MM.bipedSelect(a,b,c)};MM.midiKeyAll=function(a,b,c){console.log("midiKeyAll",a,b,c);return MM.bipedKeyAll(a,b,c)};MM.insertMini=function(a){console.log("insertMini");var b={namespace:"mini:",name:"mini",control_scale:.5,control_distance:.5,root_path:"/data/baby/",models:{cBody:"model/cBody.obj",cEyes:"model/cEyes.obj",cJoints:"model/cJoints.obj"},joints:{cBody:"skeleton/cRoot_skeleton.json"},skins:{cBody:"weights/cBody_skin.json",cEyes:"weights/cEyes_skin.json",cJoints:"weights/cJoints_skin.json"},materials:{cBody:(new THREE.Color).setRGB(85/255,72/255,68/255),cEyes:(new THREE.Color).setRGB(10/255,10/255,10/
255),cJoints:(new THREE.Color).setRGB(114/255,63/255,55/255)}},c=MM.insertBiped(a,b);c.addPost(function(){var a=c.getControl("cJawCtl");a.controlOffset.y=-1.25;a.controlOffset.z=1.5;a.controlScale.y=.15;c.getRigComponent("head").controls.cHeadCtl.controlScale.y=.5;c.getRigComponent("head").controls.cHeadCtl.controlScale.z=.6;c.getRigComponent("head").controls.cHeadCtl.controlOffset.y=5;c.getRigComponent("head").controls.cTChestCtl.controlScale.x=.1;c.getRigComponent("head").controls.cTChestCtl.controlScale.y=
.1;c.getRigComponent("head").controls.cTChestCtl.controlScale.z=.1;c.getRigComponent("head").controls.cTChestCtl.controlOffset.z=1.5;c.getRigComponent("back").controls.cBChestCtl.controlScale.x=.25;c.getRigComponent("back").controls.cBChestCtl.controlScale.y=.125;c.getRigComponent("back").controls.cBChestCtl.controlScale.z=.25;c.getRigComponent("back").controls.cHipCtl.controlScale.x=.25;c.getRigComponent("back").controls.cHipCtl.controlScale.y=.125;c.getRigComponent("back").controls.cHipCtl.controlScale.z=
.25;c.getRigComponent("back").controls.cBodyCtl.controlScale.x=.5;c.getRigComponent("back").controls.cBodyCtl.controlScale.y=.5;c.getRigComponent("back").controls.cBodyCtl.controlScale.z=.5;c.getRigComponent("global").controls.GlobalCtl.controlScale.x=1.5;c.getRigComponent("global").controls.GlobalCtl.controlScale.z=1.5;c.getRigComponent("global").controls.GlobalCtl.controlOffset.z=.75;var a=["l","r"],b;for(b=0;2>b;b++){var f=c.getRigComponent(a[b]+"Shoulder").controls.ShoulderCtl;f.controlOffset.y=
1;f.controlScale.x=.2;f.controlScale.z=.1;f=c.getRigComponent(a[b]+"Leg").controls.FootIkCtl;f.controlScale.x=2;f.controlScale.z=4.2;f.controlOffset.z=2;c.getRigComponent(a[b]+"Arm").controls.HandCtl.controlShape="planeX";c.getRigComponent(a[b]+"Arm").controls.ArmSwitch.controlOffset.z=-5}});c.build();return c};MM.miniSelect=function(a,b,c){console.log("miniSelect",a,b,c);return MM.bipedSelect(a,b,c)};MM.miniKeyAll=function(a,b,c){console.log("miniKeyAll",a,b,c);return MM.bipedKeyAll(a,b,c)};MM.insertMaxi=function(a){console.log("insertMaxi");var b={namespace:"maxi:",name:"maxi",control_scale:2,control_distance:1,root_path:"/data/maxi/",models:{cBody:"model/cBody.obj",cEyes:"model/cEyes.obj",cJoints:"model/cJoints.obj"},joints:{cBody:"skeleton/cRoot_skeleton.json"},skins:{cBody:"weights/cBody_skin.json",cEyes:"weights/cEyes_skin.json",cJoints:"weights/cJoints_skin.json"},materials:{cBody:(new THREE.Color).setRGB(85/255,72/255,68/255),cEyes:(new THREE.Color).setRGB(10/255,10/255,10/255),
cJoints:(new THREE.Color).setRGB(114/255,63/255,55/255)}},c=MM.insertBiped(a,b);c.addPost(function(){var a=c.getControl("cJawCtl");a.controlOffset.y=-2;a.controlOffset.z=5;a.controlScale.y=.25;c.getRigComponent("head").controls.cHeadCtl.controlScale.y=.6;c.getRigComponent("head").controls.cHeadCtl.controlScale.x=.6;c.getRigComponent("head").controls.cHeadCtl.controlScale.z=.6;c.getRigComponent("head").controls.cHeadCtl.controlOffset.y=4;c.getRigComponent("head").controls.cTChestCtl.controlScale.x=
.3;c.getRigComponent("head").controls.cTChestCtl.controlScale.y=.3;c.getRigComponent("head").controls.cTChestCtl.controlScale.z=.3;c.getRigComponent("head").controls.cTChestCtl.controlOffset.y=1;c.getRigComponent("head").controls.cTChestCtl.controlOffset.z=9;c.getRigComponent("back").controls.cBChestCtl.controlScale.x=.8;c.getRigComponent("back").controls.cBChestCtl.controlScale.y=.25;c.getRigComponent("back").controls.cBChestCtl.controlScale.z=.8;c.getRigComponent("back").controls.cBChestCtl.controlOffset.z=
1.6;c.getRigComponent("back").controls.cHipCtl.controlScale.x=.8;c.getRigComponent("back").controls.cHipCtl.controlScale.y=.25;c.getRigComponent("back").controls.cHipCtl.controlScale.z=.8;c.getRigComponent("back").controls.cHipCtl.controlOffset.z=1.6;c.getRigComponent("back").controls.cBodyCtl.controlScale.x=1.25;c.getRigComponent("back").controls.cBodyCtl.controlScale.y=1.25;c.getRigComponent("back").controls.cBodyCtl.controlScale.z=1.25;c.getRigComponent("global").controls.GlobalCtl.controlScale.x=
1;c.getRigComponent("global").controls.GlobalCtl.controlScale.z=1;var a=["l","r"],b;for(b=0;2>b;b++){var f=c.getRigComponent(a[b]+"Shoulder").controls.ShoulderCtl;f.controlOffset.y=8;f.controlScale.x=.4;f.controlScale.z=.8;f=c.getRigComponent(a[b]+"Leg").controls.FootIkCtl;f.controlScale.x=1.4;f.controlScale.z=2.6;f.controlOffset.z=2.2;f=c.getRigComponent(a[b]+"Arm").controls.HandCtl;f.controlShape="planeX";f.controlScale.x=1.5;f.controlScale.z=1.5;c.getRigComponent(a[b]+"Arm").controls.ArmSwitch.controlOffset.z=
-10}});c.build();return c};MM.maxiSelect=function(a,b,c){console.log("maxiSelect",a,b,c);return MM.bipedSelect(a,b,c)};MM.maxiKeyAll=function(a,b,c){console.log("maxiKeyAll",a,b,c);return MM.bipedKeyAll(a,b,c)};
